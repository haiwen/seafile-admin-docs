{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>Seafile is an open source cloud storage system for file sync, share and document collaboration. SeaDoc is an extension of Seafile that providing a lightweight online collaborative document feature.</p>"},{"location":"#license","title":"LICENSE","text":"<p>The different components of Seafile project are released under different licenses:</p> <ul> <li>Seafile iOS client: Apache License v2</li> <li>Seafile Android client: GPLv3</li> <li>Desktop syncing client: GPLv2</li> <li>Seafile Server core: AGPLv3</li> <li>Seahub (Seafile server Web UI): Apache License v2</li> </ul>"},{"location":"#contact-information","title":"Contact information","text":"<ul> <li>Twitter: @seafile https://twitter.com/seafile</li> <li>Forum: https://forum.seafile.com</li> </ul>"},{"location":"404/","title":"404 - Page Not Found or Remove Permanently","text":"<p>The requested file was not found. If you are still using https://manual.seafile.com/xxx/, please move to https://manual.seafile.com/latest/xxx/ as this path has been deprecated. We apologize for the inconvenience caused.</p>"},{"location":"changelog/","title":"Changelog","text":""},{"location":"changelog/#changelogs","title":"Changelogs","text":"<ul> <li>Seafile Community Edition</li> <li>Seafile Professional Edition</li> <li>Seafile Sync Client</li> <li>Seafile Drive Client (SeaDrive)</li> <li>Seafile Android Client (Seadroid)</li> <li>Seafile iOS Client</li> </ul>"},{"location":"administration/","title":"Administration","text":""},{"location":"administration/#enter-the-admin-panel","title":"Enter the admin panel","text":"<p>As the system admin, you can enter the admin panel by click <code>System Admin</code> in the popup of avatar.</p> <p></p>"},{"location":"administration/#account-management","title":"Account management","text":"<ul> <li>Account management</li> </ul>"},{"location":"administration/#logs","title":"Logs","text":"<ul> <li>The location of log files</li> </ul>"},{"location":"administration/#backup-and-recovery","title":"Backup and Recovery","text":"<p>Backup and recovery:</p> <ul> <li>Backup and recovery</li> </ul> <p>Recover corrupt files after server hard shutdown or system crash:</p> <ul> <li>Seafile FSCK</li> </ul> <p>You can run Seafile GC to remove unused files:</p> <ul> <li>Seafile GC</li> </ul>"},{"location":"administration/#clean-database","title":"Clean database","text":"<ul> <li>Clean database</li> </ul>"},{"location":"administration/#export-report","title":"Export report","text":"<ul> <li>Export report</li> </ul>"},{"location":"administration/account/","title":"Account Management","text":""},{"location":"administration/account/#user-management","title":"User Management","text":"<p>When you setup seahub website, you should have setup a admin account. After you logged in a admin, you may add/delete users and file libraries.</p>"},{"location":"administration/account/#how-to-change-a-users-id","title":"How to change a user's ID","text":"<p>Since version 11.0, if you need to change a user's external ID, you can manually modify database table <code>social_auth_usersocialauth</code> to map the new external ID to internal ID.</p>"},{"location":"administration/account/#resetting-user-password","title":"Resetting User Password","text":"<p>Administrator can reset password for a user in \"System Admin\" page.</p> <p>In a private server, the default settings doesn't support users to reset their password by email. If you want to enable this, you have first to set up notification email.</p>"},{"location":"administration/account/#forgot-admin-account-or-password","title":"Forgot Admin Account or Password?","text":"<p>You may run <code>reset-admin.sh</code> script under seafile-server-latest directory. This script would help you reset the admin account and password. Your data will not be deleted from the admin account, this only unlocks and changes the password for the admin account.</p> <p>Tip</p> <p>Enter into the docker image, then go to <code>/opt/seafile/seafile-server-latest</code></p>"},{"location":"administration/account/#user-quota-notice","title":"User Quota Notice","text":"<p>Under the seafile-server-latest directory, run <code>./seahub.sh python-env python seahub/manage.py check_user_quota</code> , when the user quota exceeds 90%, an email will be sent. If you want to enable this, you have first to set up notification email.</p>"},{"location":"administration/auditing/","title":"Access log and auditing (Pro)","text":"<p>In the Pro Edition, Seafile offers four audit logs in system admin panel:</p> <ul> <li>Login log</li> <li>File access log (including access to shared files)</li> <li>File update log</li> <li>Permission change log</li> </ul> <p></p> <p>The audit log data is saved in <code>seahub_db</code>.</p>"},{"location":"administration/backup_recovery/","title":"Backup and Recovery","text":""},{"location":"administration/backup_recovery/#overview","title":"Overview","text":"<p>There are generally two parts of data to backup</p> <ul> <li>Seafile library data</li> <li>Databases</li> </ul> <p>There are 3 databases:</p> <ul> <li>ccnet_db: contains user and group information</li> <li>seafile_db: contains library metadata</li> <li>seahub_db: contains tables used by the web front end (seahub)</li> </ul>"},{"location":"administration/backup_recovery/#backup-steps","title":"Backup steps","text":"<p>The backup is a two step procedure:</p> <ol> <li>Backup the databases;</li> <li>Backup the seafile data directory;</li> </ol>"},{"location":"administration/backup_recovery/#backup-order-database-first-or-data-directory-first","title":"Backup Order: Database First or Data Directory First","text":"<ul> <li>backup data directory first, SQL later: When you're backing up data directory, some new objects are written and they're not backed up. Those new objects may be referenced in SQL database. So when you restore, some records in the database cannot find its object. So the library is corrupted.</li> <li>backup SQL first, data directory later: Since you backup database first, all records in the database have valid objects to be referenced. So the libraries won't be corrupted. But new objects written to storage when you're backing up are not referenced by database records. So some libraries are out of date. When you restore, some new data are lost.</li> </ul> <p>The second sequence is better in the sense that it avoids library corruption. Like other backup solutions, some new data can be lost in recovery. There is always a backup window. However, if your storage backup mechanism can finish quickly enough, using the first sequence can retain more data.</p> <p>We assume your seafile data directory is in <code>/opt/seafile</code> for binary package based deployment (or <code>/opt/seafile-data</code> for docker based deployment). And you want to backup to <code>/backup</code> directory. The <code>/backup</code> can be an NFS or Windows share mount exported by another machine, or just an external disk. You can create a layout similar to the following in <code>/backup</code> directory:</p> <pre><code>/backup\n---- databases/  contains database backup files\n---- data/  contains backups of the data directory\n</code></pre>"},{"location":"administration/backup_recovery/#backup-and-restore-for-binary-package-based-deployment","title":"Backup and restore for binary package based deployment","text":""},{"location":"administration/backup_recovery/#backing-up-databases","title":"Backing up Databases","text":"<p>It's recommended to backup the database to a separate file each time. Don't overwrite older database backups for at least a week.</p> <p>Assume your database names are <code>ccnet_db</code>, <code>seafile_db</code> and <code>seahub_db</code>. mysqldump automatically locks the tables so you don't need to stop Seafile server when backing up MySQL databases. Since the database tables are usually very small, it won't take long to dump.</p> <pre><code>mysqldump -h [mysqlhost] -u[username] -p[password] --opt ccnet_db &gt; /backup/databases/ccnet_db.sql.`date +\"%Y-%m-%d-%H-%M-%S\"`\n\nmysqldump -h [mysqlhost] -u[username] -p[password] --opt seafile_db &gt; /backup/databases/seafile_db.sql.`date +\"%Y-%m-%d-%H-%M-%S\"`\n\nmysqldump -h [mysqlhost] -u[username] -p[password] --opt seahub_db &gt; /backup/databases/seahub_db.sql.`date +\"%Y-%m-%d-%H-%M-%S\"`\n</code></pre> <p><code>mysqldump</code>: command not found</p> <p>You may encounter this problem on some machines with a minimal (from 10.5) or a newer (from 11.0) Mariadb server installed, of which the <code>mysql*</code> series of commands have been gradually deprecated. If you encounter this error, use the <code>mariadb-dump</code> command, such as:</p> <pre><code>mariadb-dump -h [mysqlhost] -u[username] -p[password] --opt ccnet_db &gt; /backup/databases/ccnet_db.sql.`date +\"%Y-%m-%d-%H-%M-%S\"`\n\nmariadb-dump -h [mysqlhost] -u[username] -p[password] --opt seafile_db &gt; /backup/databases/seafile_db.sql.`date +\"%Y-%m-%d-%H-%M-%S\"`\n\nmariadb-dump -h [mysqlhost] -u[username] -p[password] --opt seahub_db &gt; /backup/databases/seahub_db.sql.`date +\"%Y-%m-%d-%H-%M-%S\"`\n</code></pre>"},{"location":"administration/backup_recovery/#backing-up-seafile-library-data","title":"Backing up Seafile library data","text":"<p>The data files are all stored in the <code>/opt/seafile</code> directory, so just back up the whole directory. You can directly copy the whole directory to the backup destination, or you can use rsync to do incremental backup. </p> <p>To directly copy the whole data directory,</p> <pre><code>cp -R /opt/seafile /backup/data/seafile-`date +\"%Y-%m-%d-%H-%M-%S\"`\n</code></pre> <p>This produces a separate copy of the data directory each time. You can delete older backup copies after a new one is completed.</p> <p>If you have a lot of data, copying the whole data directory would take long. You can use rsync to do incremental backup.</p> <pre><code>rsync -az /opt/seafile /backup/data\n</code></pre> <p>This command backup the data directory to <code>/backup/data/seafile</code>.</p>"},{"location":"administration/backup_recovery/#restore-from-backup","title":"Restore from backup","text":"<p>Now supposed your primary seafile server is broken, you're switching to a new machine. Using the backup data to restore your Seafile instance:</p> <ol> <li>Copy <code>/backup/data/seafile</code> to the new machine. Let's assume the seafile deployment location new machine is also <code>/opt/seafile</code>.</li> <li>Restore the database.</li> <li>Since database and data are backed up separately, they may become a little inconsistent with each other. To correct the potential inconsistency, run seaf-fsck tool to check data integrity on the new machine. See seaf-fsck documentation.</li> </ol>"},{"location":"administration/backup_recovery/#restore-the-databases","title":"Restore the databases","text":"<p>Now with the latest valid database backup files at hand, you can restore them.</p> <pre><code>mysql -u[username] -p[password] ccnet_db &lt; ccnet_db.sql.2013-10-19-16-00-05\nmysql -u[username] -p[password] seafile_db &lt; seafile_db.sql.2013-10-19-16-00-20\nmysql -u[username] -p[password] seahub_db &lt; seahub_db.sql.2013-10-19-16-01-05\n</code></pre> <p><code>mysql</code>: command not found</p> <p>You may encounter this problem on some machines with a minimal (from 10.5) or a newer (from 11.0) Mariadb server installed, of which the <code>mysql*</code> series of commands have been gradually deprecated. If you encounter this error, use the <code>mariadb</code> command, such as:</p> <pre><code>mariadb -u[username] -p[password] ccnet_db &lt; ccnet_db.sql.2013-10-19-16-00-05\nmariadb -u[username] -p[password] seafile_db &lt; seafile_db.sql.2013-10-19-16-00-20\nmariadb -u[username] -p[password] seahub_db &lt; seahub_db.sql.2013-10-19-16-01-05\n</code></pre>"},{"location":"administration/backup_recovery/#backup-and-restore-for-docker-based-deployment","title":"Backup and restore for Docker based deployment","text":""},{"location":"administration/backup_recovery/#structure","title":"Structure","text":"<p>We assume your seafile volumns path is in <code>/opt/seafile-data</code>. And you want to backup to <code>/backup</code> directory.</p> <p>The data files to be backed up:</p> <pre><code>/opt/seafile-data/seafile/conf  # configuration files\n/opt/seafile-data/seafile/seafile-data # data of seafile\n/opt/seafile-data/seafile/seahub-data # data of seahub\n</code></pre>"},{"location":"administration/backup_recovery/#backing-up-database","title":"Backing up Database","text":"<pre><code># It's recommended to backup the database to a separate file each time. Don't overwrite older database backups for at least a week.\ncd /backup/databases\ndocker exec -it seafile-mysql mariadb-dump  -u[username] -p[password] --opt ccnet_db &gt; ccnet_db.sql\ndocker exec -it seafile-mysql mariadb-dump  -u[username] -p[password] --opt seafile_db &gt; seafile_db.sql\ndocker exec -it seafile-mysql mariadb-dump  -u[username] -p[password] --opt seahub_db &gt; seahub_db.sql\n</code></pre> <p>Tip</p> <p>The default image of database is Mariadb 10.11 from Seafile 12, you may not be able to find these commands in the container (such as <code>mysqldump: command not found</code>), since commands of <code>mysql*</code> series have been gradually deprecated. So we recommend that you use the <code>mariadb*</code> series of commands. </p> <p>However, if you still use the MySQL docker image, you should continue to use <code>mysqldump</code> here:</p> <pre><code>docker exec -it seafile-mysql mysqldump  -u[username] -p[password] --opt ccnet_db &gt; ccnet_db.sql\ndocker exec -it seafile-mysql mysqldump  -u[username] -p[password] --opt seafile_db &gt; seafile_db.sql\ndocker exec -it seafile-mysql mysqldump  -u[username] -p[password] --opt seahub_db &gt; seahub_db.sql\n</code></pre>"},{"location":"administration/backup_recovery/#backing-up-seafile-library-data_1","title":"Backing up Seafile library data","text":""},{"location":"administration/backup_recovery/#to-directly-copy-the-whole-data-directory","title":"To directly copy the whole data directory","text":"<pre><code>cp -R /opt/seafile-data/seafile /backup/data/\n</code></pre>"},{"location":"administration/backup_recovery/#use-rsync-to-do-incremental-backup","title":"Use rsync to do incremental backup","text":"<pre><code>rsync -az /opt/seafile-data/seafile /backup/data/\n</code></pre>"},{"location":"administration/backup_recovery/#recovery","title":"Recovery","text":""},{"location":"administration/backup_recovery/#restore-the-databases_1","title":"Restore the databases","text":"<pre><code>docker cp /backup/databases/ccnet_db.sql seafile-mysql:/tmp/ccnet_db.sql\ndocker cp /backup/databases/seafile_db.sql seafile-mysql:/tmp/seafile_db.sql\ndocker cp /backup/databases/seahub_db.sql seafile-mysql:/tmp/seahub_db.sql\n\ndocker exec -it seafile-mysql /bin/sh -c \"mariadb -u[username] -p[password] ccnet_db &lt; /tmp/ccnet_db.sql\"\ndocker exec -it seafile-mysql /bin/sh -c \"mariadb -u[username] -p[password] seafile_db &lt; /tmp/seafile_db.sql\"\ndocker exec -it seafile-mysql /bin/sh -c \"mariadb -u[username] -p[password] seahub_db &lt; /tmp/seahub_db.sql\"\n</code></pre> <p>Tip</p> <p>The default image of database is Mariadb 10.11 from Seafile 12, you may not be able to find these commands in the container (such as <code>mysql: command not found</code>), since commands of <code>mysql*</code> series have been gradually deprecated. So we recommend that you use the <code>mariadb*</code> series of commands. </p> <p>However, if you still use the MySQL docker image, you should continue to use <code>mysql</code> here:</p> <pre><code>docker exec -it seafile-mysql /bin/sh -c \"mysql -u[username] -p[password] ccnet_db &lt; /tmp/ccnet_db.sql\"\ndocker exec -it seafile-mysql /bin/sh -c \"mysql -u[username] -p[password] seafile_db &lt; /tmp/seafile_db.sql\"\ndocker exec -it seafile-mysql /bin/sh -c \"mysql -u[username] -p[password] seahub_db &lt; /tmp/seahub_db.sql\"\n</code></pre>"},{"location":"administration/backup_recovery/#restore-the-seafile-data","title":"Restore the seafile data","text":"<pre><code>cp -R /backup/data/* /opt/seafile-data/seafile/\n</code></pre>"},{"location":"administration/clean_database/","title":"Clean Database","text":""},{"location":"administration/clean_database/#session","title":"Session","text":"<p>Use the following command to clear expired session records in Seahub database:</p> <pre><code>cd seafile-server-latest\n./seahub.sh python-env python3 seahub/manage.py clearsessions\n</code></pre> <p>Tip</p> <p>Enter into the docker image, then go to <code>/opt/seafile/seafile-server-latest</code></p>"},{"location":"administration/clean_database/#use-clean_db_records-command-to-clean-seahub_db","title":"Use clean_db_records command to clean seahub_db","text":"<p>Use the following command to simultaneously clean up table records of Activity, sysadmin_extra_userloginlog, FileAudit, FileUpdate, FileHistory, PermAudit, FileTrash 90 days ago:</p> <pre><code>./seahub.sh python-env python3 seahub/manage.py clean_db_records\n</code></pre> <p>You can also clean these tables manually if you like as following.</p>"},{"location":"administration/clean_database/#activity","title":"Activity","text":"<p>Use the following command to clear the activity records:</p> <pre><code>use seahub_db;\nDELETE FROM Activity WHERE to_days(now()) - to_days(timestamp) &gt; 90;\nDELETE FROM UserActivity WHERE to_days(now()) - to_days(timestamp) &gt; 90;\n</code></pre>"},{"location":"administration/clean_database/#login","title":"Login","text":"<p>Use the following command to clean the login records:</p> <pre><code>use seahub_db;\nDELETE FROM sysadmin_extra_userloginlog WHERE to_days(now()) - to_days(login_date) &gt; 90;\n</code></pre>"},{"location":"administration/clean_database/#file-access","title":"File Access","text":"<p>Use the following command to clean the file access records:</p> <pre><code>use seahub_db;\nDELETE FROM FileAudit WHERE to_days(now()) - to_days(timestamp) &gt; 90;\n</code></pre>"},{"location":"administration/clean_database/#file-update","title":"File Update","text":"<p>Use the following command to clean the file update records:</p> <pre><code>use seahub_db;\nDELETE FROM FileUpdate WHERE to_days(now()) - to_days(timestamp) &gt; 90;\n</code></pre>"},{"location":"administration/clean_database/#permisson","title":"Permisson","text":"<p>Use the following command to clean the permission change audit records:</p> <pre><code>use seahub_db;\nDELETE FROM PermAudit WHERE to_days(now()) - to_days(timestamp) &gt; 90;\n</code></pre>"},{"location":"administration/clean_database/#file-history","title":"File History","text":"<p>Use the following command to clean the file history records:</p> <pre><code>use seahub_db;\nDELETE FROM FileHistory WHERE to_days(now()) - to_days(timestamp) &gt; 90;\n</code></pre>"},{"location":"administration/clean_database/#clean-outdated-library-data","title":"Clean outdated library data","text":"<p>Since version 6.2, we offer command to clear outdated library records in Seafile database, e.g. records that are not deleted after a library is deleted. This is because users can restore a deleted library, so we can't delete these records at library deleting time.</p> <pre><code>./seahub.sh python-env python3 seahub/manage.py clear_invalid_repo_data\n</code></pre> <p>This command has been improved in version 10.0, including:</p> <ol> <li> <p>It will clear the invalid data in small batch, avoiding consume too much database resource in a short time.</p> </li> <li> <p>Dry-run mode: if you just want to see how much invalid data can be deleted without actually deleting any data, you can use the dry-run option, e.g.</p> </li> </ol> <pre><code>./seahub.sh python-env python3 seahub/manage.py clear_invalid_repo_data --dry-run=true\n</code></pre>"},{"location":"administration/clean_database/#clean-library-sync-tokens","title":"Clean library sync tokens","text":"<p>There are two tables in Seafile db that are related to library sync tokens.</p> <ul> <li>RepoUserToken contains the authentication tokens used for library syncing. Note that a separate token is created for every client (including sync client and SeaDrive.)</li> <li>RepoTokenPeerInfo contains more information about each client token, such as client name, IP address, last sync time etc.</li> </ul> <p>When you have many sync clients connected to the server, these two tables can have large number of rows. Many of them are no longer actively used. You may clean the tokens that are not used in a recent period, by the following SQL query:</p> <pre><code>delete t,i from RepoUserToken t, RepoTokenPeerInfo i where t.token=i.token and sync_time &lt; xxxx;\n</code></pre> <p>xxxx is the UNIX timestamp for the time before which tokens will be deleted.</p> <p>To be safe, you can first check how many tokens will be removed:</p> <pre><code>select * from RepoUserToken t, RepoTokenPeerInfo i where t.token=i.token and sync_time &lt; xxxx;\n</code></pre>"},{"location":"administration/export_report/","title":"Export Report","text":"<p>Since version 7.0.8 pro, Seafile provides commands to export reports via command line.</p> <p>Tip</p> <p>Enter into the docker image, then go to <code>/opt/seafile/seafile-server-latest</code></p>"},{"location":"administration/export_report/#export-user-traffic-report","title":"Export User Traffic Report","text":"<pre><code>cd seafile-server-latest\n./seahub.sh python-env python3 seahub/manage.py export_user_traffic_report --date 201906\n</code></pre>"},{"location":"administration/export_report/#export-user-storage-report","title":"Export User Storage Report","text":"<pre><code>cd seafile-server-latest\n./seahub.sh python-env python3 seahub/manage.py export_user_storage_report\n</code></pre>"},{"location":"administration/export_report/#export-file-access-log","title":"Export File Access Log","text":"<pre><code>cd seafile-server-latest\n./seahub.sh python-env python3 seahub/manage.py export_file_access_log --start-date 2019-06-01 --end-date 2019-07-01\n</code></pre>"},{"location":"administration/logs/","title":"Seafile server logs","text":""},{"location":"administration/logs/#log-files-of-seafile-server","title":"Log files of seafile server","text":"<ul> <li>seafile.log: logs of seaf-server</li> <li>seahub.log: logs from Django framework</li> <li>fileserver.log: logs of the golang file server component</li> <li>seafevents.log: logs for background tasks and office file conversion</li> <li>seahub_email_sender.log: logs for periodically email sending of background tasks</li> </ul>"},{"location":"administration/logs/#log-files-for-seafile-background-node-in-cluster-mode","title":"Log files for seafile background node in cluster mode","text":"<ul> <li>seafile.log: logs of seaf-server</li> <li>seafevents.log: Empty</li> <li>seafile-background-tasks.log: logs for background tasks and office file convertion</li> <li>seahub_email_sender.log: logs for periodically email sending of background tasks</li> </ul>"},{"location":"administration/seafile_fsck/","title":"Seafile FSCK","text":"<p>On the server side, Seafile stores the files in the libraries in an internal format. Seafile has its own representation of directories and files (similar to Git).</p> <p>With default installation, these internal objects are stored in the server's file system directly (such as Ext4, NTFS). But most file systems don't assure the integrity of file contents after a hard shutdown or system crash. So if new Seafile internal objects are being written when the system crashes, they can be corrupt after the system reboots. This will make part of the corresponding library not accessible.</p> <p>Warning</p> <p>If you store the seafile-data directory in a battery-backed NAS (like EMC or NetApp), or use S3 backend available in the Pro edition, the internal objects won't be corrupt.</p> <p>Note</p> <p>If your Seafile server is deployed with Docker, make sure you have enter the container before executing the following commands in this manual:</p> <pre><code>docker exec -it seafile bash\n</code></pre> <p>This is also required for the other scripts in this document.</p> <p>We provide a seaf-fsck.sh script to check the integrity of libraries. The seaf-fsck tool accepts the following arguments:</p> <pre><code>cd /opt/seafile/seafile-server-latest\n./seaf-fsck.sh [--repair|-r] [--export|-E export_path] [repo_id_1 [repo_id_2 ...]]\n</code></pre> <p>There are three modes of operation for seaf-fsck:</p> <ol> <li>checking integrity of libraries.</li> <li>repairing corrupted libraries.</li> <li>exporting libraries.</li> </ol>"},{"location":"administration/seafile_fsck/#checking-integrity-of-libraries","title":"Checking Integrity of Libraries","text":"<p>Running seaf-fsck.sh without any arguments will run a read-only integrity check for all libraries.</p> <pre><code>./seaf-fsck.sh\n</code></pre> <p>If you want to check integrity for specific libraries, just append the library id's as arguments:</p> <pre><code>./seaf-fsck.sh [library-id1] [library-id2] ...\n</code></pre> <p>The output looks like:</p> <pre><code>[02/13/15 16:21:07] fsck.c(470): Running fsck for repo ca1a860d-e1c1-4a52-8123-0bf9def8697f.\n[02/13/15 16:21:07] fsck.c(413): Checking file system integrity of repo fsck(ca1a860d)...\n[02/13/15 16:21:07] fsck.c(35): Dir 9c09d937397b51e1283d68ee7590cd9ce01fe4c9 is missing.\n[02/13/15 16:21:07] fsck.c(200): Dir /bf/pk/(9c09d937) is corrupted.\n[02/13/15 16:21:07] fsck.c(105): Block 36e3dd8757edeb97758b3b4d8530a4a8a045d3cb is corrupted.\n[02/13/15 16:21:07] fsck.c(178): File /bf/02.1.md(ef37e350) is corrupted.\n[02/13/15 16:21:07] fsck.c(85): Block 650fb22495b0b199cff0f1e1ebf036e548fcb95a is missing.\n[02/13/15 16:21:07] fsck.c(178): File /01.2.md(4a73621f) is corrupted.\n[02/13/15 16:21:07] fsck.c(514): Fsck finished for repo ca1a860d.\n</code></pre> <p>The corrupted files and directories are reported in the above message. By the way, you may also see output like the following:</p> <pre><code>[02/13/15 16:36:11] Commit 6259251e2b0dd9a8e99925ae6199cbf4c134ec10 is missing\n[02/13/15 16:36:11] fsck.c(476): Repo ca1a860d HEAD commit is corrupted, need to restore to an old version.\n[02/13/15 16:36:11] fsck.c(314): Scanning available commits...\n[02/13/15 16:36:11] fsck.c(376): Find available commit 1b26b13c(created at 2015-02-13 16:10:21) for repo ca1a860d.\n</code></pre> <p>This means the head commit (current state of the library) recorded in database is not consistent with the library data. In such case, fsck will try to find the last consistent state and check the integrity in that state.</p> <p>Tip</p> <p>If you have many libraries, it's helpful to save the fsck output into a log file for later analysis.</p>"},{"location":"administration/seafile_fsck/#repairing-corruption","title":"Repairing Corruption","text":"<p>Corruption repair in seaf-fsck basically works in two steps:</p> <ol> <li>If the library state (commit) recorded in database is not found in data directory, find the last available state from data directory.</li> <li>Check data integrity in that specific state. If files or directories are corrupted, set them to empty files or empty directories. The corrupted paths will be reported, so that the user can recover them from somewhere else.</li> </ol> <p>Running the following command repairs all the libraries:</p> <pre><code>./seaf-fsck.sh --repair\n</code></pre> <p>Most of time you run the read-only integrity check first, to find out which libraries are corrupted. And then you repair specific libraries with the following command:</p> <pre><code>./seaf-fsck.sh --repair [library-id1] [library-id2] ...\n</code></pre> <p>After repairing, in the library history, seaf-fsck includes the list of files and folders that are corrupted. So it's much easier to located corrupted paths.</p>"},{"location":"administration/seafile_fsck/#best-practice-for-repairing-a-library","title":"Best Practice for Repairing a Library","text":"<p>To check all libraries and find out which library is corrupted, the system admin can run seaf-fsck.sh without any argument and save the output to a log file. Search for keyword \"Fail\" in the log file to locate corrupted libraries. You can run seaf-fsck to check all libraries when your Seafile server is running. It won't damage or change any files.</p> <p>When the system admin find a library is corrupted, he/she should run seaf-fsck.sh with \"--repair\" for the library. After the command fixes the library, the admin should inform user to recover files from other places. There are two ways:</p> <ul> <li>Upload corrupted files or folders via the web interface</li> <li>If the library was synced to some desktop computer, and that computer has a correct version of the corrupted file, resyncing the library on that computer will upload the corrupted files to the server.</li> </ul>"},{"location":"administration/seafile_fsck/#speeding-up-fsck-by-not-checking-file-contents","title":"Speeding up FSCK by not checking file contents","text":"<p>Starting from Pro edition 7.1.5, an option is added to speed up FSCK. Most of the running time of seaf-fsck is spent on calculating hashes for file contents. This hash will be compared with block object ID. If they're not consistent, the block is detected as corrupted.</p> <p>In many cases, the file contents won't be corrupted most of time. Some objects are just missing from the system. So it's enough to only check for object existence. This will greatly speed up the fsck process.</p> <p>To skip checking file contents, add the <code>--shallow</code> or <code>-s</code> option to seaf-fsck.</p>"},{"location":"administration/seafile_fsck/#exporting-libraries-to-file-system","title":"Exporting Libraries to File System","text":"<p>You can use seaf-fsck to export all the files in libraries to external file system (such as Ext4). This procedure doesn't rely on the seafile database. As long as you have your seafile-data directory, you can always export your files from Seafile to external file system. The command about this operation is</p> <pre><code>./seaf-fsck.sh --export top_export_path [library-id1] [library-id2] ...\n</code></pre> <p>The argument <code>top_export_path</code> is a directory to place the exported files. Each library will be exported as a sub-directory of the export path. If you don't specify library ids, all libraries will be exported.</p> <p>Note</p> <p>Currently only un-encrypted libraries can be exported. Encrypted libraries will be skipped.</p>"},{"location":"administration/seafile_fsck/#checking-file-size","title":"Checking file size","text":"<p>Starting from version 13.0.9, fsck has added an option to check whether the file size matches the actual file content. Some problematic clients may upload incorrect blocks, causing the actual file size to not match the file content. With this option, you can detect files with size mismatches, along with the method and time of their upload.</p> <p>To check whether the file size matches, add the <code>--check-file-size</code> or <code>-S</code> option to seaf-fsck.</p>"},{"location":"administration/seafile_gc/","title":"Seafile GC","text":"<p>Seafile uses storage de-duplication technology to reduce storage usage. The underlying data blocks will not be removed immediately after you delete a file or a library. As a result, the number of unused data blocks will increase on Seafile server.</p> <p>To release the storage space occupied by unused blocks, you have to run a \"garbage collection\" program to clean up unused blocks on your server.</p> <p>The GC program cleans up two types of unused blocks:</p> <ol> <li>Blocks that no library references to, that is, the blocks belong to deleted libraries;</li> <li>If you set history length limit on some libraries, the out-dated blocks in those libraries will also be removed.</li> </ol>"},{"location":"administration/seafile_gc/#run-gc","title":"Run GC","text":"<p>Note</p> <p>If your Seafile server is deployed with Docker, make sure you have enter the container before executing the script:</p> <pre><code>docker exec -it seafile bash\n</code></pre> <p>For all scripts in this document, is located in <code>/opt/seafile/seafile-server-latest</code>:</p> <pre><code>cd `/opt/seafile/seafile-server-latest # valid both Docker-base Seafile and binary-package-base Seafile\n</code></pre> <p>This is also required for the other scripts in this document.</p>"},{"location":"administration/seafile_gc/#dry-run-mode","title":"Dry-run Mode","text":"<p>To see how much garbage can be collected without actually removing any garbage, use the dry-run option:</p> <pre><code>./seaf-gc.sh --dry-run [repo-id1] [repo-id2] ...\n</code></pre> <p>The output should look like:</p> <pre><code>[03/19/15 19:41:49] seafserv-gc.c(115): GC version 1 repo My Library(ffa57d93)\n[03/19/15 19:41:49] gc-core.c(394): GC started. Total block number is 265.\n[03/19/15 19:41:49] gc-core.c(75): GC index size is 1024 Byte.\n[03/19/15 19:41:49] gc-core.c(408): Populating index.\n[03/19/15 19:41:49] gc-core.c(262): Populating index for repo ffa57d93.\n[03/19/15 19:41:49] gc-core.c(308): Traversed 5 commits, 265 blocks.\n[03/19/15 19:41:49] gc-core.c(440): Scanning unused blocks.\n[03/19/15 19:41:49] gc-core.c(472): GC finished. 265 blocks total, about 265 reachable blocks, 0 blocks can be removed.\n\n[03/19/15 19:41:49] seafserv-gc.c(115): GC version 1 repo aa(f3d0a8d0)\n[03/19/15 19:41:49] gc-core.c(394): GC started. Total block number is 5.\n[03/19/15 19:41:49] gc-core.c(75): GC index size is 1024 Byte.\n[03/19/15 19:41:49] gc-core.c(408): Populating index.\n[03/19/15 19:41:49] gc-core.c(262): Populating index for repo f3d0a8d0.\n[03/19/15 19:41:49] gc-core.c(308): Traversed 8 commits, 5 blocks.\n[03/19/15 19:41:49] gc-core.c(264): Populating index for sub-repo 9217622a.\n[03/19/15 19:41:49] gc-core.c(308): Traversed 4 commits, 4 blocks.\n[03/19/15 19:41:49] gc-core.c(440): Scanning unused blocks.\n[03/19/15 19:41:49] gc-core.c(472): GC finished. 5 blocks total, about 9 reachable blocks, 0 blocks can be removed.\n\n[03/19/15 19:41:49] seafserv-gc.c(115): GC version 1 repo test2(e7d26d93)\n[03/19/15 19:41:49] gc-core.c(394): GC started. Total block number is 507.\n[03/19/15 19:41:49] gc-core.c(75): GC index size is 1024 Byte.\n[03/19/15 19:41:49] gc-core.c(408): Populating index.\n[03/19/15 19:41:49] gc-core.c(262): Populating index for repo e7d26d93.\n[03/19/15 19:41:49] gc-core.c(308): Traversed 577 commits, 507 blocks.\n[03/19/15 19:41:49] gc-core.c(440): Scanning unused blocks.\n[03/19/15 19:41:49] gc-core.c(472): GC finished. 507 blocks total, about 507 reachable blocks, 0 blocks can be removed.\n\n[03/19/15 19:41:50] seafserv-gc.c(124): === Repos deleted by users ===\n[03/19/15 19:41:50] seafserv-gc.c(145): === GC is finished ===\n\n[03/19/15 19:41:50] Following repos have blocks to be removed:\nrepo-id1\nrepo-id2\nrepo-id3\n</code></pre> <p>If you give specific library ids, only those libraries will be checked; otherwise all libraries will be checked.</p> <p>repos have blocks to be removed</p> <p>Notice that at the end of the output there is a \"repos have blocks to be removed\" section. It contains the list of libraries that have garbage blocks. Later when you run GC without --dry-run option, you can use these libraris ids as input arguments to GC program.</p>"},{"location":"administration/seafile_gc/#removing-garbage","title":"Removing Garbage","text":"<p>To actually remove garbage blocks, run without the --dry-run option:</p> <pre><code>./seaf-gc.sh [repo-id1] [repo-id2] ...\n</code></pre> <p>If libraries ids are specified, only those libraries will be checked for garbage.</p> <p>As described before, there are two types of garbage blocks to be removed. Sometimes just removing the first type of blocks (those that belong to deleted libraries) is good enough. In this case, the GC program won't bother to check the libraries for outdated historic blocks. The \"-r\" option implements this feature:</p> <pre><code>./seaf-gc.sh -r\n</code></pre> <p>Success</p> <p>Libraries deleted by the users are not immediately removed from the system. Instead, they're moved into a \"trash\" in the system admin page. Before they're cleared from the trash, their blocks won't be garbage collected.</p>"},{"location":"administration/seafile_gc/#removing-fs-objects","title":"Removing FS objects","text":"<p>Since Pro server 8.0.6 and community edition 9.0, you can remove garbage fs objects. It should be run without the --dry-run option:</p> <pre><code>./seaf-gc.sh --rm-fs\n</code></pre> <p>Bug reports</p> <p>This command has bug before Pro Edition 10.0.15 and Community Edition 11.0.7. It could cause virtual libraries (e.g. shared folders) failing to merge into their parent libraries. Please avoid using this option in the affected versions. Please contact our support team if you are affected by this bug.</p>"},{"location":"administration/seafile_gc/#using-multiple-threads-in-gc","title":"Using Multiple Threads in GC","text":"<p>You can specify the thread number in GC. By default,</p> <ul> <li>If storage backend is S3/Swift/Ceph, 10 threads are started to do the GC work.</li> <li>If storage backend is file system, only 1 thread is started.</li> </ul> <p>You can specify the thread number in with \"-t\" option. \"-t\" option can be used together with all other options. Each thread will do GC on one library. For example, the following command will use 20 threads to GC all libraries:</p> <pre><code>./seaf-gc.sh -t 20\n</code></pre> <p>Since the threads are concurrent, the output of each thread may mix with each others. Library ID is printed in each line of output.</p>"},{"location":"administration/seafile_gc/#run-gc-based-on-library-id-prefix","title":"Run GC based on library ID prefix","text":"<p>Since GC usually runs quite slowly as it needs to traverse the entire library history. You can use multiple threads to run GC in parallel. For even larger deployments, it's also desirable to run GC on multiple server in parallel.</p> <p>A simple pattern to divide the workload among multiple GC servers is to assign libraries to servers based on library ID. Since Pro edition 7.1.5, this is supported. You can add \"--id-prefix\" option to seaf-gc.sh, to specify the library ID prefix. For example, the below command will only process libraries having \"a123\" as ID prefix.</p> <pre><code>./seaf-gc.sh --id-prefix a123\n</code></pre>"},{"location":"administration/security_features/","title":"Security Questions","text":""},{"location":"administration/security_features/#how-is-the-connection-between-client-and-server-encrypted","title":"How is the connection between client and server encrypted?","text":"<p>Seafile uses HTTP(S) to syncing files between client and server (Since version 4.1.0).</p>"},{"location":"administration/security_features/#encrypted-library","title":"Encrypted Library","text":"<p>Seafile provides a feature called encrypted library to protect your privacy. The file encryption/decryption is performed on client-side when using the desktop client for file synchronization. The password of an encrypted library is not stored on the server. Even the system admin of the server can't view the file contents.</p> <p>There are a few limitation about this feature:</p> <ol> <li>File metadata is NOT encrypted. The metadata includes: the complete list of directory and file names, every files size, the history of editors, when, and what byte ranges were altered.</li> <li>The client side encryption does currently NOT work while using the web browser and the cloud file explorer of the desktop client. When you are browsing encrypted libraries via the web browser or the cloud file explorer, you need to input the password and the server is going to use the password to decrypt the \"file key\" for the library (see description below) and cache the password in memory for one hour. The plain text password is never stored or cached on the server.</li> <li>If you create an encrypted library on the web interface, the library password and encryption keys will pass through the server. If you want end-to-end protection, you should create encrypted libraries from desktop client only.</li> <li>For encryption protocol version 4, each library use its own salt to derive key/iv pairs. However, all files within a library shares the same salt. Likewise, all the files within a library are encrypted with the same key/iv pair. With encryption protocol version 2, all libraries use the same salt, but separate key/iv pairs.</li> <li>Encrypted library doesn't ensure file integrity. For example, the server admin can still partially change the contents of files in an encrypted library. The client is not able to detect such changes to contents.</li> </ol> <p>The client side encryption works on iOS client since version 2.1.6. The Android client support client side encryption since version 2.1.0. But since version 3.0.0, the iOS and Android clients drop support for client side encryptioin. You need to send the password to the server to encrypt/decrypt files.</p>"},{"location":"administration/security_features/#how-does-an-encrypted-library-work","title":"How does an encrypted library work?","text":"<p>When you create an encrypted library, you'll need to provide a password for it. All the data in that library will be encrypted with the password before uploading it to the server (see limitations above).</p>"},{"location":"administration/security_features/#encryptiondecryption-procedure","title":"Encryption/Decryption procedure","text":"<p>There are currently two supported encryption protocol versions for encrypted libraries, version 2 and versioin 4. The two versions shares the same basic procedure so we first describe the procedure.</p> <ol> <li>Generate a 32-byte long cryptographically strong random number. This will be used as the file encryption key (\"file key\").</li> <li>Encrypt the file key with the user provided password. We first use a secure hash algorithm to derive a key/iv pair from the password, then use AES 256/CBC to encrypt the file key. The result is called the \"encrypted file key\". This encrypted file key will be sent to and stored on the server. When you need to access the data, you can decrypt the file key from the encrypted file key.</li> <li>A \"magic token\" is derived from the password and library id, with the same secure hash algorithm. This token is stored with the library and will be use to check passwords before decrypting data later.</li> <li>All file data is encrypted by the file key with AES 256/CBC. We use PBKDF2-SHA256 with 1000 iterations to derive key/iv pair from the file key. After encryption, the data is uploaded to the server.</li> </ol> <p>The only difference between version 2 and version 4 is on the usage of salt for the secure hash algorithm. In version 2, all libaries share the same fixed salt. In version 4, each library will use a separate and randomly generated salt.</p>"},{"location":"administration/security_features/#secure-hash-algorithms-for-password-verification","title":"Secure hash algorithms for password verification","text":"<p>A secure hash algorithm is used to derive key/iv pair for encrypting the file key. So it's critical to choose a relatively costly algorithm to prevent brute-force guessing for the password.</p> <p>Before version 12, a fixed secure hash algorithm (PBKDF2-SHA256 with 1000 iterations) is used, which is far from secure for today's standard.</p> <p>Since Seafile server version 12, we allow the admin to choose proper secure hash algorithms. Currently two hash algorithms are supported.</p> <ul> <li>PBKDF2: The only available parameter is the number of iterations. You need to increase the the number of iterations over time, as GPUs are more and more used for such calculation. The default number of iterations is 1000. As of 2023, the recommended iterations is 600,000.</li> <li>Argon2id: Secure hash algorithm that has high cost even for GPUs. There are 3 parameters that can be set: time cost, memory cost, and parallelism degree. The parameters are seperated by commas, e.g. \"2,102400,8\", which the default parameters used in Seafile. Learn more about this algorithm on https://github.com/P-H-C/phc-winner-argon2 .</li> </ul>"},{"location":"administration/security_features/#client-side-encryption-and-decryption","title":"Client-side encryption and decryption","text":"<p>The above encryption procedure can be executed on the desktop and the mobile client. The Seahub browser client uses a different encryption procedure that happens at the server. Because of this your password will be transferred to the server.</p> <p>When you sync an encrypted library to the desktop, the client needs to verify your password. When you create the library, a \"magic token\" is derived from the password and library id. This token is stored with the library on the server side. The client use this token to check whether your password is correct before you sync the library. The magic token is generated by the secure hash algorithm chosen when the library was created.</p> <p>For maximum security, the plain-text password won't be saved on the client side, too. The client only saves the key/iv pair derived from the \"file key\", which is used to decrypt the data. So if you forget the password, you won't be able to recover it or access your data on the server.</p>"},{"location":"administration/security_features/#why-fileserver-delivers-every-content-to-everybody-knowing-the-content-url-of-an-unshared-private-file","title":"Why fileserver delivers every content to everybody knowing the content URL of an unshared private file?","text":"<p>When a file download link is clicked, a random URL is generated for user to access the file from fileserver. This url can only be access once. After that, all access will be denied to the url. So even if someone else happens to know about the url, he can't access it anymore.</p> <p>This was changed in Seafile server version 12. Instead of a random URL, a URL like 'https://yourserver.com/seafhttp/repos/{library id}/file_path' is used for downloading the file. Authorization will be done by checking cookies or API tokens on the server side. This makes the URL more cache-friendly while still being secure.</p>"},{"location":"administration/security_features/#how-does-seafile-store-user-login-password","title":"How does Seafile store user login password?","text":"<p>User login passwords are stored in hash form only. Note that user login password is different from the passwords used in encrypted libraries. In the database, its format is</p> <pre><code>PBKDF2SHA256$iterations$salt$hash\n</code></pre> <p>The record is divided into 4 parts by the $ sign.</p> <ul> <li>The first part is the used hash algorithm. Currently we use PBKDF2 with SHA256. It can be changed to an even stronger algorithm if needed.</li> <li>The second part is the number of iterations of the hash algorithm</li> <li>The third part is the random salt used to generate the hash</li> <li>The fourth part is the final hash generated from the password</li> </ul> <p>To calculate the hash:</p> <ul> <li>First, generate a 32-byte long cryptographically strong random number, use it as the salt.</li> <li>Calculate the hash with <code>PBKDF2(password, salt, iterations)</code>. The number of iterations is currently 10000.</li> </ul>"},{"location":"administration/two_factor_authentication/","title":"Two-Factor Authentication","text":"<p>Starting from version 6.0, we added Two-Factor Authentication to enhance account security.</p> <p>There are two ways to enable this feature:</p> <ul> <li> <p>System admin can tick the check-box at the \"Password\" section of the system settings page, or</p> </li> <li> <p>just add the following settings to <code>seahub_settings.py</code> and restart service.   <pre><code>ENABLE_TWO_FACTOR_AUTH = True\nTWO_FACTOR_DEVICE_REMEMBER_DAYS = 30  # optional, default 90 days.\n</code></pre></p> </li> </ul> <p>After that, there will be a \"Two-Factor Authentication\" section in the user profile page.</p> <p>Users can use the Google Authenticator app on their smart-phone to scan the QR code.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/","title":"Seafile Professional Server Changelog (old)","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#71","title":"7.1","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 7.1.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7122-20210729","title":"7.1.22 (2021/07/29)","text":"<ul> <li>[fix] Fix a UI bug for setting sharing permission</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7121-20210713","title":"7.1.21 (2021/07/13)","text":"<ul> <li>Make file download link generated for OnlyOffice can be used by multiple times</li> <li>Improve OnlyOffice integration logs</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7120-20210702","title":"7.1.20 (2021/07/02)","text":"<ul> <li>[fix] Fix a cache bug for OnlyOffice integration.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7119-20210604","title":"7.1.19 (2021/06/04)","text":"<ul> <li>[fix] Fix a bug that some threads are set as daemon in seafevents</li> <li>[fix] Improve performance in system admin listing users by removing some redundent code in fetching users' last active time</li> <li>[fix] Fix a bug in password protected sharing link with direct download set (?dl=1)</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7118-20210513","title":"7.1.18 (2021/05/13)","text":"<ul> <li>[fix] Fix a bug in library list cache</li> <li>[fix] Fix a webdav crash bug</li> <li>[fix] Fix a library can't be synced immidiately after creating</li> <li>[fix] disable max_sync_file_count and fs_id_list_request_timeout options by default</li> <li>[fix] Fix office files can't be viewd with builtin office file preview (caused by incompatible JWT library version)</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7117-20210426","title":"7.1.17 (2021/04/26)","text":"<ul> <li>[fix] Fix manual file lock can't work</li> <li>[fix] Fix webdav file range request</li> <li>Improve OnlyOffice cache handling</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7116-20210419","title":"7.1.16 (2021/04/19)","text":"<ul> <li>[fix] Fix deleting libraries without owner in admin panel</li> <li>Add an API to change a user's email</li> <li>[fix] Fix a bug in storage migration script</li> <li>[fix] Fix a bug that will cause fsck crash</li> <li>[fix] Fix a XSS problem in notification</li> </ul> <p>Potential breaking change in Seafile Pro 7.1.16: You can set the maximum number of files contained in a library that can be synced by the Seafile client. The default is 100000. When you download a repo, Seafile client will request fs id list, and you can control the timeout period of this request through <code>fs_id_list_request_timeout</code> configuration, which defaults to 5 minutes. These two options are added to prevent long fs-id-list requests from overloading the server. If you have large libraries on the server, this can cause \"internal server error\" returned to the client. You have to set a large enough limit for these two options.</p> <pre><code>[fileserver]\nmax_sync_file_count = 100000\nfs_id_list_request_timeout = 300\n</code></pre>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7115-20210318","title":"7.1.15 (2021/03/18)","text":"<ul> <li>[fix] Fix sometimes uploading via API returning 400 error</li> <li>Improve file locking handlering for OnlyOffice and Office Online integration</li> <li>[fix] Fix sometimes traffic statistics not correct</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7114-20210226","title":"7.1.14 (2021/02/26)","text":"<ul> <li>Add importing group members via a xlsx file</li> <li>[fix] Fix a bug in login via Shibboleth</li> <li>[fix] Fix remote wipe</li> <li>[fix] Fix setting a role's default quota via ADFS login</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7113-20210208","title":"7.1.13 (2021/02/08)","text":"<ul> <li>[fix] Fix file audit logs are not recorded if seaf-server restarted</li> <li>[fix] Fix a crash bug in seaf-server</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7112-20210203","title":"7.1.12 (2021/02/03)","text":"<ul> <li>[fix] Fix listing more than 100+ users in group member management dialog</li> <li>[fix] Fix guest invitation email sending problem</li> <li>ccnet-server and seaf-server close database connection when there are errors</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7111-20210128","title":"7.1.11 (2021/01/28)","text":"<ul> <li>Add cache for listing libraries request from drive clients</li> <li>Show users' last active time in admin panel</li> <li>Library owner can unlock a file</li> <li>Show image thumbnail in search result</li> <li>WebDAV support range request</li> <li>[fix] Fix WebDAV can't be used with secret when 2FA is enabled</li> <li>[fix] Fix SSO users are not created after login when LDAP is also enabled</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7110-20200111","title":"7.1.10 (2020/01/11)","text":"<ul> <li>[fix] Fix user can't login in WebDAV via secret key after two-fa is turned on</li> <li>[fix] Enable copy multiple folders/files in read-only libraries</li> <li>[fix] Add back filter functions in admin file access logs</li> <li>Enable setting work number in realtime backup</li> <li>[fix] Fix a bug in multi-tenancy mode when transfer a library from a user to a department</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#719-20201202","title":"7.1.9 (2020/12/02)","text":"<ul> <li>[new] Add pagination when listing group/department members</li> <li>[fix] Disable webdav for users that have 2fa enabled</li> <li>[fix] Fix OnlyOffice JWT broken for public shared links / PR for fix available</li> <li>[fix] Fix database crash will causing clients to unsync libraries</li> <li>[fix] Fix webdav LOCK issue</li> <li>[new, OnlyOffice] Pass user id to OnlyOffice</li> <li>[fix] Fix check_user_quote command for LDAP users</li> <li>[fix] Fix LIBRARY_TEMPLATES support</li> <li>[fix] Fix Markdown print in Firefox</li> <li>[fix] Fix a bug in OAuth</li> <li>[fix] Remove unused rest_framework files</li> <li>[fix] Fix a bug in getting file history</li> <li>[new] Admin can delete pending invitations</li> <li>[fix] Fix can not save markdown/text file for shared libraries with advanced permission control</li> <li>[fix, multi-tenancy] Fix organization traffic stats seem to not work correctly</li> <li>[fix, multi-tenancy] Fix orginization admin update user status error</li> <li>[fix] Fix Affiliation-Role-Mapping not working </li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#718-20201012","title":"7.1.8 (2020/10/12)","text":"<ul> <li>[fix] Fix user name encoding for Shibboleth SSO</li> <li>[fix] Add back the remote wipe feature when deleting a linked devices in admin panel</li> <li>[fix] Fix sorting problem in some tables in admin panel</li> <li>[fix] Fix auto-reactive user when a user deleted from LDAP and then added back</li> <li>[fix] Fix a few bugs in organization admin panel in multi-tenancy mode</li> <li>[fix] Fix libraries unsynced in a client if database crash at the server side</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#717-20200828","title":"7.1.7 (2020/08/28)","text":"<ul> <li>[fix] Fix a bug in returned group library permission for  SeaDrive client</li> <li>Support pagination when listing libraries in a group</li> <li>Update wsgidav used in WebDAV</li> <li>Remove redundent logs in seafile.log</li> <li>[fix] Fix \"save to...\" in share link</li> <li>Add an option to show a user's email in sharing dialog (ENABLE_SHOW_CONTACT_EMAIL_WHEN_SEARCH_USER)</li> <li>[fix] Fix virus scan results page can't be opened in system admin panel</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#716-20200728","title":"7.1.6 (2020/07/28)","text":"<ul> <li>Add database connection pool to reduce database connection usage</li> <li>[fix] Fix WebDAV error if a file is moved immediately after uploading</li> <li>Enable generating internal links for files in an encrypted library</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#715-20200630","title":"7.1.5 (2020/06/30)","text":"<ul> <li>Indexing LibreOffice files in file search</li> <li>Support setting the expire date time of a share link to a specific date time</li> <li>GC add --id-prefix option to scan a specific range of libraries</li> <li>fsck add an option to not check block integrity to speed up scanning</li> <li>[fix] ccnet no longer listen on port 10001</li> <li>[fix] Fix virus scan via upload link not work</li> <li>[fix] Fix WebDAV failed login via WebDAV secret</li> <li>[fix] Fix some bugs in LDAP sync</li> <li>[fix] Fix term and condition feature</li> <li>[fix] Fix support for institution feature</li> <li>Other UI fixes</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#714-20200514","title":"7.1.4 (2020/05/14)","text":"<ul> <li>[fix] Fix listing LDAP imported users when number of users is greater than 500</li> <li>[fix] Fix visiting folder share links with password and default path</li> <li>Use preview-and-download as default permission when generating share links</li> <li>Support selecting and downloading multiple files in a sharing link</li> <li>Show share link expiration time in system admin</li> <li>[multi-tenancy] Support sorting for users and libraries in organization admin panel</li> <li>FUSE extension now support multiple storage backends</li> <li>[fix] Fix file download links in public libraries</li> <li>[fix] fix seaf-backup-cmd.sh</li> <li>Other UI improvements and fixes</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#713-20200408","title":"7.1.3 (2020/04/08)","text":"<ul> <li>A library admin can see all the shared links for a library</li> <li>Sort libraries and users in admin panel</li> <li>Delete all the users and libraries in an organization when deleting that organization</li> <li>[fix] Fix some bugs in multiple storage backend feature</li> <li>Other UI fixes</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#711-beta-20200227","title":"7.1.1 Beta (2020/02/27)","text":"<ul> <li>Fix full text search</li> <li>Fix office file preview in cluster mode</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#710-beta-20200219","title":"7.1.0 Beta (2020/02/19)","text":"<ul> <li>Rewrite the system admin pages with React</li> <li>Upgrade to Python3</li> <li>Add library API Token, you can now generate API tokens for a library and use them in third party programs.</li> <li>Add a feature abuse report for reporting abuse for download links.</li> <li>Improved guest invitation: you can now invite a guest and share a library to the guest in one step.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#70","title":"7.0","text":"<p>Since seafile-pro 7.0.0, we have upgraded Elasticsearch to 5.6. As Elasticsearch 5.6 relies on the Java 8 environment and can't run with root, you need to run Seafile with a non-root user and upgrade the Java version.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7019-20200907","title":"7.0.19 (2020/09/07)","text":"<ul> <li>Fix translation</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7018-20200521","title":"7.0.18 (2020/05/21)","text":"<ul> <li>Fix a bug in adding tag for files using context menu</li> <li>Add missing translations for French language</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7017-20200428","title":"7.0.17 (2020/04/28)","text":"<ul> <li>Fix bug for EXTRA_ABOUT_DIALOG_LINKS</li> <li>Modify the default permission to \"Download and preview\" for share links</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7016-20200401","title":"7.0.16 (2020/04/01)","text":"<ul> <li>Add progress dialog when moving files across libraries</li> <li>Add more customization options (EXTRA_SHARE_DIALOG_NOTE, EXTRA_APP_BOTTOM_LINKS, EXTRA_ABOUT_DIALOG_LINKS)</li> <li>[fix] Fix a bug with domain-name that contains \"file\" when previewing markdown file via share link</li> <li>[fix] Do not show download link for a preview-only share link</li> <li>[fix] Fix searching files in a public library for login users</li> <li>Some UI improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7015-deprecated","title":"7.0.15 (Deprecated)","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#7014-20200306","title":"7.0.14 (2020/03/06)","text":"<ul> <li>[fix] Fix seaf-server crash problem when calculating library size for a corrupted library</li> <li>[fix] Fix a bug when sending file update notice</li> <li>Write virus scan log to file virus_scan.log</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7013-20200116","title":"7.0.13 (2020/01/16)","text":"<ul> <li>Fix Shibboleth login bug (added in 7.0.12)</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7012-20200110","title":"7.0.12 (2020/01/10)","text":"<ul> <li>Fix department support in multi-tenancy mode</li> <li>Fix a performance problem when deleting cache files for resume file upload</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7011-20191115","title":"7.0.11 (2019/11/15)","text":"<ul> <li>set jvm.options in ElasticSearch to <code>-Xms1g -Xmx1g</code> </li> <li>[fix] Fix revert library button missing in multi-tenancy mode</li> <li>[fix] Remove redundant log OnlineOffice file lock is expired </li> <li>[fix] Fix S3 support in multiple storage backend feature</li> <li>[LDAP Sync] Support setting default permission for automatically created library for department</li> <li>[LDAP Sync] Support get department name from a configured attribute</li> <li>[fix] Fix support for Shibboleth single log out</li> <li>[fix] Fix support for sharing a sub-folder in a department library</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#7010-20191022","title":"7.0.10 (2019/10/22)","text":"<ul> <li>[fix] Fix showing NaN when uploading a file with 0 size.</li> <li>[fix] Fix email notifications for file changes not sent</li> <li>[fix] Remove two redundant logs in seafile.log</li> <li>[fix] Fix opening a shared library with special characters</li> <li>[fix] Fix duplicated two-scrollbars when browsing a published library in Windows using Firefox</li> <li>[fix] Users can now create sharing links for files with permission \"online-preview only\" and \"online-read-write\".</li> <li>[fix] Fix links in email notification for a shared folder</li> <li>[fix] Fix the path shown for public share links of folders</li> <li>[fix] Fix a bug in loading a file's history</li> <li>[fix] Fix a case when using SAML login with LDAP configured</li> <li>[fix] Fix a bug that a broken library can't be deleted via web UI</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#709-20190920","title":"7.0.9 (2019/09/20)","text":"<ul> <li>[fix] Add institution admin back</li> <li>[fix] Fix '\\n' in system wide notification will lead to blank page</li> <li>[fix] Remove all metadata in docx template</li> <li>[fix] Fix redirection after login</li> <li>[fix] Fix group order is not alphabetic</li> <li>[fix] Fix download button in sharing link</li> <li>Mobile UI Improvement (Now all major pages can be used in Mobile smoothly)</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#708-20190826","title":"7.0.8 (2019/08/26)","text":"<ul> <li>Inviter can cancel invitation after the user has accepted the invitation. The user will be set as inactive.</li> <li>Improve organization admin panel in multi-tenancy mode</li> <li>Add notification when a user try to leave a page during file transfer</li> <li>Add UI waiting notification when resetting a user's password in admin panel</li> <li>Add generating internal link (smart-link) for folders</li> <li>Add command line tool for admin to export reports</li> <li>[fix] Fix file drag and drop in IE and Firefox</li> <li>[fix] Add back the feature of letting user to select storage backend</li> <li>Improve UI for file uploading, support re-upload after error</li> <li>[fix] Fix devices login via Shibboleth not show in devices list</li> <li>[fix] Fix support of OnlyOffice force-save option </li> <li>[fix] Fix zip download when user selecting a long list of files</li> <li>Other UI fixes</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#707-20190729","title":"7.0.7 (2019/07/29)","text":"<ul> <li>[fix] Fix a bug in multiple storage backend support</li> <li>Fix avatar problem when deployed under non-root domain</li> <li>Add get internal link in share dialog</li> <li>Fix newly created DOCX files are not empty and have a Chinese font set as default font</li> <li>Fix system does not send email to new user when adding new user in system admin</li> <li>Fix thumbnail for TIFF files</li> <li>Fix direct download link for sharing links</li> <li>Fix report in statictics module has no file extension when downloading in Firefox</li> <li>Fix \"Preview-only\" share link</li> <li>Fix file comment</li> <li>Other UI fixes</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#706-20190722","title":"7.0.6 (2019/07/22)","text":"<ul> <li>[fix] Fix a memcache bug when using S3 backend</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#705-20190716","title":"7.0.5 (2019/07/16)","text":"<ul> <li>[fix] Fix Zip download multiple files</li> <li>[fix] Fix a bug in \"System Admin -&gt; Logs -&gt; File Update -&gt; details\"</li> <li>[fix] Fix there is an extra history item for newly created docs/pptx</li> <li>[fix] Fix a bug in traffic statistics</li> <li>[fix] Fix file modification report email are not sent out</li> <li>Support show department libraries in fuse</li> <li>Add expiring date for upload link</li> <li>Add search feature in pubished libraries for anonymous users</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#704-20190705","title":"7.0.4 (2019/07/05)","text":"<ul> <li>UI Improvement and fixes</li> <li>Fix file upload button with Safari, IE edge</li> <li>Support setting history and cleaning trash for department libraries</li> <li>Fix compatibility with \"Open library in web\" from the old version desktop client</li> <li>Support \".\" in group name</li> <li>Add back \"can edit\" permission for sharing links for office file</li> <li>Add back \"send link\" for upload links</li> <li>Add back grid view for folder sharing links</li> <li>Support creating encrypted libraries for department libraries</li> <li>Fix preview for PSD, TIFF files</li> <li>Fix deleting of favorate items when they are shared items but the sharing are revoked</li> <li>Fix avatar broken problem when using a non-stardard port</li> <li>Fix resumable file uploading</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#703-20190613","title":"7.0.3 (2019/06/13)","text":"<ul> <li>UI fixes</li> <li>Support index.md in published library</li> <li>Add sub-folder permission for deparment libraries</li> <li>Enable new file history by default</li> <li>Make published library feature turned on by default</li> <li>Fix IE Edge support</li> <li>Fix LDAP group sync</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#702-beta-20190517","title":"7.0.2 beta (2019/05/17)","text":"<ul> <li>UI fixes</li> <li>Support using different salt for each encrypted libraries</li> <li>Add back sub-folder permission feature</li> <li>Improved user's settings page and file search page</li> <li>Support transfer personal library to department</li> <li>Add pubishing library to role permission</li> <li>[wopi] Pass last modified time to WOPI</li> <li>Improve image resizing in Markdown</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#701-beta-20190418","title":"7.0.1 beta (2019/04/18)","text":"<ul> <li>Improved Markdown editor</li> <li>Add columns view mode (Wiki view mode)</li> <li>Add context menu</li> <li>Realtime search</li> <li>Support search libraries</li> <li>Record file history to database for Markdown, Text and Docx, xlsx, pptx files</li> <li>Redesigned activities page</li> <li>Add preview-edit-on-cloud, preview-on-cloud permissions</li> <li>Redesigned file tags</li> <li>Support editing share link permission after creating a link</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#63","title":"6.3","text":"<p>In version 6.3, Django is upgraded to version 1.11. Django 1.8, which is used in version 6.2, is deprecated in 2018 April.</p> <p>With this upgrade, the fast-cgi mode is no longer supported. You need to config Seafile behind Nginx/Apache in WSGI mode.</p> <p>The way to run Seahub in another port is also changed. You need to modify the configuration file <code>conf/gunicorn.conf</code> instead of running <code>./seahub.sh start &lt;another-port&gt;</code>.</p> <p>Version 6.3 also changed the database table for file comments, if you have used this feature, you need migrate old file comments using the following commends after upgrading to 6.3:</p> <pre><code>./seahub.sh python-env seahub/manage.py migrate_file_comment\n</code></pre> <p>Note, this command should be run while Seafile server is running.</p> <p>Version 6.3 changed '/shib-login' to '/sso'. If you use Shibboleth, you need to to update your Apache/Nginx config. Please check the updated document: shibboleth config v6.3</p> <p>Version 6.3 add a new option for file search (<code>seafevents.conf</code>):</p> <pre><code>[INDEX FILES]\n...\nhighlight = fvh\n...\n</code></pre> <p>This option will make search speed improved significantly (10x) when the search result contains large pdf/doc files. But you need to rebuild search index if you want to add this option.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6314-20190521","title":"6.3.14 (2019/05/21)","text":"<ul> <li>[fix] Fix a bug in LDAP group sync</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6313-20190320","title":"6.3.13 (2019/03/20)","text":"<ul> <li>[fix] Fix some bugs in accessing S3 for some special configurations</li> <li>[fix] Fix OnlyOffice integration when OnlyOffice using invalid CA</li> <li>[fix] Fix sometimes users can't login into WebDAV</li> <li>[fix] Fix a crash bug in realtime backup server</li> <li>[fix] Fix the last modified time is not updated for shared sub-folders</li> <li>[fix] Keep last modified time when moving or copying files from on library to another</li> <li>[fix] Fix can't sync a sub-folder of a shared sub-folder</li> <li>[fix] Fix URL in email notification for sub-folder shared event</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6312-20190221","title":"6.3.12 (2019/02/21)","text":"<ul> <li>[fix] Fix using WebDAV with Single Sign On</li> <li>[fix] Fix a bug in importing users via excel file</li> <li>Redirect users to home page after setting up 2FA</li> <li>[fix] Fix can't send email when non-ascii symbols in filename in virus scan</li> <li>[fix] Fix a bug in syncing LDAP when a user belong to multiple groups</li> <li>Add slow log for accessing object storage for debugging purpose</li> <li>[fix] Fix a SQL bug in multi-tenancy mode</li> <li>Set the chunk size to 8MB during uploading files via chunk to speed up file transfer</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6311-20190115","title":"6.3.11 (2019/01/15)","text":"<ul> <li>[fix] Fix support for two-factor authentication using SMS</li> <li>[fix] Fix support for traffic statistics</li> <li>[fix] Improve performance for getting group library list</li> <li>[fix] Fix file access audit log</li> <li>Remove file count and size count for directories as it will lead to performance problem</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6310-20190102","title":"6.3.10 (2019/01/02)","text":"<ul> <li>[fix] Fix folder upload problem</li> <li>[fix] Fix file audit page can't be load</li> <li>[fix] Fix MIME type for .xls</li> <li>Add RPC slow log</li> <li>Add admin API for manage organizations in multi-tenancy mode</li> <li>Add warning when close page during file uploading</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#639-20181213","title":"6.3.9 (2018/12/13)","text":"<ul> <li>Fix a seaf-server crash problem</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#638-20181210","title":"6.3.8 (2018/12/10)","text":"<ul> <li>Improve online PDF view for large PDF files (In the old version, a large PDF file consumes a lot of memory)</li> <li>Admin can force a user to use two-factor authentication</li> <li>Improve performance of upgdating a library's size and file numbers</li> <li>Don't print a lot of \"Repo size compute queue is 0\"</li> <li>Enable using WebDAV with Single Sign On (A new option ENABLE_WEBDAV_SECRET)</li> <li>Enable login to WebDAV via contact email</li> <li>[fix] A shared empty folder name will be updated if the folder's name is changed</li> <li>Support preview for PSD and AI files</li> <li>[fix] Fix license information display problem</li> <li>[fix] Fix video preview for shared link on mobile browsers</li> <li>Redirect old wiki URL to new wiki URL</li> <li>Hide save as button for files viewed by Office Online Server</li> <li>When a library be transfer to another user, don't clear the syncing tokens</li> <li>Support syncing both department and groups at the same time in LDAP sync (deprecating old config options for department sync)</li> <li>Set default quota for department synced from LDAP</li> <li>Allow more independent LDAP configurations for multi-LDAP server sync</li> <li>[fix] Fix problems when downloading large list of files via Zip download</li> <li>[fix] Fix a performance problem when get the list of all groups</li> <li>[fix] Can change history settings for library in admin area even if the change of history settings is disable for normal users</li> <li>Make multi-threads mode as default for Seahub</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#637-20181016","title":"6.3.7 (2018/10/16)","text":"<ul> <li>[fix] Fix a bug of lock by online office</li> <li>Anyone that can write a file can unlock the file if it is locked by online office</li> <li>[fix] Fix a bug in sending mails in background node</li> <li>[fix] Remove forcesave option in OnlyOffice since it have a bug</li> <li>[fix] Fix a bug that wiki page can't be loaded</li> <li>Add traffic statistics</li> <li>[fix] Remove unnecessary logs in virus scan</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#636-20180921","title":"6.3.6 (2018/09/21)","text":"<ul> <li>[fix] Fix a bug in user defined role</li> <li>[fix] Editable share link can be edited by anonymous user</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#635-20180918","title":"6.3.5 (2018/09/18)","text":"<ul> <li>[fix, security] Fix a security issue in Shibboleth authentication</li> <li>[fix] Fix sometimes Web UI will not autoload a &gt;100 item directory view</li> <li>[fix] Fix sending notification emails in backend node</li> <li>Showing user's name instead of email in web interface</li> <li>[fix] Fix desktop client can't login if using ADFS</li> </ul> <p>New features</p> <ul> <li>Add a new sharing link permission \"can edit\" for docx/excel. Any login users can edit the file via share link.</li> <li>[multi-tenancy] Support department and department owned library</li> <li>Add system traffic statistics (showing the daily web download/web upload/sync traffic)</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#634-20180816","title":"6.3.4 (2018/08/16)","text":"<ul> <li>[fix] Fix a bug in creating group-owned library</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#633-20180815","title":"6.3.3 (2018/08/15)","text":"<ul> <li>[fix] Fix some bugs in sharing group-owned libraries</li> <li>[fix] Fix a bug in setting folder permission</li> <li>Update Django to 1.11.11</li> <li>Support login via contact email</li> <li>Support sharing a sub-folder in a group-owned library</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#632-20180730","title":"6.3.2 (2018/07/30)","text":"<ul> <li>[fix] Fix sometimes get group listing will cause ccnet-server crash</li> <li>[fix] Fix built in office file preview can't works</li> <li>Redirect '/shib-login' to '/sso'</li> <li>Other small fixes</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#631-20180725","title":"6.3.1 (2018/07/25)","text":"<ul> <li>Add generating of internal links</li> <li>Lock office files when editing via online office suite</li> <li>Support setting organization quota, delete an organization via Web API</li> <li>Support Swift storage backend Identity v3.0 API</li> <li>Improve markdown editor</li> <li>Several fixes</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#630-beta-20180628","title":"6.3.0 Beta (2018/06/28)","text":"<ul> <li>Support nested group and group-owned libraries</li> <li>Keep sharing link when file or folder moved or renamed</li> <li>Update Django to 1.11, remove fast-cgi support</li> <li>Update jQuery to version 3.3.1</li> <li>Update pdf.js, use pdf.js for preview pdf files</li> <li>Docx files are converted to PDFs and preview via pdf.js in builtin preview</li> <li>Support multiple storage backend to be used in a single server</li> <li>[fix] Fix some bugs with OnlyOffice and CollaboraOffice</li> <li>[fix] Use mobile version of OnlyOffice if viewed via mobile devices</li> <li>Shared sub-folders can be searched</li> <li>Show terms and condition link if terms and condition is enabled</li> <li>Remove login log after delete a user</li> <li>[admin] Support customize site title, site name, CSS via Web UI</li> <li>[fix] Fix a bug that causing seaf-fsck crash</li> <li>[fix] Cancel Zip download task at the server side when user close zip download dialog</li> <li>[fix] Fix crash when seaf-fsck, seaf-gc receive wrong arguments</li> <li>[fix] Fix a few bugs in realtime backup server</li> <li>[beta] Wiki, users can create public wikis</li> <li>Some other UI improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#62","title":"6.2","text":"<p>From 6.2, It is recommended to use proxy mode for communication between Seahub and Nginx/Apache. Two steps are needed if you'd like to switch to WSGI mode:</p> <ol> <li>Change the config file of Nginx/Apache.</li> <li>Restart Seahub with <code>./seahub.sh start</code> instead of <code>./seahub.sh start-fastcgi</code></li> </ol> <p>The configuration of Nginx is as following:</p> <pre><code>location / {\n         proxy_pass         http://127.0.0.1:8000;\n         proxy_set_header   Host $host;\n         proxy_set_header   X-Real-IP $remote_addr;\n         proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n         proxy_set_header   X-Forwarded-Host $server_name;\n         proxy_read_timeout  1200s;\n\n         # used for view/edit office file via Office Online Server\n         client_max_body_size 0;\n\n         access_log      /var/log/nginx/seahub.access.log;\n         error_log       /var/log/nginx/seahub.error.log;\n    }\n</code></pre> <p>The configuration of Apache is as following:</p> <pre><code>    # seahub\n    SetEnvIf Authorization \"(.*)\" HTTP_AUTHORIZATION=$1\n    ProxyPass / http://127.0.0.1:8000/\n    ProxyPassReverse / http://127.0.0.1:8000/\n</code></pre>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6213-2018518","title":"6.2.13 (2018.5.18)","text":"<ul> <li>[new] Support only return files or folders when search file via api.</li> <li>[fix] Fix notification display behavior bug on some page.</li> <li>[fix] Recreate folder when failed because of <code>file already exists</code> error for the first time.</li> <li>[fix] Fix bug of saving file via onlyoffice.</li> <li>[fix] Fix bug when set user\u2019s reference id to \u2018\u2019 via admin api.</li> <li>[fix] Fix bug of group info page display in organization admin panel.</li> <li>[improve] Disable full email search if current user is a guest user.</li> <li>[improve] Return library type when search file via api.</li> <li>[improve] Add user auth info to cookie when login via OAuth.</li> <li>[improve] Return timestamp instead of time string when get user clean up library trash event via api.</li> <li>[improve] Check quota when copy/move file/folder.</li> <li>[improve] Distinguish file or folder when send library/folder share notice/email.</li> <li>[improve] Sort by parent folder\u2019s name when get file/folder recursively.</li> <li>[improve] Remove unused Python imports in ADFS module.</li> <li>[improve] Optimizate library udpate event.</li> <li>[improve] Remove seahub gunicorn access log.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6212-2018420","title":"6.2.12 (2018.4.20)","text":"<ul> <li>[fix] Fix a bug in seafevents</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6211-2018419","title":"6.2.11 (2018.4.19)","text":"<ul> <li>Update multi storage backend feature, add STORAGE_CLASS_MAPPING_POLICY setting.</li> <li>[fix] Fix bug when search file by path.</li> <li>[fix] A user that can't create a library can sync a sub-folder of a library now.</li> <li>Add title when view file via OOS.</li> <li>Check if enable LIBRARY_TEMPLATES feature when creating library.</li> <li>[api] Enable return all files recursively under a folder.</li> <li>Preserve share links when admin transfer a library from a user to another user.</li> <li>Add setting to disable user change password.</li> <li>Add setting to disable group dissussion.</li> <li>Add setting to disable file comment.</li> <li>Restart both ccnet-server and seaf-server if seaf-server is down.</li> <li>Fix a bug that some cases elasticsearch be started repeatly.</li> <li>Don\u2019t start seafile if failed to mount http-temp dir.</li> <li>Don\u2019t deactive user if failed to get users from ldap server.</li> <li>[fix] Fix online preview can't work in background node caused by wrong Python path.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6210-2018320","title":"6.2.10 (2018.3.20)","text":"<ul> <li>Improve performance of file search</li> <li>[fix] Fix a bug in daily active user statistics</li> <li>[fix] Fix copy files larger than 2GB via seaf-fuse</li> <li>Show 403 error when visit share link if share link creator no longer has access permission to library.</li> <li>[api] Add api for uploading file via upload share link.</li> <li>[api] Support search file/folder in a specific library and folder via api.</li> <li>[fix] Fix bug in folder renaming operation list on activities page.</li> <li>[fix] Fix bug when creating personal/group wiki.</li> <li>[fix] Fix bug when searching specific extension file.</li> <li>[fix] Fix a bug in Two-Factor Authentication.</li> <li>[fix] Fix bug when getting encrypted library history.</li> <li>[fix] Fix UI bug of \"New Library\" and \"More\" buttons.</li> <li>[fix] Fix bug of using truncated image file as avatar.</li> <li>Change value of <code>per_page</code> parameter to 10 when search file via api.</li> <li>Support indexing files in background after file uploading via API</li> <li>Add user clean library trash event to activities</li> <li>Use inner fileserver url to save file when edit office via OOS.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#629-20180210","title":"6.2.9 (2018.02.10)","text":"<ul> <li>[fix] Support setting region for Swift backend</li> <li>[fix] Notify the admin when an invited people registered</li> <li>[new, api] Add API for cleaning trash</li> <li>[fix, api] Fix permission check in search API</li> <li>[fix] Remove redundant warning message in seahub.log</li> <li>[fix] Add API for upload files via upload link</li> <li>[fix] Fix inconsistency in showing user's space usage in multi-tenancy mode</li> <li>[new] Add online preview for SVG files</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#628-20180202","title":"6.2.8 (2018.02.02)","text":"<ul> <li>[fix] Fix command pro/pro.py --test</li> <li>All logs that went to seahub_django_request.log go to seahub.log</li> <li>Print gunicorn error to runtime/error.log</li> <li>[fix] Don't allow to generate share links via API for encrypted libraries</li> <li>[new] Support online preview for tiff and eps files</li> <li>[new, api] Add api to allow admin to copy files between libraries</li> <li>[new] Allow system admin to share a library as \"admin\" to another user in admin panel</li> <li>Other UI fixes and improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#627-20180122","title":"6.2.7 (2018.01.22)","text":"<ul> <li>[fix, important] Fix a performance bug in search index</li> <li>[fix, important] Fix a memory leak in listing folder with locked files</li> <li>[fix] Fix creating of demo account</li> <li>[new] Notify the inviter when a guest register</li> <li>[new] Add the feature \"remember this device\" after two-factor authentication</li> <li>[new] Don't allow to move, delete or rename a file when a file is locked</li> <li>[new] Add option to notify the admin after new user registration (NOTIFY_ADMIN_AFTER_REGISTRATION)</li> <li>[new, ui] Support inviting multiple guests at once</li> <li>[new] Support customize the list of groups that a user can see when sharing a library</li> <li>[new, api] Support search files in my libraries, shared libraries, shared to all libraries</li> <li>[fix] Fix OAuth bug</li> <li>[fix] Fix a bug that file preview can't work in Debian 9</li> <li>[fix, multi-tenancy] Fix permission of a shared sub-folder can't be changed</li> <li>[fix] Fix a bug in modify permission for a shared sub-folder</li> <li>[fix] Improve performance in checking folder permission and file lock</li> <li>[fix] Improve the performance of returning a user's all group libraries</li> <li>[fix] Fix support for uploading 500+ files via web interface (caused by API rate throttle)</li> <li>[fix] Fix API get_shared_repo_by_path()</li> <li>[fix] Add more log when failed to zip a file</li> <li>Don't use memcache when read object in the Python part</li> <li>Update license file check</li> <li>[multi-tenancy, api] Return origin_repo_name when listing libraries</li> <li>Add cancel zip download API</li> <li>[fix] Fix some configuration bugs in seafevents module</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#625-626-deprecated","title":"6.2.5, 6.2.6 (deprecated)","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#624-20171220","title":"6.2.4 (2017.12.20)","text":"<ul> <li>[fix] Fix a bug in file search index clearing command</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#623-20171219","title":"6.2.3 (2017.12.19)","text":"<ul> <li>[fix] Fix a bug in file search indexing.</li> <li>[fix, admin] Fix a bug of statistic module in a cluster.</li> <li>[new, admin] Support search share link.</li> <li>[improve, ui] Add transition to show/hide of feedback messages.</li> <li>Other small UI improvements.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#622-20171212","title":"6.2.2 (2017.12.12)","text":"<ul> <li>[improve] Improve performance of file history page.</li> <li>[improve] show be shared folders when copy/move file/folder to \u201cOther Libraries\u201d.</li> <li>[improve] Remove the white edge of webpage when previewing file via OnlyOffice.</li> <li>[improve] Show two file history records at least.</li> <li>[multi-tenancy] fix bug when listing libraries/folders shared to group.</li> <li>[multi-tenancy] fix bug when deleting an organization.</li> <li>[fix] fix bug when previewing excel file with \u201c&amp;\u201d character in its name.</li> <li>[fix] Don\u2019t check if user exists when deleting a group memeber in admin panel.</li> <li>[oauth] Don\u2019t overwrite public registration settings when login an unexisted user.</li> <li>[audit] Recording file access/update log when preview/edit a file via OnlyOffice.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#621-beta-20171122","title":"6.2.1 beta (2017.11.22)","text":"<ul> <li>[new] Support OAuth.</li> <li>[new] Support Swift v1 protocol.</li> <li>[new, admin] Add option to turn on statistic module</li> <li>[new] Enable publish library update events to message queue (like Redis)</li> <li>[improve, ui] Add \"click to select\" feature for download/upload links.</li> <li>[improve, ui] improved accessibility for some form elements, such as login inputs, and etc.</li> <li>[improve, api] Add <code>repo_owner</code> field to library search web api.</li> <li>[improve, admin] Show/edit contact email in admin panel.</li> <li>[improve, admin] Show upload links in admin panel.</li> <li>[improve, admin] Improve license display.</li> <li>[improve, admin] Share with admin permission recorded in audit log.</li> <li>[improve, admin] Add permission audit log when remove library from group.</li> <li>[improve, search] Set timeout for extracting contents from doc/pdf.</li> <li>[improve, search] Search indexing no longer depend on Seafile service. It reads information from database directly.</li> <li>[fix] Fix Shibboleth login redirection issue, see https://forum.seafile.com/t/shared-links-via-shibboleth/4067/19</li> <li>[fix] In some case failed to unshare a folder.</li> <li>[fix] LDAP search issue.</li> <li>[fix] Fix Safari downloaded file names are encoded like 'test-%2F%4B.doc' if it contains special characters.</li> <li>[fix] Disable client encrypt library creation when creating encrypt library is disabled on server.</li> <li>[fix] Failed to get snapshot labels when libraries are deleted.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#620-beta-20171016","title":"6.2.0 beta (2017.10.16)","text":"<ul> <li>Add report charts for daily active users, daily file operations, and usage space</li> <li>Add \"admin\" permision when sharing a library to another user/group</li> <li>Redesign login page, adding a background image.</li> <li>Clean the list of languages</li> <li>Add the ability of tagging a snapshot of a library (Use <code>ENABLE_REPO_SNAPSHOT_LABEL = True</code> to turn the feature on)</li> <li>[admin] Add an option to enable users to share a library to any groups in the system.</li> <li>Use WSGI as the default mode for deploying Seahub.</li> <li>Add a field Reference ID to support changing users primary ID in Shibboleth or LDAP</li> <li>Improved performance of loading library list</li> <li>Use multi-threads in search indexing</li> <li>[fix] Fix a bug when indexing a PDF larger than 10MB</li> <li>Support adding a custom user search function   (https://github.com/haiwen/seafile-docs/commit/115f5d85cdab7dc272da81bcc8e8c9b91d85506e)</li> <li>Other small UI improvements</li> <li>[fix] Fix ADFS support</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#61","title":"6.1","text":"<p>You can follow the document on minor upgrade.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#619-20170928","title":"6.1.9 \uff082017.09.28\uff09","text":"<ul> <li>[fix] Fix some bugs in realtime backup server</li> <li>Add option to set up Seafile HTTP server thread number</li> <li>[fix] Fix create new file API when create a file with a same name with exist file</li> <li>[fix] Fix a bug in permission check in file syncing</li> <li>Add more detailed log information when permission check error</li> <li>[fix] Add log to the size of queue of library size calculation</li> <li>[fix] Use customized logo when sending email notifications</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#618-20170818","title":"6.1.8 (2017.08.18)","text":"<ul> <li>[fix] Fix license checking</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#617-20170817","title":"6.1.7 (2017.08.17)","text":"<ul> <li>[fix] Fix a bug when concurrent uploading/creating files (in the old version, when a user uploading/deleting multiple files in cloud file browser, it had a high chance to get \u201cinternal server error\u201d message)</li> <li>[fix] Fix thumbnails for some images that 90 degrees rotated</li> <li>[fix] Fix support for resumable file upload</li> <li>[fix] Fix MySQL connection pool in Ccnet</li> <li>[fix] Use original GIF file when view GIF files</li> <li>[fix, api] Check if name is valid when creating folder/file</li> <li>Remove deleted libraries in search index</li> <li>Use 30MB as the default value of THUMBNAIL_IMAGE_SIZE_LIMIT</li> <li>[api] Improve performance when move or copy multiple files/folders</li> <li>[admin] Support syncing user role from AD/LDAP attribute (ldap role sync)</li> <li>[admin] Support deleting all outdated invitations at once</li> <li>[admin] Improve access log</li> <li>[admin] Support upload seafile-license.txt via web interface (only for single machine deployment)</li> <li>[admin] Admin can cancel two-factor authentication of a user</li> <li>[admin, role] Show user\u2019s role in LDAP(Imported) table</li> <li>[admin, role] Add wildcard support in role mapping for Shibboleth login</li> <li>[admin] Improve performance in getting total file number, used space and total number of devices</li> <li>[admin] Admin can add users to an institution via Web UI</li> <li>[admin] Admin can choose a user\u2019s role when creating a user</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#614-20170711","title":"6.1.4 (2017.07.11)","text":"<ul> <li>[api] Improve performance of getting unread notifications.</li> <li>Delete deleted libraries in search index</li> <li>Use user's languange as lang setting for OnlyOffice</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#613-20170706","title":"6.1.3 (2017.07.06)","text":"<ul> <li>Add context menu \"details\" to libraries and folders, so you can get how many files in a library or a folder.</li> <li>Improve search result accuracy</li> <li>[fix] Fix a bug in zip downloading an empty folder</li> <li>Improve performance of multiple file copy and move</li> <li>Admin can delete out-dated guest invitations</li> <li>[fix] Fix a bug in seafile-gc \"dry run\" option</li> <li>Users can restore deleted libraries by their own</li> <li>Change default block size for files uploaded via web browser to 8MB.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#612-deprecated","title":"6.1.2 (deprecated)","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#611-20170619","title":"6.1.1 (2017.06.19)","text":"<ul> <li>Add \"online preview only\" option to share links</li> <li>Enable setting favicon and logo via admin panel</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#610-beta-20170606","title":"6.1.0 beta (2017.06.06)","text":"<p>Web UI Improvement:</p> <ol> <li>Add thumbnail for video files (turn off by default)</li> <li>Improved image file view, using thumbnail to view pictures</li> <li>Move items by drap &amp; drop</li> <li>Add create docx/xlsx/pptx in web interface</li> <li>Add OnlyOffice integration</li> <li>Show which client modify a file in history, this will help to find which client accidentally modified a file or deleted a file.</li> </ol> <p>Improvement for admins:</p> <ol> <li>Admin can set default quota for each role</li> <li>Admin can set user\u2019s quote, delete users in bulk in admin panel</li> <li>Support using admin panel in mobile platform</li> <li>Add translation for settings page</li> <li>Add admin operation logs</li> <li>Admin can change users' login_id in web interface</li> <li>Admin can create libraries in admin panel</li> <li>Admin can set logo and favicon in admin panel</li> </ol> <p>System changes:</p> <ol> <li>Remove wiki by default  (to turn it on, set <code>ENABLE_WIKI = True</code> in seahub_settings.py)</li> <li>Upgrade Django to 1.8.18</li> <li>Clean Ajax API</li> <li>Increase share link token length to 20 characters</li> <li>Upgrade jstree to latest version</li> <li>Update ElasticSearch to 2.4.5</li> </ol>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#60","title":"6.0","text":"<p>You can follow the document on minor upgrade.</p> <p>Special note for upgrading a cluster:</p> <p>In version 6.0, the folder download mechanism has been updated. This requires that, in a cluster deployment, seafile-data/httptemp folder must be in an NFS share. You can make this folder a symlink to the NFS share.</p> <pre><code>cd /data/haiwen/\nln -s /nfs-share/seafile-httptemp seafile-data/httptemp\n</code></pre> <p>The httptemp folder only contains temp files for downloading/uploading file on web UI. So there is no reliability requirement for the NFS share. You can export it from any node in the cluster.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6013-20170508","title":"6.0.13 (2017.05.08)","text":"<ul> <li>[fix] Fix in file moving/copying dialog, self-owned libraries are not listed</li> <li>[fix] Fix files in self-owned libraries are not listed when searching files in all libraries</li> <li>Update timestamp in about dialog</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6012-20170417","title":"6.0.12 (2017.04.17)","text":"<ul> <li>Improve performance when checking group shared library permission</li> <li>[fix] Fix image popup in favourite page</li> <li>[fix] Fix generating sharing link with expiring time in file detailed view page</li> <li>[fix] Don't allow to create library with '/' in name</li> <li>[fix] Fix two-factor authentication</li> <li>Add script to migrate between different storage backend</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#6011-deprecated","title":"6.0.11 (Deprecated)","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#6010-20170407","title":"6.0.10 (2017.04.07)","text":"<ul> <li>[fix] Fix a bug in listing libraries in admin panel</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#609-20170401","title":"6.0.9 (2017.04.01)","text":"<ul> <li>Show user' name instead of user's email in notifications sent out by email</li> <li>Add config items for setting favicon, disable wiki feature</li> <li>Add css id to easily hide user password reset and delete account button</li> <li>[fix] Fix UI bug in restoring a file from snapshot</li> <li>[fix] Fix after renaming a file, the old versions before file rename can't be downloaded</li> <li>[security] Fix XSS problem of the \"go back\" button in history page and snapshot view page</li> <li>[fix] Fix crash problem of seaf-import</li> <li>Add API to create/delete/modify an account in Org</li> <li>[ad/ldap sync] Support import posix group</li> <li>[fix] Fix Office Web App co-authoring problems when opening file in a shared sub-folder</li> <li>[fix] Fix \"IE 9 not supported\" popup message not showing</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#608-20170223","title":"6.0.8 (2017.02.23)","text":"<p>Improvement for admin</p> <ul> <li>Admin can add/delete group members</li> <li>Admin can create group in admin panel</li> <li>Force users to change password if imported via csv</li> <li>Support set user's quota, name when import user via csv</li> <li>Set user's quota in user list page</li> <li>Add search group by group name</li> <li>Use ajax when deleting a user's library in admin panel</li> <li>Support logrotate for controller.log</li> <li>Add a log when a user can't be find in LDAP during login, so that the system admin can know whether it is caused by password error or the user can't be find</li> <li>Delete shared libraries information when deleting a user</li> <li>Add admin API to create default library for a user</li> <li>[ldap-sync]  Support syncing users from AD/LDAP as inactive user</li> </ul> <p>Other</p> <ul> <li>[fix] Fix user search when global address book is disabled in CLOUD_MODE</li> <li>[fix] Avoid timeout in some cases when showing a library trash</li> <li>Show \"the account is inactive\" when an inactive account try to login</li> <li>[security] Remove viewer.js to show open document files (ods, odt) because viewer.js is not actively maintained and may have potential security bugs</li> <li>[fix] Exclude virtual libraries from storage size statistics</li> <li>[fix] Fix mysql gone away problem in seafevents</li> <li>Add region config option for Swift storage backend</li> <li>[anti-virus] Send notification to the library owner if a virus is found</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#607-20170118","title":"6.0.7 (2017.01.18)","text":"<ul> <li>Set users role from Shibboleth affiliation attribute (shibboleth config, search \"Affiliation and user role\")</li> <li>[fix] Uploading files with special names lets seaf-server crash</li> <li>[fix] Fix reading database connection pool setting from ccnet.conf and seafile.conf</li> <li>[fix] Fix total storage integer overflow, which is shown at the info page of admin panel)</li> <li>[fix] Fix the password reset email gets send to the primary account email instead of the contact email of the profile.</li> <li>[fix] Do not check path existence when delete user/group folder permission</li> <li>Support ADFS</li> <li>[fix] Invitation email subject does not get translated</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#606-20170111","title":"6.0.6 (2017.01.11)","text":"<ul> <li>Guest invitation: Prevent the same address can be invited multiple times by the same inviter and by multiple inviters</li> <li>Guest invitation: Add an regex to prevent certain email addresses be invited (see roles permissions)</li> <li>Office online: support co-authoring</li> <li>Admin can set users' department and name when creating users</li> <li>Show total number of files and storage in admin info page</li> <li>Show total number of devices and recently connected devices in admin info page</li> <li>Delete shared libraries information when deleting a user</li> <li>Upgrade Django to 1.8.17</li> <li>Admin can create group in admin panel</li> <li>[fix] Fix quota check: users can't upload a file if the quota will be exceeded after uploading the file</li> <li>[fix] Fix quota check when copy file from one library to another</li> <li>Add <code># -*- coding: utf-8 -*-</code> to seahub_settings.py, so that admin can use non-ascii characters in the file.</li> <li>[fix] Prevent admin from access group's wiki</li> <li>[fix] Prevent transfering libraries to guest account</li> <li>[fix] Prevent guest accout to create share link via API v2</li> <li>Add a log when a user can't be find in LDAP during login, so that the system admin can know whether it is caused by password error or the user can't be find</li> <li>Ingore white space character in the end of lines in ccnet.conf</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#605-20161219","title":"6.0.5 (2016.12.19)","text":"<ul> <li>[fix] Fix generating of password protected link in file view page</li> <li>[fix] Fix .jpg/.JPG image display in IE10</li> <li>Export quota usage in export Excel in user list admin page</li> <li>[fix] Fix admin can't delete broken libraries</li> <li>Add \"back to previous page\" link in trash page, history page</li> <li>[fix] Fix file encoding for text file editing online</li> <li>[fix] Don't show operation buttons for broken libraries in normal users page</li> <li>[fix] Support both <code>[Audit]</code> and <code>[AUDIT]</code> in seafevent.conf</li> <li>[fix] Support utf-8 characters in filename when preview in MSOffice WebApp</li> <li>Support Collabora Online 2.0</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#604-20161129","title":"6.0.4 (2016.11.29)","text":"<ul> <li>[fix] Fix list_inner_pub_repos error in cloud mode</li> <li>[fix] Improve logo show in About dialog</li> <li>[fix] Fix file/folder upload in Firefox 50</li> <li>[fix] Fix groups not shown in admin panel when there are more than 100 groups</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#603-20161117","title":"6.0.3 (2016.11.17)","text":"<ul> <li>[fix] Fix the shared folder link in the notification message when a user share a folder to another user</li> <li>[fix] Update Django version from 1.8.10 to 1.8.16</li> <li>[fix] Fix the shared folder name is not changed after removing the old share, renaming the folder and re-sharing the folder</li> <li>[fix] Fix sub-folder accidentially show the files in parent folder when the parent folder contains more than 100 files</li> <li>[fix] Fix image preview navigation when there are more than 100 entries in a folder</li> <li>[fix] Fix jpeg image display in IE10</li> <li>[fix] Fix bug when admin searching unexisting user</li> <li>Add support for online view of mov video files</li> <li>Make web access token expiring time configurable</li> <li>Add an option on server to control block size for web upload files</li> <li>[fix] Failed to cache (set/get) WOPI_ACCESS_TOKEN_EXPIRATION due to memcached key length limit</li> <li>[fix] Not allow user to set the permissions onto unshared folder. Because it is useless.</li> <li>[fix] Fix condition check when display share icon for guest user</li> <li>Support full-text search and audit log by default</li> <li>[fix] Fix permission dialog bug when the corresponding user/group deleted</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#602-20161020","title":"6.0.2 (2016.10.20)","text":"<ul> <li>[fix] Virus scan fails when the keystone token has expired https://github.com/haiwen/seafile/issues/1737</li> <li>[fix] If you share a sub-folder to a group, the sub-folder will appear as a library in that group page. Don't show \"permission\" menu item for such a shared sub-folder on the group page, because setting permissions on this shared sub-folder not work. The user should set permissions on the original library directly.</li> <li>[fix] Fix API for uploading file by blocks (Used by iOS client when uploading a large file)</li> <li>[fix] Fix a database connection problem in ccnet-server</li> <li>[fix] Fix moved files are still present in local folder until refresh</li> <li>[fix] Fix admin panel can't show deleted libraries</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#601-beta","title":"6.0.1 beta","text":"<ul> <li>Enable create a library from a template</li> <li>Enable office preview by default in installation script</li> <li>[fix] Fix not able to move files via WebDAV interface</li> <li>Check whether the quota will exceed before saving the uploaded file to Seafile via Web UI or API</li> <li>[fix] Fix owner can't restore a deleted file or folder in snapshot</li> <li>[fix] Fix UI of personal profile page</li> <li>[fix] Fix in some cases mobile devices can't be unlinked</li> <li>[fix] Fix connection problem for the latest MariaDB in initialisation script</li> <li>Make maxNumberOfFiles configurable</li> <li>[fix] Remember the sorting of libraries</li> <li>Add Finnish translation</li> <li>Video + audio no longer be limited by max preview size</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#600-beta","title":"6.0.0 beta","text":"<ul> <li>Add full screen Web UI</li> <li>Add file comment</li> <li>Improve zip downloading by adding zip progress</li> <li>Change of navigation labels</li> <li>Support Seafile Drive client</li> <li>[admin] Add group transfer function in admin panel</li> <li>[admin] Admin can set library permissions in admin panel</li> <li>Improve checking the user running Seafile must be the owner of seafile-data. If seafile-data is symbolic link, check the destination folder instead of the symbolic link.</li> <li>[ui] Improve rename operation</li> <li>Show name/contact email in admin panel and enable search user by name/contact email</li> <li>Add printing style for markdown and doc/pdf</li> <li>The \u201cSeafile\u201d in \"Welcome to Seafile\" message can be customised by SITE_NAME</li> <li>Improve sorting of files with numbers</li> <li>[api] Add admin API to only return LDAP imported user list</li> <li>Code clean and update Web APIs</li> <li>Remove number of synced libraries in devices page for simplify the interface and concept</li> <li>Update help pages</li> <li>[online preview] The online preview size limit setting FILE_PREVIEW_MAX_SIZE will not affect videos and audio files. So videos and audio with any size can be previewed online.</li> <li>[online preview] Add printing style for markdown</li> </ul> <p>Pro only features</p> <ul> <li>Support LibreOffice online/Collabora Office online</li> <li>Add two-factor authentication</li> <li>Remote wipe (need desktop client 6.0.0)</li> <li>[anti-virus] Support parallel scan</li> <li>[anti-virus] Add option to only scan a file with size less than xx MB</li> <li>[anti-virus] Add option to specific which file types to scan</li> <li>[anti-virus] Add scanning virus instantly when user upload files via upload link</li> <li>[online preivew] Add printing style for doc/pdf</li> <li>[online preivew] Warn user if online preview only show 50 pages for doc/pdf with more than 50 pages</li> <li>[fix] Fix search only work on the first page of search result pages</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#44","title":"4.4","text":"<p>Note: Two new options are added in version 4.4, both are in seahub_settings.py</p> <ul> <li>SHOW_TRAFFIC: default is True, set to False if you what to hide public link traffic in profile</li> <li>SHARE_LINK_PASSWORD_MIN_LENGTH: default is 8</li> </ul> <p>This version contains no database table change.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#449-20160229","title":"4.4.9 (2016.02.29)","text":"<ul> <li>[fix] Show \u201cout of quota\u201d instead of \u201cDERP\u201d in the case of out of quota when uploading files via web interface</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#448-20151217","title":"4.4.8 (2015.12.17)","text":"<ul> <li>[security] Fix password check for visiting a file in folder sharing link</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#447-20151120","title":"4.4.7 (2015.11.20)","text":"<ul> <li>[fix] Fix viewing PDF files via Office Web App</li> <li>[fix, virus scan] Do not scanning deleted libraries in virus scan</li> <li>[fix, virus scan] Fix showing the virus scan page when libraries containing scanned items are deleted</li> <li>[virus scan] Add more debug information for virus scan</li> <li>[fix] Clean cache when set users' name from web API</li> <li>[fix] Fix a performance problem for generating picture thumbnails from folder sharing link</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#446-20151109","title":"4.4.6 (2015.11.09)","text":"<ul> <li>[security] Fix a XSS problem in raw sharing link</li> <li>[fix] Delete sharing links when deleting a library</li> <li>[fix] Clean Seafile tables when deleting a library</li> <li>[fix] Add  tag to the link in upload folder email notification <li>[fix] Fix a bug in creating a library (after submit a wrong password, the submit button is no longer clickable)</li> <li>[fix, pro] Fix a bug in listing FileUpdate audit log</li> <li>[security, pro] Don't online preview for office files in encrypted libraries</li>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#445-20151030","title":"4.4.5 (2015.10.30)","text":"<ul> <li>[fix] Fix a bug in deleting sharing link in sharing dialog.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#444-20151029","title":"4.4.4 (2015.10.29)","text":"<ul> <li>[fix] Fix support for syncing old formatted libraries</li> <li>Remove commit and fs objects in GC for deleted libraries</li> <li>Add \"transfer\" operation to library list in \"admin panel-&gt;a single user\"</li> <li>[fix] Fix the showing of the folder name for upload link generated from the root of a library</li> <li>[fix] Add access log for online file preview</li> <li>[fix] Fix permission settings for a sub-folder of a shared sub-folder</li> </ul> <p>LDAP improvements and fixes</p> <ul> <li>Only import LDAP users to Seafile internal database upon login</li> <li>Only list imported LDAP users in \"organization-&gt;members\"</li> <li>Add option to not import users via LDAP Sync (Only update information for already imported users). The option name is IMPORT_NEW_USER. See document http://manual.seafile.com/deploy/ldap_user_sync.html (url might deprecated)</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#443-20151020","title":"4.4.3 (2015.10.20)","text":"<ul> <li>[fix] Remove regenerate secret key in update script</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#442-20151019","title":"4.4.2 (2015.10.19)","text":"<ul> <li>[security] Check validity of file object id to avoid a potential attack</li> <li>[fix] Check the validity of system default library template, if it is broken, recreate a new one.</li> <li>[fix] After transfer a library, remove original sharing information</li> <li>[security] Fix possibility to bypass Captcha check</li> <li>[security] More security fixes.</li> <li>[pro] Enable syncing a sub-sub-folder of a shared sub-folder (For example, if you share library-A/sub-folder-B to a group, other group members can selectively sync sub-folder-B/sub-sub-folder-C)</li> <li>[fix, office preview] Handle the case that \"/tmp/seafile-office-output\"is removed by operating system</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#441-beta-20150924","title":"4.4.1 beta (2015.09.24)","text":"<ul> <li>[fix] Fix a bug in setting an user's language</li> <li>[fix] Show detailed failed information when sharing libraries failed</li> <li>[api] Add API to list folders in a folder recursively</li> <li>[api] Add API to list only folders in a folder</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#440-beta-20150921","title":"4.4.0 beta (2015.09.21)","text":"<p>New features:</p> <ul> <li>Allow group names with spaces</li> <li>Enable generating random password when adding an user</li> <li>Add option SHARE_LINK_PASSWORD_MIN_LENGTH</li> <li>Add sorting in share link management page</li> <li>Other UI improvements</li> </ul> <p>Pro only:</p> <ul> <li>Integrate Office Web Apps server</li> <li>Integrate virus scan</li> <li>Support resumable upload (turn off by default)</li> <li>Add option to hide public link traffic in profile (SHOW_TRAFFIC)</li> </ul> <p>Fixes:</p> <ul> <li>[fix] Fix a bug that causing duplications in table LDAPImport</li> <li>set locale when Seahub start to avoid can't start Seahub problem in a few environments.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#43","title":"4.3","text":"<p>Note: this version contains no database table change from v4.2. But the old search index will be deleted and regenerated.</p> <p>Note when upgrading from v4.2 and using cluster, a new option <code>COMPRESS_CACHE_BACKEND = 'locmem://'</code> should be added to seahub_settings.py</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#434-20150914","title":"4.3.4 (2015.09.14)","text":"<ul> <li>[fix] Fix a bug in file locking</li> <li>[fix] Fix sub-folder permission check for file rename/move</li> <li>[fix] Fix a bug in active number of users checking</li> <li>Show total/active number of users in admin panel</li> <li>Counts all downloads into traffic statistics</li> <li>[security] Use POST request to handle password reset request to avoid CSRF attack</li> <li>Don't show password reset link for LDAP users</li> <li>[ui] Small improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#433-20150821","title":"4.3.3 (2015.08.21)","text":"<ul> <li>[fix, important] Bug-fix and improvements for seaf-fsck</li> <li>[fix, important] Improve I/O error handling for file operations on web interface</li> <li>Update shared information when a sub-folder is renamed</li> <li>[fix] Fix bug of list file revisions</li> <li>[fix] Fix syncing sub-folder of encrypted library</li> <li>Update translations</li> <li>[ui] Small improvements</li> <li>[fix] Fix modification operations for system default library by admin</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#432-20150812","title":"4.3.2 (2015.08.12)","text":"<ul> <li>Update translations</li> <li>[fix] Fix bug in showing German translation</li> <li>[fix] Fix bug when remove shared link at library settings page</li> <li>[fix] Fix api error in opCopy/opMove</li> <li>Old library page (used by admin in admin panel): removed 'thumbnail' &amp; 'preview' for image files</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#431-20150731","title":"4.3.1 (2015.07.31)","text":"<ul> <li>[fix] Fix generating image thumbnail</li> <li>[ui] Improve UI for sharing link page, login page, file upload link page</li> <li>[security] Clean web sessions when reset an user's password</li> <li>Delete the user's libraries when deleting an user</li> <li>Show link expiring date in sharing link management page</li> <li>[admin] In a user's admin page, showing libraries' size and last modify time</li> <li>[fix, api] Fix star file API</li> <li>[pro, beta] Add \"Open via Client\" to enable calling local program to open a file at the web</li> </ul> <p>About \"Open via Client\": The web interface will call Seafile desktop client via \"seafile://\" protocol to use local program to open a file. If the file is already synced, the local file will be opened. Otherwise it is downloaded and uploaded after modification. Need client version 4.3.0+</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#430-20150725","title":"4.3.0 (2015.07.25)","text":"<p>Usability improvements</p> <ul> <li>[ui] Improve ui for file view page</li> <li>[ui] Improve ui for sorting files and libraries</li> <li>Redesign sharing dialog</li> <li>Enable generating random password for sharing link</li> <li>Remove direct file sharing between users (You can use sharing link instead)</li> </ul> <p>Pro only features:</p> <ul> <li>Add file locking</li> <li>[fix] Fix file name search for Chinese and other Asia language</li> <li>[fix] Support special password for MySQL database in seafevents</li> </ul> <p>Others</p> <ul> <li>[security] Improve permission check in image thumbnail</li> <li>[security] Regenerate Seahub secret key, the old secret key lack enough randomness</li> <li>Remove the support of \".seaf\" format</li> <li>[api] Add API for generating sharing link with password and expiration</li> <li>[api] Add API for generating uploading link</li> <li>[api] Add API for link files in sharing link</li> <li>Don't listen on 10001 and 12001 by default.</li> <li>Change the setting of THUMBNAIL_DEFAULT_SIZE from string to number, i.e., use <code>THUMBNAIL_DEFAULT_SIZE = 24</code>, instead of <code>THUMBNAIL_DEFAULT_SIZE = '24'</code></li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#42","title":"4.2","text":"<p>Note: because Seafile has changed the way how office preview work in version 4.2.2, you need to clean the old generated files using the command:</p> <pre><code>rm -rf /tmp/seafile-office-output/html/\n</code></pre>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#424-20150708","title":"4.2.4 (2015.07.08)","text":"<ul> <li>More fix on showing share link management page</li> <li>Fix a bug on doc/ppt preview</li> <li>Fix a bug in reading last login time</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#423-20150707","title":"4.2.3 (2015.07.07)","text":"<ul> <li>Fix translation problem for German and other language</li> <li>Remove \"open locally\" feature. It needs more testing</li> <li>Fix a problem in showing share link management page</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#422-20150703","title":"4.2.2 (2015.07.03)","text":"<ul> <li>[fix] Fix file uploading link</li> <li>Add LDAP user sync</li> <li>Improve preview for office files (doc/docx/ppt/pptx)</li> </ul> <p>In the old way, the whole file is converted to HTML5 before returning to the client. By converting an office file to HTML5 page by page, the first page will be displayed faster. By displaying each page in a separate frame, the quality for some files is improved too.</p>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#421-20150630","title":"4.2.1 (2015.06.30)","text":"<p>Improved account management</p> <ul> <li>Add global address book and remove the contacts module (You can disable it if you use CLOUD_MODE by adding ENABLE_GLOBAL_ADDRESSBOOK = False in seahub_settings.py)</li> <li>List users imported from LDAP</li> <li>[guest] Enable guest user by default</li> <li>[guest] Guest user can't generate share link</li> <li>Don't count inactive users as licensed users</li> </ul> <p>Important</p> <ul> <li>[fix] Fix viewing sub-folders for password protected sharing</li> <li>[fix] Fix viewing starred files</li> <li>[fix] Fix support of uploading multiple files in clients' cloud file browser</li> <li>Improve security of password resetting link</li> <li>Remove user private message feature</li> </ul> <p>New features</p> <ul> <li>Enable syncing any folder for an encrypted library</li> <li>Add open file locally (open file via desktop client)</li> </ul> <p>Others</p> <ul> <li>[fix] Fix permission checking for sub-folder permissions</li> <li>Change \"quit\" to \"Leave group\"</li> <li>Clean inline CSS</li> <li>Use image gallery module in sharing link for folders containing images</li> <li>[api] Update file details api, fix error</li> <li>Enable share link file download token available for multiple downloads</li> <li>[fix] Fix visiting share link whose original path is deleted</li> <li>Hide enable sub-library option since it is not meaningless for Pro edition</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#420-20150529","title":"4.2.0 (2015.05.29)","text":"<p>Pro only updates</p> <ul> <li>[new] Support set permission on every sub-folder</li> <li>[search] Support partial match like \"com\" matching \"communication\" in file name</li> <li>[search] The search result page is much clean</li> </ul> <p>Usability</p> <ul> <li>Add direct file download link</li> <li>Remove showing of library description</li> <li>Don't require library description</li> <li>Keep left navigation bar when navigate into a library</li> <li>Generate share link for the root of a library</li> <li>Add loading tip in picture preview page</li> </ul> <p>Security Improvement</p> <ul> <li>Remove access tokens (all clients will log out) when a users password changed</li> <li>Temporary file access tokens can only be used once</li> <li>sudo mode: confirm password before doing sysadmin work</li> </ul> <p>Platform</p> <ul> <li>Use HTTP/HTTPS sync only, no longer use TCP sync protocol</li> <li>Support byte-range requests</li> <li>Automatically clean of trashed libraries</li> <li>[ldap] Save user information into local DB after login via LDAP</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#41","title":"4.1","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#412-20150507","title":"4.1.2 (2015.05.07)","text":"<ul> <li>[fix] Fix bug in syncing LDAP groups</li> <li>[fix] Fix bug in viewing PDF/Doc</li> <li>[fix] Fix crash bug when memcache is full</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#411-20150416","title":"4.1.1 (2015.04.16)","text":"<ul> <li>[fix] Fix Webdav's port can't be changed to non default port (8082)</li> <li>[fix, searching] Fix handling invalid path name when indexing</li> <li>[fix] Fix seaf-fsck for swift/s3/ceph backend</li> <li>Do not show \"this type of file can't be viewed online\"</li> <li>[fix] Fix showing of activity feed in mobile device</li> <li>[fix] Fix viewing sharing link for deleted directories</li> <li>Log email sending in background task to seahub_email_sender.log</li> <li>Improve shibboleth login by supporting \"next\" parameter in URL</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#410-20150401","title":"4.1.0 (2015.04.01)","text":"<p>Pro only updates</p> <ul> <li>Support syncing any sub-folder in the desktop client</li> <li>Add audit log, see http://manual.seafile.com/security/auditing.html (url might deprecated). This feature is turned off by default. To turn it on, see http://manual.seafile.com/deploy_pro/configurable_options.html (url might deprecated)</li> <li>Syncing LDAP groups</li> <li>Add permission setting for a sub-folder (beta)</li> </ul> <p>Updates in community edition too</p> <ul> <li>[fix] Fix image thumbnail in sharing link</li> <li>Show detailed time when mouse over a relative time</li> <li>Add trashed libraries (deleted libraries will first be put into trashed libraries where system admin can restore)</li> <li>Improve seaf-gc.sh</li> <li>Redesign fsck.</li> <li>Add API to support logout/login an account in the desktop client</li> <li>Add API to generate thumbnails for images files</li> <li>Clean syncing tokens after deleting an account</li> <li>Change permission of seahub_settings.py, ccnet.conf, seafile.conf to 0600</li> <li>Update Django to v1.5.12</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#40","title":"4.0","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#406-20150306","title":"4.0.6 (2015.03.06)","text":"<ul> <li>[fix] Fix the seafevents not shutdown by seafile.sh problem</li> <li>Improved shibboleth support</li> <li>[fix] Fix uploading a directory if the top directory only contains sub-folders (no files)</li> <li>Improve thumbnail API</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#405-20150213","title":"4.0.5 (2015.02.13)","text":"<ul> <li>[fix] Fix a crash problem when a client tries to upload corrupted data</li> <li>Add image thumbnails</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#404-20150205","title":"4.0.4 (2015.02.05)","text":"<p>Important</p> <ul> <li>[fix] Fix transfer library error in sysadmin page</li> <li>[fix] Fix showing of space used in sysadmin page for LDAP users</li> <li>[fix] Fix preview office files in file share links and private share</li> <li>Improved trash listing performance</li> </ul> <p>Small</p> <ul> <li>[webdav] list organisation public libraries</li> <li>Disable non-shibboleth login for shibboleth users</li> <li>[fix] Fix wrong timestamp in file view page for files in sub-library</li> <li>Add Web API for thumbnail</li> <li>Add languages for Thai and Turkish, update a few translations</li> <li>[ldap] Following referrals</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#403-20150115","title":"4.0.3 (2015.01.15)","text":"<ul> <li>[fix] Fix memory leak in HTTP syncing</li> <li>Repo owner can restore folders/files from library snapshot</li> <li>Update translations</li> <li>[ldap] Make the \"page result\" support turn off by default to be compatible with community edition.</li> <li>Only repo owner can restore a library to a snapshot</li> <li>[fix] Remote redundant logs in seaf-server</li> <li>[fix] Raise 404 when visiting an non-existing folder</li> <li>[fix] Enable add admin when LDAP is enabled</li> <li>Add API to get server features information (what features are supported by this server)</li> <li>[fix] Fix throttle for /api2/ping</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#402-20150106","title":"4.0.2 (2015.01.06)","text":"<ul> <li>[fix] Fix syncing sub-library with HTTP protocol</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#401-20141229","title":"4.0.1 (2014.12.29)","text":"<ul> <li>Add Shibboleth support (beta)</li> <li>Improve libraries page loading speed by adding cache for library</li> <li>[fix] Fix performance problem of FUSE when using ceph/swift backend</li> <li>[fix] Fix folder upload by drap&amp;drop</li> <li>[fix] Fix version check for pro edition</li> <li>[fix] Fix performance problem in listing files API</li> <li>[fix] Fix listing files of a large folder</li> <li>[fix] Fix folder sharing link with password protection</li> <li>[fix] Fix deleting broken libraries in the system admin panel</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#400-20141213","title":"4.0.0 (2014.12.13)","text":"<ul> <li>Add HTTP syncing support</li> <li>Merge FileServer into seaf-server</li> <li>[web] New upload file dialog</li> <li>[search] Improve the speed of search by removing in-efficient code in calculating file modification time in the search result page.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#31","title":"3.1","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#3113-20141125","title":"3.1.13 (2014.11.25)","text":"<ul> <li>Add WMV video file preview on web</li> <li>Support office documents online preview in cluster deployment</li> <li>[fix] Fix file private sharing bug when file name contains &amp;</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#3112-20141117","title":"3.1.12 (2014.11.17)","text":"<ul> <li>Update ElasticSearch to v1.4</li> <li>Limit content search of txt file to 100KB.</li> <li>Fix \"out of memory\" problem.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#3111-20141103","title":"3.1.11 (2014.11.03)","text":"<ul> <li>[fix] Fixed ./seaf-gc.sh to run online GC</li> <li>[fix] Fixed showing libraries with same name in WebDAV extension in some specific Python version</li> <li>[fix] Fixed event timestamp for library creation and library deleting events</li> <li>[fix] Don't allow setting an encrypted library as default library</li> <li>[fix] Don't list unregistered contacts in sharing dialog</li> <li>Don't list inactive users in \"organization-&gt;members\"</li> <li>[multi-tenancy] Add webdav support</li> <li>Autoupload files when added in web interface</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#3110-20141027","title":"3.1.10 (2014.10.27)","text":"<ul> <li>Online GC: you don't need to shutdown Seafile server to perform GC</li> <li>[fix] Fixed performance problem in WebDAV extension</li> <li>[fix] Fixed quota check in WebDAV extension</li> <li>[fix] Fixed showing libraries with same name in WebDAV extension</li> <li>Add \"clear\" button in a library's trash</li> <li>[fix] Fix small errors when upload files via Web interface</li> <li>[fix] Fix moving/coping files when the select all file checkbox is checked</li> <li>[multi-tenancy] Listing libraries of an organization</li> <li>[multi-tenancy] Enable rename an organization</li> <li>[multi-tenancy] Prevent the deleting of creator account of an organisation</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#319-20141013","title":"3.1.9 (2014.10.13)","text":"<ul> <li>[ldap] split LDAP and Database in organization -&gt; pubuser</li> <li>[ldap] Support pagination for loading users from LDAP</li> <li>[multi-tenancy] fix quota related bugs</li> <li>[office preview] Fix seafevents not start bug when using Python v2.6</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#317-318","title":"3.1.7, 3.1.8","text":"<ul> <li>Add support for multi-tenancy</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#316-20140916","title":"3.1.6 (2014.09.16)","text":"<ul> <li>Add access.log for file download</li> <li>[fix, api] Fix bug in group creation</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#315-20140913","title":"3.1.5 (2014.09.13)","text":"<ul> <li>Add multi-tenancy support</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#314-20140911","title":"3.1.4 (2014.09.11)","text":"<ul> <li>[fix] Fix bug in uploading &gt;1GB files via Web</li> <li>[fix] Remove assert in Ccnet to avoid denial-of-service attack</li> <li>[fix] Add the missing ./seaf-gc.sh</li> <li>Support two modes of license, life-time and subscription</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#313-20140829","title":"3.1.3 (2014.08.29)","text":"<ul> <li>[fix] Fix multi-file upload in upload link and library page</li> <li>[fix] Fix libreoffice file online view</li> <li>Add 'back to top' for pdf file view.</li> <li>[fix] Fix \"create sub-library\" button under some language</li> <li>[fix popup] Fix bug in set single notice as read.</li> <li>Add message content to notification email</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#312-20140827","title":"3.1.2 (2014.08.27)","text":"<ul> <li>[fix] Fix support for guest account</li> <li>[fix, security] Fix permission check for PDF full screen view</li> <li>[fix] Fix copy/move multiple files in web</li> <li>Improve UI for group reply notification</li> <li>Improve seaf-fsck, seaf-fsck now can fix commit missing problem</li> <li>[security improve] Access token generated by FileServer can only be used once.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#311-20140818","title":"3.1.1 (2014.08.18)","text":"<ul> <li>[fix] Fix memory leak</li> <li>[fix] Fix a memory not initialized problem which may cause sync problem under heavy load.</li> <li>[fix, search] Closing database connection first before indexing</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#310-20140815","title":"3.1.0 (2014.08.15)","text":"<p>Pro edition only:</p> <ul> <li>[search] Enable searching directories</li> <li>[search] Enable search groups in organization tab</li> <li>[search] Enable encrypted libraries (filename only)</li> <li>[search, fix] Fix a bug when indexing a large library</li> <li>[preview,fix] Fix document preview for Excel files in sharing links</li> <li>[user] Enable add users as guests. Guests are only able to use libraries shared to him/her.</li> <li>[user] Enable set users password strength requirement</li> <li>[sharing link] Enable set expiring time for sharing links</li> <li>[sharing link] Library owner can manage all share links from this library</li> </ul> <p>Syncing</p> <ul> <li>Improve performance: easily syncing 10k+ files in a library.</li> <li>Don't need to download files if they are moved to another directory.</li> </ul> <p>Platform</p> <ul> <li>Rename HttpServer to FileServer to remove confusing.</li> <li>Support log rotate</li> <li>Use unix domain socket in ccnet to listen for local connections. This isolates the access to ccnet daemon for different users.</li> <li>Delete old PID files when stop Seafile</li> <li>Remove simplejson dependency</li> <li>[fix] fix listing libraries when some libraries are broken</li> <li>Add a bash wrapper for seafile-gc</li> </ul> <p>Web</p> <ul> <li>Enable deleting of personal messages</li> <li>Improved notification</li> <li>Upgrade pdf.js</li> <li>Password protection for sharing links</li> <li>[admin] Create multi-users by uploading a CSV file</li> <li>Sort libraries by name/date</li> <li>Enable users to put an additional message when sending a sharing link</li> <li>Expiring time for sharing links</li> <li>[fix] Send notification to all users participating a group discussion</li> <li>Redesigned file viewing page</li> <li>Remove simplejson dependency</li> <li>Disable the ability to make a group public by default (admin can turn it on in settings)</li> <li>Add \"Back to Top\" button in file view page</li> <li>Improve page refreshing after uploading files</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#30","title":"3.0","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#307","title":"3.0.7","text":"<ul> <li>Add support for logrotate</li> <li>[fix] Fix script for migrating from community edition</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#306","title":"3.0.6","text":"<ul> <li>Fix seahub failing to start problem when Ceph backend is used</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#305","title":"3.0.5","text":"<ul> <li>Add option to enable highlight search keyword in the file view</li> <li>[fix] Fix \"Save to My Library\" in file sharing</li> <li>[fix] Fix API for renaming files containing non-ASCII characters from mobile clients</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#304","title":"3.0.4","text":"<ul> <li>Add support for MariaDB Cluster</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#303","title":"3.0.3","text":"<p>Web</p> <ul> <li>Show a notice when one tries to reset/change the password of a LDAP user</li> <li>Improve the initial size of pdf/office documents online preview</li> <li>Handle languages more gracefully in search</li> <li>Highlight the keywords in the search results</li> <li>[fix] Fixed a web page display problem for French language</li> </ul> <p>Platform</p> <ul> <li>Improve the speed when saving objects to disks</li> <li>Show error messages when seahub.sh script failed to start</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#302","title":"3.0.2","text":"<ul> <li>Added Ceph storage backend support</li> <li>Use random ID as avatar file name instead of the file name uploaded by the user</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#301","title":"3.0.1","text":"<ul> <li>[fix] Fix an UI bug in selecting multiple contacts in sending message</li> <li>Library browser page: Loading contacts asynchronously to improve initial loading speed</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#300","title":"3.0.0","text":"<p>Web</p> <ul> <li>Redesigned UI</li> <li>[admin] Add login log</li> <li>[admin] Add share link traffic statistics</li> <li>[fix] Handle loading avatar exceptions to avoid 500 error</li> <li>Fixed a few api errors</li> <li>Improve page loading speed</li> <li>[fix] Fix UI problem when selecting contacts in personal message send form</li> <li>[fix] Add nickname check and escape nickname to prevent XSS attack</li> <li>[fix] Check validity of library name (only allow a valid directory name).</li> </ul> <p>Platform</p> <ul> <li>Separate the storage of libraries</li> <li>Record files' last modification time directly</li> <li>Keep file timestamp during syncing</li> <li>Allow changing password of an encrypted library</li> <li>Allow config httpserver bind address</li> <li>Improved device (desktop and mobile clients) management</li> </ul> <p>Misc</p> <ul> <li>[fix] Fix API for uploading files from iOS in an encrypted library.</li> <li>[fix] Fix API for getting groups messages containing multiple file attachments</li> <li>[fix] Fix bug in HttpServer when file block is missing</li> <li>[fix] Fix login error for some kind of Android</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#22","title":"2.2","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#221","title":"2.2.1","text":"<ul> <li>Add more checking for the validity of users' Email</li> <li>Use random salt and PBKDF2 algorithm to store users' password.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#21","title":"2.1","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#215","title":"2.1.5","text":"<ul> <li>Add correct mime types for mp4 files when downloading</li> <li>[important] set correct file mode bit after uploading a file from web.</li> <li>Show meaningful message instead of \"auto merged by system\" for file merges</li> <li>Improve file history calculation for files which were renamed</li> </ul> <p>WebDAV</p> <ul> <li>Return last modified time of files</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#214-1","title":"2.1.4-1","text":"<ul> <li>[fix] fixed the <code>pro.py search --clear</code> command</li> <li>[fix] fixed full text search for office/pdf files</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#214","title":"2.1.4","text":"<ul> <li>Improved Microsoft Excel files online preview</li> <li>[fix] Fixed file share link download issue on some browsers.</li> <li>[wiki] Enable create index for wiki.</li> <li>Hide email address in avatar.</li> <li>Show \"create library\" button on Organization page.</li> <li>[fix] Further improve markdown filter to avoid XSS attack.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#213","title":"2.1.3","text":"<ul> <li>Fixed a problem of Seafile WebDAV server</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#212","title":"2.1.2","text":"<ul> <li>Fixed a problem of requiring python boto library even if it's not needed.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#211","title":"2.1.1","text":"<p>Platform</p> <ul> <li>Added FUSE support, currently read-only</li> <li>Added WebDAV support</li> <li>A default library would be created for new users on first login to seahub</li> <li>Upgrade scripts support MySQL databases now</li> </ul> <p>Web</p> <ul> <li>Redesigned Web UI</li> <li>Redesigned notification module</li> <li>Uploadable share links</li> <li>[login] Added captcha to prevent brute force attack</li> <li>[login] Allow the user to choose the expiration of the session when login</li> <li>[login] Change default session expiration age to 1 day</li> <li>[fix] Fixed a bug of \"trembling\" when scrolling file lists</li> <li>[sub-library] User can choose whether to enable sub-library</li> <li>Improved error messages when upload fails</li> <li>Set default browser file upload size limit to unlimited</li> </ul> <p>Web for Admin</p> <ul> <li>Improved admin UI</li> <li>More flexible customization options</li> <li>Support specify the width of height of custom LOGO</li> <li>Online help is now bundled within Seahub</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#20","title":"2.0","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#205","title":"2.0.5","text":"<ul> <li>Support S3-compatible storage backends like Swift</li> <li>Support use existing elasticsearch server</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#204","title":"2.0.4","text":"<ul> <li>[fix] set the utf8 charset when connecting to database</li> <li>Use users from both database and LDAP</li> <li>[admin] List database and LDAP users in sysadmin</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#203","title":"2.0.3","text":"<ul> <li>[fix] Speed up file syncing when there are lots of small files</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#201","title":"2.0.1","text":"<ul> <li>[fix] Elasticsearch now would not be started if search is not enabled</li> <li>[fix] Fix CIFS support.</li> <li>[fix] Support special characters like '@' in MySQL password</li> <li>[fix] Fix create library from desktop client when deploy Seafile with Apache.</li> <li>[fix] Fix sql syntax error in ccnet.log, issue #400 (https://github.com/haiwen/seafile/issues/400).</li> <li>[fix] Return organization libraries to the client.</li> <li>Update French, German and Portuguese (Brazil) languages.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#200","title":"2.0.0","text":"<p>Platform</p> <ul> <li>New crypto scheme for encrypted libraries</li> <li>A fsck utility for checking data integrity</li> </ul> <p>Web</p> <ul> <li>Change owner of a library/group</li> <li>Move/delete/copy multiple files</li> <li>Automatically save draft during online editing  </li> <li>Add \"clear format\" to .seaf file online editing</li> <li>Support user delete its own account</li> <li>Hide Wiki module by default</li> <li>Remove the concept of sub-library</li> </ul> <p>Web for Admin</p> <ul> <li>Change owner of a library</li> <li>Search user/library</li> </ul> <p>API</p> <ul> <li>Add list/add/delete user API</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#18","title":"1.8","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#183","title":"1.8.3","text":"<ul> <li>Improve seahub.sh</li> <li>Improve license checking</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#182","title":"1.8.2","text":"<ul> <li>fixed 'cannot enter space' bug for .seaf file online edit</li> <li>add paginating for repo files list</li> <li>fixed a bug for empty repo</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#181","title":"1.8.1","text":"<ul> <li>Remove redundant log messages</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#180","title":"1.8.0","text":"<p>Web</p> <ul> <li>Improve online file browsing and uploading</li> <li>Redesigned interface</li> <li>Use ajax for file operations</li> <li>Support selecting of multiple files in uploading</li> <li>Support drag/drop in uploading</li> <li>Improve file syncing and sharing</li> <li>Syncing and sharing a sub-directory of an existing library.</li> <li>Directly sharing files between two users (instead of generating public links)</li> <li>User can save shared files to one's own library</li> <li>[wiki] Add frame and max-width to images</li> <li>Use 127.0.0.1 to read files (markdown, txt, pdf) in file preview</li> <li>[bugfix] Fix pagination in library snapshot page</li> <li>Set the max length of message reply from 128 characters to 2000 characters.</li> </ul> <p>API</p> <ul> <li>Add creating/deleting library API</li> </ul> <p>Platform</p> <ul> <li>Improve HTTPS support, now HTTPS reverse proxy is the recommend way.</li> <li>Add LDAP filter and multiple DN</li> <li>Case insensitive login</li> <li>Move log files to a single directory</li> <li>[security] Add salt when saving user's password</li> <li>[bugfix] Fix a bug in handling client connection</li> <li>Add a script to automate setup seafile with MySQL</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#17","title":"1.7","text":""},{"location":"changelog/changelog-for-seafile-professional-server-old/#1704","title":"1.7.0.4","text":"<ul> <li>Fixed a bug in file activities module</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server-old/#170","title":"1.7.0","text":"<ul> <li>First release of Seafile Professional Server</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/","title":"Seafile Professional Server Changelog","text":"<p>You can check Seafile release table to find the lifetime of each release and current supported OS: https://cloud.seatable.io/dtable/external-links/a85d4221e41344c19566/?tid=0000&amp;vid=0000</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#120","title":"12.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 12.0</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#12015-2025-08-15","title":"12.0.15 (2025-08-15)","text":"<ul> <li>[fix] Fix OCM support</li> <li>[fix] Fix sending anti-virus email to system admin using contract email</li> <li>[fix] Fix expiring check for upload link</li> <li>[fix] Fix smart-link accessing for shared folders in multi-tenancy mode</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#12014-2025-05-28","title":"12.0.14 (2025-05-28)","text":"<ul> <li>[fix] Fix two stored XSS issues (In rendering terms and conditions and in institution admin page)</li> <li>[fix] Do not close the search popover when click a result</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#12013-2025-05-09","title":"12.0.13 (2025-05-09)","text":"<ul> <li>Add S/MIME support for emails</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#12012-2025-04-21","title":"12.0.12 (2025-04-21)","text":"<ul> <li>[fix] Fix a UI bug in \"share admin -&gt; share links\"</li> <li>[fix] Fix a bug in rendering \"system admin -&gt; users\"</li> <li>Update translations</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#12011-2025-03-20","title":"12.0.11 (2025-03-20)","text":"<ul> <li>[fix] Fix a stored XSS issue</li> <li>[fix] Do not show Wiki libraries in clients and WebDAV</li> <li>Add library name in \"share admin -&gt; folders\"</li> <li>[fix] Fix set of library history keep days</li> <li>[fix] Fix support for enforcing Two-Factor Authentication</li> <li>Update support for working with SeaSearch 0.9.1</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#12010-2025-03-05","title":"12.0.10 (2025-03-05)","text":"<ul> <li>[fix] Fix seaf-fuse support</li> <li>[fix] Fix \"save to\" button in external link</li> <li>[fix] Search library text in system admin page is incorrect</li> <li>[fix] Fix library path displays issue in read-only shared</li> <li>Improve icons for creating Wiki and inviting links</li> <li>[fix] Fix a bug in Collabora integration: Interface in English despite Seafile interface in French</li> <li>Delete temp files if zip download failed</li> <li>Create a record in social_auth table when user login via SSO even if SSO_LDAP_USE_SAME_UID enabled</li> <li>[fix] Cannot create a share link with the \u201ccloud edit\u201d permission for OpenDocument (odt, ods, odp, odg)</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1209-beta-2025-02-12","title":"12.0.9 beta (2025-02-12)","text":"<ul> <li>[fix] Fix a bug related to smart-link in mutli-tenancy mode</li> <li>Improve consistency of format of logs</li> <li>DISABLE_ADFS_USER_PWD_LOGIN now work for OAuth too</li> <li>[fix] Fix a bug in search indexing with SeaSearch backend</li> <li>[fix] Thumbnail server does not preserve ICC profiles, resulting in washed out colors</li> <li>[fix] A few small UI fixes and improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1208-beta-2025-01-17","title":"12.0.8 beta (2025-01-17)","text":"<ul> <li>A redesigned Web UI</li> <li>SeaDoc is now stable, providing online notes and documents feature</li> <li>A new wiki module</li> <li>A new trash mechanism, that deleted files will be recorded in database for fast listing</li> <li>The password strength level is now calculated by algorithm. The old USER_PASSWORD_MIN_LENGTH, USER_PASSWORD_STRENGTH_LEVEL is removed. Only USER_STRONG_PASSWORD_REQUIRED is still used.</li> <li>ADDITIONAL_APP_BOTTOM_LINKS is removed. Because there is no buttom bar in the navigation side bar now.</li> <li>SERVICE_URL and FILE_SERVER_ROOT are removed. SERVICE_URL will be calculated from SEAFILE_SERVER_PROTOCOL and SEAFILE_SERVER_HOSTNAME in <code>.env</code> file.</li> <li><code>ccnet.conf</code> is removed. Some of its configuration items are moved from <code>.env</code> file, others are read from items in <code>seafile.conf</code> with same name.</li> <li>For security reason, WebDAV no longer support login with LDAP account, the user with LDAP account must generate a WebDAV token at the profile page</li> <li>[File tags] The current file tags feature is deprecated. We will re-implement a new one in version 13.0 with a new general metadata management module.</li> <li>For ElasticSearch based search, full text search of doc/xls/ppt file types are no longer supported. This enable us to remove Java dependency in Seafile side.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#110","title":"11.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 11.0</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#11019-2025-03-21","title":"11.0.19 (2025-03-21)","text":"<ul> <li>[fix] Fix a stored XSS issue</li> <li>SSO_LDAP_USE_SAME_UID option now support Shibboleth login method</li> <li>[fix] Fix a bug when a user view a shared file belong to a deleted user</li> <li>Improve SAML error message when exceed number of user limit of license</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11018-2025-01-20","title":"11.0.18 (2025-01-20\uff09","text":"<ul> <li>[fix] Fix license check in SAML mode</li> <li>[fix] Do not change a user's role if it is manully set in Shibboleth login</li> <li>Support using different office suites for different roles</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11017-2025-01-04","title":"11.0.17 (2025-01-04)","text":"<ul> <li>[fix] Fix a few issues in golang file server related to permission check</li> <li>[fix] Fix a bug in golang file server related to online GC</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11016-2024-11-04","title":"11.0.16 (2024-11-04)","text":"<ul> <li>The storage migration script now does not allow migration to the original bucket</li> <li>[Security] Do not allow .. as a file directory name</li> <li>[fix] Search results now show the first 20 entries and the user can click more to jump to the page dedicated to search</li> <li>[fix] Fixed SSE_C support</li> <li>Added an option USE_LDAP_SYNC_ONLY to meet the case that using LDAP to sync users to Seafile and let users to login via SSO only</li> <li>[fix] Hide the print button when opening with office online server for preview only the folder share</li> <li>[fix] Do not send file lock notifications to notification server if notification server is not configured for golang fileserver</li> <li>[fix] Sending Links with Passwords has no HTML escape</li> <li>[fix] Fix preview support for TIFF images</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11015-2024-10-17","title":"11.0.15 (2024-10-17)","text":"<ul> <li>[fix] Check the length of email in login form, preventing too long input</li> <li>[fix] Use user name instead of user ID in email content</li> <li>[fix] auth-token API also prevent brute force attack</li> <li>[fix] Fix invite people in multi-tenancy mode</li> <li>[fix] Add option SSO_LDAP_USE_SAME_UID</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11014-2024-08-22","title":"11.0.14 (2024-08-22)","text":"<ul> <li>[fix] Fix a bug that system admin can not share a library in admin panel</li> <li>[fix] Fix a bug when syncing user role in LDAP sync</li> <li>[fix] Fix S3 support configuration</li> <li>[fix] Add redis package in Docker image</li> <li>[fix] Improve client side SSO via local browser</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11013-2024-08-14","title":"11.0.13 (2024-08-14)","text":"<ul> <li>Update translations</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11012-2024-08-07","title":"11.0.12 (2024-08-07)","text":"<ul> <li>[fix] [important] Fix a security bug in WebDAV</li> <li>[fix] Fix S3 backend with V4 protocal and path_style_request</li> <li>[fix] Use user's name in reset password email instead of internal ID</li> <li>[fix] Fix invited guest cannot be revoke</li> <li>[fix] Fix keyerror when using backup code in two-factor auth</li> <li>[fix] Do not print warning in seaf-server.log when a LDAP user login</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11011-2024-07-24","title":"11.0.11 (2024-07-24)","text":"<ul> <li>Remove unnecessary warning in seahub_email_sender.log </li> <li>[fix] Fix a performance issue in sending file activities notification via email</li> <li>Remove REPLACE_FROM_EMAIL setting as most email server does not support it</li> <li>[fix] Fix a bug in LDAP login with multiple OU</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#11010-2024-07-09","title":"11.0.10 (2024-07-09)","text":"<ul> <li>[fix] Fix system admin users page when institution feature is enabled</li> <li>Improving logging of search index</li> <li>[fix] Support using contact email in OCM sharing</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1109-2024-06-25","title":"11.0.9 (2024-06-25)","text":"<ul> <li>[fix] Fix a crash problem in golang file server introduced in version 11.0.8</li> <li>Add a new role permission \"can_share_repo\"</li> <li>Add rate control for password reset for a user</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1108-2024-06-20","title":"11.0.8 (2024-06-20)","text":"<ul> <li>support named groups in SAML claim</li> <li>[fix] Fix CollaboraOnline integration for read-only shares and share links</li> <li>[fix] Fix display issue for ADDITIONAL_SHARE_DIALOG_NOTE</li> <li>[fix] Fix buckets check for ceph and swift backend</li> <li>[fix] Use contact_email in user freeze notifications for system admins</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1107-2024-06-03","title":"11.0.7 (2024-06-03)","text":"<p>Seafile</p> <ul> <li>Improve accessibility</li> <li>Support open ODG files with LibreOffice (Collabora Online)</li> <li>Support showing last modified time for folders in WebDAV</li> <li>[fix] Fix \"remember me\" in 2FA</li> <li>Enable transfering a library to department in system admin panel</li> <li>[fix] Fix a bug in SAML single logout</li> </ul> <p>SDoc editor 0.8</p> <ul> <li>Support automatically adjusting table width to fit page width</li> <li>Improve comments feature</li> <li>Improve documents shown on mobile</li> <li>More UI fixes and improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1106-beta-2024-04-19","title":"11.0.6 beta (2024-04-19)","text":"<p>Seafile</p> <ul> <li>Support log rotate for golang file server and notification server</li> <li>Update UI for upload link</li> <li>Support OnlyOffice version feature</li> <li>Show files' original path in the trash</li> <li>Fix traffic statistics</li> <li>Fix an error in LDAP user sync</li> <li>Add an option DISABLE_ADFS_USER_PWD_LOGIN to prevent SAML users login via email/password</li> </ul> <p>SDoc editor 0.7</p> <ul> <li>Improve file comment feature</li> <li>Improve file diff showing</li> <li>Support print a document</li> <li>Improve table editing</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1105-beta-2024-03-20","title":"11.0.5 beta (2024-03-20)","text":"<ul> <li>Forbid generating share links for a library if the user has invisible/cloud-read-only permission on the library</li> <li>[fix] Fix a configuration error for Ceph storage (if you don't use S3 interface)</li> <li>[fix] Fix a bug in traffic statistic in golang file server</li> <li>Support use different index names for ElasticSearch</li> <li>Fix column view is limited to 100 items</li> <li>Fix LDAP user login for WebDAV</li> <li>Remove the configuration item \"ENABLE_FILE_COMMENT\" as it is no longer needed</li> <li>Enable copy/move files between encrypted and non-encrypted libraries</li> <li>Forbid creating libraries with Emoji in name</li> <li>Fix some letters in the file name do not fit in height in some dialogs</li> <li>Fix a performance issue in sending file updates report</li> <li>Some other UI fixes and improvements</li> </ul> <p>SDoc editor 0.6</p> <ul> <li>Support convert docx file to sdoc file</li> <li>Support Markdown format in comments</li> <li>Support drag rows/columns in table element and other improvements for table elements</li> <li>Other UI fixes and improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1104-beta-and-sdoc-editor-05-2024-02-01","title":"11.0.4 beta and SDoc editor 0.5 (2024-02-01)","text":"<p>Major changes</p> <ul> <li>Use a virtual ID to identify a user</li> <li>LDAP login update</li> <li>SAML/Shibboleth/OAuth login update</li> <li>Update Django to version 4.2</li> <li>Update SQLAlchemy to version 2.x</li> <li>Add SeaDoc</li> </ul> <p>UI Improvements</p> <ul> <li>Improve UI of PDF view page</li> <li>Update folder icon</li> <li>The activities page support filter records based on modifiers</li> <li>Add indicator for folders that has been shared out</li> <li>Use file type icon as favicon for file preview pages</li> <li>Support preview of JFIF image format</li> </ul> <p>Pro edition only changes</p> <ul> <li>Support S3 SSE-C encryption</li> <li>Support a new invisible sub-folder permission</li> <li>Update of online read-write permission, online read-write permission now support the shared user to update/rename/delete files online, making it consistent with normal read-write permission</li> </ul> <p>Other changes</p> <ul> <li>Remove file comment features as they are used very little (except for SeaDoc)</li> <li>Add move dir/file, copy dir/file, delete dir/file, rename dir/file APIs for library token based API</li> <li>Use user's current language when create Office files in OnlyOffice</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#100","title":"10.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 10.0.</p> <p>Note</p> <p>If you upgrade to version 10.0.18+ from 10.0.16 or below, you need to upgrade the sqlalchemy to version 1.4.44+ if you use binary based installation. Otherwise \"activities\" page will not work.</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#10018-2024-11-01","title":"10.0.18 (2024-11-01)","text":"<ul> <li>[fix] Prevent the creating of files with name \"..\"</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#10017-2024-10-23","title":"10.0.17 (2024-10-23)","text":"<p>This release is for Docker image only</p> <ul> <li>[fix] Update the version of sqlalchemy to make \"activities\" page work. The bug was introduced in v10.0.16.</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#10016-2024-06-21","title":"10.0.16 (2024-06-21)","text":"<ul> <li>[fix] Fix CollaboraOnline integration for read-only shares and share links</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#10015-2024-03-21","title":"10.0.15 (2024-03-21)","text":"<ul> <li>[Fix] Fix a bug in seaf-gc for FS object</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#10014-2024-02-27","title":"10.0.14 (2024-02-27)","text":"<ul> <li>Update some translations</li> <li>[Fix] Fix a bug in OnlyOffice desktop editor integration</li> <li>[Fix] Fix a bug in moving file dialog</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#10013-2024-02-05","title":"10.0.13 (2024-02-05)","text":"<ul> <li>[security] Upgrade pillow dependency from 9.0 to 10.0.</li> </ul> <p>Note, after upgrading to this version, you need to upgrade the Python libraries in your server \"pillow==10.2.* captcha==0.5.* django_simple_captcha==0.5.20\" </p>"},{"location":"changelog/changelog-for-seafile-professional-server/#10012-2024-01-16","title":"10.0.12 (2024-01-16)","text":"<ul> <li>Improved WOPI-integration of Collabora Online</li> <li>Fix \"Share Admin-&gt;Links-&gt;Share Links\" crash when shared link file does not exist anymore</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#10011-2023-11-09","title":"10.0.11 (2023-11-09)","text":"<ul> <li>[fix] Improve error message in SAML login when the IdP have a connection problem</li> <li>[fix] Fix a bug that go fileserver causing client to generate empty commit</li> <li>[fix] Add missing max number of files for a library when uploading via WebDAV</li> <li>[fix] Show which users cannot be imported when importing users to group</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#10010-2023-10-17","title":"10.0.10 (2023-10-17)","text":"<ul> <li>[fix] Fix a bug in golang file server that cannot handle sharing permission correctly for departments</li> <li>[fix] Fix a bug Share Link Email Verification cannot work for Italy language</li> <li>[fix] Fix notification server support in golang file server</li> <li>[fix] Fix a bug in search library by ID in admin panel</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1009-2023-08-25","title":"10.0.9 (2023-08-25)","text":"<ul> <li>Add an option (library_file_limit in seafile.conf) to support setting the maximum number of files in a single library</li> <li>[fix] Support for virus scan in golang file server when uploading files via upload links</li> <li>Some UI fixes and improvements</li> <li>Improve script clear_invalid_repo_data.py</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1008-2023-08-01","title":"10.0.8 (2023-08-01)","text":"<ul> <li>[fix] Fix a bug in worker pool management in golang file server</li> <li>Improve error message when a user log in via SAML in multi-tenancy mode</li> <li>[fix] Fix a bug that causing fsck crash</li> <li>Improve the way how cluster_shared folder is cleaned up</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1007-2023-07-25","title":"10.0.7 (2023-07-25)","text":"<ul> <li>[fix] Fix a memory leak in golang file server</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1006-2023-06-27","title":"10.0.6 (2023-06-27)","text":"<ul> <li>[fix] Fix \"all notifications\" page link broken when notification server is used</li> <li>[fix] Fix UI bug of notifications dialog</li> <li>[fix] Fix a bug in listing shared out libraries/folders in multi-tenancy mode</li> <li>[fix] Fix a bug in sending emails to admin when finding virus</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1005-2023-06-12","title":"10.0.5 (2023-06-12)","text":"<ul> <li>[fix] Fix display of tags in the file details side bar</li> <li>[fix] Fix a file name encoding bug in golang file server</li> <li>[fix] Fix a UI bug in setting expiration time for a sharing link</li> <li>Update included POI java library which is used to extracting contents of doc/docx files in indexing</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1004-2023-05-17","title":"10.0.4 (2023-05-17)","text":"<ul> <li>Add \"Undo\" action in the notification toast after deleting files and folders</li> <li>Improve UI of system admin -&gt; department page</li> <li>Support online preview of more audio file formats</li> <li>Support TLS connection to MySQL/MariaDB server</li> <li>[fix] Fix a few bugs in notification server</li> <li>Some other UI improvements</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1003-beta-2023-04-12","title":"10.0.3 beta (2023-04-12)","text":"<ul> <li>[fix] Fix a performance issue when displaying many share links for a single file</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1002-beta-2023-04-12","title":"10.0.2 beta (2023-04-12)","text":"<ul> <li>Support generating multiple share links for a file and a folder</li> <li>[fix] Fix a bug in golang file server when zip-downloading a folder in encrypted library</li> <li>[fix] Fix a bug in upgrading script when there is no configuration for Nginx</li> <li>Video player support changing playback speed</li> <li>[fix] Fix a few bugs in notification server</li> <li>[multi-tenancy] Support org admin to changing logo for each organization</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#1000-beta-2023-04-12","title":"10.0.0 beta (2023-04-12)","text":"<ul> <li>Update Python dependencies and support Ubuntu 22.04 and Debian 11</li> <li>Update ElasticSearch to 8.0</li> <li>[new] Add a new notification server (document will be provided later)</li> <li>[new] Support downloading/uploading rate limit for a user</li> <li>[new] Watch and get notifications for libraries</li> <li>[new] Support each organization to have its own SAML login in multi-tenancy mode</li> <li>Update WebDAV password to use one-way hash</li> <li>Remove SQL sub queries to improve SQL query speed in seaf-server</li> <li>Show number of shared users/groups if any when deleting a folder</li> <li>Support online playing of .wav files</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#90","title":"9.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 9.0.</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#9016-2023-03-22","title":"9.0.16 (2023-03-22)","text":"<ul> <li>[fix] Fix a bug in clear_invalid_repo_data with virtual repos </li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#9015-2023-03-01","title":"9.0.15 (2023-03-01)","text":"<ul> <li>[fix] Fix a bug in seaf-gc for fs object</li> <li>[fix] Fix some bugs in golang fileserver</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#9014-2023-01-06","title":"9.0.14 (2023-01-06)","text":"<ul> <li>[fix] Fix some bugs in golang fileserver</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#9013-2022-11-11","title":"9.0.13 (2022-11-11)","text":"<ul> <li>[multi-tenancy] Add device management for organization admin</li> <li>[multi-tenancy] Add statistics for organization admin</li> <li>[multi-tenancy] Support import users from xlsx</li> <li>[fix] Prevent system admin creating libraries with invalid name in admin panel</li> <li>Add \"create\" permission in custome sharing permission</li> <li>Improve performance in golang file server</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#9012-2022-11-04","title":"9.0.12 (2022-11-04)","text":"<ul> <li>Enable 'zoom in/out by pinch' for mobile in pdf file view page</li> <li>[fix] Fix recording device information for desktop clients login with SSO</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#9011-2022-10-27","title":"9.0.11 (2022-10-27)","text":"<ul> <li>[fix] Fix file accessed by seadrive cannot be correctly logged in access log</li> <li>[fix] Fix \"document convertion failed\u201d error visiting a shared document with preview only</li> <li>[fix] Fix memory leak when block cache is enabled</li> <li>[fix] Add unique index to repo_id_file_path_md5 in table onlyoffice_onlyofficedockey</li> <li>[fix] Fix the default created ElasticSearch(v7.x) index has only one shard</li> <li>[fix] Fix search in move files dialog not working</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#9010-2022-10-12","title":"9.0.10 (2022-10-12)","text":"<ul> <li>Admin list all users API now return last_login and last_access_time</li> <li>[fix] Fix a bug in displaying markdown file in sharing link</li> <li>[fix] Fix notification mails are sent to inactive users</li> <li>[fix] Fix viewing a file in an old snapshot leads to server hickup</li> <li>[fix] Fix an HTTP/500 \"Internal server error\" when the user sets password containing non-latin characters for sharing links</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#909-2022-09-22","title":"9.0.9 (2022-09-22)","text":"<ul> <li>[fix] Fix a memory leak problem</li> <li>[fix] Fix a bug that will lead to seaf-fsck crash</li> <li>[fix] Fix a stored XSS problem for library names</li> <li>[fix] Disable open a file in OnlyOffice for encrypted libraries when open from trash</li> <li>[fix] Fix library template feature cannot work for department libraries</li> <li>[fix] Fix file locking display on client for shared sub-folder</li> <li>[fix] Fix a memcached problem in go fileserver</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#908-2022-09-09","title":"9.0.8 (2022-09-09)","text":"<ul> <li>[fix] Fix a UI bug in sending sharing link by email</li> <li>[fix] Markdown editor does not properly filter javscript URIs from the href attribute, which results in stored XSS</li> <li>[fix] Fix a bug in OCM sharing</li> <li>[fix] Fix a bug in un-linking a device in admin panel</li> <li>[fix] Adding URL security check in /accounts/login redirect by ?next= parameter</li> <li>Improve Onlyoffice document info cache handling</li> <li>[fix] Fix a performance problem in go fileserver</li> <li>When a Custom Sharing Permissions is deleted, removing corresponding shares</li> <li>[fix] Don't show auto-deletion menu item when the feature is not enabled</li> <li>[fix] Fix a bug in reading a role's quota when a user login with SSO</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#907-20220811","title":"9.0.7 (2022/08/11)","text":"<p>Note: included lxml library is removed for some compatiblity reason. The library is used in published libraries feature and WebDAV feature. You need to install lxml manually after upgrade to 9.0.7. Use command <code>pip3 install lxml</code> to install it.</p> <ul> <li>A page in published libraries is rendered at the server side to improve loading speed.</li> <li>Upgrade Django from 3.2.6 to 3.2.14</li> <li>Fix a bug in collaboration notice sending via email to users' contact email</li> <li>Support OnlyOffice oform/docxf files</li> <li>Improve user search when sharing a library</li> <li>Admin panel support searching a library via ID prefix</li> <li>[fix] Fix preview PSD images</li> <li>[fix] Fix a bug that office files can't be opened in sharing links via OnlyOffice</li> <li>[fix] Go fileserver: Folder or File is not deletable when there is a spurious utf-8 char inside the filename</li> <li>[fix] Fix file moving in WebDAV</li> <li>ElasticSearch now support https</li> <li>Support advanced permissions like cloud-preview only, cloud read-write only when shareing a department library</li> <li>[fix] Fix a bug in get library sharing info in multi-tenancy mode</li> <li>[fix] Fix a bug in library list cache used by syncing client</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#906-20220706","title":"9.0.6 (2022/07/06)","text":"<ul> <li>Support using custom permission when shareing a department library</li> <li>[fix] Fix a bug in go file-server when working with online GC</li> <li>Add cache for getting locked files and getting folder permission (reduce server load caused by sycing client)</li> <li>Show table of contents in Markdown sharing link</li> <li>Check if quota exceeded before file uploading in upload sharing link</li> <li>Support import group member via contact email</li> <li>[fix] Fix a bug that sometimes a shared subfolder is unshared automatically by database access error</li> <li>[fix] Fix a bug in work with Python 3.10+</li> <li>[fix] Fix a bug in smart link redirect to the file page</li> <li>[fix] Fix a UI bug when drag and drop a file</li> <li>Improve UI of file comments</li> <li>[fix] Fix permission check in deleting/editing a file comment</li> <li>Support editing of expire time for sharing links</li> <li>Show ISO date and time in file history page instead of showing relative time</li> <li>Add \"Visit related snapshot\" in the dropdown menu of an entry in file history</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#905-20220321","title":"9.0.5 (2022/03/21)","text":"<ul> <li>Remove unused \"related files\" feature</li> <li>[fix] Fix zip downloading a folder not having .zip suffix when using golang file server</li> <li>UI improvement of file label feature</li> <li>Show file labels in folder sharing links</li> <li>Improve performance when deleting virtual repos when original repo is deleted</li> <li>[fix, security] Fix permission check in deleting/editing a file comment</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#904-20220124","title":"9.0.4 (2022/01/24)","text":"<ul> <li>Users can save files or folders in shared folder link to their own libraries</li> <li>[fix] Fix markdown file print</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#903-beta-20211228","title":"9.0.3 beta (2021/12/28)","text":"<ul> <li>Upgrade ElasticSearch to version 7.x</li> <li>Improve UI of file moving/copying dialog to show folders with long names</li> <li>Expand to the current folder when open file moving/copying dialog</li> <li>[fix] Fix a bug in golang file server log rotate support</li> <li>[fix] Fix a bug in folder download-link and try to download files/folders as zip using golang file server</li> <li>Preserve keyword when expanding search dialog to a separate search page</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#902-beta-20211215","title":"9.0.2 beta (2021/12/15)","text":"<ul> <li>Upgrade Django to 3.2</li> <li>Enable showing password for encrypted sharing links</li> <li>Rewrite HTTP service in seaf-server with golang and move it to a separate component (turn off by default)</li> <li>Upgrade PDFjs to new version, support viewing of password protected PDF</li> <li>Use database to store OnlyOffice cache keys</li> <li>Supporting converting files like doc to docx using OnlyOffice for online editing</li> <li>In sharing link with edit permission, anonymous users can set his/her name in OnlyOffice editing</li> <li>Move SERVICE_URL configuration from ccnet.conf to seahub_settings.py</li> </ul> <p>The new file-server written in golang serves HTTP requests to upload/download/sync files. It provides three advantages:</p> <ul> <li>The performance is better in a high-concurrency environment and it can handle long requests. Now you can sync libraries with large number of files.</li> <li>Now file zipping and downloading can be done simutaneously. When zip downloading a folder, you don't need to wait until zip is done.</li> <li>Support rate control for file uploading and downloading.</li> </ul> <p>You can turn golang file-server on by adding following configuration in seafile.conf</p> <pre><code>[fileserver]\nuse_go_fileserver = true\n</code></pre>"},{"location":"changelog/changelog-for-seafile-professional-server/#901","title":"9.0.1","text":"<p>Deprecated</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#900","title":"9.0.0","text":"<p>Deprecated</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#80","title":"8.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 8.0.</p>"},{"location":"changelog/changelog-for-seafile-professional-server/#8017-20220110","title":"8.0.17 (2022/01/10)","text":"<ul> <li>[fix] Remove JndiManager.class, JmsAppender.class and SmtpAppender.class from log4j jar in bundled ElasticSearch</li> <li>[fix] Fix a bug in insert file from library in Markdown editor</li> <li>[fix] Fix a crash bug in real-time backup service</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#8016-20211228","title":"8.0.16 (2021/12/28)","text":"<ul> <li>[fix] Remove JndiLookup.class from log4j jar in bundled ElasticSearch</li> <li>[fix] Fix a memory leak in seaf-server</li> <li>Use contact email and name in guest invitation revoking email</li> <li>Upgrade bundled mariadb connector c to 3.2.5</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#8015-20211206","title":"8.0.15 (2021/12/06)","text":"<ul> <li>If a custom admin role is not found in admin role list, a role with minimal permissions (\"audit_admin\") will be assigned to the user</li> <li>[fix] Fix a security issue in token check in file syncing</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#8014-20211117","title":"8.0.14 (2021/11/17)","text":"<ul> <li>[fix] Fix hanlding of user disconnect and connect messages from OnlyOffice </li> <li>[fix] Fix OnlyOffice editing support for anonymous users in sharing links</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#8012-20211103","title":"8.0.12 (2021/11/03)","text":"<ul> <li>Improve the way to download scan code for sharing links</li> <li>Group admins can search group members now</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#8011-20210926","title":"8.0.11 (2021/09/26)","text":"<ul> <li>[fix] Fix a bug in LDAP group sync when using OpenLDAP</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#8010-20210909","title":"8.0.10 (2021/09/09)","text":"<ul> <li>[fix] Fix a bug in LDAP sync</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#809-20210826","title":"8.0.9 (2021/08/26)","text":"<ul> <li>Improve title of guest invitation email</li> <li>[fix] Fix a bug that page \"admin panel -&gt; logs -&gt; permissions\" can't be displayed</li> <li>[fix] Fix a bug in admin search users</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#808-20210806","title":"8.0.8 (2021/08/06)","text":"<ul> <li>[multi-tenancy] Support system Admin to add additional admins to a specific org</li> <li>[fix] Fix zip downloading for large files in cluster</li> <li>[fix] Fix online editing for  files with very long names</li> <li>Improve performance for listing deleted files in trash</li> <li>[fix] Update expire date for new guest invitation if there is an old expired invitation</li> <li>[fix] Fix FORCE_PASSWORD_CHANGE does not force the new user to change their password if the user is added by admin</li> <li>[fix] Fix setting a webdav password when 2FA enabled</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#807-20210719","title":"8.0.7 (2021/07/19)","text":"<ul> <li>Add missing accessibility labels for some links and buttons in file details page</li> <li>[fix] Fix a bug in file zip download when the size of files exceed limit</li> <li>[fix] Fix long WebDAV Secret Yields 500 Error</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#806-20210715","title":"8.0.6 (2021/07/15)","text":"<ul> <li>[fix] Fix a cache problem in OnlyOffice integration when automatically saving is used</li> <li>[fix] Once a user quota have been set, I can not set it back to 0 (unlimited)</li> <li>[fix] Fix collabora integration</li> <li>User's can manage his/her Web API Auth Token in profile page</li> <li>A group admin can now leave a group</li> <li>[fix] Fix Lazy loading / pagination breaks image viewer (https://forum.seafile.com/t/lazy-loading-pagination-breaks-image-viewer/14655)</li> <li>seaf-gc can now clean fs object</li> <li>Update included libradios to version 16</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#805-20210625","title":"8.0.5 (2021/06/25)","text":"<ul> <li>Add compatibility with IE11</li> <li>[fix] Fix a bug in seaf-gc for libraries with sub-libraies</li> <li>Enable deleting devices in admin panel</li> <li>Enable setting a user's quota back to 0 (unlimited)</li> <li>Users can now manage its own Web API auth token in profile page</li> <li>Enable a group admin leave a group</li> <li>[fix] Disable editing via sharing link when a file is locked</li> <li>[fileserver] Add block cache option when downloading file from web or API</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#804-20210520","title":"8.0.4 (2021/05/20)","text":"<ul> <li>[fix] Add back virus scan support in uploading link</li> <li>[fix] Fix a bug in seaf-gc</li> <li>[fix] Fix a bug in library list cache</li> <li>[fix] Fix a bug that a libary can't be synced immidiately after creating</li> <li>[fix] Do not show watermark when editing files with Office Online Server</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#803-20210427","title":"8.0.3 (2021/04/27)","text":"<ul> <li>[fix] Fix SAML2 authentication</li> <li>[fix] Fix file locking</li> <li>[fix] Fix anothoer bug in upload files to a sharing link with upload permission</li> </ul> <p>Potential breaking change in Seafile Pro 8.0.3: You can set the maximum number of files contained in a library that can be synced by the Seafile client. The default is 100000. When you download a repo, Seafile client will request fs id list, and you can control the timeout period of this request through <code>fs_id_list_request_timeout</code> configuration, which defaults to 5 minutes. These two options are added to prevent long fs-id-list requests from overloading the server. If you have large libraries on the server, this can cause \"internal server error\" returned to the client. You have to set a large enough limit for these two options.</p> <pre><code>[fileserver]\nmax_sync_file_count = 100000\nfs_id_list_request_timeout = 300\n</code></pre>"},{"location":"changelog/changelog-for-seafile-professional-server/#802-20210421","title":"8.0.2 (2021/04/21)","text":"<ul> <li>[fix] Fix upload files to sub-folders in a sharing link with upload permission</li> <li>[fix] Enable sending collabration notification emails by default</li> <li>[fix] Recreate a department if it is deleted in LDAP syncing</li> <li>[fix] Fix compatibility with old MariaDB in upgrading SQL statements from version 7.1 to 8.0 </li> <li>[fix] Fix deleting libraries without owner in admin panel</li> <li>Add an API to change a user's email</li> <li>[fix] Fix a bug in storage migration script</li> <li>[fix] Fix a bug that will cause fsck crash</li> <li>[fix] Fix a XSS problem in notification</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#801-20210407","title":"8.0.1 (2021/04/07)","text":"<ul> <li>Users can set whether to receive email notifications in the setting page</li> <li>[fix] Fix a bug that sometimes traffic statistics are not correct</li> <li>Improve file locking handling for OnlyOffice and Office Online Server integration</li> <li>[fix] Fix a bug in seaf-gc</li> <li>[fix] Fix wrong links of files in library history details dialog</li> <li>Add \"Open via Client\" button in file view page</li> <li>Add an admin API to change a user's email</li> </ul>"},{"location":"changelog/changelog-for-seafile-professional-server/#800-beta-20210302","title":"8.0.0 beta (2021/03/02)","text":"<ul> <li>Add open cloud mesh feature</li> <li>Upgrade Django to 2.2 version</li> <li>Remove ccnet-server component</li> <li>Users can use secret key to access WebDAV after enabling two-factor authentication</li> <li>Add QR code for sharing links</li> <li>Rewrite upload link page to use React technology</li> <li>Improve GC performance</li> <li>Update help page</li> <li>Release v4 encrypted library format to enhance security for v3 encrypted format</li> </ul>"},{"location":"changelog/client-changelog/","title":"Seafile Client Changelog","text":""},{"location":"changelog/client-changelog/#90","title":"9.0","text":""},{"location":"changelog/client-changelog/#9014-20250616","title":"9.0.14 (2025/06/16)","text":"<ul> <li>Improve cloud file browser dialog</li> <li>Improve icons for system notification area</li> <li>Add link to FAQ in file sync error dialog</li> <li>Check and notify when client uses wrong key for encryption</li> <li>Update some seahub APIs</li> <li>Update grandparent modification time when file is updated</li> <li>[win] Skip syncing special legacy folders under Documents (\"My Music\", \"My Pictures\" and \"My Videos\"), to avoid permission errors</li> </ul>"},{"location":"changelog/client-changelog/#9013-20250402","title":"9.0.13 (2025/04/02)","text":"<ul> <li>[win] Fix bug that some items of context menu in Windows Explorer don't show up</li> <li>[mac] Fix bug of handling rename events, that can cause files moved to wrong folder</li> <li>[linux] Support Wayland</li> <li>[linux] Auto lock Office files opened by LibreOffice and WPS</li> <li>Upgrade OpenSSL</li> </ul>"},{"location":"changelog/client-changelog/#9012-20250212","title":"9.0.12 (2025/02/12)","text":"<ul> <li>Improve sync error descriptions in the main window for file sync errors</li> <li>Don't timeout for fs-id-list requests</li> <li>[mac] Fix generate internal links bug</li> <li>[linux] Add option to ignore symlinks</li> <li>[linux] Fix bug that filenames with different cases cannot be synced</li> <li>[linux] Auto detect CA location</li> <li>[linux] Improve support for Wayland</li> </ul>"},{"location":"changelog/client-changelog/#9011-20241115","title":"9.0.11 (2024/11/15)","text":"<ul> <li>Fix potential UI freeze in 9.0.10</li> <li>Fix possible unsync of synced folders on restart</li> </ul>"},{"location":"changelog/client-changelog/#9010-20241111","title":"9.0.10 (2024/11/11)","text":"<ul> <li>Don't checkout file/folder with name \"..\"</li> <li>Fix auto unsync library bug</li> <li>Don't show \"The path contains symbols that are not supported by the windows system\" error by default</li> <li>[mac] Fix potential file deletion bug when handling rename events</li> <li>[linux] Support GNUTLS for encrypted library version 4</li> </ul>"},{"location":"changelog/client-changelog/#909-20241029","title":"9.0.9 (2024/10/29)","text":"<ul> <li>Auto unsync libraries that has no permission</li> <li>Fix low download speed in high-speed networks</li> <li>Add API request timeout in GUI</li> <li>Turn single-sign-on to a button</li> <li>Support syncing encrypted library with custom password hash algorithms (Argon and PBKDF2)</li> <li>[mac] Don't split rename event into delete and add events</li> <li>[linux] Fix UI in dark modes</li> <li>[linux] Fix bug for single-sign-on with built-in browser</li> </ul>"},{"location":"changelog/client-changelog/#908-20240812","title":"9.0.8 (2024/08/12)","text":"<ul> <li>[win] Fix a potential crash bug when downloading files</li> <li>[linux] Fix a few issues in AppImage</li> <li>[linux] Support using AppImageUpdate to check updates</li> </ul>"},{"location":"changelog/client-changelog/#907-20240723","title":"9.0.7 (2024/07/23)","text":"<ul> <li>Checkout files directly without writing to cache folder first</li> <li>Use user name when creating conflict files</li> <li>Display user name in shared library list</li> <li>Fix \"Copy move is already in progress\" error in cloud file browser</li> <li>Support server addresses with special characters</li> <li>Fix help links</li> <li>[mac] Fix crash on first run for Apple Silicon CPUs</li> <li>[linux] Use AppImage format for release</li> <li>[linux] Disable deletion confirmation for CLI client</li> </ul>"},{"location":"changelog/client-changelog/#906-20240523","title":"9.0.6 (2024/05/23)","text":"<ul> <li>Fix sync error icon in main window</li> <li>Handle filename case conflicts better when downloading (don't download file with case conflicts)</li> <li>Improve conflict handling in cloud file browser</li> <li>Add sort library feature in main window</li> <li>Support username and password when use SOCKS5 proxy</li> <li>Requires at least version 2 encryption protocol when creating an encrypted library (Thanks to Jonas Hofmann and Kien Tuong Truong from ETH Zurich)</li> <li>Change local file permission when recieving unlock event from notification server</li> <li>[mac] Update system tray icon</li> <li>[linux] ensure only one seaf-daemon running for each account</li> <li>[linux] Support reading parameters from configuration file</li> </ul>"},{"location":"changelog/client-changelog/#905-20240305","title":"9.0.5 (2024/03/05)","text":"<ul> <li>Support Single-Sign-On with desktop browsers</li> <li>Optimize confilct handling in cloud file browser</li> <li>Improve share link generation UI</li> <li>Use system proxy setting by default</li> <li>[win] Display warning when syncing a library to network drive or windows share</li> <li>[mac] Adapt to system style for tray area icons</li> <li>[mac] Persist notifications to notification area</li> <li>[linux] Check daemon running when start</li> </ul>"},{"location":"changelog/client-changelog/#904-20230913","title":"9.0.4 (2023/09/13)","text":"<ul> <li>[win] Upgrade to Qt 6.5.2 and OpenSSL 3.0</li> <li>Record an error when fail to checkout a file</li> <li>[linux] Supports notification server</li> <li>Handles new errors returned by newer servers</li> </ul>"},{"location":"changelog/client-changelog/#903-20230705","title":"9.0.3 (2023/07/05)","text":"<ul> <li>[macOS] Provide universial package for Apple Silicon and Intel</li> <li>Some UI improvements</li> <li>Support file number limits for libraries on server</li> <li>Fix error when getting links with extension menu from library root</li> </ul>"},{"location":"changelog/client-changelog/#902-20230427","title":"9.0.2 (2023/04/27)","text":"<ul> <li>[macOS] Fix UTF-8 encoding issue for file names</li> <li>Persist file sync errors in the UI</li> <li>Fix an issue when removing large number of files from encrypted libraries</li> <li>Remove client version checking</li> <li>Fix resyncing libraries with non-default location</li> <li>Fix UI issue for 2FA</li> </ul>"},{"location":"changelog/client-changelog/#901-20230324","title":"9.0.1 (2023/03/24)","text":"<ul> <li>[win] Update app signing certificate</li> </ul>"},{"location":"changelog/client-changelog/#900-20230320","title":"9.0.0 (2023/03/20)","text":"<ul> <li>Support notification server to update libraries and locked files more timely</li> <li>Support Windows 7/8 again</li> <li>Fix a progress dialog bug in cloud file browser when uploading file larger than 100MB</li> </ul>"},{"location":"changelog/client-changelog/#80","title":"8.0","text":""},{"location":"changelog/client-changelog/#8010-20221228","title":"8.0.10 (2022/12/28)","text":"<ul> <li>Improve handling of moving large folders to avoid potential false deletion of files</li> <li>Ask for user confirmation when deleting more than 500 files at once</li> </ul>"},{"location":"changelog/client-changelog/#809-20221114","title":"8.0.9 (2022/11/14)","text":"<ul> <li>Add events.log to debug local file changes</li> <li>Change commit process on restart, to avoid potential corruption state</li> </ul>"},{"location":"changelog/client-changelog/#808-20220705","title":"8.0.8 (2022/07/05)","text":"<ul> <li>Allow login with password after loging out an SSO account</li> <li>Add additional log messages when failing to start upload/download</li> </ul>"},{"location":"changelog/client-changelog/#807-20220429","title":"8.0.7 (2022/04/29)","text":"<ul> <li>Fix \"Another copy or move operation is in progress\" error when copying items in cloud file browser</li> <li>Fix folder timestamp when all items under a folder is removed</li> </ul>"},{"location":"changelog/client-changelog/#806-20220304","title":"8.0.6 (2022/03/04)","text":"<ul> <li>Improve some permission error messages</li> <li>Show errors when fails to create share link or upload link</li> <li>Support compiling with Qt 6.2</li> </ul>"},{"location":"changelog/client-changelog/#805-20211118","title":"8.0.5 (2021/11/18)","text":"<ul> <li>[Win] Improve German and French translations for context menus</li> <li>[Linux] Fix crash bug when hovering mouse on the settings button</li> </ul>"},{"location":"changelog/client-changelog/#804-20210922","title":"8.0.4 (2021/09/22)","text":"<ul> <li>Add a Settings button in the main panel</li> <li>[CLI] Add an option to use API token for login, instead of password. This is useful for SSO login in CLI.</li> <li>Fix problem recording file sync errors</li> <li>Send proper content-type headers in http requests</li> <li>A few UI fixes</li> <li>[Linux] Support Debian 11</li> </ul>"},{"location":"changelog/client-changelog/#803-20210703","title":"8.0.3 (2021/07/03)","text":"<ul> <li>[Mac,Linux] Add option to not show Windows incompatible path notifications</li> <li>[Linux] Fix compatibility to new GLib versions</li> </ul>"},{"location":"changelog/client-changelog/#802-20210521","title":"8.0.2 (2021/05/21)","text":"<ul> <li>[Mac] Fix dark mode support</li> <li>Fix bug for updating server address</li> <li>[Mac] Improve Finder context menu</li> <li>[Win] Support setting password and expiration when creating links from context menu</li> <li>[Win] Avoid consuming too much Windows Explorer CPU when copying large folders into library</li> <li>[Mac, Linux] Pop-up notification when uploading files whose names are invalid on Windows</li> <li>[Cli] Add --json option for listing libraries</li> </ul>"},{"location":"changelog/client-changelog/#801-20201215","title":"8.0.1 (2020/12/15)","text":"<ul> <li>[Win] Fix compatibility to previously synced libraries</li> <li>[Win] Fix failing to run issue</li> <li>Don't stop syncing a library when local folder is unavailable, if option is set</li> <li>[Win] Fix files with invalid names reappearing problem</li> <li>Use SOCKS5 proxy to resolve domain names</li> </ul>"},{"location":"changelog/client-changelog/#800-beta-20201128","title":"8.0.0 beta (2020/11/28)","text":"<ul> <li>[Win] Build with Visual Studio 2019 instead of MinGW</li> <li>[Win/Mac] Upgrade Qt version to 5.15.1 (which supports TLS 1.3)</li> <li>Add V4 encryption library support, which will be available in server 8.0</li> </ul>"},{"location":"changelog/client-changelog/#70","title":"7.0","text":""},{"location":"changelog/client-changelog/#7010-20201016","title":"7.0.10 (2020/10/16)","text":"<ul> <li>Fix sync error when downloading duplicated files from a library</li> <li>Fix crash bug when downloading files with very long names</li> </ul>"},{"location":"changelog/client-changelog/#709-20200730","title":"7.0.9 (2020/07/30)","text":"<ul> <li>Avoid downloading existing blocks during sync download</li> <li>Fix crash when cancel syncing before a library is synced</li> <li>Fix incorrect error message in some error situations</li> </ul>"},{"location":"changelog/client-changelog/#708-20200603","title":"7.0.8 (2020/06/03)","text":"<ul> <li>Fix GUI crash on start</li> <li>Avoid redundant notification when downloading updates from a read-only library</li> </ul>"},{"location":"changelog/client-changelog/#707-20200403","title":"7.0.7 (2020/04/03)","text":"<ul> <li>Use new API to copy/move files from one library to another in cloud file browser</li> <li>[fix] Fix SSO problem after logout and login again</li> <li>[mac] Ignore files start with <code>._</code> </li> <li>[fix] Fix deleting of multiple sync error logs</li> </ul>"},{"location":"changelog/client-changelog/#706-20200214","title":"7.0.6 (2020/02/14)","text":"<ul> <li>Enable to config block size at the client side</li> <li>Do not refresh explorer when restart</li> <li>Can clean sync error records in sync errors dialog</li> <li>[fix] Do not popup the sync errors dialog when click a sync notification popup</li> </ul>"},{"location":"changelog/client-changelog/#705-20200114","title":"7.0.5 (2020/01/14)","text":"<ul> <li>Fix some right click menu do not work</li> <li>Fix \"View on cloud\" function</li> <li>Fix sign in file name break \"view file history\"</li> <li>Support get upload link for folders</li> <li>[mac] Fix SSO in MacOS 10.15</li> </ul>"},{"location":"changelog/client-changelog/#704-20191120","title":"7.0.4 (2019/11/20)","text":"<ul> <li>Fix showing syncing error \"!\" in the system tray icon after restarting the client</li> <li>Don't clean modified files in cloud file browser</li> <li>Improve seaf-cli</li> <li>[mac] Add support for MacOS 10.15</li> <li>[mac] Drop support for MacOS 10.12, 10.11 and 10.10</li> </ul>"},{"location":"changelog/client-changelog/#703-20191031","title":"7.0.3 (2019/10/31)","text":"<ul> <li>Official repo for CentOS or RHEL is ready. Currently only CentOS/RHEL 7 is supported.</li> <li>Seaf-cli now support both Python2 and Python3.</li> <li>Re-enable the old style seafile internal links (seafile://openfile?repo_id=\u2026)</li> <li>Improve error message display</li> <li>Fix a bug that local added files are deleted if the folder is removed or renamed by another user simultaneously.</li> <li>Improve progress percentage display during syncing downloading.</li> <li>Users can check who locked a file now</li> </ul>"},{"location":"changelog/client-changelog/#702-20190812","title":"7.0.2 (2019/08/12)","text":"<ul> <li>Improve notifications when user editing files in read-only libraries</li> <li>[fix] Fix seaf-cli syncing problem</li> </ul>"},{"location":"changelog/client-changelog/#701-20190711","title":"7.0.1 (2019/07/11)","text":"<ul> <li>Fix a bug that causing GUI to crash when seaf-daemon dead</li> <li>Fix a bug that cloud file browser does not show file status correctly</li> <li>Do not show lots of \"Failed to index file\" messages</li> </ul>"},{"location":"changelog/client-changelog/#700-20190604","title":"7.0.0 (2019/06/04)","text":"<ul> <li>Improve error notifications</li> <li>Support new version of encrypted libraries if server version is 7.0.0+</li> <li>Starred items support libraries and folders</li> <li>Support new version of file activities</li> <li>Fix the error of \"Failed to remove local repos sync token\" during client shutdown</li> <li>Add menu to repair Windows Explorer extension</li> </ul>"},{"location":"changelog/client-changelog/#62","title":"6.2","text":""},{"location":"changelog/client-changelog/#6210-20190115","title":"6.2.10 (2019/01/15)","text":"<ul> <li>[fix] Fix support for Windows user name containting non-ascii characters</li> <li>Remove seacloud.cc from the default server list</li> <li>Remove description from library detail dialog</li> </ul>"},{"location":"changelog/client-changelog/#629-20181210","title":"6.2.9 (2018/12/10)","text":"<ul> <li>[fix] Fix background index when upload files via cloud file browser</li> <li>Don't call ping and account-info every 5 minutes</li> </ul>"},{"location":"changelog/client-changelog/#628-20181205","title":"6.2.8 (2018/12/05)","text":"<ul> <li>[fix] Don't refresh activity list automatically</li> <li>[fix] Fix view on Web link for starred items</li> </ul>"},{"location":"changelog/client-changelog/#627-20181122","title":"6.2.7 (2018/11/22)","text":"<ul> <li>Handle library permission change for synced libraries</li> <li>Don't retry forever when error occur during first time downloading</li> <li>[mac] Fix dark mode support on Mac Mojave</li> <li>Show user's name instead of email in account switching popup</li> </ul>"},{"location":"changelog/client-changelog/#625-20180914","title":"6.2.5 (2018/09/14)","text":"<ul> <li>More robust deleting folder locally if it is deleted on the server</li> <li>Show file modifier in cloud file browser</li> <li>[fix, win] Fix avatar with jpg format can't be displayed problem</li> <li>Support getting internal link</li> <li>[fix, win] Fix support for some SSL CA</li> </ul>"},{"location":"changelog/client-changelog/#624-20180803","title":"6.2.4 (2018/08/03)","text":"<ul> <li>[fix] Fix a bug that causing Windows Explorer crash</li> </ul>"},{"location":"changelog/client-changelog/#623-20180730","title":"6.2.3 (2018/07/30)","text":"<ul> <li>Prevent multiple seaf-daemon running</li> <li>[fix] Support preconfigured Shibboleth Url</li> <li>Restart seaf-daemon automatically if it is dead</li> </ul>"},{"location":"changelog/client-changelog/#622-621-beta-20180713","title":"6.2.2 6.2.1 Beta (2018/07/13)","text":"<ul> <li>[fix] Fix initialization problem in first time launching</li> <li>Improve file syncing notification message</li> </ul>"},{"location":"changelog/client-changelog/#620-beta-20180703","title":"6.2.0 Beta (2018/07/03)","text":"<ul> <li>[mac] Add automatical locking support for Office files</li> <li>[mac] Don't update local office file if it is editing locally while simultaneously edited remotely  </li> <li>[win] Enable using both syncing client and drive client while keep the Explorer file status icon work for both</li> <li>[win] Remove ccnet component to make running multiple-instances on a single machine possible</li> <li>Don't send unneccesary \"api2/events\" requests</li> <li>[cloud file browser] Fix uploading retrying</li> <li>[fix] Fix .eml files can't be deleted</li> </ul>"},{"location":"changelog/client-changelog/#61","title":"6.1","text":""},{"location":"changelog/client-changelog/#618-20180508","title":"6.1.8 (2018/05/08)","text":"<ul> <li>[fix] Fix display of library search box</li> </ul>"},{"location":"changelog/client-changelog/#617-20180329","title":"6.1.7 (2018/03/29)","text":"<ul> <li>[fix] Fix file searching</li> <li>[cloud file browser] Support showing indexing progress after uploading a large file</li> </ul>"},{"location":"changelog/client-changelog/#616-20180313","title":"6.1.6 (2018/03/13)","text":"<ul> <li>[fix] Fix crash during login</li> <li>[cloud file browser] Only show search button when the server is pro edition</li> <li>Show detailed path when a library can't be synced because a file is locked</li> <li>[fix] Fix a crash during file syncing caused by files with illegal file name</li> <li>[fix] Fix a bug that causing crash during loading libraries</li> </ul>"},{"location":"changelog/client-changelog/#615-20180206","title":"6.1.5 (2018/02/06)","text":"<ul> <li>Add \"trust this device\" function to two-step authentication</li> <li>Add search files inside a library</li> <li>Some UI improvements</li> </ul>"},{"location":"changelog/client-changelog/#614-20171220","title":"6.1.4 (2017/12/20)","text":"<p>cloud file browser</p> <ul> <li>Don't use resumable upload feature when updating a file</li> <li>Show an icon to indicate that a file is cached</li> <li>Show a warning icon when a file failed to upload to the server after changing</li> <li>User can re-upload a local modified file that failed to upload</li> <li>Add a command to open local cache folder</li> <li>Improve error messages when uploading a file or a folder</li> <li>[mac] Fix a bug that a doc/xls file uploaded automatically after downloading</li> <li>Some ui fixes and improvements</li> </ul> <p>others</p> <ul> <li>Don't show the connection status of 127.0.0.1</li> <li>Disable editing of local syncing path, users can only choose a path</li> <li>Some ui fixes and improvements</li> </ul>"},{"location":"changelog/client-changelog/#613-20171103","title":"6.1.3 (2017/11/03)","text":"<ul> <li>[fix] Fix system tray icon</li> <li>Change \"Shibbeloth Login\" to \"Single Sign On\"</li> <li>[fix] Fix MacOS client using discrete GPU</li> <li>[cloud file browser] Improve file uploading after modification</li> <li>[cloud file browser, fix] Don't show quota exceeded when server return 502 error</li> <li>[cloud file browser] Show number of files in current folder</li> </ul>"},{"location":"changelog/client-changelog/#612-20171028","title":"6.1.2 (2017/10/28)","text":"<ul> <li>[win] Update system tray icon</li> <li>Return error if repo name contains invalid characters when syncing a library</li> <li>Update local folder name when repo name is changed.</li> <li>Leave a shared library</li> <li>[fix] Fix open cloud file browser from activity view</li> <li>[fix] Fix loading more events in activity tab</li> <li>[fix, cloud file browser] Always watching local cached files after uploading failed when file changed</li> <li>[fix, cloud file browser] Use local cached version if it is changed locally</li> </ul>"},{"location":"changelog/client-changelog/#611-20170920","title":"6.1.1 (2017/09/20)","text":"<ul> <li>Improve support for syncing EML files (Don't sync EML files if only timestamp changed)</li> <li>Improve support for Copy/Paste files in cloud file browser</li> <li>[mac] Fix opening file history from Mac</li> <li>[fix] Fix memory leak in Windows extension handler</li> <li>[fix] Fix re-login with Shibboleth</li> <li>UI/UX improvements for cloud file browser</li> <li>[fix, windows] Fix a bug in detecting whether there is an old instance of Seafile running</li> </ul>"},{"location":"changelog/client-changelog/#610-20170802","title":"6.1.0 (2017/08/02)","text":"<ul> <li>[fix] Fix a bug that library name will be changed back when it is changed in the server</li> <li>[fix] Fix a bug that uploading progress exceeding 100%.</li> <li>[fix] Fix selectively synced subfolder disappear after logout and login again</li> <li>Use new library icons</li> <li>[fix] Fix showing of avatars</li> <li>[fix] Improve UI in Windows with high DPI screens</li> <li>Only allow https for Shibboleth login</li> <li>Clean unused logs in applet.log</li> <li>Remove the function of map a library to a network drive</li> <li>[fix] Fix an issue when uploading a deep empty folder like \"A/B/C\"</li> <li>Change default block size to 8MB</li> <li>[fix, mac] Popup a notification after user clicking the \"Check new version\" button in about dialog if the current version is the latest version</li> </ul>"},{"location":"changelog/client-changelog/#60","title":"6.0","text":""},{"location":"changelog/client-changelog/#607-20170623","title":"6.0.7 (2017/06/23)","text":"<ul> <li>[fix] Fix auto-completion in sharing dialog</li> <li>Show contact avatars in auto-completion of sharing dialog</li> <li>[fix] Fix mis-leading error message when uploading a file to a read-only library via cloud file browser</li> <li>Add highlight background color when drag and drop a file/folder to a library</li> <li>[fix] Fix connection error in libcurl</li> <li>[fix] Fix sorting by time in cloud file browser</li> <li>[fix] Fix sorting by name case sensitive in cloud file browser</li> <li>[fix] Fix drag more than one folder to cloud file browser</li> <li>Add loading more in activity tab and search tab</li> <li>\"View sync error\" can only be clicked when there are sync errors</li> <li>Move seafile.log, applet.log to seafile.log.old, applet.log.old if they become too large</li> <li>Remove the \"?\" icon in creating new folder dialog title bar</li> </ul>"},{"location":"changelog/client-changelog/#606-20170508","title":"6.0.6 (2017/05/08)","text":"<ul> <li>Sort files by numbers if numbers contained in the file name, so \"1, 10, 2, 11, 3\" will be sorted as \"1, 2, 3, 10, 11\".</li> <li>Use native system window for Seafile main windown and cloud file browser window.</li> <li>Fix progress overflow when uploading large file using cloud file browser</li> <li>Improve the tip when removing an account in the client</li> <li>Don't show download button when select folders in cloud file browser</li> <li>Clean cache data of cloud file browser when logout an account or restart the client</li> <li>[fix] Fix display problem for high screen Windows in win10</li> <li>[fix] Fix libssl compatibility problem in Debain Stretch</li> <li>Add auto-update check</li> </ul>"},{"location":"changelog/client-changelog/#604-20170221","title":"6.0.4 (2017/02/21)","text":"<ul> <li>[fix] Fix Shibboleth login support</li> <li>Improve network connection check</li> <li>Don't log \"read pipe error\" into log file</li> <li>[fix] Fix the link for help page</li> <li>Improve library sharing dialog (pro edition only feature)</li> </ul>"},{"location":"changelog/client-changelog/#603-20170211","title":"6.0.3 (2017/02/11)","text":"<ul> <li>Add a dialog to list all sync errors</li> <li>Don't popup file is locked by other users error message</li> <li>Make sync error message more accurate</li> <li>[win] Support intermediate CA</li> <li>[cloud file browser] Show correct error message when quota is exceeded during file upload</li> <li>Show the server address during Shibboleth login</li> <li>Support pre-config Shibboleth server address in seafile.ini</li> <li>[fix] Show the recent shared user in sharing dialog</li> <li>\"open folder\" changed to \"open local folder\"</li> </ul>"},{"location":"changelog/client-changelog/#602-deprecated","title":"6.0.2 (deprecated)","text":"<p>This version has a few bugs. We will fix it soon.</p>"},{"location":"changelog/client-changelog/#601-20161207","title":"6.0.1 (2016/12/07)","text":"<ul> <li>Don't generate case conflict file/folder</li> <li>[fix] Fix popup style for Mac Sierra</li> <li>Show image thumbnail in cloud file browser</li> <li>Change label \"organization\" to \"shared with all\", \"private shares\" to \"shared with me\"</li> </ul>"},{"location":"changelog/client-changelog/#600-20161014","title":"6.0.0 (2016/10/14)","text":"<ul> <li>[fix] Fix a conflict problem with ESET anti-virus program</li> <li>Fix client name and add client version in modification history</li> <li>Add remote wipe support</li> <li>[fix] Fix sub-folder permission support</li> </ul>"},{"location":"changelog/client-changelog/#51","title":"5.1","text":""},{"location":"changelog/client-changelog/#514-20160729","title":"5.1.4 (2016/07/29)","text":"<ul> <li>[fix] Fix seaf-daemon crash if root dir is corrupted</li> <li>[fix, pro] Fix auto-completion in sharing a folder to a user if the user name contains a space</li> </ul>"},{"location":"changelog/client-changelog/#513-20160627","title":"5.1.3 (2016/06/27)","text":"<ul> <li>Support syncing any sub-folder with a community server</li> <li>[fix, win] Fix automatically unlocking office files</li> <li>[fix, pro] Fix auto-completion in sharing a folder to a user</li> <li>auto-login for open file history in web</li> <li>Prevent generating too many \"case conflict\" files</li> </ul>"},{"location":"changelog/client-changelog/#512-20160607","title":"5.1.2 (2016/06/07)","text":"<ul> <li>Add context menu to view file history in web</li> <li>[fix, pro] Fix user auto-completion in folder sharing dialog</li> <li>[linux] Fix tray icon not shown in KDE 5 https://github.com/haiwen/seafile-client/issues/697</li> <li>[win 10, fix] Fix explorer context menu has no right arrow</li> <li>[win, fix] Can't create new files/folders in \"My Library\" Shortcut</li> <li>[win, fix] Fix on Windows 10 sometimes the seafile client main window exceeds the height of the screen.</li> </ul>"},{"location":"changelog/client-changelog/#511-20160504","title":"5.1.1 (2016/05/04)","text":"<ul> <li>Add \u201cGroups\u201d category in the client\u2019s library view</li> <li>Click notification pop up now open the exact folder containing the modified file.</li> <li>Change \"Get Seafile Share Link\" to \"Get Seafile Download Link\"</li> <li>[fix] Use case-insensitive sorting in cloud file browser</li> <li>[fix] Don't sync a folder in Windows if it contains invalid characters instead of creating an empty folder with invalid name</li> <li>[fix] Fix a rare bug where sometimes files are synced as zero length files. This happens when another software doesn't change the file timestamp after changing the content of the file.</li> </ul>"},{"location":"changelog/client-changelog/#510-20160411","title":"5.1.0 (2016/04/11)","text":"<p>Note: Seafile client now support HiDPI under Windows, you should remove QT_DEVICE_PIXEL_RATIO settings if you had set one previous.</p> <ul> <li>Update to QT5.6</li> <li>Add HiDPI support</li> <li>Remove corrupted local metadata when unsync or resync a library</li> </ul>"},{"location":"changelog/client-changelog/#50","title":"5.0","text":""},{"location":"changelog/client-changelog/#507-20160329","title":"5.0.7 (2016/03/29)","text":"<ul> <li>[fix, mac] Enable multi-users running Seafile on Mac</li> <li>[win, pro] auto-lock office files (doc/ppt/excel) when open, require Seafile pro edition v5.1.0+</li> <li>Enable using system proxy setting</li> <li>Auto login when viewing unread notifications</li> <li>Record device name to modification history</li> </ul>"},{"location":"changelog/client-changelog/#506-20160308","title":"5.0.6 (2016/03/08)","text":"<ul> <li>[fix, mac] Fix deleted folder get re-uploaded if with .DS_Store inside</li> <li>[fix] Fix loading proxy configuration during start-up</li> <li>[fix] Fix a crash bug when using libcurl with multiplt https connection</li> <li>[fix] Fix sync problem when the network connection is slow</li> <li>Use GB/MB/KB instead of GiB/MiB/KiB (1GB = 1000MB = 1,000,000KB)</li> <li>[fix] Fix disappear of synced sub-folder from the main window</li> <li>Small UI improvements</li> </ul>"},{"location":"changelog/client-changelog/#505-20160220","title":"5.0.5 (2016/02/20)","text":"<ul> <li>[fix] Fix a crash bug in multi-threaded file download/upload</li> </ul>"},{"location":"changelog/client-changelog/#504-20160126","title":"5.0.4 (2016/01/26)","text":"<ul> <li>Add crash report support</li> <li>[win] Add mapping a synced library as a network drive</li> </ul>"},{"location":"changelog/client-changelog/#503-20160113","title":"5.0.3 (2016/01/13)","text":"<ul> <li>[fix] Fix German translation</li> </ul>"},{"location":"changelog/client-changelog/#502-20160111","title":"5.0.2 (2016/01/11)","text":"<ul> <li>[fix] Fix compatibility issue with F-Secure</li> <li>Add setting sync interval for a library</li> <li>Showing progress when downloading file list during the first-time syncing</li> </ul>"},{"location":"changelog/client-changelog/#501-20151221","title":"5.0.1 (2015/12/21)","text":"<ul> <li>[fix] Fix a memory leak</li> <li>Show user name instead of email in the profile area</li> <li>[pro] For pro users, you can manage the library sharing from the client now.</li> </ul>"},{"location":"changelog/client-changelog/#500-20151125","title":"5.0.0 (2015/11/25)","text":"<ul> <li>Show storage usage</li> <li>Support login via username</li> <li>Set current tab icon color to orange</li> <li>Send notifications when sync error happens for some files</li> <li>Improve file locking for Microsoft Office files</li> <li>[fix] Fix preventing syncing with any folder if it is prevented by the server</li> <li>[windows] Set TCP send buffer size and TCP_NODELAY options</li> <li>[fix] Keep ignore files when deleting a folder (https://github.com/haiwen/seafile/issues/1383)</li> </ul>"},{"location":"changelog/client-changelog/#44","title":"4.4","text":""},{"location":"changelog/client-changelog/#442-20151020","title":"4.4.2 (2015/10/20)","text":"<ul> <li>[fix] Fix showing data transfer percentage in syncing.</li> <li>Add open containing folder in search result</li> </ul>"},{"location":"changelog/client-changelog/#441-20151014","title":"4.4.1 (2015/10/14)","text":"<ul> <li>[fix, win] Fix a rare bug in file sync on Windows related to multi-thread downloading</li> </ul>"},{"location":"changelog/client-changelog/#440-20150918","title":"4.4.0 (2015/09/18)","text":"<ul> <li>Fix bugs in file ignore feature</li> <li>Fix popup two password input dialogs when visit an encrypted library</li> <li>Popup a tip when file conflicts happen</li> <li>Don't send the password to server when creating an encrypted library</li> <li>[mac] Fix support for TLS 1.2</li> <li>[win, extension] Add context menu \"get internal link\"</li> <li>Enable uploading of an empty folder in cloud file browser</li> <li>[pro] Enable customization of app name and logo for the main window (See https://github.com/haiwen/seafile-docs/blob/master/config/seahub_customization.md#customize-the-logo-and-name-displayed-on-seafile-desktop-clients-seafile-professional-only)</li> <li>A few small UI improvements</li> </ul>"},{"location":"changelog/client-changelog/#43","title":"4.3","text":""},{"location":"changelog/client-changelog/#434-20150914","title":"4.3.4 (2015/09/14)","text":"<ul> <li>Fix a bug in refresh file locking status icon</li> <li>Use 3 threads instead of 10 threads when syncing files to reduce load on server</li> </ul>"},{"location":"changelog/client-changelog/#433-20150825","title":"4.3.3 (2015/08/25)","text":"<ul> <li>Fix one more syncing issues introduced in v4.3.0</li> <li>Improve the file lock icon</li> <li>Improve cloud file browser</li> <li>Fix icon overlay problem in win10</li> <li>Add back sync with existing folder</li> </ul>"},{"location":"changelog/client-changelog/#432-20150819","title":"4.3.2 (2015/08/19)","text":"<ul> <li>Fix more syncing issues introduced in v4.3.0</li> <li>Update translation</li> <li>Fix ignore feature</li> <li>Add HiDPI icons for cloud file browser</li> </ul>"},{"location":"changelog/client-changelog/#431-20150811","title":"4.3.1 (2015/08/11)","text":"<ul> <li>Fix syncing issues.</li> </ul>"},{"location":"changelog/client-changelog/#430-beta-20150803","title":"4.3.0 beta (2015/08/03)","text":"<ul> <li>[fix, windows] Fix a bug that causes freeze of Seafile UI</li> <li>[sync] Improve index performance after a file is modified</li> <li>[sync] Use multi-threads to upload/download file blocks</li> <li>[admin] Enable config Seafile via seafile.rc in Mac/Linux or seafile.ini in Windows (https://github.com/haiwen/seafile-user-manual/blob/master/en/faq.md)</li> <li>[admin] Enable uninstall Seafile without popup \"deleting config files\" dialog</li> <li>Add file lock</li> <li>[mac, extension] Add getting Seafile internal link</li> <li>[mac, extension] Improve performance of showing sync status</li> </ul>"},{"location":"changelog/client-changelog/#42","title":"4.2","text":""},{"location":"changelog/client-changelog/#428-20150711","title":"4.2.8 (2015/07/11)","text":"<ul> <li>[win] Another fix on the explorer extension</li> <li>Improve the ui for downloading the encrypted library</li> <li>filebrowser: fix a crash when closed while context menu pop up</li> <li>explorer extension: show read-only badge when a file is read-only</li> </ul>"},{"location":"changelog/client-changelog/#427-20150708","title":"4.2.7 (2015/07/08)","text":"<ul> <li>[win] Fixed another bug that will cause crash of explorer extension</li> <li>[win] Add executable file version information for the client</li> <li>[mac] Use OS X native notification when possible (OS X &gt;= 10.8)</li> <li>[mac] Implement sync status improvement for every files</li> <li>filebrowser: fix uploading failures in the folders with permission set</li> <li>filebrowser: support \"save as\" multiple files simultaneously</li> <li>filebrowser: fix the sorting of folders</li> <li>filebrowser: implement get seafile internal link</li> <li>shibboleth: popup ShiLoginDialog when doing relogin</li> <li>[ui] disable the inputablity of computer name when doing login</li> </ul>"},{"location":"changelog/client-changelog/#426-20150625","title":"4.2.6 (2015/06/25)","text":"<ul> <li>[win] Fixed more memory problem that will cause crash of explorer extension</li> </ul>"},{"location":"changelog/client-changelog/#425-20150624","title":"4.2.5 (2015/06/24)","text":"<ul> <li>[win] Fixed a possible memory corruption in explorer extension</li> <li>[win] Add icon for readonly state in explorer extension</li> <li>[win] unconfigured clients now can hide the configuration wizard</li> <li>[win] ui: improve set password dialog</li> <li>[win] fix broken local DNS resolve</li> <li>[mac] add \"seafile://\" protocol support</li> <li>[ui] tweak search tab item padding</li> <li>Add a menu item to open seafile folder</li> <li>[ui] don't change current account after logout</li> <li>[ui] fix some bugs on account-view</li> <li>[ui] improve account management</li> <li>filebrowser: support readonly directories</li> <li>[fix] Fix creating subfolder for password-protected repo</li> <li>[fix] Fix file size integer overflow in search results</li> </ul>"},{"location":"changelog/client-changelog/#424-20150611","title":"4.2.4 (2015/06/11)","text":"<ul> <li>[win] add workarounds with auto update bugs in cloud browser</li> <li>[win] add the missing support for ipv6 (curl)</li> <li>[pro] add new tab to searching files</li> <li>[osx] fix the regularly disappearance tray icon (Qt5.4.2)</li> <li>[osx] fix broken network connection sometimes after resume (Qt5.4.2)</li> <li>add an option to syncing with an existing folder with a different name</li> <li>avoid race condition when quiting</li> <li>fix a bug with opening password-protected repo in cloud browser</li> <li>ui: tweak paddings in the event activities</li> <li>filebrowser: show file type correctly along with icons</li> <li>ui: improve repo item category</li> <li>ui: show download link in share link dialog</li> <li>ui: enhance event details</li> </ul>"},{"location":"changelog/client-changelog/#423-20150529","title":"4.2.3 (2015/05/29)","text":"<ul> <li>Improve self-signed CA support</li> <li>Auto login when click \"view on cloud\"</li> <li>[fix] Fix bugs with open directory from modification details dialog (pro)</li> <li>[fix] Fix incorrect transfer rates for each sync task</li> <li>[fix] Fix auto uploaded modified files in cloud file browser for some office files</li> </ul>"},{"location":"changelog/client-changelog/#422-20150526","title":"4.2.2 (2015/05/26)","text":"<ul> <li>[win] Use Openssl to handle HTTPS connection</li> <li>[mac] Load trusted CA certificates from Keychain</li> <li>[fix] Fix logout/login issue (libraries stay at waiting for sync)</li> <li>[fix] Fix a file deletion problem in Mac client</li> <li>Ignore the others of ssl errors if we have dealt with one</li> <li>Expand env variable in preconfigure seafile directory</li> <li>Hide explorer extension option on other platforms than windows</li> <li>Cloud file browser: fix broken title bar when minimized on windows</li> <li>Remove unused option in setting dialog</li> </ul>"},{"location":"changelog/client-changelog/#421-20150514","title":"4.2.1 (2015/05/14)","text":"<ul> <li>[fix] Fix \"Waiting for synchronization\" problem</li> <li>[win] Fixed encoding problem in the explorer extension</li> <li>[win] Prefer home for seafile data dir when it is on the largest drive</li> <li>[win] Adopt preconfigure directory for initialization if any</li> <li>[win] Adopt preconfigure server addr for adding accounts if any</li> <li>[win] Open current repo worktree when clicking ballon message</li> <li>[mac] Fix some memory leaks</li> <li>Description is no longer required when creating repositories</li> <li>[fix] Fix webview url for server version &gt;= 4.2.0</li> <li>redesign the event list in activity tab (pro)</li> <li>[fix] Fix window focus when creating repository from drag and drop</li> <li>[fix] filebrowser: fix sorting column kind for non-English users</li> <li>network: disable weak ciphers explicitly</li> <li>[fix] Fix a issue synced subfolders are not shown when client starts</li> <li>[fix] Remember the used server addresses for convenience</li> <li>[fix] Fix the ssl handshake errors with custom CA seafile servers</li> </ul>"},{"location":"changelog/client-changelog/#420-20150507","title":"4.2.0 (2015/05/07)","text":"<ul> <li>[win] Support overlay icons for files based on the sync status</li> <li>Use http syncing only</li> <li>Auto detect existing folders and prompt \"syncing with existing folder\" in first time syncing</li> <li>[win] Open desktop icon popup the main window if Seafile is already running</li> <li>Respect umask on Linux</li> <li>[fix] Fix main window stay outside screens problem</li> <li>[fix] Fix a few small syncing issues.</li> <li>[osx] Allow sharing root directory from finder extension</li> <li>Auto login from the client when click the server URL (need v4.2 server)</li> <li>Auto logout when the authorization is expired (require server supports)</li> <li>Auto detect existing folders in first time syncing</li> <li>Save server info persistently</li> <li>More miscellaneous fixes</li> </ul>"},{"location":"changelog/client-changelog/#41","title":"4.1","text":""},{"location":"changelog/client-changelog/#416-20150421","title":"4.1.6 (2015/04/21)","text":"<ul> <li>[win] add overlay icon to show sync status at the library level</li> <li>[win] add an option to enable/disable explorer extension support</li> <li>[mac] add finder sync extension (need OSX 10.10.x)</li> <li>[mac] fix the broken hide-the-dock option in some cases</li> <li>[linux] fix the bug that we have two title bar for some desktop environment</li> <li>Update shibboleth support</li> <li>[cloud file browser] Pop notifications when new versions of cached files uploaded</li> <li>[cloud file browser] Add a save_as action</li> <li>[cloud file browser] Improve file browser's UI</li> <li>[fix] Fix a rare case of login failure by using complex password, a regression from 4.1.0</li> <li>[fix] Fix a rare case of program crash when changing accounts</li> <li>Update avatars automatically</li> <li>More miscellaneous fixes</li> </ul>"},{"location":"changelog/client-changelog/#415-20150409","title":"4.1.5 (2015/04/09)","text":"<ul> <li>Add Shibboleth login support</li> <li>Reset local modified files to the state in Server when resyncing a read-only library.</li> <li>[fix] Fix unable to unsync a library when it is in the state of uploading files</li> <li>[fix, win] handle file/directory locking more gracefully</li> <li>Add http user agent for better logging in Apache/Nginx</li> <li>[fix] Fix timeout problem in first time syncing for large libraries</li> </ul>"},{"location":"changelog/client-changelog/#414-20150327","title":"4.1.4 (2015/03/27)","text":"<ul> <li>[fix, win] Fix Windows explore crash by seafile extension when right clicking on \"Libraries-&gt;Documents\" at the right side</li> </ul>"},{"location":"changelog/client-changelog/#413-20150323","title":"4.1.3 (2015/03/23)","text":"<ul> <li>[fix] Fix unable to sync bug (permission denial) if the Windows system user name contains space like \"test 123\" introduced in v4.1.2</li> <li>[win] Update version of OpenSSL to 1.0.2a</li> </ul>"},{"location":"changelog/client-changelog/#412-20150319-deprecated","title":"4.1.2 (2015/03/19) (deprecated)","text":"<ul> <li>Add logout/login support (need server 4.1.0+)</li> <li>fix proxy password disappearance after restarting issue</li> <li>mask proxy password in the setting dialog</li> <li>[fix] fix unexpected disconnection with proxy servers</li> <li>[fix] fix a conflicting case when we have read-only sharing repository to a group</li> <li>update translations</li> <li>support darkmode (OS X)</li> <li>and other minor fixes</li> </ul>"},{"location":"changelog/client-changelog/#411-20150303","title":"4.1.1 (2015/03/03)","text":"<ul> <li>Add network proxy support for HTTP sync</li> <li>[mac] Add more complete support for retina screen</li> <li>Improve UI</li> <li>Add option for killing old Seafile instance when starting a new one</li> <li>Add experimental support for HiDPI screen on Windows and Linux</li> <li>Showing shared from for private shared libraries</li> <li>Use API token v2 for shibbloeth login</li> <li>[fix] Fix some bugs in uploading file from cloud file browser</li> <li>fix a bug of uploading directory from cloud file browser (pro version)</li> </ul>"},{"location":"changelog/client-changelog/#410-beta-20150129","title":"4.1.0 beta (2015/01/29)","text":"<ul> <li>Add support for HDPI screen by using QT5</li> <li>[win] Add context menu for generating share link</li> <li>Enable changing of interface language</li> <li>Make http syncing the default option (will fall back to non-http sync automatically if the server does not support it)</li> <li>[fix] Fix a problem in handling long path in Windows</li> </ul>"},{"location":"changelog/client-changelog/#40","title":"4.0","text":""},{"location":"changelog/client-changelog/#407-20150122","title":"4.0.7 (2015/01/22)","text":"<ul> <li>[win] support for file path greater than 260 characters.</li> </ul> <p>In the old version, you will sometimes see strange directory such as \"Documents~1\" synced to the server, this because the old version did not handle long path correctly.</p>"},{"location":"changelog/client-changelog/#406-20150109","title":"4.0.6 (2015/01/09)","text":"<ul> <li>[fix] Fix a timeout problem during file syncing (Which also cause program crash sometimes).</li> </ul>"},{"location":"changelog/client-changelog/#405-20141224","title":"4.0.5 (2014/12/24)","text":"<ul> <li>[mac] More on fixing mac syncing problem</li> <li>[linux, mac] Do not ignore files with invalid name in Windows</li> <li>[fix] Fix \"sync now\"</li> <li>[fix] Handle network problems during first time sync</li> <li>[file browser] Support create folders</li> <li>[file browser] Improve interface</li> <li>[file browser] Support multiple file selection and operation</li> </ul>"},{"location":"changelog/client-changelog/#404-20141215","title":"4.0.4 (2014/12/15)","text":"<ul> <li>[mac] Fix a syncing problem when library name contains \"\u00e8\" characters</li> <li>[windows] Gracefully handle file lock issue.</li> </ul> <p>In the previous version, when you open an office file in Windows, it is locked by the operating system. If another person modify this file in another computer, the syncing will be stopped until you close the locked file. In this new version, the syncing process will continue. The locked file will not be synced to local computer, but other files will not be affected.</p>"},{"location":"changelog/client-changelog/#403-20141203","title":"4.0.3 (2014/12/03)","text":"<ul> <li>[mac] Fix a syncing problem when library name contains \"\u00e8\" characters</li> <li>[fix] Fix another bug in syncing with HTTP protocol</li> </ul>"},{"location":"changelog/client-changelog/#402-20141129","title":"4.0.2 (2014/11/29)","text":"<ul> <li>[fix] Fix bugs in syncing with HTTP protocol</li> </ul>"},{"location":"changelog/client-changelog/#401-20141118","title":"4.0.1 (2014/11/18)","text":"<ul> <li>[fix] Fix crash problem</li> </ul>"},{"location":"changelog/client-changelog/#400-20141110","title":"4.0.0 (2014/11/10)","text":"<ul> <li>Add http syncing support</li> <li>Add cloud file browser</li> </ul>"},{"location":"changelog/client-changelog/#31","title":"3.1","text":""},{"location":"changelog/client-changelog/#3112-20141201","title":"3.1.12 (2014/12/01)","text":"<ul> <li>[fix] Fix a syncing problem for files larger than 100MB.</li> </ul>"},{"location":"changelog/client-changelog/#3111-20141115","title":"3.1.11 (2014/11/15)","text":"<ul> <li>[fix] Fix \"sometimes deleted folder reappearing problem\" on Windows.</li> </ul> <p>You have to update all the clients in all the PCs. If one PC does not use the v3.1.11, when the \"deleting folder\" information synced to this PC, it will fail to delete the folder completely. And the folder will be synced back to other PCs. So other PCs will see the folder reappear again.</p>"},{"location":"changelog/client-changelog/#3110-20141113","title":"3.1.10 (2014/11/13)","text":"<ul> <li>[fix] Fix conflict problem when rename the case of a folder</li> <li>[fix] Improve the deleted folder reappearing problem if it contains ignored files</li> <li>[fix] Add \"resync\" action</li> </ul>"},{"location":"changelog/client-changelog/#318-20141028","title":"3.1.8 (2014/10/28)","text":"<ul> <li>Better support read-only sync. Now local changes will be ignored.</li> <li>[mac,fix] Fix detection of local changes.</li> </ul>"},{"location":"changelog/client-changelog/#317-20140928","title":"3.1.7 (2014/09/28)","text":"<ul> <li>[fix] Fix another not sync problem when adding a big file (&gt;100M) and several other files.</li> </ul>"},{"location":"changelog/client-changelog/#316-20140919","title":"3.1.6 (2014/09/19)","text":"<ul> <li>Add option to sync MSOffice/Libreoffice template files</li> <li>Add back choosing the \"Seafile\" directory when install Seafile client.</li> <li>Add option to change the address of a server</li> <li>Add menu item for open logs directory</li> <li>[mac] Add option for hide dock icon</li> <li>Show read-only icon for read-only libraries</li> <li>Show detailed information if SSL certification is not valid</li> <li>Do not show \"Seafile was closed unexpectedly\" message when turning down of Windows</li> <li>Don't refresh libraries/starred files when the window is not visible</li> <li>Move local file to conflict file when syncing with existing folder</li> <li>Add more log information when file conflicts happen</li> <li>[fix] Fix sync error when deleting all files in a library</li> <li>[fix] Fix not sync problem when adding a big file (&gt;100M) and several small files together.</li> <li>[fix] Fix Windows client doesn't save advanced settings</li> </ul>"},{"location":"changelog/client-changelog/#315-20140814","title":"3.1.5 (2014/08/14)","text":"<ul> <li>Do not ignore libreoffice lock files</li> <li>[fix] Fix possible crash when network condition is not good.</li> <li>[fix] Fix problem in syncing a large library with an existing folder</li> <li>Add option \"do not unsync a library even it is deleted in the server\"</li> <li>[mac] upgrade bundled openssl to 1.0.1i</li> <li>[mac] remove unused ossp-uuid dependency</li> <li>[mac] fix code sign issue under OSX 10.10</li> </ul>"},{"location":"changelog/client-changelog/#314-20140805","title":"3.1.4 (2014/08/05)","text":"<ul> <li>[fix, mac] Fix case conflict problem under Mac</li> </ul>"},{"location":"changelog/client-changelog/#313-20140804","title":"3.1.3 (2014/08/04)","text":"<ul> <li>[fix] Fix showing bubble</li> <li>[mac] More UI improvements</li> <li>Do not ignore 'TMP', 'tmp' files</li> </ul>"},{"location":"changelog/client-changelog/#312-20140801","title":"3.1.2 (2014/08/01)","text":"<ul> <li>Do not show rotate icon when checking update for a library</li> <li>Do not show activity tab if server not supported</li> <li>[mac] show unread messages tray icon on Mac</li> <li>[mac] Improve UI for Mac</li> <li>[fix] Support rename files from upper case to lower case or vice versa.</li> </ul>"},{"location":"changelog/client-changelog/#311-20140728","title":"3.1.1 (2014/07/28)","text":"<ul> <li>[win] Fix crash problems</li> <li>[win] Fix interface freeze problem when restoring the window from the minimized state</li> <li>Remove the need of selecting Seafile directory</li> </ul>"},{"location":"changelog/client-changelog/#310-20140724","title":"3.1.0 (2014/07/24)","text":"<ul> <li>Add starred files and activity history</li> <li>Notification on unread messages</li> <li>Improve icons for Retina screen</li> <li>Load and show avatar from server</li> <li>Use new and better icons</li> </ul>"},{"location":"changelog/client-changelog/#30","title":"3.0","text":""},{"location":"changelog/client-changelog/#304","title":"3.0.4","text":"<ul> <li>[fix] Fix a syncing bug</li> </ul>"},{"location":"changelog/client-changelog/#303","title":"3.0.3","text":"<ul> <li>[fix] Fix syncing problem when update from version 2.x</li> <li>[fix] Fix UI when syncing an encrypted library</li> </ul>"},{"location":"changelog/client-changelog/#302","title":"3.0.2","text":"<ul> <li>[fix] Fix a syncing issue.</li> </ul>"},{"location":"changelog/client-changelog/#301","title":"3.0.1","text":"<ul> <li>Improved ssl check</li> <li>Imporved ui of sync library dialog</li> <li>Send device name to the server</li> <li>[fix] Fixed system shutdown problem</li> <li>[fix] Fixed duplicate entries in recently updated libraries list</li> <li>Remove ongoing library download tasks when removing an account</li> <li>Updated translation</li> <li>[fix] Fix file ID calculation</li> </ul>"},{"location":"changelog/client-changelog/#300","title":"3.0.0","text":"<ul> <li>Adjust settings dialog hint text size</li> <li>Improved login dialog</li> </ul>"},{"location":"changelog/client-changelog/#22","title":"2.2","text":""},{"location":"changelog/client-changelog/#220","title":"2.2.0","text":"<ul> <li>Add check for the validity of servers' SSL Certification</li> </ul>"},{"location":"changelog/client-changelog/#21","title":"2.1","text":""},{"location":"changelog/client-changelog/#212","title":"2.1.2","text":"<ul> <li>Show proper error message when failed to login</li> <li>Show an error message in the main window when failed to get libraries list</li> <li>Open seahub in browser when clicking the account url</li> <li>Add an option \"Do not automatically unsync a library\"</li> <li>Improve sync status icons for libraries</li> <li>Show correct repo sync status icon even if global auto sync is turned off</li> <li>Show more useful notification than \"Auto merge by system\" when conflicts were merged</li> </ul>"},{"location":"changelog/client-changelog/#211","title":"2.1.1","text":"<ul> <li>Make the main window resizable</li> <li>[windows] Improved tray icons</li> <li>Show detailed network error when login failed</li> <li>Show sub-libraries</li> <li>[windows] Use the name of the default library as the name of the virtual disk</li> </ul>"},{"location":"changelog/client-changelog/#210","title":"2.1.0","text":"<ul> <li>Redesigned the UI of the main window</li> <li>[windows] Download the default library, and creates a virtual disk for it in \"My Computer\"</li> <li>Support drag and drop a folder to sync</li> <li>Automatically check for new version on startup</li> <li>Support of file syncing from both inside and outside the LAN</li> <li>[fix] Fix a bug of clicking the tray icon during initialization</li> <li>[fix] fixed a few bugs in merge and handling of empty folders</li> <li>[mac] Fixed the alignment in settings dialog</li> </ul>"},{"location":"changelog/client-changelog/#20","title":"2.0","text":""},{"location":"changelog/client-changelog/#208","title":"2.0.8","text":"<ul> <li>[fix] Fix UI freeze problem during file syncing</li> <li>Improve syncing speed (More improvements will be carried out in our next version)</li> </ul>"},{"location":"changelog/client-changelog/#207-dont-use-it","title":"2.0.7 (Don't use it)","text":"<p>Note: This version contains a bug that you can't login into your private servers.</p> <ul> <li>[fix] Fix a bug which may lead to crash when exiting client</li> <li>show library download progress in the library list</li> <li>add official server addresses to the login dialog</li> <li>improve library sync status icons</li> <li>[windows] use the same tray icon for all windows version later than Vista</li> <li>translate the bubble notification details to Chinese</li> </ul>"},{"location":"changelog/client-changelog/#206","title":"2.0.6","text":"<ul> <li>[windows] Fix handling daylight saving time</li> <li>Improve library details dialog</li> <li>[fix] Fix a bug in api request</li> <li>Improve the handling of \"Organization\" libraries</li> <li>[fix] Fix the settings of upload/download rate limit</li> <li>[fix] Update French/German translations</li> <li>[cli] Support the new encryption scheme</li> </ul>"},{"location":"changelog/client-changelog/#205","title":"2.0.5","text":"<ul> <li>Improve UI</li> <li>Fix a bug in French translation</li> </ul>"},{"location":"changelog/client-changelog/#204","title":"2.0.4","text":"<ul> <li>Improve memory usage during syncing</li> <li>[windows] Change system tray icons</li> <li>[windows] Hide seafile-data under Seafile folder</li> <li>[fix] Fix remember main window's location</li> <li>Improve the dialog for adding account</li> <li>Add setting for showing main windows on seafile start up</li> <li>Open local folder when double click on a library</li> <li>Show warning dialog when login to a server with untrusted ssl certification</li> </ul>"},{"location":"changelog/client-changelog/#203","title":"2.0.3","text":"<ul> <li>sync empty folder</li> <li>support seafile crypto v2</li> <li>show warning in system tray when some servers not connected</li> <li>add German/French/Hungarian translations</li> <li>change system tray icons for Windows</li> <li>show \"recent updated libraries\"</li> <li>reduce cpu usage</li> <li>[fix] fixed a bug when login with password containing characters like \"+\" \"#\"</li> <li>ask the user about untrusted ssl certs when login</li> <li>add Edit-&gt;Settings and \"view online help\" menu item</li> </ul>"},{"location":"changelog/client-changelog/#202","title":"2.0.2","text":"<ul> <li>[fix] Fix compatibility with server v1.8</li> <li>[fix] the bug of closing the settings dialog</li> <li>Add Chinese translation</li> <li>Show error detail when login failed</li> <li>Remember main window position and size</li> <li>Improve library detail dialog</li> <li>Add unsync a library</li> </ul>"},{"location":"changelog/client-changelog/#200","title":"2.0.0","text":"<ul> <li>Re-implement GUI with Qt</li> </ul>"},{"location":"changelog/client-changelog/#18","title":"1.8","text":"<p>1.8.1</p> <ul> <li>[bugfix] Fix a bug in indexing files</li> </ul> <p>1.8.0</p> <ul> <li>[bugfix] Skip chunking error</li> <li>Improve local web interface</li> <li>Remove link to official Seafile server</li> <li>Ignore all temporary files created by Microsoft Office</li> <li>Add French and Slovak translation</li> </ul>"},{"location":"changelog/client-changelog/#17","title":"1.7","text":"<p>1.7.3</p> <ul> <li>[bugfix] Fix a small syncing bug.</li> </ul> <p>1.7.2</p> <ul> <li>[bugfix] Fix a bug in un-syncing library. https://github.com/haiwen/seafile/issues/270</li> </ul> <p>1.7.1</p> <ul> <li>[win] Fix selecting of Seafile directory</li> </ul> <p>1.7.0</p> <ul> <li>[win] Enable selecting of Seafile directory</li> <li>Enable setting of upload/download speed</li> <li>Use encrypted transfer by default</li> <li>Support ignore certain files by seafile-ignore.txt</li> </ul>"},{"location":"changelog/client-changelog/#16","title":"1.6","text":"<p>1.6.2</p> <ul> <li>[bugfix,mac] Fix a bug in supporting directory names with accents</li> </ul> <p>1.6.1</p> <ul> <li>[bugfix] Prevent running of multiple seaf-daemon instance</li> <li>Improve the efficiency of start-up GC for libraries in merge stage</li> <li>[mac,win] Handle case-conflict files by renaming</li> </ul> <p>1.6.0</p> <ul> <li>[linux,mac] Support symbolic links</li> <li>[seaf-cli] clean logs</li> <li>Do not re-download file blocks when restart Seafile during file syncing</li> <li>[bugfix] Fix treating files as deleted when failed to create it due to reasons like disk full.</li> <li>[bugfix] Fix several bugs when shutdown Seafile during some syncing operation.</li> </ul>"},{"location":"changelog/client-changelog/#15","title":"1.5","text":"<p>1.5.3</p> <ul> <li>Log the version of seafile client when start-up.</li> <li>[bugfix] Fix a bug when simultaneously creating an empty folder with same name in server and client.</li> <li>[bugfix] Always use IPv4 address to connect a server.</li> </ul> <p>1.5.2</p> <ul> <li>[bug] Fix a memory-access bug when showing \"Auto merge by seafile system\" in bubble</li> </ul> <p>1.5.1</p> <ul> <li>[seaf-cli] Fix a bug in initializing the config dir.</li> <li>[bugfix] Improve the robustness of DNS looking-up.     Use standard DNS looking-up instead of libevent's non-blocking version.</li> </ul> <p>1.5.0</p> <ul> <li>Add Seaf-cli</li> <li>Check the correctness of password in the beginning of downloading a encrypted library.</li> <li>Show detailed information in bubble</li> <li>Enable change the server's address in the client</li> <li>[linux] Do not popup the browser when start up</li> <li>Remove seafile-web.log</li> </ul>"},{"location":"changelog/drive-client-changelog/","title":"SeaDrive Client Changelog","text":""},{"location":"changelog/drive-client-changelog/#3015-20250626","title":"3.0.15 (2025/06/26)","text":"<ul> <li>Persist file sync errors over restart</li> <li>Save encryption keys for encrypted libraries after delete confirmation \"No\"</li> <li>Increase fs-id-list request timeout to 30 minutes</li> <li>Update parent folder modification time when file are updated</li> <li>[mac] Fix memory leaks when removing downloaded items from cache</li> <li>[linux] Add Nautilus extension for GNOME</li> </ul>"},{"location":"changelog/drive-client-changelog/#3014-20250507","title":"3.0.14 (2025/05/07)","text":"<ul> <li>[win] Avoid potential file overwriting issue after internal metadata is removed by Anti-virus</li> <li>[win] Keep encryption keys after auto-resyncing an encrypted library, when internal metadata is removed by Anti-virus</li> <li>[win] Enhance handling of pinned files</li> <li>[mac] Auto lock office files when they're opened (requires macOS 15+)</li> </ul>"},{"location":"changelog/drive-client-changelog/#3013-20250306","title":"3.0.13 (2025/03/06)","text":"<ul> <li>Support PDF previews</li> <li>Don't timeout for fs-id-list requests</li> <li>Upgrade OpenSSL</li> <li>[mac] Fix handling of \"._DS\" files</li> <li>[win] Add user name in the SeaDrive entry in Windows Explorer</li> <li>[linux] Support importing CA certificates from OS</li> <li>[linux] Auto lock Office files opened by LibreOffice and WPS</li> </ul>"},{"location":"changelog/drive-client-changelog/#3012-20241203","title":"3.0.12 (2024/12/03)","text":"<ul> <li>Handle changes of invisible sub-folder permissions</li> <li>Support encrypted library with custom password hash algorithms</li> <li>[mac] Add back file search UI</li> <li>[mac] Fix bug that duplicated files are created by the client</li> <li>[mac] Don't show \"The path contains symbols that are not supported by the windows system\" message</li> <li>[win] Fix bug that sometimes files cannot be deleted</li> <li>[linux] Don't wait for file deletion confirmation in CLI</li> </ul>"},{"location":"changelog/drive-client-changelog/#3011-20240910","title":"3.0.11 (2024/09/10)","text":"<ul> <li>[win] Reuse cache folder when resync account</li> <li>[win] Don't download files with case conflicts in file names</li> <li>[mac] Remove local library metadata when deleting account</li> <li>[mac] Support uploading app package files</li> <li>[mac] Support latest TLS protocol</li> <li>[mac] Fix crash when first start on Apple Silicon</li> <li>[mac] Fix sync issue when creating a new folder and putting files into it</li> <li>Use usernames as suffix for conflict files, instead of emails</li> </ul>"},{"location":"changelog/drive-client-changelog/#3010-20240618","title":"3.0.10 (2024/06/18)","text":"<ul> <li>[mac] Fix support for using mulitple accounts after macOS 14.4</li> <li>Support accessing libraries with cloud-only sub-folders</li> <li>Support username and password for SOCKS5 proxy</li> <li>Record sync error when fail to download file</li> </ul>"},{"location":"changelog/drive-client-changelog/#309-20240425","title":"3.0.9 (2024/04/25)","text":"<ul> <li>Improve handling of exceptional file/folder operations, e.g. creating files in root folder, read-only folders</li> <li>Fixed some crash issues</li> <li>[mac] Hide \"Do not sync\" menu item from context menu</li> <li>[mac] Improved tray icon</li> <li>[mac] Improved mechanism for preventing more than one seadrive file provider processes from running</li> </ul>"},{"location":"changelog/drive-client-changelog/#308-20240221","title":"3.0.8 (2024/02/21)","text":"<ul> <li>Support Single-Sign-On with desktop browser</li> <li>[win] Delete invalid placeholders when re-login to an account</li> <li>[mac] Adjust the color and size of icons in system tray area</li> <li>[mac] Upload file execution permission</li> <li>[mac] Keep messages in notification area</li> <li>[mac] Fix some syncing issues</li> </ul>"},{"location":"changelog/drive-client-changelog/#307-20231204","title":"3.0.7 (2023/12/04)","text":"<ul> <li>Support accessing libraries with invisible sub-folder permissions</li> <li>[mac] Don't remove cache folders when removing accounts</li> <li>[mac] Always start extension when restarting the SeaDrive app</li> <li>[win] Avoid a case that can create empty commits</li> <li>[win] Make modifying cache location work again</li> <li>Use system proxy settings by default</li> </ul>"},{"location":"changelog/drive-client-changelog/#306-20230915","title":"3.0.6 (2023/09/15)","text":"<ul> <li>[win] Upgrade Qt to 6.5.2 and OpenSSL 3.0</li> <li>[win] Add a tip that re-syncing an account will create a new sync root folder</li> <li>[mac] Fix a bug that uncaching a file will make it 0-sized</li> </ul>"},{"location":"changelog/drive-client-changelog/#305-20230815","title":"3.0.5 (2023/08/15)","text":"<ul> <li>[win] Fix thumbnail orientation issue</li> <li>[mac] Add confirmation when move/copy files into root or category folders</li> <li>[mac] Fix unix socket name too long issue</li> <li>Fix bug when removing folder group permissions when notification server is used</li> <li>Support some new errors returned by newer servers</li> </ul>"},{"location":"changelog/drive-client-changelog/#304-20230610","title":"3.0.4 (2023/06/10)","text":"<ul> <li>[mac] Fix crash bug when adding new account</li> <li>[mac] Fix crash bug of GUI due to file descriptor leakage</li> <li>Fix status icon display issue</li> </ul>"},{"location":"changelog/drive-client-changelog/#303-20230525","title":"3.0.3 (2023/05/25)","text":"<ul> <li>[win] Support image thumbnails</li> <li>[win] Add resync account function, to help fix invalid placeholder issues</li> <li>[win] Remove entry in explorer when remove an account</li> <li>[win] Only convert file to placeholder after it's uploaded</li> <li>[win] Fix a bug that opening a file returns all zeros</li> <li>[win] Fix a bug that syncing doesn't work when restart SeaDrive with no network connection</li> <li>[win] Fix seafile_ext64.dll permission</li> <li>Require user confirmation when deleting a library</li> <li>Always display \"File Sync Errors\" menu item in system tray icon menu</li> <li>[mac] (Beta) Provide native Apple Silicon binary</li> <li>[mac] (Beta) Upgrade Qt to 6.2.4</li> <li>[mac] (Beta) Fix a bug that after downloading file with web browser to SeaDrive, file modification time becomes 1970.</li> <li>[mac] (Beta) Add more actions to right-click menu in Finder</li> </ul>"},{"location":"changelog/drive-client-changelog/#302-beta-20230324","title":"3.0.2 Beta (2023/03/24)","text":"<ul> <li>[mac] Use File Provider API to implement virtual drive</li> <li>Allow syncing multiple accounts at the same time</li> <li>Support notification server, which makes library and locked files update more timely</li> </ul>"},{"location":"changelog/drive-client-changelog/#2027-for-windows-20230324","title":"2.0.27 for Windows (2023/03/24)","text":"<ul> <li>[win] Update app signing certificate</li> <li>[win] Fix a potential crash issue</li> </ul>"},{"location":"changelog/drive-client-changelog/#2026-20221228","title":"2.0.26 (2022/12/28)","text":"<ul> <li>Ask for user confirmation when deleting more than 500 files at once</li> </ul>"},{"location":"changelog/drive-client-changelog/#2025-windows-20221203","title":"2.0.25 (Windows) (2022/12/03)","text":"<ul> <li>Disable removing invalid placeholders logic, to avoid mistakenly removing placeholders</li> <li>Fix a crash issue when fails to register sync root</li> <li>Avoid a potential case where empty commits are created</li> </ul>"},{"location":"changelog/drive-client-changelog/#2024-windows-20221114","title":"2.0.24 (Windows) (2022/11/14)","text":"<ul> <li>Add events.log for debugging local file changes</li> <li>Remove invalid placeholders after re-login (when corresponsiding files were removed on server)</li> <li>Resume creating placehooders when the first sync process was interrupted</li> </ul>"},{"location":"changelog/drive-client-changelog/#2024-macos-20221109","title":"2.0.24 (macOS) (2022/11/09)","text":"<ul> <li>Support macOS 13</li> </ul>"},{"location":"changelog/drive-client-changelog/#2023-20220818","title":"2.0.23 (2022/08/18)","text":"<ul> <li>[Win] Fix problems when renaming libraries in the client</li> </ul>"},{"location":"changelog/drive-client-changelog/#2022-20220623","title":"2.0.22 (2022/06/23)","text":"<ul> <li>[Win] Fix a placeholder size not updated issue.</li> <li>Improving moving files/folders with special characters in names</li> <li>[Linux] Fix CMake error</li> </ul>"},{"location":"changelog/drive-client-changelog/#2021-windows-20220321","title":"2.0.21 (Windows) (2022/03/21)","text":"<ul> <li>Don't remove cache folder when logout and remove account, to prevent unintended removal of files.</li> <li>Disallow changing cases for library names.</li> <li>Retry when failed to convert a file/folder to placeholder.</li> </ul>"},{"location":"changelog/drive-client-changelog/#2020-20220304","title":"2.0.20 (2022/03/04)","text":"<ul> <li>[Win] Avoid creating empty change records</li> <li>[Win] Fix a bug in cache cleaning: Don't clean files not uploaded yet.</li> <li>Support cache path that contains empty spaces</li> <li>Improve a few permission error messages</li> <li>Show errors when fails to create share links or upload links</li> <li>Support compiling with Qt 6.2</li> </ul>"},{"location":"changelog/drive-client-changelog/#2019-windows-20211229","title":"2.0.19 (Windows) (2021/12/29)","text":"<ul> <li>Ignore timestamp changes to .eml files</li> <li>Unregister sync root when user choose to remove account data in uninstallation</li> </ul>"},{"location":"changelog/drive-client-changelog/#2018-macos-20211029","title":"2.0.18 (macOS) (2021/10/29)","text":"<ul> <li>Add support for macOS 12</li> </ul>"},{"location":"changelog/drive-client-changelog/#2018-windows-20211026","title":"2.0.18 (Windows) (2021/10/26)","text":"<ul> <li>Improve library loading speed on restart</li> </ul>"},{"location":"changelog/drive-client-changelog/#2017-20210930","title":"2.0.17 (2021/09/30)","text":"<ul> <li>[Win] Fix unable to rename libraries</li> <li>[Win] Avoid repetitively removing and re-downloading libraries in some rare cases</li> <li>[Win] Add notification when all libraries are loaded on restart</li> <li>[Win] Fix bug when a library is both shared personally and to a group</li> </ul>"},{"location":"changelog/drive-client-changelog/#2016-2021813","title":"2.0.16 (2021/8/13)","text":"<ul> <li>[Win] Fix failure to delete placeholder files</li> <li>[Win] Fix failure to create placeholder files when there are duplicate file names with different cases</li> <li>Set Content-Type header in http requests</li> </ul>"},{"location":"changelog/drive-client-changelog/#2015-2021720","title":"2.0.15 (2021/7/20)","text":"<ul> <li>[Win] Fix wrong status icon after a folder is moved to another library</li> <li>[Win] Fix one more potential isssue that can cause \"cloud operation invalid\" error</li> <li>[Win] Fix pinning a file in device</li> <li>[Win] Pop-up notifications when a folder is moved to the category folder</li> <li>[Linux] Fix build with latest GLib</li> </ul>"},{"location":"changelog/drive-client-changelog/#2014-2021526","title":"2.0.14 (2021/5/26)","text":"<ul> <li>[Win] Fix crash issue when have multiple accounts with the same user names</li> <li>[Win] Fix potential \"cloud operation invalid\" error when downloading a file</li> <li>[Win] Avoid creating unwanted conflict files on restart</li> <li>[Win] Handle renaming of invalid folder name</li> <li>[Win] Support auto cleaning cache space</li> <li>[Win,Mac] Support \"seafile://\" protocol for opening file with client</li> <li>Report nicer error message when a library is too large to sync</li> </ul>"},{"location":"changelog/drive-client-changelog/#2013-2021323","title":"2.0.13 (2021/3/23)","text":"<ul> <li>[Win] Fix crash issue when multiple accounts with the same name are used</li> <li>[Win] Improve download speed for large files</li> <li>[Win] Improvement and bug fixes for context menu</li> <li>[Win] A few UI fixes</li> <li>[Win] Support preconfigure cache folder location</li> <li>[Mac] Fix bug for cleaning cached file/folder</li> </ul>"},{"location":"changelog/drive-client-changelog/#2012-2021129","title":"2.0.12 (2021/1/29)","text":"<ul> <li>[Win] Fix crash issue when repeatedly download and cancel download some files</li> <li>[Win] Fix some cases for creating unexpected conflict files</li> <li>[Win] Automatically download new files for pinned folders</li> <li>Don't create commits for read-only libraries. Avoid unexpected permission errors.</li> <li>[Win] Add user names to the shortcut in File Explorer</li> <li>[Win] Pop notifications when files are created in a category folder</li> <li>[Win] Make the columns in transfer progress dialog resizable</li> </ul>"},{"location":"changelog/drive-client-changelog/#2010-20201229","title":"2.0.10 (2020/12/29)","text":"<ul> <li>[Win] Add context menu</li> <li>[Mac] Support Apple Silicon M1 CPU</li> <li>[Linux] Unmount on exit</li> </ul>"},{"location":"changelog/drive-client-changelog/#209-20201120","title":"2.0.9 (2020/11/20)","text":"<ul> <li>[Mac] Fix failure to load kernel extension on macOS 11 Big Sur</li> </ul>"},{"location":"changelog/drive-client-changelog/#208-20201114","title":"2.0.8 (2020/11/14)","text":"<ul> <li>[Mac] Support macOS 11</li> <li>[Win] Fix moving multiple files/folders across different folders</li> </ul>"},{"location":"changelog/drive-client-changelog/#207-20201031","title":"2.0.7 (2020/10/31)","text":"<ul> <li>[Win] Avoid unintended file deletions when removing seafile account</li> <li>[Mac] Fix some application compatibility issues caused by extended file attributes handling</li> </ul>"},{"location":"changelog/drive-client-changelog/#206-20200924","title":"2.0.6 (2020/09/24)","text":"<ul> <li>[Win] Remove invalid characters from sync root folder name</li> <li>[Win] Increase request timeout for rename library, delete library, create library, move folders</li> <li>[Win] Avoid creating redundant sync root folders on restart</li> <li>[Win] Support pre-configuration registry keys</li> </ul>"},{"location":"changelog/drive-client-changelog/#1012-20200825","title":"1.0.12 (2020/08/25)","text":"<ul> <li>Fix occasional \"permission denied\" error when syncing a library</li> </ul>"},{"location":"changelog/drive-client-changelog/#205-20200730","title":"2.0.5 (2020/07/30)","text":"<ul> <li>Fix occasional \"permission denied\" error when syncing a library</li> <li>[Win] Remove explorer shortcut when uninstall SeaDrive or change cache folder location</li> </ul>"},{"location":"changelog/drive-client-changelog/#204-20200713","title":"2.0.4 (2020/07/13)","text":"<ul> <li>[Win] Use username for cache folder name instead of a hash value</li> <li>[Win] Retry download files when pinning a folder</li> <li>[Win] Retry rename category folder when switching language</li> <li>[Win] Only allow install on Windows 10 1709 or later</li> <li>[Mac] Disable \"search in Finder\" option</li> <li>Fix tray icon sync error status</li> </ul>"},{"location":"changelog/drive-client-changelog/#203-20200617","title":"2.0.3 (2020/06/17)","text":"<ul> <li>[Win] Fix crash on Windows 10 1709 - 1803</li> <li>[Win] Show SeaDrive shortcut when opening files in 32-bit applications (e.g. Word)</li> <li>[Win] Avoid creating unnecessary conflict files</li> <li>[Win] Improve error message of opening placeholder files when SeaDrive is not running</li> <li>[Win] Support removing account information when uninstall</li> </ul>"},{"location":"changelog/drive-client-changelog/#202-20200523","title":"2.0.2 (2020/05/23)","text":"<ul> <li>[Mac] Support syncing encrypted libraries</li> <li>[Win] Support change cache location</li> <li>[Win] Improve account switching behaviors</li> <li>[Win] Other bug fixes</li> </ul>"},{"location":"changelog/drive-client-changelog/#201-for-windows-20200413","title":"2.0.1 for Windows (2020/04/13)","text":"<ul> <li>Fix issues when switching languages</li> <li>Fix issues for legacy Windows \"8.3 format\" paths</li> <li>Improve speed of creating placeholders</li> <li>Don't add SeaDrive cache folder to Windows search index</li> <li>Use short hash instead of \"servername_account\" for cache folder name</li> <li>Prevent the old Explorer extension from calling new SeaDrive (avoiding high CPU usage)</li> <li>Fix small issues in encrypted library support</li> <li>Change installation location from \"Seafile Ltd\" to \"Seafile\"</li> <li>Add SeaDrive entry to Windows start menu</li> <li>Change \"seadrive\" to \"SeaDrive\" in Explorer navigation pane</li> <li>Fix SSO re-login failure</li> </ul>"},{"location":"changelog/drive-client-changelog/#200-for-windows-20200320","title":"2.0.0 for Windows (2020/03/20)","text":"<ul> <li>Use Windows 10 native API to implement the virtual drive</li> <li>Support syncing encrypted libraries</li> </ul>"},{"location":"changelog/drive-client-changelog/#1011-20200207","title":"1.0.11 (2020/02/07)","text":"<ul> <li>Fix a bug that logout and login will lead to file deletion</li> <li>[mac] Fix a bug in SSO</li> </ul>"},{"location":"changelog/drive-client-changelog/#1010-20191223","title":"1.0.10 (2019/12/23)","text":"<ul> <li>Fix a bug that sometimes SeaDrive is empty when network unavailable</li> <li>Fix generating too many tokens when library downloading failed</li> <li>Fix sometimes files should be ignored are uploaded</li> <li>Automatically re-sync a library if local metadata is broken</li> <li>[mac] Add support for MacOS 10.15</li> <li>[mac] Drop support for MacOS 10.12</li> </ul>"},{"location":"changelog/drive-client-changelog/#108-20191105","title":"1.0.8 (2019/11/05)","text":"<ul> <li>Support French and Germany language for top level folder name</li> <li>Fix a compatible issue with Excel</li> <li>Fix a problem in cleaning local cache</li> <li>Support delete library in category My Libraries</li> <li>Ignore .fuse_hidden file in Mac</li> <li>Rotate seadrive.log</li> </ul>"},{"location":"changelog/drive-client-changelog/#107-20190821","title":"1.0.7 (2019/08/21)","text":"<ul> <li>[mac] Improve finder extension</li> </ul>"},{"location":"changelog/drive-client-changelog/#106-20190701","title":"1.0.6 (2019/07/01)","text":"<ul> <li>[fix, win] Fix a problem when uninstall or upgrade the drive client when the client is running.</li> <li>[fix] Fix a crash problem when file path containing invalid character</li> </ul>"},{"location":"changelog/drive-client-changelog/#105-20190611","title":"1.0.5 (2019/06/11)","text":"<ul> <li>[fix] Fix lots of \"Creating partial commit after adding\" in the log</li> <li>[fix] Fix permission at the client is wrong when a library shared to different groups with different permissions</li> <li>[fix] Don't show libraries with online preview or online read-write permission</li> <li>[mac] Add Mac Finder preview plugin to prevent automatically downloading of files</li> </ul>"},{"location":"changelog/drive-client-changelog/#104-20190423","title":"1.0.4 (2019/04/23)","text":"<ul> <li>[fix] Fix file locking</li> <li>[fix] Fix support of detecting pro edition when first time login</li> <li>Support Kerberos authentication</li> </ul>"},{"location":"changelog/drive-client-changelog/#103-20190318","title":"1.0.3 (2019/03/18)","text":"<ul> <li>[fix] Fix copy folders with properties into SeaDrive</li> <li>[fix] Fix a possible crash bug when listing libraries</li> </ul>"},{"location":"changelog/drive-client-changelog/#101-20190114","title":"1.0.1 (2019/01/14)","text":"<ul> <li>Update included Dokany drive</li> <li>Improve notification when user try to delete a library in the client</li> <li>[fix] Fix getting internal link for folders</li> <li>[fix] Fix problem after changing the cache directory</li> <li>[fix] Fix support for guest users that have no storage capacity</li> <li>[fix] Fix timeout when loading a library with a lot of files</li> </ul>"},{"location":"changelog/drive-client-changelog/#100-20181119","title":"1.0.0 (2018/11/19)","text":"<ul> <li>[fix] Allow a guest user to copy files into shared library</li> <li>Support pause sync</li> <li>[win] Add option to only allow current user to view the virtual disk</li> <li>[win] Don't let the Windows to search into the internal cache folder</li> <li>[win] Install the explorer extension to system path to allow multiple users to use the extension</li> <li>[mac] Add option to allow search in Finder (disabled by default)</li> <li>[mac] Update kernel drive to support Mac Mojave</li> <li>[mac] Support office file automatically lock</li> </ul>"},{"location":"changelog/drive-client-changelog/#095-20180910","title":"0.9.5 (2018/09/10)","text":"<ul> <li>[fix, win] Fix support for some SSL CA</li> <li>Redirect to https if user accidentally input server's address with http but the server is actually use http</li> <li>[fix, win] Show a tooltip that the Windows system maybe rebooted during upgrading drive client</li> <li>[fix, mac] Fix permission problems during installation on Mac 10.13+</li> </ul>"},{"location":"changelog/drive-client-changelog/#094-20180818","title":"0.9.4 (2018/08/18)","text":"<ul> <li>[win] No longer depends on .Net framework</li> <li>[mac] Support file search in Finder</li> <li>[win] Fix loading of HTTPS certifications</li> </ul>"},{"location":"changelog/drive-client-changelog/#093-20180619","title":"0.9.3 (2018/06/19)","text":"<ul> <li>[win] Show syncing status at the top level folders</li> <li>[fix] Fix sometimes logout/login lead to empty drive folder</li> <li>Support change cache folder</li> <li>Add \"open file/open folder\" in search window</li> <li>Set automatically login to true in SSO mode</li> <li>[mac] Fix compatibility with AirDrop</li> </ul>"},{"location":"changelog/drive-client-changelog/#092-20180505","title":"0.9.2 (2018/05/05)","text":"<ul> <li>Fix a bug that causing SeaDrive crash</li> </ul>"},{"location":"changelog/drive-client-changelog/#091-20180424","title":"0.9.1 (2018/04/24)","text":"<ul> <li>Fix a bug that causing crash when file search menu is clicked</li> </ul>"},{"location":"changelog/drive-client-changelog/#090-20180424","title":"0.9.0 (2018/04/24)","text":"<ul> <li>Libraries are displayed under three folders \"My Libraries\", \"Group Libraries\", \"Shared libraries\"</li> <li>[fix] Fix a bug in cleaning cache</li> <li>[win] Update the kernel drive</li> <li>Improve syncing notification messages</li> <li>[mac] Include the kernel drive with the SeaDrive package</li> <li>[mac] Add Finder sidebar shortcut</li> <li>Add file search</li> </ul>"},{"location":"changelog/drive-client-changelog/#086-20180319","title":"0.8.6 (2018/03/19)","text":"<ul> <li>[fix] Fix compatibility with Visio and other applications by implementing a missing system API</li> </ul>"},{"location":"changelog/drive-client-changelog/#085-20180103","title":"0.8.5 (2018/01/03)","text":"<ul> <li>[fix] Fix SeaDrive over RDP in Windows 10/7</li> <li>[fix] Fix SeaDrive shell extension memory leak</li> <li>[fix] Fix duplicated folder/files shown in Finder.app (macOS)</li> <li>[fix] Fix file cache status icon for MacOS</li> </ul>"},{"location":"changelog/drive-client-changelog/#084-20171201","title":"0.8.4 (2017/12/01)","text":"<ul> <li>[fix] Fix Word/Excel files can't be saved in Windows 10</li> <li>Add \"download\" context menu to explicitly download a file</li> <li>Change \"Shibboleth\" to \"Single Sign On\"</li> </ul>"},{"location":"changelog/drive-client-changelog/#083-20171124","title":"0.8.3 (2017/11/24)","text":"<ul> <li>[fix] Fix deleted folder recreated issue</li> <li>Improve UI of downloading/uploading list dialog</li> </ul>"},{"location":"changelog/drive-client-changelog/#081-20171103","title":"0.8.1 (2017/11/03)","text":"<ul> <li>Use \"REMOVABLE\" when mount the drive disk</li> <li>Prevent creating \"System Volume Information\"</li> <li>Some UI fixes</li> </ul>"},{"location":"changelog/drive-client-changelog/#080-20170916","title":"0.8.0 (2017/09/16)","text":"<ul> <li>[fix] Reuse old drive letter after SeaDrive crash</li> <li>[fix] Fix rename library back to old name when it is changed in the server</li> <li>[fix] Fix sometimes network can not reconnected after network down</li> <li>Change default block size to 8MB</li> <li>Make auto-login as default</li> <li>Remount SeaDrive when it is unmounted after Windows hibernate</li> </ul>"},{"location":"changelog/drive-client-changelog/#071-20170623","title":"0.7.1 (2017/06/23)","text":"<ul> <li>[fix] Fix a bug that causing client crash</li> </ul>"},{"location":"changelog/drive-client-changelog/#070-20170607","title":"0.7.0 (2017/06/07)","text":"<ul> <li>Add support for multi-users using SeaDrive on a single desktop. But different users must choose different drive letters.</li> <li>Improve write performance</li> <li>[fix] When a non-cached file is locked in the server, the \"lock\" icon will be shown instead of the \"cloud\" icon.</li> <li>Add \"automatically login\" option in login dialog</li> <li>Add file transfer status dialog.</li> </ul>"},{"location":"changelog/drive-client-changelog/#062-20170422","title":"0.6.2 (2017/04/22)","text":"<ul> <li>[fix] Fix after moving a file to a newly created sub folder, the file reappear when logout and login</li> <li>Refresh current folder and the destination folder after moving files from one library to another library</li> <li>[fix] Fix file locking not work</li> <li>[fix] Fix sometimes files can't be saved</li> </ul>"},{"location":"changelog/drive-client-changelog/#061-20170327","title":"0.6.1 (2017/03/27)","text":"<ul> <li>[fix] Don't show a popup notification to state that a file can't be created in <code>S:</code> because a few programs will automatically try to create files in <code>S:</code></li> </ul>"},{"location":"changelog/drive-client-changelog/#060-20170325","title":"0.6.0 (2017/03/25)","text":"<ul> <li>Improve syncing status icons</li> <li>Show error in the interface when there are syncing errors</li> <li>Don't show rorate icon when downloading/uploading metadata</li> <li>[fix] Don't download files when the network is not connected</li> </ul>"},{"location":"changelog/drive-client-changelog/#052-20170309","title":"0.5.2 (2017/03/09)","text":"<ul> <li>[fix] Rename a non-cached folder or file will lead to sync error.</li> </ul>"},{"location":"changelog/drive-client-changelog/#051-20170216","title":"0.5.1 (2017/02/16)","text":"<ul> <li>[fix] Fix copying exe files to SeaDrive on Win 7 will freeze the explorer</li> <li>The mounted drive is only visible to the current user</li> <li>Add popup notification when syncing is done</li> <li>[fix] Fix any change in the settings leads to a drive letter change</li> </ul>"},{"location":"changelog/drive-client-changelog/#050-20170118","title":"0.5.0 (2017/01/18)","text":"<ul> <li>Improve stability</li> <li>Support file locking</li> <li>Support sub-folder permission</li> <li>[fix] Fix 1TB limitation</li> <li>User can choose disk letter in settings dialog</li> <li>Support remote wipe</li> <li>[fix] Use proxy server when login</li> <li>Click system tray icon open SeaDrive folder</li> <li>Support application auto-upgrade</li> </ul>"},{"location":"changelog/drive-client-changelog/#042-20161216","title":"0.4.2 (2016/12/16)","text":"<ul> <li>[fix] Fix SeaDrive initialization error during Windows startup</li> </ul>"},{"location":"changelog/drive-client-changelog/#041-20161107","title":"0.4.1 (2016/11/07)","text":"<ul> <li>[fix] Fix a bug that lead to empty S: drive after installation.</li> </ul>"},{"location":"changelog/drive-client-changelog/#040-20161105","title":"0.4.0 (2016/11/05)","text":"<ul> <li>[fix] Fix a bug that leads to generation of conflict files when editing</li> <li>Add translations</li> <li>Update included Dokany library to 1.0</li> <li>Don't show encrypted libraries even in command line</li> <li>Show permission error when copy a file to the root</li> <li>Show permission error when try to modify a read-only folder</li> <li>Show permission error when try to delete a folder in the root folder</li> </ul>"},{"location":"changelog/drive-client-changelog/#031-20161022","title":"0.3.1 (2016/10/22)","text":"<ul> <li>Fix link for license terms</li> <li>Use new system tray icon</li> <li>Add notification for cross-libraries file move</li> </ul>"},{"location":"changelog/drive-client-changelog/#030-20161014","title":"0.3.0 (2016/10/14)","text":"<ul> <li>Support selecting Drive letter</li> <li>Don't create folders like msiS50.tmp on Windows</li> <li>[fix] Fix cache size limit settings</li> <li>Correctly show the storage space if the space is unlimited on the server side.</li> </ul>"},{"location":"changelog/drive-client-changelog/#020-20160915","title":"0.2.0 (2016/09/15)","text":"<ul> <li>Add shibboleth support</li> <li>Show a dialog notify the client is downloading file list from the server during initialisation</li> <li>Show transfer rate</li> <li>[fix] Fix a bug that lead to the file modification time to be empty</li> <li>[fix] Fix a bug that lead to files not be uploaded</li> </ul>"},{"location":"changelog/drive-client-changelog/#010-20160902","title":"0.1.0 (2016/09/02)","text":"<ul> <li>Initial release</li> </ul>"},{"location":"changelog/server-changelog-old/","title":"Seafile Server Changelog (old)","text":""},{"location":"changelog/server-changelog-old/#71","title":"7.1","text":"<p>Feature changes</p> <p>Progresql support is dropped as we have rewritten the database access code to remove copyright issue.</p> <p>Upgrade</p> <p>Please check our document for how to upgrade to 7.1.</p>"},{"location":"changelog/server-changelog-old/#715-20200922","title":"7.1.5 (2020/09/22)","text":"<ul> <li>[fix] Fix a bug in returned group library permission for  SeaDrive client</li> <li>[fix] Fix files preview using OnlyOffice in public shared links </li> <li>Support pagination when listing libraries in a group</li> <li>Update wsgidav used in WebDAV</li> <li>[fix] Fix WebDAV failed login via WebDAV secret</li> <li>[fix] Fix WebDAV error if a file is moved immediately after uploading</li> <li>Remove redundent logs in seafile.log</li> <li>[fix] Fix \"save to...\" in share link</li> <li>Add an option to show a user's email in sharing dialog (ENABLE_SHOW_CONTACT_EMAIL_WHEN_SEARCH_USER)</li> <li>Add database connection pool to reduce database connection usage</li> <li>Enable generating internal links for files in an encrypted library</li> <li>Support setting the expire date time of a share link to a specific date time</li> <li>GC add --id-prefix option to scan a specific range of libraries</li> <li>fsck add an option to not check block integrity to speed up scanning</li> <li>[fix] ccnet no longer listen on port 10001</li> </ul>"},{"location":"changelog/server-changelog-old/#714-20200519","title":"7.1.4 (2020/05/19)","text":"<ul> <li>[fix] Fix page error in \"System Admin-&gt; Users -&gt; A User -&gt; Groups\"</li> <li>[fix] Fix listing LDAP imported users when number of users is greater than 500</li> <li>Support selecting and downloading multiple files in a sharing link</li> <li>Show share link expiration time in system admin</li> <li>[fix] Fix file download links in public libraries</li> <li>Other UI fixes</li> </ul>"},{"location":"changelog/server-changelog-old/#713-20200326","title":"7.1.3 (2020/03/26)","text":"<ul> <li>Support sort libraries by size and number of files in admin panel</li> <li>Support sort users by used storage in admin panel</li> <li>[fix] Fix Markdown print for markdown with more than 1 page</li> <li>Other UI fixes</li> </ul>"},{"location":"changelog/server-changelog-old/#712-beta-20200305","title":"7.1.2 beta (2020/03/05)","text":"<ul> <li>[fix] Fix HTTP/2 support</li> <li>Markdown page can now be printed using browser's \"Print...\"</li> <li>Add zoom buttons for PDF page</li> <li>Add sort function to directory share link page</li> <li>Add support for JSON web tokens in OnlyOffice integration</li> <li>UI improvements for pages in admin panel</li> </ul>"},{"location":"changelog/server-changelog-old/#711-beta-20191223","title":"7.1.1 beta (2019/12/23)","text":"<ul> <li>[fix] Fix Gunicorn warning</li> <li>[fix] Fix SQLite upgrade script</li> <li>[fix] Fix Seahub can't started problem on Debian 10</li> <li>[fix] For for Excel and PPT, the default fonts are Chinese font sets.</li> <li>Some other UI fixes and improvements</li> </ul>"},{"location":"changelog/server-changelog-old/#710-beta-20191205","title":"7.1.0 beta (2019/12/05)","text":"<ul> <li>Rewrite the system admin pages with React</li> <li>Upgrade to Python3</li> <li>Add library API Token, you can now generate API tokens for a library and use them in third party programs.</li> <li>Add a feature abuse report for reporting abuse for download links.</li> </ul>"},{"location":"changelog/server-changelog-old/#70","title":"7.0","text":"<p>Feature changes</p> <p>In version 6.3, users can create public or private Wikis. In version 7.0, private Wikis is replaced by column mode view. Every library has a column mode view. So users don't need to explicitly create private Wikis.</p> <p>Public Wikis are now renamed to published libraries.</p> <p>Upgrade</p> <p>Just follow our document on major version upgrade. No special steps are needed.</p>"},{"location":"changelog/server-changelog-old/#705-20190923","title":"7.0.5 (2019/09/23)","text":"<ul> <li>[fix] Fix '\\n' in system wide notification will lead to blank page</li> <li>[fix] Remove all metadata in docx template</li> <li>[fix] Fix redirection after login</li> <li>[fix] Fix group order is not alphabetic</li> <li>[fix] Fix download button in sharing link</li> <li>Mobile UI Improvement (Now all major pages can be used in Mobile smoothly)</li> <li>Add notification when a user try to leave a page during file transfer</li> <li>Add UI waiting notification when resetting a user's password in admin panel</li> <li>Add generating internal link (smart-link) for folders</li> <li>[fix] Fix file drag and drop in IE and Firefox</li> <li>Improve UI for file uploading, support re-upload after error</li> <li>[fix] Fix devices login via Shibboleth not show in devices list</li> <li>Support of OnlyOffice auto-save option</li> <li>[fix] Fix zip download when user selecting a long list of files</li> <li>Other UI fixes</li> </ul>"},{"location":"changelog/server-changelog-old/#704-20190726","title":"7.0.4 (2019/07/26)","text":"<ul> <li>Fix avatar problem when deployed under non-root domain</li> <li>Add get internal link in share dialog</li> <li>Fix newly created DOCX files are not empty and have a Chinese font set as default font</li> <li>Fix system does not send email to new user when adding new user in system admin</li> <li>Fix thumbnail for TIFF files</li> <li>Fix direct download link for sharing links</li> </ul>"},{"location":"changelog/server-changelog-old/#703-20190705","title":"7.0.3 (2019/07/05)","text":"<ul> <li>UI Improvements and fixes</li> <li>Fix file upload button with Safari, IE edge</li> <li>Fix compatibility with \"Open library in web\" from the old version desktop client</li> <li>Support \".\" in group name</li> <li>Add back \"send link\" for upload links</li> <li>Add back grid view for folder sharing links</li> <li>Fix preview for PSD, TIFF files</li> <li>Fix deleting of favorate items when they are shared items but the sharing are revoked</li> <li>Fix avatar broken problem when using a non-stardard port</li> <li>Fix resumable file uploading</li> </ul>"},{"location":"changelog/server-changelog-old/#702-20190613","title":"7.0.2 (2019/06/13)","text":"<ul> <li>UI fixes</li> <li>Support index.md in published library</li> <li>Fix IE Edge support</li> </ul>"},{"location":"changelog/server-changelog-old/#701-beta-20190531","title":"7.0.1 beta (2019/05/31)","text":"<ul> <li>[fix] Fix database upgrade problem</li> <li>[fix] Fix WebDAV can't be started</li> <li>[fix] Some UI fixes</li> </ul>"},{"location":"changelog/server-changelog-old/#700-beta-20190523","title":"7.0.0 beta (2019/05/23)","text":"<ul> <li>Upgraded Web UI with React framework. The look and feel of the new UI is much better.</li> <li>Improved Markdown editor</li> <li>Add columns view mode (tree view like in the Windows Explorer)</li> <li>Add context menu to manipulate files</li> <li>Move files via drag and drop</li> <li>Redesigned file tags</li> <li>Support editing share link permission after creating a link</li> </ul>"},{"location":"changelog/server-changelog-old/#63","title":"6.3","text":"<p>In version 6.3, Django is upgraded to version 1.11. Django 1.8, which is used in version 6.2, is deprecated in 2018 April.</p> <p>With this upgrade, the fast-cgi mode is no longer supported. You need to config Seafile behind Nginx/Apache in WSGI mode.</p> <p>The way to run Seahub in another port is also changed. You need to modify the configuration file <code>conf/gunicorn.conf</code> instead of running <code>./seahub.sh start &lt;another-port&gt;</code>.</p> <p>Version 6.3 also changed the database table for file comments, if you have used this feature, you need migrate old file comments using the following commends after upgrading to 6.3:</p> <pre><code>./seahub.sh python-env seahub/manage.py migrate_file_comment\n</code></pre> <p>Note, this command should be run while Seafile server is running.</p>"},{"location":"changelog/server-changelog-old/#634-20180915","title":"6.3.4 (2018/09/15)","text":"<ul> <li>[fix] Fix a security issue in Shibboleth authentication</li> <li>[fix] Fix sometimes Web UI will not autoload a &gt;100 item directory view</li> </ul>"},{"location":"changelog/server-changelog-old/#633-20180907","title":"6.3.3 (2018/09/07)","text":"<ul> <li>Add generating of internal links</li> <li>Support copy a file to its own parent folder, creating a file with a suffix like test-1.docx</li> <li>Support setting the language list</li> <li>Redirect '/shib-login' to '/sso'</li> <li>Change \"Unknown error\" to \"network error\" when uploading failed caused by network error</li> <li>[fix] Fix groups not shown in system admin panel</li> <li>Support files be manually saved in OnlyOffice</li> <li>Improve performance when getting users quota usage</li> <li>Improve Markdown editor</li> <li>The new Wiki feature is ready</li> <li>Update Django to 1.11.11</li> </ul>"},{"location":"changelog/server-changelog-old/#632-20180709","title":"6.3.2 (2018/07/09)","text":"<ul> <li>[fix] Fix error when public wiki be viewed by anonymous users</li> <li>Remove department field in users' profile page</li> <li>[fix] Print warning instead of exit when there are errors in database table upgrade</li> <li>[fix] Send notification to the upload link creator after there are files uploaded</li> <li>[fix] Fix customize css via \"custom/custom.css\"</li> <li>[api] return the last modifier in file detail API</li> <li>[fix] Fix ZIP download can't work in some languages</li> </ul>"},{"location":"changelog/server-changelog-old/#631-20180624","title":"6.3.1 (2018/06/24)","text":"<ul> <li>Allow fullscreen presentation when view ppt(x) file via CollaboraOffice.</li> <li>Support mobile UI style when view file via OnlyOffice.</li> <li>Some UI improvement.</li> <li>Show terms and condition link if terms and condition is enabled</li> <li>[fix] Update OnlyOffice callback func (save file when status is 6).</li> <li>[fix] Show library\u2019s first commit\u2019s desc on library history page.</li> <li>[fix] Check if is an deleted library when admin restore a deleted library.</li> <li>[fix] Removed dead 'quota doc' link on user info popup.</li> <li>[fix] Fix bug of OnlyOffice file co-authoring.</li> <li>[api] Add starred field to file detail api.</li> <li>Use ID instead of email on sysadmin user page.</li> <li>[fix] Fix database upgrade problems</li> <li>[fix] Fix support for sqlite3</li> <li>[fix] Fix crash when seaf-fsck, seaf-gc receive wrong arguments</li> </ul>"},{"location":"changelog/server-changelog-old/#630-beta-20180526","title":"6.3.0 beta (2018/05/26)","text":"<ul> <li>UI Improvements: moving buttons to top bar, improve scrolling in file/library list</li> <li>Update Django to 1.11, remove fast-cgi support</li> <li>Update jQuery to version 3.3.1</li> <li>Update pdf.js</li> <li>Add invite people link to share dialog if the feature is enabled</li> <li>Remove login log after delete a user</li> <li>[admin] Support customize site title, site name, CSS via Web UI</li> <li>[beta] Wiki, users can create public wikis</li> <li>Add an option to define the listening address for WSGI mode</li> <li>[fix] Fix a bug that causing seaf-fsck crash</li> <li>[fix] Fix support for uploading folder via \u2018Cloud file browser\u2019</li> <li>[fix] Cancel Zip download task at the server side when user close zip download dialog</li> <li>Other fixes</li> </ul>"},{"location":"changelog/server-changelog-old/#62","title":"6.2","text":"<p>From 6.2, It is recommended to use WSGI mode for communication between Seahub and Nginx/Apache. Two steps are needed if you'd like to switch to WSGI mode:</p> <ol> <li>Change the config file of Nginx/Apache.</li> <li>Restart Seahub with <code>./seahub.sh start</code> instead of <code>./seahub.sh start-fastcgi</code></li> </ol> <p>The configuration of Nginx is as following:</p> <pre><code>location / {\n         proxy_pass         http://127.0.0.1:8000;\n         proxy_set_header   Host $host;\n         proxy_set_header   X-Real-IP $remote_addr;\n         proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n         proxy_set_header   X-Forwarded-Host $server_name;\n         proxy_read_timeout  1200s;\n\n         # used for view/edit office file via Office Online Server\n         client_max_body_size 0;\n\n         access_log      /var/log/nginx/seahub.access.log;\n         error_log       /var/log/nginx/seahub.error.log;\n    }\n</code></pre> <p>The configuration of Apache is as following:</p> <pre><code>    # seahub\n    SetEnvIf Authorization \"(.*)\" HTTP_AUTHORIZATION=$1\n    ProxyPass / http://127.0.0.1:8000/\n    ProxyPassReverse / http://127.0.0.1:8000/\n</code></pre>"},{"location":"changelog/server-changelog-old/#625-20180123","title":"6.2.5 (2018/01/23)","text":"<ul> <li>[fix] Fix OAuth bug</li> <li>[fix] Improve the performance of returning a user's all group libraries</li> <li>[new] Support customize the list of groups that a user can see when sharing a library</li> </ul>"},{"location":"changelog/server-changelog-old/#624-20180116","title":"6.2.4 (2018/01/16)","text":"<ul> <li>[new] Add the feature \"remember this device\" after two-factor authentication</li> <li>[new] Add option to notify the admin after new user registration (NOTIFY_ADMIN_AFTER_REGISTRATION)</li> <li>[fix] Fix a bug in modify permission for a a shared sub-folder</li> <li>[fix] Fix support for PostgreSQL</li> <li>[fix] Fix a bug in SQLite database support</li> <li>[fix] Fix support for uploading 500+ files via web interface (caused by API rate throttle)</li> <li>[improve, ui] Add transition to show/hide of feedback messages.</li> <li>[improve] Improve performance of file history page.</li> <li>[improve] Show two file history records at least.</li> <li>[fix] show shared sub-folders when copy/move file/folder to \u201cOther Libraries\u201d.</li> <li>[fix] Remove the white edge of webpage when previewing file via OnlyOffice.</li> <li>[fix] Don\u2019t check if user exists when deleting a group member in admin panel.</li> <li>[fix, oauth] Don\u2019t overwrite public registration settings when login a nonexistent user.</li> <li>Other UI improvements.</li> </ul>"},{"location":"changelog/server-changelog-old/#623-20171115","title":"6.2.3 (2017/11/15)","text":"<ul> <li>Support OAuth.</li> <li>WSGI uses 5 processors by default instead of 3 processors each with 5 threads</li> <li>[share] Add \"click to select\" feature for download/upload links.</li> <li>[admin] Show/edit contact email in admin panel.</li> <li>[admin] Show upload links in admin panel.</li> <li>[fix] Fix Shibboleth login redirection issue, see https://forum.seafile.com/t/shared-links-via-shibboleth/4067/19</li> <li>[fix] In some case failed to unshare a folder.</li> <li>[fix] LDAP search issue.</li> <li>[fix] Fix Safari downloaded file names are encoded like 'test-%2F%4B.doc' if it contains special characters.</li> <li>[fix] Disable client encrypt library creation when creating encrypt library is disabled on server.</li> </ul>"},{"location":"changelog/server-changelog-old/#622-20170925","title":"6.2.2 (2017/09/25)","text":"<ul> <li>[fix] Fix register button can't be clicked in login page</li> <li>[fix] Fix login_success field not exist in sysadmin_extra_userloginlog</li> </ul>"},{"location":"changelog/server-changelog-old/#621-20170922","title":"6.2.1 (2017/09/22)","text":"<ul> <li>[fix] Fix upgrade script for SQLite database</li> <li>Add Czech language</li> <li>[ui] Move password setting to a separate section</li> <li>[ui] Add divider to file operation menu</li> <li>[ui] Use high DPI icon in favorites page</li> <li>[ui] Focus on password fields by default</li> <li>[ui] Show feedback message when restore a library to a snapshot</li> <li>[fix] Don't import settings in seafile.conf to database</li> </ul>"},{"location":"changelog/server-changelog-old/#620-beta-20170914","title":"6.2.0 beta (2017/09/14)","text":"<ul> <li>Redesign login page, adding a background image.</li> <li>Add two factor authentication</li> <li>Clean the list of languages</li> <li>Add the ability of tagging a snapshot of a library (Use <code>ENABLE_REPO_SNAPSHOT_LABEL = True</code> to turn the feature on)</li> <li>[admin] Add an option to enable users to share a library to any groups in the system.</li> <li>Use WSGI as the default mode for deploying Seahub.</li> <li>Add a field Reference ID to support changing users primary ID in Shibboleth or LDAP</li> <li>Improved performance of loading library list</li> <li>Support adding a custom user search function (https://github.com/haiwen/seafile-docs/commit/115f5d85cdab7dc272da81bcc8e8c9b91d85506e)</li> <li>Other small UI improvements</li> </ul>"},{"location":"changelog/server-changelog-old/#61","title":"6.1","text":"<p>If you upgrade from 6.0 and you'd like to use the feature video thumbnail, you need to install ffmpeg package:</p> <pre><code># for ubuntu 16.04\napt-get install ffmpeg\npip install pillow moviepy\n\n# for Centos 7\nyum -y install epel-release\nrpm --import http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro\nyum -y install ffmpeg ffmpeg-devel\npip install pillow moviepy\n</code></pre>"},{"location":"changelog/server-changelog-old/#612-20170815","title":"6.1.2 (2017.08.15)","text":"<ul> <li>Use user's language as lang setting for OnlyOffice</li> <li>Improve performance for getting user\u2019s unread messages</li> <li>Fix error when uploading files to system default library template</li> <li>Users can restore their own deleted libraries</li> <li>Improve performance when move or copy multiple files/folders</li> <li>Add \u201cdetails\u201d for libraries, folders and files to show information like how many files in a library/folder</li> <li>[fix] Fix a bug in seaf-gc</li> <li>[fix, api] Fix a bug in creating folder API</li> <li>[admin] Improve performance in getting total file number, used space and total number of devices</li> <li>[fix] Fix MySQL connection pool in Ccnet</li> </ul>"},{"location":"changelog/server-changelog-old/#611-20170615","title":"6.1.1 (2017.06.15)","text":"<ul> <li>Disable thumbnail for video files in default</li> <li>Enable fixing the email for share link to be fixed in certain language (option SHARE_LINK_EMAIL_LANGUAGE in seahub_setting.py). So admin can force the language for a email of a share link to be always in English, regardless of what language the sender is using.</li> <li>The language of the interface of CollaboraOffice/OnlyOffice will be determined by the language of the current user.</li> <li>Display the correct image thumbnails in favorites instead of the generic one</li> <li>Enable set favicon and logo via admin panel</li> <li>Admin can add libraries in admin panel</li> </ul>"},{"location":"changelog/server-changelog-old/#610-beta-20170511","title":"6.1.0 beta (2017.05.11)","text":"<p>Web UI Improvement:</p> <ol> <li>Add thumbnail for video files</li> <li>Improved image file view, using thumbnail to view pictures</li> <li>Improve pdf preview in community edition</li> <li>Move items by drap &amp; drop</li> <li>Add create docx/xlsx/pptx in web interface</li> <li>Add OnlyOffice integration</li> <li>Add Collabora integration</li> <li>Support folder upload in community edition</li> <li>Show which client modify a file in history, this will help to find which client accidentally modified a file or deleted a file.</li> </ol> <p>Improvement for admins:</p> <ol> <li>Admin can set user\u2019s quote, delete users in bulk</li> <li>Support using admin panel in mobile platform</li> <li>Add translation for settings page</li> </ol> <p>System changes:</p> <ol> <li>Remove wiki by default</li> <li>Upgrade Django to 1.8.18</li> <li>Clean Ajax API</li> <li>Increase share link token length to 20 characters</li> <li>Upgrade jstree to latest version</li> </ol>"},{"location":"changelog/server-changelog-old/#60","title":"6.0","text":"<p>Note: If you ever used 6.0.0 or 6.0.1 or 6.0.2 with SQLite as database and encoutered a problem with desktop/mobile client login, follow https://github.com/haiwen/seafile/pull/1738 to fix the problem.</p>"},{"location":"changelog/server-changelog-old/#609-20170330","title":"6.0.9 (2017.03.30)","text":"<ul> <li>Show user' name instead of user's email in notifications sent out by email</li> <li>Add config items for setting favicon, disable wiki feature</li> <li>Add css id to easily hide user password reset and delete account button</li> <li>[fix] Fix UI bug in restoring a file from snapshot</li> <li>[fix] Fix after renaming a file, the old versions before file rename can't be downloaded</li> <li>[security] Fix XSS problem of the \"go back\" button in history page and snapshot view page</li> </ul>"},{"location":"changelog/server-changelog-old/#608-20170216","title":"6.0.8 (2017.02.16)","text":"<p>Improvement for admin</p> <ul> <li>Admin can add/delete group members</li> <li>Admin can create group in admin panel</li> <li>Show total storage, total number of files, total number of connected devices in the info page of admin panel</li> <li>Force users to change password if imported via csv</li> <li>Support set user's quota, name when import user via csv</li> <li>Set user's quota in user list page</li> <li>Add search group by group name</li> <li>Use ajax when deleting a user's library in admin panel</li> <li>Support logrotate for controller.log</li> <li>Add <code># -*- coding: utf-8 -*-</code> to seahub_settings.py, so that admin can use non-ascii characters in the file.</li> <li>Ingore white space character in the end of lines in ccnet.conf</li> <li>Add a log when a user can't be find in LDAP during login, so that the system admin can know whether it is caused by password error or the user can't be find</li> <li>Delete shared libraries information when deleting a user</li> </ul> <p>Other</p> <ul> <li>[fix] Uploading files with special names lets seaf-server crash</li> <li>[fix] Fix user search when global address book is disabled in CLOUD_MODE</li> <li>[fix] Avoid timeout in some cases when showing a library trash</li> <li>Show \"the account is inactive\" when an inactive account try to login</li> <li>[security] Remove viewer.js to show open document files (ods, odt) because viewer.js is not actively maintained and may have potential security bugs (Thanks to Lukas Reschke from Nextcloud GmbH to report the issue)</li> <li>[fix] Fix PostgreSQL support</li> <li>Update Django to 1.8.17</li> <li>Change time_zone to UTC as default</li> <li>[fix] Fix quota check: users can't upload a file if the quota will be exceeded after uploading the file</li> <li>[fix] Fix quota check when copy file from one library to another</li> <li>[fix] Prevent admin from access group's wiki</li> <li>[fix] Fix a bug when download folder in grid view</li> </ul>"},{"location":"changelog/server-changelog-old/#607-20161216","title":"6.0.7 (2016.12.16)","text":"<ul> <li>[fix] Fix generating of password protected link in file view page</li> <li>[fix] Fix .jpg/.JPG image display in IE10</li> <li>Export quota usage in export Excel in user list admin page</li> <li>[fix] Fix admin can't delete broken libraries</li> <li>Add \"back to previous page\" link in trash page, history page</li> <li>[fix] Improve logo show in About page</li> <li>[fix] Fix file encoding for text file editing online</li> <li>[fix] Don't show operation buttons for broken libraries in normal users page</li> </ul>"},{"location":"changelog/server-changelog-old/#606-20161116","title":"6.0.6 (2016.11.16)","text":"<ul> <li>[fix] Fix the shared folder link in the notification message when a user share a folder to another user</li> <li>[fix] Update Django version from 1.8.10 to 1.8.16</li> <li>[fix] Fix support for PostgreSQL</li> <li>[fix] Fix SQLite database locking problem</li> <li>[fix] Fix the shared folder name is not changed after removing the old share, renaming the folder and re-sharing the folder</li> <li>[fix] Fix sub-folder accidentially show the files in parent folder when the parent folder contains more than 100 files</li> <li>[fix] Fix image preview navigation when there are more than 100 entries in a folder</li> <li>[fix] Fix bug when admin searching unexisting user</li> <li>[fix] Fix jpeg image display in IE10</li> <li>Add support for online view of mov video files</li> <li>Make web access token expiring time configurable</li> <li>Add an option on server to control block size for web upload files</li> </ul>"},{"location":"changelog/server-changelog-old/#605-20161017","title":"6.0.5 (2016.10.17)","text":"<ul> <li>[fix] Fix API for uploading file by blocks (Used by iOS client when uploading a large file)</li> <li>[fix] Fix a database connection problem in ccnet-server</li> <li>[fix] Fix moved files are still present in local folder until refresh</li> <li>[fix] Fix admin panel can't show deleted libraries</li> </ul>"},{"location":"changelog/server-changelog-old/#604-20160922","title":"6.0.4 (2016.09.22)","text":"<ul> <li>[fix] Fix not able to move files via WebDAV interface</li> <li>Check whether the quota will exceed before saving the uploaded file to Seafile via Web UI or API</li> <li>[fix] Fix owner can't restore a deleted file or folder in snapshot</li> <li>[fix] Fix UI of personal profile page</li> <li>[fix] Fix in some cases mobile devices can't be unlinked</li> <li>[fix] Fix connection problem for the latest MariaDB in initialisation script</li> <li>[fix] PNG Thumbnail creation broken in 6.0.3 (getexif failes)</li> <li>Make maxNumberOfFiles configurable</li> <li>[fix] Remember the sorting of libraries</li> <li>Add Finnish translation</li> <li>Video + audio no longer be limited by max preview size</li> </ul>"},{"location":"changelog/server-changelog-old/#603-20160903","title":"6.0.3 (2016.09.03)","text":"<ul> <li>[fix] Fix a bug in sqlite database upgrade script</li> <li>[fix] Fix a bug in database connection pool</li> <li>[fix] Fix a bug in file comment</li> </ul>"},{"location":"changelog/server-changelog-old/#602-20160902","title":"6.0.2 (2016.09.02)","text":"<ul> <li>[fix] Fix a bug in sqlite database table locking</li> <li>Update translations</li> <li>Support create libraries for Seafile Drive client</li> </ul>"},{"location":"changelog/server-changelog-old/#601-beta-20160822","title":"6.0.1 beta (2016.08.22)","text":"<ul> <li>[fix] Fix  default value of created_at in table api2_tokenv2. This bug leads to login problems for desktop and mobile clients.</li> <li>[fix] Fix a bug in generating a password protected share link</li> <li>Improve checking the user running Seafile must be the owner of seafile-data. If seafile-data is symbolic link, check the destination folder instead of the symbolic link.</li> <li>[ui] Improve rename operation</li> <li>Admin can set library permissions in admin panel</li> <li>Show name/contact email in admin panel and enable search user by name/contact email</li> <li>Add printing style for markdown</li> <li>The \u201cSeafile\u201d in \"Welcome to Seafile\" message can be customised by SITE_NAME</li> <li>Improve sorting of files with numbers</li> <li>[fix] Fix can't view more than 100 files</li> <li>[api] Add admin API to only return LDAP imported user list</li> </ul>"},{"location":"changelog/server-changelog-old/#600-beta-20160802","title":"6.0.0 beta (2016.08.02)","text":"<ul> <li>Add full screen Web UI</li> <li>Code clean and update Web APIs</li> <li>Add file comment</li> <li>Improve zip downloading by adding zip progress</li> <li>Change of navigation labels</li> <li>[admin] Add group transfer function in admin panel</li> <li>Remove number of synced libraries in devices page for simplify the interface and concept</li> <li>Update help pages</li> </ul>"},{"location":"changelog/server-changelog-old/#51","title":"5.1","text":"<p>Warning:</p> <ul> <li>The concept of sub-library is removed in version 5.1. You can do selective sync with the latest desktop client</li> <li>The group message reply function is removed, and the old reply messages will not be shown with the new UI</li> </ul> <p>Note: when upgrade from 5.1.3 or lower version to 5.1.4+, you need to install python-urllib3 (or python2-urllib3 for Arch Linux) manually:</p> <pre><code># for Ubuntu\nsudo apt-get install  python-urllib3\n# for CentOS\nsudo yum install python-urllib3\n</code></pre>"},{"location":"changelog/server-changelog-old/#514-20160723","title":"5.1.4 (2016.07.23)","text":"<ul> <li>[fix] Fix seaf-fsck.sh --export fails without database</li> <li>[fix] Fix users with Umlauts in their display name breaks group management and api2/account/info on some special Linux distribution</li> <li>Remove user from groups when a user is deleted.</li> <li>[fix] Fix can't generate shared link for read-only shared library</li> <li>[fix] Fix can still view file history after library history is set to \"no history\".</li> <li>[fix] Fix after moving or deleting multiple selected items in the webinterface, the buttons are lost until reloading</li> <li>Check user before start seafile. The user must be the owner of seafile-data directory</li> <li>Don't allow emails with very special characters that may containing XSS string to register</li> <li>[fix] During downloading multiple files/folders, show \"Total size exceeds limits\" instead of \"internal server error\" when selected items exceeds limits.</li> <li>[fix] When delete a share, only check whether the be-shared user exist or not. This is to avoid the situation that share to a user can't be deleted after the user be deleted.</li> <li>Add a notificition to a user if he/she is added to a group</li> <li>Improve UI for password change page when forcing password change after admin reset a user's password</li> <li>[fix] Fix duplicated files show in Firefox if the folder name contains single quote '</li> </ul>"},{"location":"changelog/server-changelog-old/#513-20160530","title":"5.1.3 (2016.05.30)","text":"<ul> <li>[security]  Fix permission checking for generating share links</li> <li>Add an option (ENABLE_SETTINGS_VIA_WEB) to ignore settings via Web UI (system admin-&gt;settings)</li> <li>[fix] Making user search (used in auto-completion) case insensitive</li> </ul>"},{"location":"changelog/server-changelog-old/#512-20160513","title":"5.1.2 (2016.05.13)","text":"<ul> <li>[fix] Fix group rename</li> <li>[fix] Fix group transfer</li> <li>Send notifications to members when a new library is shared to a group</li> <li>Download multiple selected files from Seahub as a ZIP-file</li> <li>Use seafile-data/http-temp to store zip file when downloading a dir</li> <li>[ui] Remember the expanded status of groups in the left hand nav bar</li> <li>[accessibility] Improve accessiblity of library trash/history page by making links for operations selectable by tab.</li> <li>[accessibility] Improve accessiblity of dialogs, add missing labelledby properties for the whole dialog.</li> <li>[accessibility] Improve file/folder upload menu</li> <li>list all devices in admin panel</li> <li>Add syslog support for seafile.log</li> </ul>"},{"location":"changelog/server-changelog-old/#511-20160408","title":"5.1.1 (2016.04.08)","text":"<p>Note: downloading multiple files at once will be added in the next release.</p> <ul> <li>A few UI Improvement and fixes</li> <li>Add group-discussion (warning: the group message reply function is removed, and the old reply messages will not be shown with the new UI)</li> <li>Add an option for disable forcing users to change password (FORCE_PASSWORD_CHANGE, default is True)</li> <li>Support new Shibboleth users be created as inactive and activated via Admin later (SHIB_ACTIVATE_AFTER_CREATION , default is True)</li> <li>Update jquery to v1.11</li> </ul>"},{"location":"changelog/server-changelog-old/#510-beta-20160322","title":"5.1.0 beta (2016.03.22)","text":"<p>Note: in this version, the group discussion is not re-implement yet. It will be available when the stable verison is released.</p> <ul> <li>Redesign navigation</li> <li>Rewrite group management</li> <li>Improve sorting for large folder</li> <li>Remember the sorting option for folder</li> <li>Improve devices page</li> <li>Update icons for libraries and files</li> <li>Remove library settings page, re-implement them with dialogs</li> <li>Remove group avatar</li> <li>Don't show share menu in top bar when multiple item selected</li> <li>Auto-focus on username field when loading the login page</li> <li>Remove self-introduction in user profile</li> <li>Upgrade to django 1.8</li> <li>Force the user to change password if adding by admin or password reset by admin</li> <li>disable add non-existing user to a group</li> </ul>"},{"location":"changelog/server-changelog-old/#50","title":"5.0","text":"<p>Note when upgrade to 5.0 from 4.4</p> <p>You can follow the document on major upgrade (http://manual.seafile.com/deploy/upgrade.html) (url might deprecated)</p> <p>In Seafile 5.0, we have moved all config files to folder <code>conf</code>, including:</p> <ul> <li>seahub_settings.py -&gt; conf/seahub_settings.py</li> <li>ccnet/ccnet.conf -&gt; conf/ccnet.conf</li> <li>seafile-data/seafile.conf -&gt; conf/seafile.conf</li> <li>[pro only]  pro-data/seafevents.conf -&gt; conf/seafevents.conf</li> </ul> <p>If you want to downgrade from v5.0 to v4.4, you should manually copy these files back to the original place, then run minor_upgrade.sh to upgrade symbolic links back to version 4.4.</p> <p>The 5.0 server is compatible with v4.4 and v4.3 desktop clients.</p> <p>Common issues (solved) when upgrading to v5.0:</p> <ul> <li>DatabaseError after Upgrade to 5.0 https://github.com/haiwen/seafile/issues/1429#issuecomment-153695240</li> </ul>"},{"location":"changelog/server-changelog-old/#505-20160302","title":"5.0.5 (2016.03.02)","text":"<ul> <li>Get name, institution, contact_email field from Shibboleth</li> <li>[webdav] Don't show sub-libraries</li> <li>Enable LOGIN_URL to be configured, user need to add LOGIN_URL to seahub_settings.py explicitly if deploy at non-root domain, e.g. LOGIN_URL = '//accounts/login/'. <li>Add ENABLE_USER_CREATE_ORG_REPO to enable/disable organization repo creation.</li> <li>Change the Chinese translation of \"organization\"</li> <li>Use GB/MB/KB instead of GiB/MiB/KiB in quota calculation and quota setting (1GB = 1000MB = 1,000,000KB)</li> <li>Show detailed message if sharing a library failed.</li> <li>[fix] Fix JPG Preview in IE11</li> <li>[fix] Show \"out of quota\" instead of \"DERP\" in the case of out of quota when uploading files via web interface</li> <li>[fix] Fix empty nickname during shibboleth login.</li> <li>[fix] Fix default repo re-creation bug when web login after desktop.</li> <li>[fix] Don't show sub-libraries at choose default library page, seafadmin page and save shared file to library page</li> <li>[fix] Seafile server daemon: write PID file before connecting to database to avoid a problem when the database connection is slow</li> <li>[fix] Don't redirect to old library page when restoring a folder in snapshot page</li>"},{"location":"changelog/server-changelog-old/#504-20160113","title":"5.0.4 (2016.01.13)","text":"<ul> <li>[fix] Fix unable to set a library to keep full history when the  globally default keep_days is set.</li> <li>[fix] Improve the performance of showing library trash</li> <li>[fix] Improve share icon</li> <li>Search user by name in case insensitive way</li> <li>Show broken libraries in user's library page (so they can contact admin for help)</li> <li>[fix] Fix cache for thumbnail in sharing link</li> <li>[fix] Enable copy files from read-only shared libraries to other libraries</li> <li>[fix] Open image gallery popup in grid view when clicking the thumbnail image</li> </ul>"},{"location":"changelog/server-changelog-old/#503-20151217","title":"5.0.3 (2015.12.17)","text":"<ul> <li>[ui] Improve UI of all groups page</li> <li>Don't allow sharing library to a non-existing user</li> <li>[fix, admin] Fix deleting a library when the owner does not exist anymore</li> <li>[fix] Keep file last modified time when copy files between libraries</li> <li>Enable login via username in API</li> <li>[ui] Improve markdown editor</li> </ul> <p>Improve seaf-fsck</p> <ul> <li>Do not set \"repaired\" mark</li> <li>Clean syncing tokens for repaired libraries so the user are forced to resync the library</li> <li>Record broken file paths in the modification message</li> </ul> <p>Sharing link</p> <ul> <li>Remember the \"password has been checked\" information in session instead of memcached</li> <li>[security] Fix password check for visiting a file in password protected sharing link.</li> <li>Show file last modified time</li> <li>[fix] Fix image thumbnail in grid view</li> <li>[ui] Improve UI of grid view mode</li> </ul>"},{"location":"changelog/server-changelog-old/#502-20151204","title":"5.0.2 (2015.12.04)","text":"<ul> <li>[admin] Show the list of groups an user joined in user detail page</li> <li>[admin] Add exporting user/group statistics into Excel file</li> <li>Showing libraries list in \"All Groups\" page</li> <li>Add importing group members from CSV file</li> <li>[fix] Fix the performance problem in showing thumbnails in folder sharing link page</li> <li>[fix] Clear cache when set user name via API</li> <li>[fix, admin] Fix searching libraries by name when some libraries are broken</li> </ul>"},{"location":"changelog/server-changelog-old/#501-beta-20151112","title":"5.0.1 beta (2015.11.12)","text":"<ul> <li>[fix] Fix start up parameters for seaf-fuse, seaf-server, seaf-fsck</li> <li>Update Markdown editor and viewer. The update of the markdown editor and parser removed support for the Seafile-specific wiki syntax: Linking to other wikipages isn't possible anymore using <code>[[ Pagename]]</code>.</li> <li>Add tooltip in admin panel-&gt;library-&gt;Trash: \"libraries deleted 30 days before will be cleaned automatically\"</li> <li>Include fixes in v4.4.6</li> </ul>"},{"location":"changelog/server-changelog-old/#500-beta-20151103","title":"5.0.0 beta (2015.11.03)","text":"<p>UI changes:</p> <ul> <li>change most png icons to icon font</li> <li>UI change of file history page</li> <li>UI change of library history page</li> <li>UI change of trash page</li> <li>UI change of sharing link page</li> <li>UI change of rename operation</li> <li>Add grid view for folder sharing link</li> <li>Don't open a new page when click the settings, trash and history icons in the library page</li> <li>other small UI improvements</li> </ul> <p>Config changes:</p> <ul> <li>Move all config files to folder <code>conf</code></li> <li>Add web UI to config the server. The config items are saved in database table (seahub-dab/constance_config). They have a higher priority over the items in config files.</li> </ul> <p>Trash:</p> <ul> <li>A trash for every folder, showing deleted items in the folder and sub-folders.   Others changes</li> </ul> <p>Admin:</p> <ul> <li>Admin can see the file numbers of a library</li> <li>Admin can disable the creation of encrypted library</li> </ul> <p>Security:</p> <ul> <li>Change most GET requests to POST to increase security</li> </ul>"},{"location":"changelog/server-changelog-old/#44","title":"4.4","text":""},{"location":"changelog/server-changelog-old/#446-20151109","title":"4.4.6 (2015.11.09)","text":"<ul> <li>[security] Fix a XSS problem in raw sharing link</li> <li>[fix] Delete sharing links when deleting a library</li> <li>[fix] Clean Seafile tables when deleting a library</li> <li>[fix] Add  tag to the link in upload folder email notification <li>[fix] Fix a bug in creating a library (after submit a wrong password, the submit button is no longer clickable)</li>"},{"location":"changelog/server-changelog-old/#445-20151031","title":"4.4.5 (2015.10.31)","text":"<ul> <li>[fix] Fix a bug in deleting sharing link in sharing dialog.</li> </ul>"},{"location":"changelog/server-changelog-old/#444-20151027","title":"4.4.4 (2015.10.27)","text":"<ul> <li>[fix] Fix support for syncing old formatted libraries</li> <li>Only import LDAP users to Seafile internal database upon login</li> <li>Only list imported LDAP users in \"organization-&gt;members\"</li> <li>Remove commit and fs objects in GC for deleted libraries</li> <li>Improve error log for LDAP</li> <li>Add \"transfer\" operation to library list in \"admin panel-&gt;a single user\"</li> <li>[fix] Fix the showing of the folder name for upload link generated from the root of a library</li> </ul>"},{"location":"changelog/server-changelog-old/#443-20151015","title":"4.4.3 (2015.10.15)","text":"<ul> <li>[security] Check validity of file object id to avoid a potential attack</li> <li>[fix] Check the validity of system default library template, if it is broken, recreate a new one.</li> <li>[fix] After transfer a library, remove original sharing information</li> <li>[security] Fix possibility to bypass Captcha check</li> <li>[security] More security fixes.</li> </ul>"},{"location":"changelog/server-changelog-old/#442-20151012","title":"4.4.2 (2015.10.12)","text":"<ul> <li>[fix] Fix sometimes a revision is missing from a file's version history</li> <li>[security] Use HTTP POST instead of GET to remove libraries</li> <li>[fix] Fix a problem that sharing dialog not popup in IE10</li> <li>A few other small UI improvements</li> </ul>"},{"location":"changelog/server-changelog-old/#441-20150924","title":"4.4.1 (2015.09.24)","text":"<ul> <li>[fix] Fix a bug in setting an user's language</li> <li>[fix] Show detailed failed information when sharing libraries failed</li> <li>Update translations</li> <li>[api] Add API to list folders in a folder recursively</li> <li>[api] Add API to list only folders in a folder</li> </ul>"},{"location":"changelog/server-changelog-old/#440-20150916","title":"4.4.0 (2015.09.16)","text":"<p>New features:</p> <ul> <li>Allow group names with spaces</li> <li>Enable generating random password when adding an user</li> <li>Add option SHARE_LINK_PASSWORD_MIN_LENGTH</li> <li>Add sorting in share link management page</li> <li>Show total/active number of users in admin panel</li> <li>Other UI improvements</li> </ul> <p>Fixes:</p> <ul> <li>[fix] Fix a bug that causing duplications in table LDAPImport</li> <li>[security] Use POST request to handle password reset request to avoid CSRF attack</li> <li>Don't show password reset link for LDAP users</li> <li>set locale when Seahub start to avoid can't start Seahub problem in a few environments.</li> </ul>"},{"location":"changelog/server-changelog-old/#43","title":"4.3","text":""},{"location":"changelog/server-changelog-old/#432-20150820","title":"4.3.2 (2015.08.20)","text":"<ul> <li>[fix, important] Bug-fix and improvements for seaf-fsck</li> <li>[fix, important] Improve I/O error handling for file operations on web interface</li> <li>Update shared information when a sub-folder is renamed</li> <li>[fix] Fix bug of list file revisions</li> <li>Update translations</li> <li>[ui] Small improvements</li> <li>[fix] Fix api error in opCopy/opMove</li> <li>Old library page (used by admin in admin panel): removed 'thumbnail' &amp; 'preview' for image files</li> <li>[fix] Fix modification operations for system default library by admin</li> </ul>"},{"location":"changelog/server-changelog-old/#431-20150729","title":"4.3.1 (2015.07.29)","text":"<ul> <li>[fix] Fix generating image thumbnail</li> <li>[ui] Improve UI for sharing link page, login page, file upload link page</li> <li>[security] Clean web sessions when reset an user's password</li> <li>Delete the user's libraries when deleting an user</li> <li>Show link expiring date in sharing link management page</li> <li>[admin] In a user's admin page, showing libraries' size and last modify time</li> </ul>"},{"location":"changelog/server-changelog-old/#430-20150721","title":"4.3.0 (2015.07.21)","text":"<p>Usability Improvement</p> <ul> <li>[ui] Improve ui for file view page</li> <li>[ui] Improve ui for sorting files and libraries</li> <li>Redesign sharing dialog</li> <li>Enable generating random password for sharing link</li> <li>Remove private message module</li> <li>Remove direct single file sharing between users (You can still sharing folders)</li> <li>Change \"Quit\" to \"Leave group\" in group members page</li> </ul> <p>Others</p> <ul> <li>Improve user management for LDAP</li> <li>[fix] Fix a bug that client can't detect a library has been deleted in the server</li> <li>[security] Improve permission check in image thumbnail</li> <li>[security] Regenerate Seahub secret key, the old secret key lack enough randomness</li> <li>Remove the support of \".seaf\" format</li> <li>[api] Add API for generating sharing link with password and expiration</li> <li>[api] Add API for generating uploading link</li> <li>[api] Add API for link files in sharing link</li> <li>Don't listen in 10001 and 12001 by default.</li> <li>Add an option to disable sync with any folder feature in clients</li> <li>Change the setting of THUMBNAIL_DEFAULT_SIZE from string to number, i.e., use <code>THUMBNAIL_DEFAULT_SIZE = 24</code>, instead of <code>THUMBNAIL_DEFAULT_SIZE = '24'</code></li> </ul>"},{"location":"changelog/server-changelog-old/#42","title":"4.2","text":"<p>Note when upgrade to 4.2 from 4.1:</p> <p>If you deploy Seafile in a non-root domain, you need to add the following extra settings in seahub_settings.py:</p> <pre><code>COMPRESS_URL = MEDIA_URL\nSTATIC_URL = MEDIA_URL + '/assets/'\n</code></pre>"},{"location":"changelog/server-changelog-old/#423-20150618","title":"4.2.3 (2015.06.18)","text":"<ul> <li>Add global address book and remove the contacts module (You can disable it if you use CLOUD_MODE by adding ENABLE_GLOBAL_ADDRESSBOOK = False in seahub_settings.py)</li> <li>Use image gallery module in sharing link for folders containing images</li> <li>[fix] Fix missing library names (show as none) in 32bit version</li> <li>[fix] Fix viewing sub-folders for password protected sharing</li> <li>[fix] Fix viewing starred files</li> <li>[fix] Fix supporting of uploading multi-files in clients' cloud file browser</li> <li>Improve security of password resetting link</li> </ul>"},{"location":"changelog/server-changelog-old/#422-20150529","title":"4.2.2 (2015.05.29)","text":"<ul> <li>[fix] Fix picture preview in sharing link of folders</li> <li>Improve add library button in organization tab</li> </ul>"},{"location":"changelog/server-changelog-old/#421-20150527","title":"4.2.1 (2015.05.27)","text":"<ul> <li>Add direct file download link</li> <li>[fix] Fix group library creation bug</li> <li>[fix] Fix library transfer bug</li> <li>[fix] Fix markdown file/wiki bug</li> <li>Don't show generating sharing link for encrypted libraries</li> <li>Don't show the list of sub-libraries if user do not enable sub-library</li> <li>Enable adding existing libraries to organization</li> <li>Add loading tip in picture preview page</li> </ul>"},{"location":"changelog/server-changelog-old/#420-beta-20150513","title":"4.2.0 beta (2015.05.13)","text":"<p>Usability</p> <ul> <li>Remove showing of library description</li> <li>Don't require library description</li> <li>Keep left navigation bar when navigate into a library</li> <li>Generate share link for the root of a library</li> </ul> <p>Security Improvement</p> <ul> <li>Remove access tokens (all clients will log out) when a users password changed</li> <li>Temporary file access tokens can only be used once</li> <li>sudo mode: confirm password before doing sysadmin work</li> </ul> <p>Platform</p> <ul> <li>Use HTTP/HTTPS sync only, no longer use TCP sync protocol</li> <li>read/write permission on sub-folders (Pro)</li> <li>Support byte-range requests</li> <li>Automatically clean of trashed libraries</li> <li>[ldap] Save user information into local DB after login via LDAP</li> </ul>"},{"location":"changelog/server-changelog-old/#41","title":"4.1","text":""},{"location":"changelog/server-changelog-old/#412-20150331","title":"4.1.2 (2015.03.31)","text":"<ul> <li>[fix] Fix several packaging related bugs (missing some python libraries)</li> <li>[fix] Fix webdav issue</li> <li>[fix] Fix image thumbnail in sharing link</li> <li>[fix] Fix permission mode of seaf-gc.sh</li> <li>Show detailed time when mouse over a relative time</li> </ul>"},{"location":"changelog/server-changelog-old/#411-20150325","title":"4.1.1 (2015.03.25)","text":"<ul> <li>Add trashed libraries (deleted libraries will first be put into trashed libraries where system admin can restore)</li> <li>[fix] Fix upgrade script for SQLite</li> <li>Improve seaf-gc.sh</li> <li>Do not support running on CentOS 5.</li> </ul>"},{"location":"changelog/server-changelog-old/#410-beta-20150318","title":"4.1.0 beta (2015.03.18)","text":"<ul> <li>Shibboleth authentication support.</li> <li>Redesign fsck.</li> <li>Add image thumbnail in folder sharing link</li> <li>Add API to support logout/login an account in the desktop client</li> <li>Add API to generate thumbnails for images files</li> <li>Clean syncing tokens after deleting an account</li> <li>Change permission of seahub_settings.py, ccnet.conf, seafile.conf to 0600</li> <li>Update Django to v1.5.12</li> </ul>"},{"location":"changelog/server-changelog-old/#40","title":"4.0","text":""},{"location":"changelog/server-changelog-old/#406-20150204","title":"4.0.6 (2015.02.04)","text":"<p>Important</p> <ul> <li>[fix] Fix transfer library error in sysadmin page</li> <li>[fix] Fix showing of space used in sysadmin page for LDAP users</li> <li>Improved trash listing performance</li> </ul> <p>Small</p> <ul> <li>[webdav] list organisation public libraries</li> <li>Disable non-shibboleth login for shibboleth users</li> <li>[fix] Fix wrong timestamp in file view page for files in sub-library</li> <li>Add Web API for thumbnail</li> <li>Add languages for Thai and Turkish, update a few translations</li> </ul>"},{"location":"changelog/server-changelog-old/#405-20150114","title":"4.0.5 (2015.01.14)","text":"<p>Important</p> <ul> <li>[fix] Fix memory leak in HTTP syncing</li> <li>Repo owner can restore folders/files from library snapshot</li> <li>Update translations</li> <li>Only repo owner can restore a library to a snapshot</li> </ul> <p>Small improvements</p> <ul> <li>[fix] Remote redundant logs in seaf-server</li> <li>[fix] Raise 404 when visiting an non-existing folder</li> <li>[fix] Enable add admin when LDAP is enabled</li> <li>Add API to get server features information (what features are supported by this server)</li> <li>[fix] Fix throttle for /api2/ping</li> </ul>"},{"location":"changelog/server-changelog-old/#404-20150106","title":"4.0.4 (2015.01.06)","text":"<ul> <li>[fix] Fix syncing sub-library with HTTP protocol</li> <li>[fix] Fix a bug in setup-seafile-mysql.sh</li> </ul>"},{"location":"changelog/server-changelog-old/#403-20141230","title":"4.0.3 (2014.12.30)","text":"<ul> <li>[fix] Fix unable to share library to another user</li> </ul>"},{"location":"changelog/server-changelog-old/#402-20141226","title":"4.0.2 (2014.12.26)","text":"<ul> <li>Add image thumbnail</li> <li>Add Shibboleth support (beta)</li> <li>[fix] Fix performance problem in listing files API</li> <li>[fix] Fix listing files of a large folder</li> <li>[fix] Fix folder sharing link with password protection</li> <li>[fix] Fix deleting broken libraries in the system admin panel</li> </ul>"},{"location":"changelog/server-changelog-old/#401-20141129","title":"4.0.1 (2014.11.29)","text":"<ul> <li>[fix] Fix bugs in syncing with HTTP protocol</li> <li>Add upgrading script (from v3.1 to v4.0)</li> </ul>"},{"location":"changelog/server-changelog-old/#400-20141110","title":"4.0.0 (2014.11.10)","text":"<ul> <li>Add HTTP syncing support</li> <li>Merge FileServer into seaf-server</li> </ul>"},{"location":"changelog/server-changelog-old/#31","title":"3.1","text":""},{"location":"changelog/server-changelog-old/#317-20141020","title":"3.1.7 (2014.10.20)","text":"<ul> <li>[fix] Fixed performance problem in WebDAV extension</li> <li>[fix] Fixed quota check in WebDAV extension</li> <li>[fix] Fixed showing libraries with same name in WebDAV extension</li> <li>Add \"clear\" button in a library's trash</li> <li>Support upload a folder in web interface when using Chrome</li> <li>[fix] Improve small errors when upload files via Web interface</li> <li>[fix] Fix moving/coping files when the select all file checkbox is checked</li> </ul>"},{"location":"changelog/server-changelog-old/#316-20140911","title":"3.1.6 (2014.09.11)","text":"<ul> <li>[fix] Fix bug in uploading &gt;1GB files via Web</li> <li>[fix] Remove assert in Ccnet to avoid denial-of-service attack</li> <li>Revert the work \"access token generated by FileServer can only be used once\" because this leads to several problems</li> </ul>"},{"location":"changelog/server-changelog-old/#315-20140829","title":"3.1.5 (2014.08.29)","text":"<ul> <li>[fix] Fix multi-file upload in upload link and library page</li> <li>[fix] Fix libreoffice file online view</li> <li>Add 'back to top' for pdf file view.</li> <li>[fix] Fix \"create sub-library\" button under some language</li> <li>[fix popup] Fix bug in set single notice as read.</li> </ul>"},{"location":"changelog/server-changelog-old/#314-20140826","title":"3.1.4 (2014.08.26)","text":"<ul> <li>[fix, security] Fix permission check for PDF full screen view</li> <li>[fix] Fix copy/move multiple files in web</li> <li>Improve UI for group reply notification</li> <li>Improve seaf-fsck, seaf-fsck now can fix commit missing problem</li> <li>[security improve] Access token generated by FileServer can only be used once.</li> </ul>"},{"location":"changelog/server-changelog-old/#313-20140818","title":"3.1.3 (2014.08.18)","text":"<ul> <li>[fix] fix memory leak</li> <li>[fix] fix a memory not initialized problem which may cause sync problem under heavy load.</li> <li>[fix] fix creating personal wiki</li> </ul>"},{"location":"changelog/server-changelog-old/#312-20140807","title":"3.1.2 (2014.08.07)","text":"<ul> <li>Use unix domain socket in ccnet to listen for local connections. This isolates the access to ccnet daemon for different users. Thanks to Kimmo Huoman and Henri Salo for reporting this issue.</li> </ul>"},{"location":"changelog/server-changelog-old/#311-20140801","title":"3.1.1 (2014.08.01)","text":"<ul> <li>Add a bash wrapper for seafile-gc</li> <li>[fix] fix listing libraries when some libraries are broken</li> <li>Remove simplejson dependency</li> <li>Update translations</li> <li>Add \"Back to Top\" button in file view page</li> <li>Improve page refreshing after uploading files</li> </ul>"},{"location":"changelog/server-changelog-old/#310-20140724","title":"3.1.0 (2014.07.24)","text":"<p>Syncing</p> <ul> <li>Improve performance: easily syncing 10k+ files in a library.</li> <li>Don't need to download files if they are moved to another directory.</li> </ul> <p>Platform</p> <ul> <li>Rename HttpServer to FileServer to remove confusing.</li> <li>Support log rotate</li> <li>Delete old PID files when stop Seafile</li> </ul> <p>Web</p> <ul> <li>Enable deleting of personal messages</li> <li>Improved notification</li> <li>Upgrade pdf.js</li> <li>Password protection for sharing links</li> <li>[admin] Create multi-users by uploading a CSV file</li> <li>Sort libraries by name/date</li> <li>Enable users to put an additional message when sending a sharing link</li> <li>Expiring time for sharing links</li> <li>[fix] Send notification to all users participating a group discussion</li> <li>Redesigned file viewing page</li> <li>Remove simplejson dependency</li> <li>Disable the ability to make a group public by default (admin can turn it on in settings)</li> </ul>"},{"location":"changelog/server-changelog-old/#30","title":"3.0","text":""},{"location":"changelog/server-changelog-old/#304-20140607","title":"3.0.4 (2014.06.07)","text":"<ul> <li>[api] Add replace if exist into upload-api</li> <li>Show detailed error message when Gunicorn failed to start</li> <li>Improve object and block writting performance</li> <li>Add retry when failed getting database connection</li> <li>[fix] Use hash value for avatar file names to avoid invalid file name</li> <li>[fix] Add cache for repo_crypto.js to improve page speed</li> <li>[fix] Show error message when change/reset password of LDAP users</li> <li>[fix] Fix \"save to my library\" when viewing a shared file</li> <li>[fix, api] Fix rename file names with non-ascii characters</li> </ul>"},{"location":"changelog/server-changelog-old/#303","title":"3.0.3","text":"<ul> <li>[fix] Fix an UI bug in selecting multiple contacts in sending message</li> <li>Library browser page: Loading contacts asynchronously to improve initial loading speed</li> </ul>"},{"location":"changelog/server-changelog-old/#302","title":"3.0.2","text":"<ul> <li>[fix] Fix a bug in writing file metadata to disk, which causing \"file information missing error\" in clients.</li> <li>[fix] Fix API for uploading files from iOS in an encrypted library.</li> <li>[fix] Fix WebDAV</li> <li>[fix] Fix API for getting groups messages containing multiple file attachments</li> <li>[fix] Fix bug in HttpServer when file block is missing</li> <li>[fix] Fix login error for some kind of Android</li> </ul>"},{"location":"changelog/server-changelog-old/#301","title":"3.0.1","text":"<ul> <li>[fix] Fix showing bold/italic text in .seaf format</li> <li>[fix] Fix UI problem when selecting contacts in personal message send form</li> <li>[fix] Add nickname check and escape nickname to prevent XSS attack</li> <li>[fix] Check validity of library name (only allow a valid directory name).</li> </ul>"},{"location":"changelog/server-changelog-old/#300","title":"3.0.0","text":"<p>Web</p> <ul> <li>Lots of small improvements in UI</li> <li>Translations</li> <li>[fix] Handle loading avatar exceptions to avoid 500 error</li> </ul> <p>Platform</p> <ul> <li>Use random salt and PBKDF2 algorithm to store users' password. (You need to manually upgrade the database if you using 3.0.0 beta2 with MySQL backend.)</li> </ul>"},{"location":"changelog/server-changelog-old/#300-beta2","title":"3.0.0 beta2","text":"<p>Web</p> <ul> <li>Handle 413 error of file upload</li> <li>Support cross library files copy/move</li> <li>Fixed a few api errors</li> </ul> <p>Platform</p> <ul> <li>Allow config httpserver bind address</li> <li>[fix] Fix file ID calculation</li> <li>Improved device (desktop and mobile clients) management</li> <li>Add back webdav support</li> <li>Add upgrade script</li> </ul>"},{"location":"changelog/server-changelog-old/#300-beta","title":"3.0.0 beta","text":"<p>Platform</p> <ul> <li>Separate the storage of libraries</li> <li>Record files' last modification time directly</li> <li>Keep file timestamp during syncing</li> <li>Allow changing password of an encrypted library</li> </ul> <p>Web</p> <ul> <li>Redesigned UI</li> <li>Improve page loading speed</li> </ul>"},{"location":"changelog/server-changelog-old/#22","title":"2.2","text":""},{"location":"changelog/server-changelog-old/#221","title":"2.2.1","text":"<ul> <li>[fix] Fixed creation of admin account</li> </ul>"},{"location":"changelog/server-changelog-old/#220","title":"2.2.0","text":"<ul> <li>Add more checking for the validity of users' Email</li> <li>Use random salt and PBKDF2 algorithm to store users' password.</li> </ul>"},{"location":"changelog/server-changelog-old/#21","title":"2.1","text":""},{"location":"changelog/server-changelog-old/#215","title":"2.1.5","text":"<ul> <li>Add correct mime types for mp4 files when downloading</li> <li>[important] set correct file mode bit after uploading a file from web.</li> <li>Show meaningful message instead of \"auto merged by system\" for file merges</li> <li>Improve file history calculation for files which were renamed</li> </ul> <p>WebDAV</p> <ul> <li>Return last modified time of files</li> </ul>"},{"location":"changelog/server-changelog-old/#214","title":"2.1.4","text":"<ul> <li>[fix] Fix file share link download issue on some browsers.</li> <li>[wiki] Enable create index for wiki.</li> <li>Hide email address in avatar.</li> <li>Show \"create library\" button on Organization page.</li> <li>[fix] Further improve markdown filter to avoid XSS attack.</li> </ul>"},{"location":"changelog/server-changelog-old/#213","title":"2.1.3","text":"<ul> <li>[api] Add more web APIs</li> <li>Incorporate Viewer.js to display opendocument formats</li> <li>[fix] Add user email validation to avoid SQL injection</li> <li>[fix] Only allow <code>&lt;a&gt;, &lt;table&gt;, &lt;img&gt;</code> and a few other html elements in markdown to avoid XSS attack.  </li> <li>Return sub-libraries to the client when the feature is enabled.</li> </ul>"},{"location":"changelog/server-changelog-old/#212","title":"2.1.2","text":"<ul> <li>[fix] Fixed a bug in update script</li> </ul>"},{"location":"changelog/server-changelog-old/#211","title":"2.1.1","text":"<ul> <li>Allow the user to choose the expiration of the session when login</li> <li>Change default session expiration age to 1 day</li> <li>[fix] Fixed a bug of copying/moving files on web browsers</li> <li>[fix] Don't allow script in markdown files to avoid XSS attacks</li> <li>Disable online preview of SVG files to avoid potential XSS attacks</li> <li>[custom] Support specify the width of height of custom LOGO</li> <li>Upgrade scripts support MySQL databases now</li> </ul>"},{"location":"changelog/server-changelog-old/#210","title":"2.1.0","text":"<p>Platform</p> <ul> <li>Added FUSE support, currently read-only</li> <li>Added WebDAV support</li> <li>A default library would be created for new users on first login to seahub</li> </ul> <p>Web</p> <ul> <li>Redesigned Web UI</li> <li>Redesigned notification module</li> <li>Uploadable share links</li> <li>[login] Added captcha to prevent brute force attack</li> <li>[fix] Fixed a bug of \"trembling\" when scrolling file lists</li> <li>[sub-library] User can choose whether to enable sub-library</li> <li>Improved error messages when upload fails</li> <li>Set default browser file upload size limit to unlimited</li> </ul> <p>Web for Admin</p> <ul> <li>Improved admin UI</li> <li>More flexible customization options</li> <li>Online help is now bundled within Seahub</li> </ul>"},{"location":"changelog/server-changelog-old/#20","title":"2.0","text":""},{"location":"changelog/server-changelog-old/#204","title":"2.0.4","text":"<ul> <li>[fix] set the utf8 charset when connecting to database</li> <li>Getting users from both database and LDAP</li> <li>[web] List all contacts when sharing libraries</li> <li>[admin] List database and LDAP users in sysadmin</li> </ul>"},{"location":"changelog/server-changelog-old/#203","title":"2.0.3","text":"<ul> <li>[fix] Speed up file syncing when there are lots of small files</li> </ul>"},{"location":"changelog/server-changelog-old/#202","title":"2.0.2","text":"<ul> <li>[fix] Fix CIFS support.</li> <li>[fix] Support special characters like '@' in MySQL password</li> <li>[fix] Fix create library from desktop client when deploy Seafile with Apache.</li> <li>[fix] Fix sql syntax error in ccnet.log, issue #400 (https://github.com/haiwen/seafile/issues/400).</li> <li>[fix] Return organization libraries to the client.</li> <li>Update French, German and Portuguese (Brazil) languages.</li> </ul>"},{"location":"changelog/server-changelog-old/#201","title":"2.0.1","text":"<ul> <li>[fix] Fix a bug in sqlite3 upgrade script</li> <li>Add Chinese translation</li> </ul>"},{"location":"changelog/server-changelog-old/#200","title":"2.0.0","text":"<p>Platform</p> <ul> <li>New crypto scheme for encrypted libraries</li> <li>A fsck utility for checking data integrity</li> </ul> <p>Web</p> <ul> <li>Change owner of a library/group</li> <li>Move/delete/copy multiple files</li> <li>Automatically save draft during online editing  </li> <li>Add \"clear format\" to .seaf file online editing</li> <li>Support user delete its own account</li> <li>Hide Wiki module by default</li> <li>Remove the concept of sub-library</li> </ul> <p>Web for Admin</p> <ul> <li>Change owner of a library</li> <li>Search user/library</li> </ul> <p>API</p> <ul> <li>Add list/add/delete user API</li> </ul>"},{"location":"changelog/server-changelog-old/#18","title":"1.8","text":""},{"location":"changelog/server-changelog-old/#185","title":"1.8.5","text":"<ul> <li>[bugfix] Fix \"can't input space\" bug in .seaf files</li> <li>Add pagination for online file browsing</li> </ul>"},{"location":"changelog/server-changelog-old/#183","title":"1.8.3","text":"<ul> <li>[bugfix] Fix bug in setup-seafile-mysql.sh</li> <li>Make reset-admin script work for MySQL</li> <li>Remove redundant log messages</li> <li>Fixed bugs in web API</li> </ul>"},{"location":"changelog/server-changelog-old/#182","title":"1.8.2","text":"<ul> <li>Add script for setting up MySQL</li> <li>[bugfix] Fixed a bug when sharing a library to another user without sending HTTP_REFERER</li> </ul>"},{"location":"changelog/server-changelog-old/#181","title":"1.8.1","text":"<ul> <li>[bugfix] Fixed a bug when generating shared link</li> </ul>"},{"location":"changelog/server-changelog-old/#180","title":"1.8.0","text":"<p>Web</p> <ul> <li>Improve online file browsing and uploading</li> <li>Redesigned interface</li> <li>Use ajax for file operations</li> <li>Support selecting of multiple files in uploading</li> <li>Support drag/drop in uploading</li> <li>Improve file syncing and sharing</li> <li>Syncing and sharing a sub-directory of an existing library.</li> <li>Directly sharing files between two users (instead of generating public links)</li> <li>User can save shared files to one's own library</li> <li>[wiki] Add frame and max-width to images</li> <li>Use 127.0.0.1 to read files (markdown, txt, pdf) in file preview</li> <li>[bugfix] Fix pagination in library snapshot page</li> <li>Set the max length of message reply from 128 characters to 2000 characters.</li> <li>Improved performance for home page and group page</li> <li>[admin] Add administration of public links</li> </ul> <p>API</p> <ul> <li>Add creating/deleting library API</li> </ul> <p>Platform</p> <ul> <li>Improve HTTPS support, now HTTPS reverse proxy is the recommend way.</li> <li>Add LDAP filter and multiple DN</li> <li>Case insensitive login</li> <li>Move log files to a single directory</li> <li>[security] Add salt when saving user's password</li> <li>[bugfix] Fix a bug in handling client connection</li> </ul>"},{"location":"changelog/server-changelog-old/#17","title":"1.7","text":""},{"location":"changelog/server-changelog-old/#1702-for-linux-32-bit","title":"1.7.0.2 for Linux 32 bit","text":"<ul> <li>[bugfix] Fix \"Page Unavailable\" when view doc/docx/ppt.</li> </ul>"},{"location":"changelog/server-changelog-old/#1701-for-linux-32-bit","title":"1.7.0.1 for Linux 32 bit","text":"<ul> <li>[bugfix] Fix PostgreSQL support.</li> </ul>"},{"location":"changelog/server-changelog-old/#170","title":"1.7.0","text":"<p>Web</p> <ul> <li>Upgrade to Django 1.5</li> <li>Add personal messaging</li> <li>Support cloud_mode to hide the \"organization\" tab</li> <li>Support listing/revoking syncing clients</li> <li>[bugfix] Fix a bug in Markdown undo/redo</li> <li>[pro-edition] Searching in a library</li> <li>[pro-edition] Redesign file activities</li> <li>[pro-edition] Redesign doc/ppt/pdf preview with pdf2htmlEX</li> </ul> <p>Daemon</p> <ul> <li>Support PostgreSQL</li> <li>[bugfix] fix bugs in GC</li> </ul>"},{"location":"changelog/server-changelog-old/#16","title":"1.6","text":""},{"location":"changelog/server-changelog-old/#161","title":"1.6.1","text":"<p>Web</p> <ul> <li>[bugfix] Fix showing personal Wiki under French translation</li> <li>[bugfix] Fix showing markdown tables in Wiki</li> <li>[bugfix] Fixed wiki link parsing bug when page alias contains dot.</li> <li>Disable sharing link for encrypted libraries</li> <li>[admin] improved user-add, set/revoke admin, user-delete</li> </ul> <p>Daemon</p> <ul> <li>[controller] Add monitor for httpserver</li> </ul>"},{"location":"changelog/server-changelog-old/#160","title":"1.6.0","text":"<p>Web</p> <ul> <li>Separate group functions into Library/Discuss/Wiki tabs</li> <li>Redesign Discussion module</li> <li>Add Wiki module</li> <li>Improve icons</li> <li>Can make a group public</li> <li>[editing] Add toolbar and help page for Markdown files</li> <li>[editing] A stable rich document editor for .seaf files</li> <li>[bugfix] Keep encryption property when change library name/desc.</li> </ul> <p>For Admin</p> <ul> <li>Add --dry-run option to seafserv-gc.</li> <li>Support customize seafile-data location in seafile-admin</li> <li>Do not echo the admin password when setting up Seafile server</li> <li>seahub/seafile no longer check each other in start/stop scripts</li> </ul> <p>API</p> <ul> <li>Show file modification time</li> <li>Add update file API</li> </ul>"},{"location":"changelog/server-changelog-old/#15","title":"1.5","text":""},{"location":"changelog/server-changelog-old/#152","title":"1.5.2","text":"<ul> <li>[daemon] Fix problem in DNS lookup for LDAP server</li> </ul>"},{"location":"changelog/server-changelog-old/#151","title":"1.5.1","text":"<ul> <li>[web] Fix password reset bug in Seafile Web</li> <li>[daemon] Fix memory leaks in Seafile server</li> </ul>"},{"location":"changelog/server-changelog-old/#150","title":"1.5.0","text":"<p>Seafile Web</p> <ul> <li>Video/Audio playback with MediaElement.js (Contributed by Phillip Thelen)</li> <li>Edit library title/description</li> <li>Public Info &amp; Public Library page are combined into one</li> <li>Support selection of file encoding when viewing online</li> <li>Improved online picture view (Switch to prev/next picture with keyboard)</li> <li>Fixed a bug when doing diff for a newly created file.</li> <li>Sort starred files by last-modification time.</li> </ul> <p>Seafile Daemon</p> <ul> <li>Fixed bugs for using httpserver under https</li> <li>Fixed performance bug when checking client's credential during sync.</li> <li>LDAP support</li> <li>Enable setting of the size of the thread pool.</li> </ul> <p>API</p> <ul> <li>Add listing of shared libraries</li> <li>Add unsharing of a library.</li> </ul>"},{"location":"changelog/server-changelog/","title":"Seafile Server Changelog","text":"<p>You can check Seafile release table to find the lifetime of each release and current supported OS: https://cloud.seatable.io/dtable/external-links/a85d4221e41344c19566/?tid=0000&amp;vid=0000</p>"},{"location":"changelog/server-changelog/#130","title":"13.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 13.0</p>"},{"location":"changelog/server-changelog/#13011-beta-2025-09-22","title":"13.0.11 beta (2025-09-22)","text":"<ul> <li>[metadata] Add a new view type \"Statistics\"</li> <li>[metadata] Some UI fixes</li> <li>Support realtime comments update for file types like PDF, Markdown and so on</li> <li>Collabora: Fix clipboard issue</li> <li>Add access log for sdoc-server</li> <li>Some other UI fixes</li> <li>[sdoc] Fix images are lost after restoring a sdoc file from trash</li> </ul>"},{"location":"changelog/server-changelog/#1309-beta-2025-08-28","title":"13.0.9 beta (2025-08-28)","text":"<ul> <li>[metadata] Edit and add location information for photos</li> <li>[metadata] Videos cannot be displayed directly in detail panel</li> <li>[metadata] UI improvement for table view</li> <li>[UI] Polishing the dark mode</li> <li>Add Excalidraw</li> <li>Enable editing of SeaDoc or Markdown Documents via Sharing Link</li> <li>Support OnlyOffice Form building</li> <li>Update Django to version 5.2</li> <li>Fix reading MySQL environment variables in go fileserver</li> <li>Fix an error in database upgrade script</li> <li>Fix seadoc reports an error when accessing history</li> <li>Fix a XSS issue in upload link</li> </ul>"},{"location":"changelog/server-changelog/#1308-beta-2025-07-30","title":"13.0.8 beta (2025-07-30)","text":"<ul> <li>Add basic support for dark mode, it will be polished in a later version</li> <li>Support set order for folders/files in navigation panel</li> <li>Improve image view page by supporting dragging view position and zoom in/zoom out</li> <li>Fix login with WebDAV password</li> <li>Support searching in trash bin</li> <li>Fix docker image of thumbnail server</li> <li>Some other UI fixes</li> </ul>"},{"location":"changelog/server-changelog/#1307-beta-2025-07-14","title":"13.0.7 beta (2025-07-14)","text":"<p>Deploying Seafile with binary package is no longer supported for community edition. We recommend you to migrate your existing Seafile deployment to docker based.</p> <ul> <li>SeaDoc: SeaDoc is now version 2.0</li> <li>Thumbnail server: A new thumbnail server component is added to improve performance for thumbnail generating and support thumbnail for videos</li> <li>Metadata server: A new metadata server component is available to manage extended file properties</li> <li>Notification server: The web interface now support real-time update when other people add or remove files if notification-server is enabled</li> <li>Database and memcache configurations are added to <code>.env</code>, it is recommended to use environment variables to config database and memcache</li> <li>Redis is recommended to be used as memcache server</li> <li>For security reason, WebDAV no longer support login with LDAP account, the user with LDAP account must generate a WebDAV token at the profile page</li> <li>[File tags] The old file tags feature can no longer be used, the interface provide an upgrade notice for migrate the data to the new file tags feature</li> <li>Some UI updated and fixes</li> </ul>"},{"location":"changelog/server-changelog/#120","title":"12.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 12.0</p>"},{"location":"changelog/server-changelog/#12014-2025-05-29","title":"12.0.14 (2025-05-29)","text":"<ul> <li>[fix] Fix two stored XSS issues (In rendering terms and conditions and in institution admin page)</li> <li>Add S/MIME support for emails</li> <li>[fix] Fix a UI bug in \"share admin -&gt; share links\"</li> <li>[fix] Fix a bug in rendering \"system admin -&gt; users\"</li> <li>Update translations</li> </ul>"},{"location":"changelog/server-changelog/#12011-2025-03-19","title":"12.0.11 (2025-03-19)","text":"<ul> <li>[fix] Fix a stored XSS issue</li> <li>[fix] Do not show Wiki libraries in clients and WebDAV</li> <li>Add library name in \"share admin -&gt; folders\"</li> <li>[fix] Fix set of library history keep days</li> <li>[fix] Fix support for enforcing Two-Factor Authentication</li> </ul>"},{"location":"changelog/server-changelog/#12010-2025-03-03","title":"12.0.10 (2025-03-03)","text":"<ul> <li>[fix] Fix seaf-fuse support</li> <li>[fix] Fix \"save to\" button in external link</li> <li>[fix] Search library text in system admin page is incorrect  </li> <li>[fix] Fix library path displays issue in read-only shared</li> <li>Improve icons for creating Wiki and inviting links</li> <li>[fix] Fix a bug in Collabora integration: Interface in English despite Seafile interface in French</li> </ul>"},{"location":"changelog/server-changelog/#1209-2025-02-14","title":"12.0.9 (2025-02-14)","text":"<ul> <li>Improve consistency of format of logs</li> <li>[fix] Thumbnail server does not preserve ICC profiles, resulting in washed out colors</li> <li>[fix] A few small UI fixes and improvements</li> </ul>"},{"location":"changelog/server-changelog/#1207-2025-01-08","title":"12.0.7 (2025-01-08)","text":"<ul> <li>[fix] Some UI improvements and fixes</li> <li>[Wiki] Some UI improvements and fixes</li> <li>Clean inconsistent format in logs</li> <li>[fix] Fix WebDAV upload \"0 Byte Files\" issue</li> </ul>"},{"location":"changelog/server-changelog/#1206-beta-2024-12-19","title":"12.0.6 beta (2024-12-19)","text":"<ul> <li>[fix] Fix seafevents not started</li> <li>Update translation</li> <li>Some UI fixes</li> </ul>"},{"location":"changelog/server-changelog/#1204-beta-2024-11-21","title":"12.0.4 beta (2024-11-21)","text":"<ul> <li>A redesigned Web UI</li> <li>SeaDoc is now stable, providing online notes and documents feature</li> <li>A new wiki module</li> <li>A new trash mechanism, that deleted files will be recorded in database for fast listing</li> <li>The password strength level is now calculated by algorithm. The old USER_PASSWORD_MIN_LENGTH, USER_PASSWORD_STRENGTH_LEVEL is removed. Only USER_STRONG_PASSWORD_REQUIRED is still used.</li> <li>ADDITIONAL_APP_BOTTOM_LINKS is removed. Because there is no buttom bar in the navigation side bar now.</li> <li>SERVICE_URL and FILE_SERVER_ROOT are removed. SERVICE_URL will be calculated from SEAFILE_SERVER_PROTOCOL and SEAFILE_SERVER_HOSTNAME in <code>.env</code> file.</li> <li><code>ccnet.conf</code> is removed. Some of its configuration items are moved from <code>.env</code> file, others are read from items in <code>seafile.conf</code> with same name.</li> <li>For security reason, WebDAV no longer support login with LDAP account, the user with LDAP account must generate a WebDAV token at the profile page</li> <li>[File tags] The current file tags feature is deprecated. We will re-implement a new one in version 13.0 with a new general metadata management module.</li> <li>Support online GC </li> </ul>"},{"location":"changelog/server-changelog/#110","title":"11.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 11.0</p>"},{"location":"changelog/server-changelog/#11012-2024-08-14","title":"11.0.12 (2024-08-14)","text":"<ul> <li>Update translations</li> </ul>"},{"location":"changelog/server-changelog/#11011-2024-08-07","title":"11.0.11 (2024-08-07)","text":"<ul> <li>[fix] [important] Fix a security bug in WebDAV</li> </ul>"},{"location":"changelog/server-changelog/#11010-2024-08-06","title":"11.0.10 (2024-08-06)","text":"<p>Seafile</p> <ul> <li>[fix] Use user's name in reset password email instead of internal ID</li> <li>[fix] Fix SeaDoc incompatible with go fileserver</li> <li>[fix] Fix invited guest cannot be revoke</li> <li>[fix] Fix keyerror when using backup code in two-factor auth</li> <li>[fix] Do not print warning in seaf-server.log when a LDAP user login</li> </ul>"},{"location":"changelog/server-changelog/#1109-2024-05-30","title":"11.0.9 (2024-05-30)","text":"<p>Seafile</p> <ul> <li>Improve accessibility</li> <li>Support open ODG files with LibreOffice (Collabora Online)</li> <li>Support showing last modified time for folders in WebDAV</li> <li>[fix] Fix \"remember me\" in 2FA</li> </ul> <p>SDoc editor 0.8</p> <ul> <li>Support automatically adjusting table width to fit page width</li> <li>Improve comments feature</li> <li>Improve documents shown on mobile</li> <li>More UI fixes and improvements</li> </ul>"},{"location":"changelog/server-changelog/#1108-2024-04-22","title":"11.0.8 (2024-04-22)","text":"<ul> <li>Fix a bug in generating sharing links</li> </ul>"},{"location":"changelog/server-changelog/#1107-2024-04-18","title":"11.0.7 (2024-04-18)","text":"<p>Seafile</p> <ul> <li>Support log rotate for golang file server and notification server</li> <li>Update UI for upload link</li> <li>Support OnlyOffice version feature</li> <li>Show files' original path in the trash</li> </ul> <p>SDoc editor 0.7</p> <ul> <li>Improve file comment feature</li> <li>Improve file diff showing</li> <li>Support print a document</li> <li>Improve table editing</li> </ul>"},{"location":"changelog/server-changelog/#1106-2024-03-14","title":"11.0.6 (2024-03-14)","text":"<p>Seafile</p> <ul> <li>Fix column view is limited to 100 items</li> <li>Fix LDAP user login for WebDAV</li> <li>Remove the configuration item \"ENABLE_FILE_COMMENT\" as it is no longer needed</li> <li>Enable copy/move files between encrypted and non-encrypted libraries</li> <li>Forbid creating libraries with Emoji in name</li> <li>Fix some letters in the file name do not fit in height in some dialogs</li> <li>Some other UI fixes and improvements</li> <li>Fix a performance issue in sending file updates report</li> </ul> <p>SDoc editor 0.6</p> <ul> <li>Support convert docx file to sdoc file</li> <li>Support Markdown format in comments</li> <li>Support drag rows/columns in table element and other improvements for table elements</li> <li>Other UI fixes and improvements</li> </ul>"},{"location":"changelog/server-changelog/#1105-2024-01-31","title":"11.0.5 (2024-01-31)","text":"<p>Seafile</p> <ul> <li>Fix captcha showing issue</li> </ul>"},{"location":"changelog/server-changelog/#1104-2024-01-26","title":"11.0.4 (2024-01-26)","text":"<p>Seafile</p> <ul> <li>Add move dir/file, copy dir/file, delete dir/file, rename dir/file APIs for library token based API</li> <li>Support preview of JFIF image format</li> <li>Use user's current language when create Office files in OnlyOffice</li> <li>More UI fixes and improvements</li> </ul> <p>SDoc editor 0.5</p> <ul> <li>Support convert sdoc to docx format</li> <li>Improve UX for internal document linking</li> <li>Support icons in callout element</li> <li>Add Search/Replace feature</li> <li>More UI fixes and improvements</li> </ul>"},{"location":"changelog/server-changelog/#1103-2023-12-19","title":"11.0.3 (2023-12-19)","text":"<p>Seafile</p> <ul> <li>Use file type icon as favicon for file preview pages</li> <li>More UI fixes and improvements</li> <li>[fix] seafdav.conf workers parameters does not to be used</li> </ul> <p>SDoc editor 0.4</p> <ul> <li>Add templates with predefined stypes for tables</li> <li>Support combining table cells</li> <li>Add callout element</li> <li>Support drag and drop elements</li> <li>Improve file comments</li> <li>Improve file history display by grouping history items</li> <li>More UI fixes and improvements</li> </ul>"},{"location":"changelog/server-changelog/#1102-2023-11-20","title":"11.0.2 (2023-11-20)","text":"<p>Seafile</p> <ul> <li>Update folder icon</li> <li>The activities page support filter records based on modifiers</li> <li>Add indicator for folders that has been shared out</li> <li>Some small UI fixes</li> <li>[fix] Fix some small bugs in golang file server</li> <li>[fix] Fix LDAP users cannot login via desktop client</li> <li>Add login ID field when exporting users in admin panel</li> </ul> <p>SDoc editor 0.3</p> <ul> <li>Improved file comment feature</li> <li>Improved revision and review feature</li> <li>Support file tags</li> <li>Better support editing list/table/code/image element</li> <li>Support getting link for header element</li> </ul>"},{"location":"changelog/server-changelog/#1101-beta-2023-10-18","title":"11.0.1 beta (2023-10-18)","text":"<p>Seafile</p> <ul> <li>Improve UI of notifications dialog</li> <li>Improve UI of dropdown menus for libraries and files</li> <li>Improve UI for file tags</li> <li>Remove file comment features as they are used very little</li> </ul> <p>SDoc editor 0.2</p> <ul> <li>All major elements like tables, lists are now supported</li> <li>The editor is basically stable to use. Everyone is welcome to try it out.</li> </ul>"},{"location":"changelog/server-changelog/#1100-beta-cancelled","title":"11.0.0 beta (cancelled)","text":"<ul> <li>Use a virtual ID to identify a user</li> <li>LDAP login update</li> <li>SAML/Shibboleth/OAuth login update</li> <li>Update Django to version 4.2</li> <li>Update SQLAlchemy to version 2.x</li> <li>Improve UI of PDF view page</li> <li>Add seafevents component</li> </ul>"},{"location":"changelog/server-changelog/#100","title":"10.0","text":"<p>Upgrade</p> <p>Please check our document for how to upgrade to 10.0.</p>"},{"location":"changelog/server-changelog/#1001-2023-04-11","title":"10.0.1 (2023-04-11)","text":"<ul> <li>Support generating multiple share links for a file and a folder</li> <li>[fix] Fix a bug in golang file server when zip-downloading a folder in encrypted library</li> <li>[fix] Fix a bug in upgrading script when there is no configuration for Nginx</li> <li>Video player support changing playback speed</li> <li>[fix] Fix a few bugs in notification server</li> </ul>"},{"location":"changelog/server-changelog/#1000-beta-2023-02-22","title":"10.0.0 beta (2023-02-22)","text":"<ul> <li>Update Python dependencies and support Ubuntu 22.04 and Debian 11</li> <li>Add a new notification server (document will be provided later)</li> <li>Update WebDAV password to use one-way hash</li> <li>Remove SQL sub queries to improve SQL query speed in seaf-server</li> <li>Show number of shared users/groups if any when deleting a folder</li> <li>Support online playing of .wav files</li> </ul>"},{"location":"changelog/server-changelog/#90","title":"9.0","text":""},{"location":"changelog/server-changelog/#9010-2022-12-07","title":"9.0.10 (2022-12-07)","text":"<ul> <li>Admin list all users API now return last_login and last_access_time</li> <li>[fix] Fix a bug in displaying markdown file in sharing link</li> <li>[fix] Fix notification mails are sent to inactive users</li> <li>[fix] Fix viewing a file in an old snapshot leads to server hickup</li> <li>[fix] Fix an HTTP/500 \"Internal server error\" when the user sets password containing non-latin characters for sharing links</li> <li>[fix] Fix \"document convertion failed\u201d error visiting a shared document with preview only</li> <li>[fix] Fix memory leak when block cache is enabled</li> <li>Enable 'zoom in/out by pinch' for mobile in pdf file view page</li> <li>[fix] Prevent system admin creating libraries with invalid name in admin panel</li> <li>Improve performance in golang file server</li> </ul>"},{"location":"changelog/server-changelog/#909-2022-09-22","title":"9.0.9 (2022-09-22)","text":"<ul> <li>[fix] Fix a memory leak problem</li> <li>[fix] Fix a bug that will lead to seaf-fsck crash</li> <li>[fix] Fix a stored XSS problem for library names</li> <li>[fix] Disable open a file in OnlyOffice for encrypted libraries when open from trash</li> </ul>"},{"location":"changelog/server-changelog/#908-2022-09-07","title":"9.0.8 (2022-09-07)","text":"<ul> <li>[fix] Fix a UI bug in sending sharing link by email</li> <li>[fix] Markdown editor does not properly filter javscript URIs from the href attribute, which results in stored XSS</li> <li>[fix] Fix a bug in OCM sharing</li> <li>[fix] Fix a bug in un-linking a device in admin panel</li> <li>[fix] Adding URL security check in <code>/accounts/login</code> redirect by <code>?next=</code> parameter</li> </ul>"},{"location":"changelog/server-changelog/#907-2022-08-10","title":"9.0.7 (2022-08-10)","text":"<p>Note: included lxml library is removed for some compatiblity reason. The library is used in published libraries feature and WebDAV feature. You need to install lxml manually after upgrade to 9.0.7. Use command <code>pip3 install lxml</code> to install it.</p> <ul> <li>A page in published libraries is rendered at the server side to improve loading speed.</li> <li>Upgrade Django from 3.2.6 to 3.2.14</li> <li>Fix a bug in collaboration notice sending via email to users' contact email</li> <li>Support OnlyOffice oform/docxf files</li> <li>Improve user search when sharing a library</li> <li>Admin panel support searching a library via ID prefix</li> <li>[fix] Fix preview PSD images</li> <li>[fix] Fix a bug that office files can't be opened in sharing links via OnlyOffice</li> <li>[fix] Go fileserver: Folder or File is not deletable when there is a spurious utf-8 char inside the filename</li> </ul>"},{"location":"changelog/server-changelog/#906-2022-06-22","title":"9.0.6 (2022-06-22)","text":"<ul> <li>Show table of contents in Markdown sharing link</li> <li>Check if quota exceeded before file uploading in upload sharing link</li> <li>Support import group member via contact email</li> </ul>"},{"location":"changelog/server-changelog/#905-2022-05-13","title":"9.0.5 (2022-05-13)","text":"<ul> <li>[fix] Fix a bug that sometimes a shared subfolder is unshared automatically by database access error</li> <li>[fix] Fix a bug in work with Python 3.10+</li> <li>[fix] Fix a bug in smart link redict to the file page</li> <li>[fix] Fix a UI bug when drag and drop a file</li> <li>[fix] Fix zip downloading a folder not having .zip suffix when using golang file server</li> <li>Improve UI for file tags</li> <li>Show file tags in sharing links</li> <li>Improve UI of file comments</li> <li>[fix] Fix permission check in deleting/editing a file comment</li> <li>Remove the feature of related files as it is not used</li> <li>Support editing of expire time for sharing links</li> <li>Improve SQL performance when deleting a library</li> <li>Show ISO date and time in file history page instead of showing relative time</li> <li>Add \"Visit related snapshot\" in the dropdown menu of an entry in file history</li> </ul>"},{"location":"changelog/server-changelog/#904-2022-02-21","title":"9.0.4 (2022-02-21)","text":"<ul> <li>[fix] Fix a UI bug in file moving/copying dialog</li> <li>Support admin enforcing a strong password in WebDAV secret</li> <li>[fix] Fix WebDAV error while filename contains special chars</li> </ul>"},{"location":"changelog/server-changelog/#903-2022-02-15","title":"9.0.3 (2022-02-15)","text":"<ul> <li>Enable deleting fs objects in GC</li> <li>Users can save files or folders in shared folder link to their own libraries</li> <li>[fix] Fix language in calendar UI component used when picking date in sharing dialog</li> <li>[fix] Fix markdown file print</li> <li>Improve UI of file moving/copying dialog to show folders with long names</li> <li>Expand to the current folder when open file moving/copying dialog</li> <li>[fix] Fix a bug in golang file server log rotate support</li> <li>[fix] Fix a bug in folder download-link and try to download files/folders as zip using golang file server</li> <li>Show current number of shared users and groups when deleting a library</li> <li>[fix] Fix support for customizing of favicon</li> <li>[fix] Fix printing support of Markdown file</li> <li>[fix] Fix zip-downloading in sharing links when golang file server is used</li> </ul>"},{"location":"changelog/server-changelog/#902-2021-12-10","title":"9.0.2 (2021-12-10)","text":"<ul> <li>Fix OnlyOffice/Collabora integration when golang http server</li> <li>Enable showing password for encrypted sharing links</li> </ul>"},{"location":"changelog/server-changelog/#901-beta-2021-11-20","title":"9.0.1 beta (2021-11-20)","text":"<ul> <li>Fix OnlyOffice integration</li> </ul>"},{"location":"changelog/server-changelog/#900-beta-2021-11-11","title":"9.0.0 beta (2021-11-11)","text":"<ul> <li>Upgrade Django to 3.2</li> <li>Rewrite HTTP service in seaf-server with golang and move it to a separate component (turn off by default)</li> <li>Upgrade PDFjs to new version, support viewing of password protected PDF</li> <li>Use database to store OnlyOffice cache keys</li> <li>Supporting converting files like doc to docx using OnlyOffice for online editing</li> <li>Move SERVICE_URL configuration from ccnet.conf to seahub_settings.py</li> </ul> <p>The new file-server written in golang serves HTTP requests to upload/download/sync files. It provides three advantages:</p> <ul> <li>The performance is better in a high-concurrency environment and it can handle long requests. Now you can sync libraries with large number of files.</li> <li>Now file zipping and downloading can be done simutaneously. When zip downloading a folder, you don't need to wait until zip is done.</li> <li>Support rate control for file uploading and downloading.</li> </ul> <p>You can turn golang file-server on by adding following configuration in seafile.conf</p> <pre><code>[fileserver]\nuse_go_fileserver = true\n</code></pre>"},{"location":"changelog/server-changelog/#80","title":"8.0","text":"<p>Please check our document for how to upgrade to 8.0.</p>"},{"location":"changelog/server-changelog/#808-20211206","title":"8.0.8 (2021/12/06)","text":"<ul> <li>[fix] Fix a security issue in token check in file syncing</li> <li>[fix] Fix URL encoding problem when view a file's history for files with special characters in file name.</li> </ul>"},{"location":"changelog/server-changelog/#807-20210809","title":"8.0.7 (2021/08/09)","text":"<ul> <li>Improve performance for listing deleted files in trash</li> <li>[fix] Fix FORCE_PASSWORD_CHANGE does not force the new user to change the password if the user is added by admin</li> <li>[fix] Fix setting a webdav password when 2FA enabled</li> <li>[fix] Fix search in a shared sub-folder</li> <li>[fix] Remove watermark shown in Collabora integration</li> </ul>"},{"location":"changelog/server-changelog/#806-20210714","title":"8.0.6 (2021/07/14)","text":"<ul> <li>[fix] Fix a cache problem in OnlyOffice integration when automatically saving is used</li> <li>Admin can delete devices in the admin panel</li> <li>[fix] Once a user quota have been set, I can not set it back to 0 (unlimited)</li> <li>[fix] Fix collabora integration</li> <li>User's can manage his/her Web API Auth Token in profile page</li> <li>A group admin can now leave a group</li> <li>[fix] Fix Lazy loading / pagination breaks image viewer (https://forum.seafile.com/t/lazy-loading-pagination-breaks-image-viewer/14655)</li> </ul>"},{"location":"changelog/server-changelog/#805-20210514","title":"8.0.5 (2021/05/14)","text":"<ul> <li>Add \"Open via Client\" button in file view page</li> <li>Add an admin API to change a user's email</li> <li>[fix] Fix a bug in seaf-gc</li> <li>[fix] Fix wrong links of files in library history details dialog</li> <li>[fix] Fix deleting libraries without owner in admin panel</li> <li>[fix] Fix a XSS problem in notification</li> <li>[fix] Fix JWT token support in OnlyOffice integration</li> <li>[fix] Fix sometimes webdav cache files are not cleaned</li> </ul>"},{"location":"changelog/server-changelog/#804-20210325","title":"8.0.4 (2021/03/25)","text":"<ul> <li>[fix] Fix a permission denial problem in OCM, if a library is shared to more than two users in another server</li> <li>[fix] Fix a bug in password protected upload link</li> <li>[fix] Fix running seafile-controller with \"seafile-controller -t\" </li> <li>[fix] Fix user search in \"Transfering a library\" dialog</li> <li>Add \"Open via Client\" button in file view page</li> <li>Add an admin API to change a user's email</li> </ul>"},{"location":"changelog/server-changelog/#803-20210127","title":"8.0.3 (2021/01/27)","text":"<ul> <li>Users can use secret key to access WebDAV after enabling two-factor authentication</li> <li>Fix fuse</li> <li>Fix navigation side panel in public library on mobile</li> <li>Improve UI of file search</li> <li>Add QR code for sharing links</li> <li>Fix OnlyOffice integration when JWT is enabled</li> </ul>"},{"location":"changelog/server-changelog/#802-20210104","title":"8.0.2 (2021/01/04)","text":"<ul> <li>Fix LDAP problem</li> <li>Fix upgrade script</li> </ul>"},{"location":"changelog/server-changelog/#801-beta-20210104","title":"8.0.1 beta (2021/01/04)","text":"<ul> <li>Update translations for help pages</li> <li>Add missing upgrade script</li> <li>Add open cloud mesh feature</li> </ul>"},{"location":"changelog/server-changelog/#800-beta-20201127","title":"8.0.0 beta (2020/11/27)","text":"<ul> <li>Support searching file in a library</li> <li>Rewrite upload link page to use React technology</li> <li>Improve GC performance</li> <li>Upgrade Django to 2.2 version</li> <li>Remove ccnet-server component</li> <li>Update help page</li> <li>Release v4 encrypted library format to enhance security for v3 encrypted format</li> </ul>"},{"location":"config/","title":"Server Configuration and Customization","text":""},{"location":"config/#config-files","title":"Config Files","text":"<p>The config files used in Seafile include:</p> <ul> <li>environment variables: contains environment variables, the items here are shared between different components. Newly introduced components, like sdoc-server and notificaiton server, read configuraitons from environment variables and have no config files.</li> <li>seafile.conf: contains settings for seafile daemon and fileserver.</li> <li>seahub_settings.py: contains settings for Seahub</li> <li>seafevents.conf: contains settings for background tasks and file search.</li> </ul> <p>You can also modify most of the config items via web interface.The config items are saved in database table (seahub-db/constance_config). They have a higher priority over the items in config files.</p> <p></p>"},{"location":"config/#the-design-of-configure-options","title":"The design of configure options","text":"<p>There are now three places you can config Seafile server:</p> <ul> <li>environment variables</li> <li>config files</li> <li>via web interface</li> </ul> <p>The web interface has the highest priority. It contains a subset of end-user oriented settings. In practise, you can disable settings via web interface for simplicity.</p> <p>Environment variables contains system level settings that needed when initialize Seafile server or run Seafile server. Environment variables also have three categories:</p> <ul> <li>Initialization variables that used to generate config files when Seafile server run for the first time.</li> <li>Variables that shared and used by multiple components of Seafile server.</li> <li>Variables that used both in generate config files and later also needed for some components that have no corresponding config files.</li> </ul> <p>The variables in the first category can be deleted after initialization. In the future, we will make more components to read config from environment variables, so that the third category is no longer needed.</p>"},{"location":"config/admin_roles_permissions/","title":"Roles and Permissions Support","text":"<p>You can add/edit roles and permission for administrators. Seafile has four build-in admin roles:</p> <ol> <li> <p>default_admin, has all permissions.</p> </li> <li> <p>system_admin, can only view system info and config system.</p> </li> <li> <p>daily_admin, can only view system info, view statistic, manage library/user/group, view user log.</p> </li> <li> <p>audit_admin, can only view system info and admin log.</p> </li> </ol> <p>All administrators will have <code>default_admin</code> role with all permissions by default. If you set an administrator to some other admin role, the administrator will only have the permissions you configured to <code>True</code>.</p> <p>Seafile supports eight permissions for now,  its configuration is very like common user role, you can custom it by adding the following settings to <code>seahub_settings.py</code>.</p> <pre><code>ENABLED_ADMIN_ROLE_PERMISSIONS = {\n    'system_admin': {\n        'can_view_system_info': True,\n        'can_config_system': True,\n    },\n    'daily_admin': {\n        'can_view_system_info': True,\n        'can_view_statistic': True,\n        'can_manage_library': True,\n        'can_manage_user': True,\n        'can_manage_group': True,\n        'can_view_user_log': True,\n    },\n    'audit_admin': {\n        'can_view_system_info': True,\n        'can_view_admin_log': True,\n    },\n    'custom_admin': {\n        'can_view_system_info': True,\n        'can_config_system': True,\n        'can_view_statistic': True,\n        'can_manage_library': True,\n        'can_manage_user': True,\n        'can_manage_group': True,\n        'can_view_user_log': True,\n        'can_view_admin_log': True,\n    },\n}\n</code></pre>"},{"location":"config/auth_switch/","title":"Switch authentication type","text":"<p>Seafile Server supports the following external authentication types:</p> <ul> <li>LDAP (Auth and Sync)</li> <li>OAuth</li> <li>Shibboleth</li> <li>SAML</li> </ul> <p>Since 11.0 version, switching between the types is possible, but any switch requires modifications of Seafile's databases.</p> <p>Note</p> <p>Before manually manipulating your database, make a database backup, so you can restore your system if anything goes wrong!</p> <p>See more about make a database backup.</p>"},{"location":"config/auth_switch/#migrating-from-local-user-database-to-external-authentication","title":"Migrating from local user database to external authentication","text":"<p>As an organisation grows and its IT infrastructure matures, the migration from local authentication to external authentication like LDAP, SAML, OAUTH is common requirement. Fortunately, the switch is comparatively simple. </p>"},{"location":"config/auth_switch/#general-procedure","title":"General procedure","text":"<ol> <li> <p>Configure and test the desired external authentication. Note the name of the <code>provider</code> you use in the config file. The user to be migrated should already be able to log in with this new authentication type, but he will be created as a new user with a new unique identifier, so he will not have access to his existing libraries. Note the <code>uid</code> from the <code>social_auth_usersocialauth</code> table. Delete this new, still empty user again.</p> </li> <li> <p>Determine the ID of the user to be migrated in ccnet_db.EmailUser. For users created before version 11, the ID should be the user's email, for users created after version 11, the ID should be a string like <code>xxx@auth.local</code>.</p> </li> <li> <p>Replace the password hash with an exclamation mark.</p> </li> <li> <p>Create a new entry in <code>social_auth_usersocialauth</code> with the <code>xxx@auth.local</code>, your <code>provider</code> and the <code>uid</code>.</p> </li> </ol> <p>The login with the password stored in the local database is not possible anymore. After logging in via external authentication, the user has access to all his previous libraries.</p>"},{"location":"config/auth_switch/#example","title":"Example","text":"<p>This example shows how to migrate the user with the username <code>12ae56789f1e4c8d8e1c31415867317c@auth.local</code> from local database authentication to OAuth. The OAuth authentication is configured in <code>seahub_settings.py</code> with the provider name <code>authentik-oauth</code>. The <code>uid</code> of the user inside the Identity Provider is <code>HR12345</code>.</p> <p>This is what the database looks like before these commands must be executed:</p> <pre><code>mysql&gt; select email,left(passwd,25) from EmailUser where email = '12ae56789f1e4c8d8e1c31415867317c@auth.local';\n+---------------------------------------------+------------------------------+\n| email                                       | left(passwd,25)              |\n+---------------------------------------------+------------------------------+\n| 12ae56789f1e4c8d8e1c31415867317c@auth.local | PBKDF2SHA256$10000$4cdda6... |\n+---------------------------------------------+------------------------------+\n\nmysql&gt; update EmailUser set passwd = '!' where email = '12ae56789f1e4c8d8e1c31415867317c@auth.local';\n\nmysql&gt; insert into `social_auth_usersocialauth` (`username`, `provider`, `uid`, `extra_data`) values ('12ae56789f1e4c8d8e1c31415867317c@auth.local', 'authentik-oauth', 'HR12345', '');\n</code></pre> <p>Note</p> <p>The <code>extra_data</code> field store user's information returned from the provider. For most providers, the <code>extra_data</code> field is usually an empty character. Since version 11.0.3-Pro, the default value of the <code>extra_data</code> field is <code>NULL</code>.</p> <p>Afterwards the databases should look like this:</p> <pre><code>mysql&gt; select email,passwd from EmailUser where email = '12ae56789f1e4c8d8e1c31415867317c@auth.local';\n+---------------------------------------------+------- +\n| email                                       | passwd |\n+---------------------------------------------+--------+\n| 12ae56789f1e4c8d8e1c31415867317c@auth.local | !      |\n+---------------------------------------------+--------+\n\nmysql&gt; select username,provider,uid from social_auth_usersocialauth where username = '12ae56789f1e4c8d8e1c31415867317c@auth.local';\n+---------------------------------------------+-----------------+---------+\n| username                                    | provider        | uid     |\n+---------------------------------------------+-----------------+---------+\n| 12ae56789f1e4c8d8e1c31415867317c@auth.local | authentik-oauth | HR12345 |\n+---------------------------------------------+-----------------+---------+\n</code></pre>"},{"location":"config/auth_switch/#migrating-from-one-external-authentication-to-another","title":"Migrating from one external authentication to another","text":"<p>First configure the two external authentications and test them with a dummy user. Then, to migrate all the existing users you only need to make changes to the <code>social_auth_usersocialauth</code> table. No entries need to be deleted or created. You only need to modify the existing ones. The <code>xxx@auth.local</code> remains the same, you only need to replace the <code>provider</code> and the <code>uid</code>.</p>"},{"location":"config/auth_switch/#migrating-from-external-authentication-to-local-user-database","title":"Migrating from external authentication to local user database","text":"<p>First, delete the entry in the <code>social_auth_usersocialauth</code> table that belongs to the particular user.</p> <p>Then you can reset the user's password, e.g. via the web interface. The user will be assigned a local password and from now on the authentication against the local database of Seafile will be done. </p> <p>More details about this option will follow soon.</p>"},{"location":"config/auto_login_seadrive/","title":"Auto Login to SeaDrive on Windows","text":"<p>Kerberos is a widely used single sign on (SSO) protocol. Supporting of auto login will use a Kerberos service. For server configuration, please read remote user authentication documentation. You have to configure Apache to authenticate with Kerberos. This is out of the scope of this documentation. You can for example refer to this webpage.</p>"},{"location":"config/auto_login_seadrive/#technical-details","title":"Technical Details","text":"<p>The client machine has to join the AD domain. In a Windows domain, the Kerberos Key Distribution Center (KDC) is implemented on the domain service. Since the client machine has been authenticated by KDC when a Windows user logs in, a Kerberos ticket will be generated for current user without needs of another login in the browser.</p> <p>When a program using the WinHttp API tries to connect a server, it can perform a login automatically through the Integrated Windows Authentication. Internet Explorer and SeaDrive both use this mechanism.</p> <p>The details of Integrated Windows Authentication is described below:</p> <ol> <li>Decide whether or not to use IWA according to the address and Internet Options. (more in next section)</li> <li>Send a request to the server (e.g. http://test.seafile.com/sso)</li> <li>The server returns an HTTP 401 unauthorized response with the Negotiate header which includes an authentication protocol.</li> <li>The WinHttp API will try to use Kerberos first, if there is a valid ticket from KDC. The request will be sent again, together with the ticket in an HTTP header.</li> <li>Then, Apache can check the ticket with KDC, and extract the username from it. The username will be passed to SeaHub for a successful auto login.</li> <li>If the WinHttp API failed to get a ticket, it will then try the NTLM protocol by sending an HTTP request with Negotiate NTLMSSP token in the header. Without supporting the NTLM protocol, Apache shall returns an HTTP 401 unauthorized response and stops negotiation. At this point, the browser will pop up a login dialog, which means an auto login failure.</li> </ol> <p>In short:</p> <ol> <li>The client machine has to join the AD domain.</li> <li>The Internet Options has to be configured properly.</li> <li>The WinHttp API should be able to get a valid ticket from KDC. Make sure you use the correct server address (e.g. test.seafile.com) when you generate keytab file on the domain controller.</li> </ol>"},{"location":"config/auto_login_seadrive/#auto-login-on-internet-explorer","title":"Auto Login on Internet Explorer","text":"<p>The Internet Options has to be configured as following:</p> <p>Open \"Internet Options\", select \"Security\" tab, select \"Local Intranet\" zone.</p> <ol> <li>\"Sites\" -&gt; \"Advanced\" -&gt; \"Add this website to zone\". This is the place where we fill the address (e.g. http://test.seafile.com)</li> <li>\"Security level for this zone\" -&gt; \"Custom level...\" -&gt; \"Automatic log-on with current username and password\".</li> </ol> <p>Note</p> <p>Above configuration requires a reboot to take effect.</p> <p></p> <p>Next, we shall test the auto login function on Internet Explorer: visit the website and click \"Single Sign-On\" link. It should be able to log in directly, otherwise the auto login is malfunctioned.</p> <p>Note</p> <p>The address in the test must be same as the address specified in the keytab file. Otherwise, the client machine can't get a valid ticket from Kerberos.</p>"},{"location":"config/auto_login_seadrive/#auto-login-on-seadrive","title":"Auto Login on SeaDrive","text":"<p>SeaDrive will use the Kerberos login configuration from the Windows Registry under <code>HKEY_CURRENT_USER/SOFTWARE/SeaDrive</code>.</p> <pre><code>Key   : PreconfigureServerAddr\nType  : REG_SZ\nValue : &lt;the url of seafile server&gt;\n\nKey   : PreconfigureUseKerberosLogin\nType  : REG_SZ\nValue : &lt;0|1&gt; // 0 for normal login, 1 for SSO login\n</code></pre> <p>The system wide configuration path is located at <code>HKEY_LOCAL_MACHINE/SOFTWARE/Wow6432Node/SeaDrive</code>.</p>"},{"location":"config/auto_login_seadrive/#seadrive-silent-installation","title":"SeaDrive Silent Installation","text":"<p>SeaDrive can be installed silently with the following command (requires admin privileges):</p> <pre><code>msiexec /i seadrive.msi /quiet /qn /log install.log\n</code></pre>"},{"location":"config/auto_login_seadrive/#auto-login-via-group-policy","title":"Auto Login via Group Policy","text":"<p>The configuration of Internet Options : https://docs.microsoft.com/en-us/troubleshoot/browsers/how-to-configure-group-policy-preference-settings</p> <p>The configuration of Windows Registry : https://thesolving.com/server-room/how-to-deploy-a-registry-key-via-group-policy/</p>"},{"location":"config/config_seafile_with_ADFS/","title":"config seafile with ADFS","text":""},{"location":"config/config_seafile_with_ADFS/#requirements","title":"Requirements","text":"<p>To use ADFS to log in to your Seafile, you need the following components:</p> <ol> <li> <p>A Winodws Server with ADFS installed. For configuring and installing ADFS you can see this article.</p> </li> <li> <p>A valid SSL certificate for ADFS server, and here we use adfs-server.adfs.com as the domain name example.</p> </li> <li> <p>A valid SSL certificate for Seafile server, and here we use demo.seafile.com as the domain name example.</p> </li> </ol>"},{"location":"config/config_seafile_with_ADFS/#prepare-certs-file","title":"Prepare Certs File","text":"<ol> <li>x.509 certs for SP (Service Provider)</li> </ol> <p>You can generate them by:</p> <p>``` openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout sp.key -out sp.crt <pre><code> These x.509 certs are used to sign and encrypt elements like NameID and Metadata for SAML. \n\n Then copy these two files to **&lt;seafile-install-path&gt;/seahub-data/certs**. (if the certs folder not exists, create it.)\n\n2. x.509 cert from IdP (Identity Provider)\n\n 1. Log into the ADFS server and open the ADFS management.\n\n 1. Double click **Service** and choose **Certificates**.\n\n 1. Export the **Token-Signing** certificate:\n\n    1. Right-click the certificate and select **View Certificate**.\n    1. Select the **Details** tab.\n    1. Click **Copy to File** (select **DER encoded binary X.509**).\n\n 1. Convert this certificate to PEM format, rename it to **idp.crt**\n\n 1. Then copy it to **&lt;seafile-install-path&gt;/seahub-data/certs**.\n\n### Prepare IdP Metadata File\n\n1. Open https://adfs-server.adfs.com/federationmetadata/2007-06/federationmetadata.xml\n\n1. Save this xml file, rename it to **idp_federation_metadata.xml**\n\n1. Copy it to **&lt;seafile-install-path&gt;/seahub-data/certs**.\n\n### Install Requirements on Seafile Server\n\n- For Ubuntu 16.04\n</code></pre> sudo apt install xmlsec1 sudo pip install cryptography djangosaml2==0.15.0 <pre><code>### Config Seafile\n\nAdd the following lines to **seahub_settings.py**\n</code></pre> from os import path import saml2 import saml2.saml</p>"},{"location":"config/config_seafile_with_ADFS/#update-following-lines-according-to-your-situation","title":"update following lines according to your situation","text":"<p>CERTS_DIR = '/seahub-data/certs' SP_SERVICE_URL = 'https://demo.seafile.com' XMLSEC_BINARY = '/usr/local/bin/xmlsec1' ATTRIBUTE_MAP_DIR = '/seafile-server-latest/seahub-extra/seahub_extra/adfs_auth/attribute-maps' SAML_ATTRIBUTE_MAPPING = {     'DisplayName': ('display_name', ),     'ContactEmail': ('contact_email', ),     'Deparment': ('department', ),     'Telephone': ('telephone', ), }"},{"location":"config/config_seafile_with_ADFS/#update-the-idp-section-in-sampl_config-according-to-your-situation-and-leave-others-as-default","title":"update the 'idp' section in SAMPL_CONFIG according to your situation, and leave others as default","text":"<p>ENABLE_ADFS_LOGIN = True EXTRA_AUTHENTICATION_BACKENDS = (     'seahub_extra.adfs_auth.backends.Saml2Backend', ) SAML_USE_NAME_ID_AS_USERNAME = True LOGIN_REDIRECT_URL = '/saml2/complete/' SAML_CONFIG = {     # full path to the xmlsec1 binary programm     'xmlsec_binary': XMLSEC_BINARY,</p> <pre><code>'allow_unknown_attributes': True,\n\n# your entity id, usually your subdomain plus the url to the metadata view\n'entityid': SP_SERVICE_URL + '/saml2/metadata/',\n\n# directory with attribute mapping\n'attribute_map_dir': ATTRIBUTE_MAP_DIR,\n\n# this block states what services we provide\n'service': {\n    # we are just a lonely SP\n    'sp' : {\n        \"allow_unsolicited\": True,\n        'name': 'Federated Seafile Service',\n        'name_id_format': saml2.saml.NAMEID_FORMAT_EMAILADDRESS,\n        'endpoints': {\n            # url and binding to the assetion consumer service view\n            # do not change the binding or service name\n            'assertion_consumer_service': [\n                (SP_SERVICE_URL + '/saml2/acs/',\n                 saml2.BINDING_HTTP_POST),\n            ],\n            # url and binding to the single logout service view\n            # do not change the binding or service name\n            'single_logout_service': [\n                (SP_SERVICE_URL + '/saml2/ls/',\n                 saml2.BINDING_HTTP_REDIRECT),\n                (SP_SERVICE_URL + '/saml2/ls/post',\n                 saml2.BINDING_HTTP_POST),\n            ],\n        },\n\n        # attributes that this project need to identify a user\n        'required_attributes': [\"uid\"],\n\n        # attributes that may be useful to have but not required\n        'optional_attributes': ['eduPersonAffiliation', ],\n\n        # in this section the list of IdPs we talk to are defined\n        'idp': {\n            # we do not need a WAYF service since there is\n            # only an IdP defined here. This IdP should be\n            # present in our metadata\n\n            # the keys of this dictionary are entity ids\n            'https://adfs-server.adfs.com/federationmetadata/2007-06/federationmetadata.xml': {\n                'single_sign_on_service': {\n                    saml2.BINDING_HTTP_REDIRECT: 'https://adfs-server.adfs.com/adfs/ls/idpinitiatedsignon.aspx',\n                },\n              'single_logout_service': {\n                  saml2.BINDING_HTTP_REDIRECT: 'https://adfs-server.adfs.com/adfs/ls/?wa=wsignout1.0',\n              },\n            },\n        },\n    },\n},\n\n# where the remote metadata is stored\n'metadata': {\n    'local': [path.join(CERTS_DIR, 'idp_federation_metadata.xml')],\n},\n\n# set to 1 to output debugging information\n'debug': 1,\n\n# Signing\n'key_file': '', \n'cert_file': path.join(CERTS_DIR, 'idp.crt'),  # from IdP\n\n# Encryption\n'encryption_keypairs': [{\n    'key_file': path.join(CERTS_DIR, 'sp.key'),  # private part\n    'cert_file': path.join(CERTS_DIR, 'sp.crt'),  # public part\n}],\n\n'valid_for': 24,  # how long is our metadata valid\n</code></pre> <p>}</p> <p>```</p>"},{"location":"config/config_seafile_with_ADFS/#config-adfs-server","title":"Config ADFS Server","text":"<ol> <li>Add Relying Party Trust</li> </ol> <p>Relying Party Trust is the connection between Seafile and ADFS.</p> <ol> <li> <p>Log into the ADFS server and open the ADFS management.</p> </li> <li> <p>Double click Trust Relationships, then right click Relying Party Trusts, select Add Relying Party Trust\u2026.</p> </li> <li> <p>Select Import data about the relying party published online or one a local network, input <code>https://demo.seafile.com/saml2/metadata/</code> in the Federation metadata address.</p> </li> <li> <p>Then Next until Finish.</p> </li> <li> <p>Add Relying Party Claim Rules</p> </li> </ol> <p>Relying Party Claim Rules is used for attribute communication between Seafile and users in Windows Domain. </p> <p>Important: Users in Windows domain must have the E-mail value setted.</p> <ol> <li> <p>Right-click on the relying party trust and select Edit Claim Rules...</p> </li> <li> <p>On the Issuance Transform Rules tab select Add Rules...</p> </li> <li> <p>Select Send LDAP Attribute as Claims as the claim rule template to use. </p> </li> <li> <p>Give the claim a name such as LDAP Attributes. </p> </li> <li> <p>Set the Attribute Store to Active Directory, the LDAP Attribute to E-Mail-Addresses, and the Outgoing Claim Type to E-mail Address. </p> </li> <li> <p>Select Finish. </p> </li> <li> <p>Click Add Rule... again.</p> </li> <li> <p>Select Transform an Incoming Claim. </p> </li> <li> <p>Give it a name such as Email to Name ID.</p> </li> <li> <p>Incoming claim type should be E-mail Address (it must match the Outgoing Claim Type in rule #1).</p> </li> <li> <p>The Outgoing claim type is Name ID (this is required in Seafile settings policy <code>'name_id_format': saml2.saml.NAMEID_FORMAT_EMAILADDRESS</code>).</p> </li> <li> <p>the Outgoing name ID format is Email.</p> </li> <li> <p>Pass through all claim values and click Finish. </p> </li> </ol> <ul> <li> <p>https://support.zendesk.com/hc/en-us/articles/203663886-Setting-up-single-sign-on-using-Active-Directory-with-ADFS-and-SAML-Plus-and-Enterprise-</p> </li> <li> <p>http://wiki.servicenow.com/?title=Configuring_ADFS_2.0_to_Communicate_with_SAML_2.0#gsc.tab=0</p> </li> <li> <p>https://github.com/rohe/pysaml2/blob/master/src/saml2/saml.py</p> </li> </ul>"},{"location":"config/customize_email_notifications/","title":"Customize Email Notifications","text":"<p>Note: Subject line may vary between different releases, this is based on Release 2.0.1. Restart Seahub so that your changes take effect.</p>"},{"location":"config/customize_email_notifications/#user-reset-hisher-password","title":"User reset his/her password","text":"<p>Subject</p> <p>seahub/seahub/auth/forms.py line:103</p> <p>Body</p> <p>seahub/seahub/templates/registration/password_reset_email.html</p> <p>Note: You can copy password_reset_email.html to <code>seahub-data/custom/templates/registration/password_reset_email.html</code> and modify the new one. In this way, the customization will be maintained after upgrade. </p>"},{"location":"config/customize_email_notifications/#system-admin-add-new-member","title":"System admin add new member","text":"<p>Subject</p> <p>seahub/seahub/views/sysadmin.py line:424</p> <p>Body</p> <p>seahub/seahub/templates/sysadmin/user_add_email.html</p> <p>Note: You can copy user_add_email.html to <code>seahub-data/custom/templates/sysadmin/user_add_email.html</code> and modify the new one. In this way, the customization will be maintained after upgrade. </p>"},{"location":"config/customize_email_notifications/#system-admin-reset-user-password","title":"System admin reset user password","text":"<p>Subject</p> <p>seahub/seahub/views/sysadmin.py line:368</p> <p>Body</p> <p>seahub/seahub/templates/sysadmin/user_reset_email.html</p> <p>Note: You can copy user_reset_email.html to <code>seahub-data/custom/templates/sysadmin/user_reset_email.html</code> and modify the new one. In this way, the customization will be maintained after upgrade. </p>"},{"location":"config/customize_email_notifications/#user-send-filefolder-share-link","title":"User send file/folder share link","text":"<p>Subject</p> <p>seahub/seahub/share/views.py line:668</p> <p>Body</p> <p>seahub/seahub/templates/shared_link_email.html</p>"},{"location":"config/details_about_file_search/","title":"Details about File Search","text":""},{"location":"config/details_about_file_search/#search-options","title":"Search Options","text":"<p>The following options can be set in seafevents.conf to control the behaviors of file search. You need to restart seafile and seahub to make them take effect.</p> <pre><code>[INDEX FILES]\n## must be \"true\" to enable search\nenabled = true\n\n## The interval the search index is updated. Can be s(seconds), m(minutes), h(hours), d(days)\ninterval=10m\n\n## this is for improving the search speed\nhighlight = fvh                              \n\n## If true, indexes the contents of office/pdf files while updating search index\n## Note: If you change this option from \"false\" to \"true\", then you need to clear the search index and update the index again.\nindex_office_pdf=false\n\n## From 9.0.7 pro, Seafile supports connecting to Elasticsearch through username and password, you need to configure username and password for the Elasticsearch server\nusername = elastic           # username to connect to Elasticsearch\npassword = elastic_password  # password to connect to Elasticsearch\n\n## From 9.0.7 pro, Seafile supports connecting to elasticsearch via HTTPS, you need to configure HTTPS for the Elasticsearch server\nscheme = https               # The default is http. If the Elasticsearch server is not configured with HTTPS, the scheme and cafile do not need to be configured\ncafile = path/to/cert.pem    # The certificate path for user authentication. If the Elasticsearch server does not enable certificate authentication, do not need to be configured\n\n## From version 11.0.5 Pro, you can custom ElasticSearch index names for distinct instances when intergrating multiple Seafile servers to a single ElasticSearch Server.\nrepo_status_index_name = your-repo-status-index-name  # default is `repo_head`\nrepo_files_index_name = your-repo-files-index-name    # default is `repofiles`\n</code></pre>"},{"location":"config/details_about_file_search/#enable-full-text-search-for-officepdf-files","title":"Enable full text search for Office/PDF files","text":"<p>Full text search is not enabled by default to save system resources. If you want to enable it, you need to follow the instructions below.</p>"},{"location":"config/details_about_file_search/#modify-seafeventsconf","title":"Modify <code>seafevents.conf</code>","text":"Deploy in DockerDeploy from binary packages <pre><code>cd /opt/seafile-data/seafile/conf\nnano seafevents.conf\n</code></pre> <pre><code>cd /opt/seafile/conf\nnano seafevents.conf\n</code></pre> <p>set <code>index_office_pdf</code> to <code>true</code></p> <pre><code>...\n[INDEX FILES]\n...\nindex_office_pdf=true\n...\n</code></pre>"},{"location":"config/details_about_file_search/#restart-seafile-server","title":"Restart Seafile server","text":"Deploy in DockerDeploy from binary packages <pre><code>docker exec -it seafile bash\ncd /scripts\n./seafile.sh restart\n\n# delete the existing search index and recreate it\n./pro/pro.py search --clear\n./pro/pro.py search --update\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\n./seafile.sh restart\n\n# delete the existing search index and recreate it\n./pro/pro.py search --clear\n./pro/pro.py search --update\n</code></pre>"},{"location":"config/details_about_file_search/#common-problems","title":"Common problems","text":""},{"location":"config/details_about_file_search/#how-to-rebuild-the-index-if-something-went-wrong","title":"How to rebuild the index if something went wrong","text":"<p>You can rebuild search index by running:</p> Deploy in DockerDeploy from binary packages <pre><code>docker exec -it seafile bash\ncd /scripts\n./pro/pro.py search --clear\n./pro/pro.py search --update\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\n./pro/pro.py search --clear\n./pro/pro.py search --update\n</code></pre> <p>Tip</p> <p>If this does not work, you can try the following steps:</p> <ol> <li>Stop Seafile</li> <li>Remove the old search index <code>rm -rf pro-data/search</code></li> <li>Restart Seafile</li> <li>Wait one minute then run <code>./pro/pro.py search --update</code></li> </ol>"},{"location":"config/details_about_file_search/#access-the-aws-elasticsearch-service-using-https","title":"Access the AWS elasticsearch service using HTTPS","text":"<ol> <li> <p>Create an elasticsearch service on AWS according to the documentation.</p> </li> <li> <p>Configure the seafevents.conf:</p> </li> </ol> <pre><code>[INDEX FILES]\nenabled = true\ninterval = 10m\nindex_office_pdf=true\nes_host = your domain endpoint(for example, https://search-my-domain.us-east-1.es.amazonaws.com)\nes_port = 443\nscheme = https\nusername = master user\npassword = password\nhighlight = fvh\nrepo_status_index_name = your-repo-status-index-name  # default is `repo_head`\nrepo_files_index_name = your-repo-files-index-name    # default is `repofiles`\n</code></pre>"},{"location":"config/details_about_file_search/#i-get-no-result-when-i-search-a-keyword","title":"I get no result when I search a keyword","text":"<p>The search index is updated every 10 minutes by default. So before the first index update is performed, you get nothing no matter what you search.</p> <p>To be able to search immediately,</p> <ul> <li>Make sure you have started Seafile Server</li> <li>Update the search index manually:</li> </ul> Deploy in DockerDeploy from binary packages <pre><code>docker exec -it seafile bash\ncd /scripts\n./pro/pro.py search --update\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\n./pro/pro.py search --update\n</code></pre>"},{"location":"config/details_about_file_search/#encrypted-files-cannot-be-searched","title":"Encrypted files cannot be searched","text":"<p>This is because the server cannot index encrypted files, since they are encrypted.</p>"},{"location":"config/env/","title":".env","text":"<p>The <code>.env</code> file will be used to specify the components used by the Seafile-docker instance and the environment variables required by each component.</p>"},{"location":"config/env/#seafile-docker-configurations","title":"Seafile-docker configurations","text":""},{"location":"config/env/#components-configurations","title":"Components configurations","text":"<ul> <li><code>COMPOSE_FILE</code>: <code>.yml</code> files for components of Seafile-docker, each <code>.yml</code> must be separated by the symbol defined in <code>COMPOSE_PATH_SEPARATOR</code>. The core components are involved in <code>seafile-server.yml</code> and <code>caddy.yml</code> which must be taken in this term.</li> <li><code>COMPOSE_PATH_SEPARATOR</code>: The symbol used to separate the <code>.yml</code> files in term <code>COMPOSE_FILE</code>, default is ','.</li> </ul>"},{"location":"config/env/#docker-images-configurations","title":"Docker images configurations","text":"<ul> <li><code>SEAFILE_IMAGE</code>: The image of Seafile-server, default is <code>seafileltd/seafile-pro-mc:12.0-latest</code>.</li> <li><code>SEAFILE_DB_IMAGE</code>: Database server image, default is <code>mariadb:10.11</code>.</li> <li><code>SEAFILE_MEMCACHED_IMAGE</code>: Cached server image, default is <code>memcached:1.6.29</code></li> <li><code>SEAFILE_ELASTICSEARCH_IMAGE</code>: Only valid in pro edition. The elasticsearch image, default is <code>elasticsearch:8.15.0</code>.</li> <li><code>SEAFILE_CADDY_IMAGE</code>: Caddy server image, default is <code>lucaslorentz/caddy-docker-proxy:2.9-alpine</code>.</li> <li><code>SEADOC_IMAGE</code>: Only valid after integrating SeaDoc. SeaDoc server image, default is <code>seafileltd/sdoc-server:2.0-latest</code>.</li> <li><code>NON_ROOT</code>: Run Seafile container without a root user, default is <code>false</code></li> </ul>"},{"location":"config/env/#persistent-volume-configurations","title":"Persistent Volume Configurations","text":"<ul> <li><code>SEAFILE_VOLUME</code>: The volume directory of Seafile data, default is <code>/opt/seafile-data</code>.</li> <li><code>SEAFILE_MYSQL_VOLUME</code>: The volume directory of MySQL data, default is <code>/opt/seafile-mysql/db</code>.</li> <li><code>SEAFILE_CADDY_VOLUME</code>: The volume directory of Caddy data used to store certificates obtained from Let's Encrypt's, default is <code>/opt/seafile-caddy</code>.</li> <li><code>SEAFILE_ELASTICSEARCH_VOLUME</code>: Only valid in pro edition. The volume directory of Elasticsearch data, default is <code>/opt/seafile-elasticsearch/data</code>.</li> <li><code>SEADOC_VOLUME</code>: Only valid after integrating SeaDoc. The volume directory of SeaDoc server data, default is <code>/opt/seadoc-data</code>.</li> </ul>"},{"location":"config/env/#mysql-configurations","title":"MySQL configurations","text":"<ul> <li><code>SEAFILE_MYSQL_DB_HOST</code>: The host address of Mysql, default is the pre-defined service name <code>db</code> in Seafile-docker instance.</li> <li><code>SEAFILE_MYSQL_DB_PORT</code>: The port of Mysql, default is <code>3306</code>.</li> <li><code>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</code>: (Only required on first deployment) The <code>root</code> password of MySQL. </li> <li><code>SEAFILE_MYSQL_DB_USER</code>: The user of MySQL (<code>database</code> - <code>user</code> can be found in <code>conf/seafile.conf</code>).</li> <li><code>SEAFILE_MYSQL_DB_PASSWORD</code>: The user <code>seafile</code> password of MySQL.</li> <li><code>SEAFILE_MYSQL_DB_SEAFILE_DB_NAME</code>: The name of Seafile database name, default is <code>seafile_db</code></li> <li><code>SEAFILE_MYSQL_DB_CCNET_DB_NAME</code>: The name of ccnet database name, default is <code>ccnet_db</code></li> <li><code>SEAFILE_MYSQL_DB_SEAHUB_DB_NAME</code>: The name of seahub database name, default is <code>seahub_db</code></li> </ul>"},{"location":"config/env/#cache-configurations","title":"Cache configurations","text":"<ul> <li><code>CACHE_PROVIDER</code>: The type of cache server used for Seafile. The available options are <code>redis</code> and <code>memcached</code>. Since Seafile 13, it is recommended to use <code>redis</code> as the cache service to support new features, and <code>memcached</code> will no longer be integrated into Seafile Docker by default. Default is <code>redis</code></li> </ul>"},{"location":"config/env/#redis-configurations","title":"Redis configurations","text":"<p>This part of configurations is only valid in <code>CACHE_PROVIDER=redis</code>:</p> <ul> <li><code>REDIS_HOST</code>: Redis server host, default is <code>redis</code></li> <li><code>REDIS_PORT</code>: Redis server port, default is <code>6379</code></li> <li><code>REDIS_PASSWORD</code>: Redis server password. </li> </ul>"},{"location":"config/env/#memcached-configurations","title":"Memcached configurations","text":"<p>This part of configurations is only valid in <code>CACHE_PROVIDER=memcached</code>:</p> <ul> <li><code>MEMCACHED_HOST</code>: Memcached server host, default is <code>memcached</code></li> <li><code>MEMCACHED_PORT</code>: Memcached server port, default is <code>11211</code></li> </ul>"},{"location":"config/env/#seafile-server-configurations","title":"Seafile-server configurations","text":"<ul> <li><code>JWT_PRIVATE_KEY</code>: JWT_PRIVATE_KEY, A random string with a length of no less than 32 characters, generate example: <code>pwgen -s 40 1</code></li> <li><code>SEAFILE_SERVER_HOSTNAME</code>: Seafile server hostname or domain</li> <li><code>SEAFILE_SERVER_PROTOCOL</code>: Seafile server protocol (http or https)</li> <li><code>TIME_ZONE</code>: Time zone (default <code>UTC</code>)</li> <li><code>INIT_SEAFILE_ADMIN_EMAIL</code>: Admin username</li> <li><code>INIT_SEAFILE_ADMIN_PASSWORD</code>: Admin password</li> </ul>"},{"location":"config/env/#seadoc-configurations-only-valid-after-integrating-seadoc","title":"SeaDoc configurations (only valid after integrating SeaDoc)","text":"<ul> <li><code>ENABLE_SEADOC</code>: Enable the SeaDoc server or not, default is <code>false</code>.</li> <li><code>SEADOC_SERVER_URL</code>: Only valid in <code>ENABLE_SEADOC=true</code>. External URL of Seadoc server (e.g., https://seafile.example.com/sdoc-server).</li> </ul>"},{"location":"config/env/#s3-storage-backend-configurations-pro","title":"S3 storage backend configurations (pro)","text":"<ul> <li><code>SEAF_SERVER_STORAGE_TYPE</code>: What kind of the Seafile data for storage. Available options are <code>disk</code> (i.e., local disk), <code>s3</code> and <code>multiple</code> (see the details of multiple storage backends)</li> <li><code>S3_COMMIT_BUCKET</code>: S3 storage backend fs objects bucket</li> <li><code>S3_FS_BUCKET</code>: S3 storage backend block objects bucket</li> <li><code>S3_BLOCK_BUCKET</code>: S3 storage backend block objects bucket</li> <li><code>S3_SS_BUCKET</code>: S3 storage bucket for SeaSearch data (valid when service enabled)</li> <li><code>S3_MD_BUCKET</code>: S3 storage bucket for metadata-sever data (valid when service available)</li> <li><code>S3_KEY_ID</code>: S3 storage backend key ID</li> <li><code>S3_SECRET_KEY</code>: S3 storage backend secret key</li> <li><code>S3_USE_V4_SIGNATURE</code>: Use the v4 protocol of S3 if enabled, default is <code>true</code></li> <li><code>S3_AWS_REGION</code>: Region of your buckets (AWS only), default is <code>us-east-1</code>.</li> <li><code>S3_HOST</code>: Host of your buckets (required when not use AWS).</li> <li><code>S3_USE_HTTPS</code>: Use HTTPS connections to S3 if enabled, default is <code>true</code></li> <li><code>S3_PATH_STYLE_REQUEST</code>: This option asks Seafile to use URLs like <code>https://192.168.1.123:8080/bucketname/object</code> to access objects. In Amazon S3, the default URL format is in virtual host style, such as <code>https://bucketname.s3.amazonaws.com/object</code>. But this style relies on advanced DNS server setup. So most self-hosted storage systems only implement the path style format. Default <code>false</code>.</li> <li><code>S3_SSE_C_KEY</code>: A string of 32 characters can be generated by openssl rand -base64 24. It can be any 32-character long random string. It's required to use V4 authentication protocol and https if you enable SSE-C.</li> </ul> <p>Easier to configure S3 for Seafile and its components</p> <p>Since Seafile Pro 13.0, in order to facilitate users to deploy Seafile's related extension components and other services in the future, a section will be provided in <code>.env</code> to store the S3 Configurations for Seafile and some extension components (such as SeaSearch, Metadata server). You can locate it with the title bar Storage configurations for S3.</p> <p>S3 configurations in <code>.env</code> only support single S3 storage backend mode</p> <p>The Seafile server only support configuring S3 in <code>.env</code> for single S3 storage backend mode (i.e., when <code>SEAF_SERVER_STORAGE_TYPE=s3</code>). If you would like to use other storage backend (e.g., Ceph, Swift) or other settings that can only be set in <code>seafile.conf</code> (like multiple storage backends), please set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>multiple</code>, and set <code>MD_STORAGE_TYPE</code> and <code>SS_STORAGE_TYPE</code> according to your configurations.</p> <p>The S3 configurations only valid with at least one <code>STORAGE_TYPE</code> has specified to <code>s3</code></p> <p>Now there are three (pro) and one (cluster) STORAGE_TYPE we provided in <code>.env</code>:     - SEAF_SERVER_STORAGE_TYPE (pro &amp; cluster)     - MD_STORAGE_TYPE (pro, see the Metadata server section for the details)     - SS_STORAGE_TYPE (pro, see the SeaSearch section for the details)</p> <p>You have to specify at least one of them as s3 for the above configuration to take effect.</p>"},{"location":"config/env/#seasearch","title":"SeaSearch","text":"<p>For configurations about SeaSearch in <code>.env</code>, please refer here for the details.</p>"},{"location":"config/env/#metadata-server","title":"Metadata server","text":"<p>For configurations about Metadata server in <code>.env</code>, please refer here for the details.</p>"},{"location":"config/env/#notification-server","title":"Notification server","text":"<ul> <li><code>ENABLE_NOTIFICATION_SERVER</code>: Enable (<code>true</code>) or disable (<code>false</code>) notification feature for Seafile. Default is <code>false</code>.</li> <li><code>NOTIFICATION_SERVER_URL</code>: Used to do the connection between client (i.e., user's browser) and notification server. Default is <code>https://seafile.example.com/notification</code>. </li> <li><code>INNER_NOTIFICATION_SERVER_URL</code>: Used to do the connection between Seafile server and notification server. Default is <code>http://notification-server:8083</code>.</li> </ul>"},{"location":"config/env/#metadata-server_1","title":"Metadata server","text":"<ul> <li><code>MD_FILE_COUNT_LIMIT</code>: The maximum number of files in a repository that the metadata feature allows. If the number of files in a repository exceeds this value, the metadata management function will not be enabled for the repository. For a repository with metadata management enabled, if the number of records in it reaches this value but there are still some files that are not recorded in metadata server, the metadata management of the unrecorded files will be skipped. Default is <code>100000</code>.</li> </ul>"},{"location":"config/env/#cluster-init-configuration","title":"Cluster init configuration","text":"<ul> <li><code>CLUSTER_INIT_MODE</code>: (only valid in pro edition at deploying first time). Cluster initialization mode, in which the necessary configuration files for the service to run will be generated (but the service will not be started). If the configuration file already exists, no operation will be performed. The default value is <code>true</code>. When the configuration file is generated, be sure to set this item to <code>false</code>.</li> <li><code>CLUSTER_INIT_ES_HOST</code>: (only valid in pro edition at deploying first time). Your cluster Elasticsearch server host.</li> <li><code>CLUSTER_INIT_ES_PORT</code>: (only valid in pro edition at deploying first time). Your cluster Elasticsearch server port. Default is <code>9200</code>.</li> <li><code>CLUSTER_MODE</code>: Seafile service node type, i.e., <code>frontend</code> (default) or <code>backend</code>.</li> </ul>"},{"location":"config/ldap_in_ce/","title":"Configure Seafile to use LDAP","text":"<p>This documentation is for the Community Edition. If you're using Pro Edition, please refer to the Seafile Pro documentation</p>"},{"location":"config/ldap_in_ce/#how-does-ldap-user-management-work-in-seafile","title":"How does LDAP User Management work in Seafile","text":"<p>When Seafile is integrated with LDAP, users in the system can be divided into two tiers:</p> <ul> <li> <p>Users within Seafile's internal user database. Some attributes are attached to these users, such as whether it's a system admin user, whether it's activated.</p> </li> <li> <p>Users in LDAP server. These are all the intended users of Seafile inside the LDAP server. Seafile doesn't manipulate these users directly. It has to import them into its internal database before setting attributes on them.</p> </li> </ul> <p>When Seafile counts the number of users in the system, it only counts the activated users in its internal database.</p>"},{"location":"config/ldap_in_ce/#basic-ldap-integration","title":"Basic LDAP Integration","text":"<p>The only requirement for Seafile to use LDAP for authentication is that there must be a unique identifier for each user in the LDAP server. This id should also be user-friendly as the users will use it as username when login. Below are some usual options for this unique identifier:</p> <ul> <li>Email address: this is the most common choice. Most organizations assign unique email address for each member.</li> <li>UserPrincipalName: this is a user attribute only available in Active Directory. It's format is <code>user-login-name@domain-name</code>, e.g. <code>john@example.com</code>. It's not a real email address, but it works fine as the unique identifier.</li> </ul> <p>The identifier is stored in table <code>social_auth_usersocialauth</code> to map the identifier to internal user ID in Seafile. When this ID is changed in LDAP for a user, you only need to update <code>social_auth_usersocialauth</code> table</p>"},{"location":"config/ldap_in_ce/#basic-configuration-items","title":"Basic configuration items","text":"<p>Add the following options to <code>seahub_settings.py</code>. Examples are as follows:</p> <pre><code>ENABLE_LDAP = True\nLDAP_SERVER_URL = 'ldap://192.168.0.1'       \nLDAP_BASE_DN = 'ou=test,dc=seafile,dc=ren'                     \nLDAP_ADMIN_DN = 'administrator@example.com'  \nLDAP_ADMIN_PASSWORD = 'yourpassword'         \nLDAP_PROVIDER = 'ldap'                                     \nLDAP_LOGIN_ATTR = 'email'                                                            \nLDAP_CONTACT_EMAIL_ATTR = ''                \nLDAP_USER_ROLE_ATTR = ''                     \nLDAP_USER_FIRST_NAME_ATTR = 'givenName'     \nLDAP_USER_LAST_NAME_ATTR = 'sn'              \nLDAP_USER_NAME_REVERSE = False               \nLDAP_FILTER = 'memberOf=CN=testgroup,OU=test,DC=seafile,DC=ren' \n</code></pre> <p>Meaning of some options:</p> variable description <code>LDAP_SERVER_URL</code> The URL of LDAP server <code>LDAP_BASE_DN</code> The root node of users who can log in to Seafile in the LDAP server <code>LDAP_ADMIN_DN</code> DN of the administrator used to query the LDAP server for information. For OpenLDAP, it may be <code>cn=admin,dc=example,dc=com</code> <code>LDAP_ADMIN_PASSWORD</code> Password of <code>LDAP_ADMIN_DN</code> <code>LDAP_PROVIDER</code> Identify the source of the user, used in the table <code>social_auth_usersocialauth</code>, defaults to 'ldap' <code>LDAP_LOGIN_ATTR</code> User's attribute used to log in to Seafile. It should be a unique identifier for the user in LDAP server. Learn more about this id from the descriptions at the beginning of this section. <code>LDAP_CONTACT_EMAIL_ATTR</code> LDAP user's <code>contact_email</code> attribute <code>LDAP_USER_ROLE_ATTR</code> LDAP user's role attribute <code>LDAP_USER_FIRST_NAME_ATTR</code> Attribute for user's first name. It's <code>\"givenName\"</code> by default. <code>LDAP_USER_LAST_NAME_ATTR</code> Attribute for user's last name. It's <code>\"sn\"</code> by default. <code>LDAP_USER_NAME_REVERSE</code> In some languages, such as Chinese, the display order of the first and last name is reversed. Set this option if you need it. <code>LDAP_FILTER</code> Additional filter conditions. Users who meet the filter conditions can log in, otherwise they cannot log in. <p>Tips for choosing <code>LDAP_BASE_DN</code> and <code>LDAP_ADMIN_DN</code>:</p> <ul> <li> <p>To determine the <code>LDAP_BASE_DN</code>, you first have to navigate your organization hierachy on the domain controller GUI.</p> <ul> <li> <p>If you want to allow all users to use Seafile, you can use <code>cn=users,dc=yourdomain,dc=com</code> as <code>LDAP_BASE_DN</code> (with proper adjustment for your own needs).</p> </li> <li> <p>If you want to limit users to a certain OU (Organization Unit), you run <code>dsquery</code> command on the domain controller to find out the DN for this OU. For example, if the OU is <code>staffs</code>, you can run <code>dsquery ou -name staff</code>. More information can be found here.</p> </li> </ul> </li> <li> <p>AD supports <code>user@domain.name</code> format for the <code>LDAP_ADMIN_DN</code> option. For example you can use administrator@example.com for <code>LDAP_ADMIN_DN</code>. Sometime the domain controller doesn't recognize this format. You can still use <code>dsquery</code> command to find out user's DN. For example, if the user name is 'seafileuser', run <code>dsquery user -name seafileuser</code>. More information here.</p> </li> </ul>"},{"location":"config/ldap_in_ce/#advanced-ldap-integration-options","title":"Advanced LDAP Integration Options","text":""},{"location":"config/ldap_in_ce/#multiple-base","title":"Multiple BASE","text":"<p>Multiple base DN is useful when your company has more than one OUs to use Seafile. You can specify a list of base DN in the <code>LDAP_BASE_DN</code> option. The DNs are separated by \";\", e.g.</p> <pre><code>LDAP_BASE_DN = 'ou=developers,dc=example,dc=com;ou=marketing,dc=example,dc=com'\n</code></pre>"},{"location":"config/ldap_in_ce/#additional-search-filter","title":"Additional Search Filter","text":"<p>Search filter is very useful when you have a large organization but only a portion of people want to use Seafile. The filter can be given by setting <code>LDAP_FILTER</code> option. The value of this option follows standard LDAP search filter syntax (https://msdn.microsoft.com/en-us/library/aa746475(v=vs.85).aspx).</p> <p>The final filter used for searching for users is <code>(&amp;($LOGIN_ATTR=*)($LDAP_FILTER))</code>. <code>$LOGIN_ATTR</code> and <code>$LDAP_FILTER</code> will be replaced by your option values.</p> <p>For example, add below option to <code>seahub_settings.py</code>:</p> <pre><code>LDAP_FILTER = 'memberOf=CN=group,CN=developers,DC=example,DC=com'\n</code></pre> <p>The final search filter would be <code>(&amp;(mail=*)(memberOf=CN=group,CN=developers,DC=example,DC=com))</code></p> <p>Note that the case of attribute names in the above example is significant. The <code>memberOf</code> attribute is only available in Active Directory.</p>"},{"location":"config/ldap_in_ce/#limiting-seafile-users-to-a-group-in-active-directory","title":"Limiting Seafile Users to a Group in Active Directory","text":"<p>You can use the <code>LDAP_FILTER</code> option to limit user scope to a certain AD group.</p> <ol> <li> <p>First, you should find out the DN for the group. Again, we'll use the <code>dsquery</code> command on the domain controller. For example, if group name is 'seafilegroup', run <code>dsquery group -name seafilegroup</code>.</p> </li> <li> <p>Add below option to <code>seahub_settings.py</code>:</p> </li> </ol> <pre><code>LDAP_FILTER = 'memberOf={output of dsquery command}'\n</code></pre>"},{"location":"config/ldap_in_ce/#using-tls-connection-to-ldap-server","title":"Using TLS connection to LDAP server","text":"<p>If your LDAP service supports TLS connections, you can configure <code>LDAP_SERVER_URL</code> as the access address of the ldaps protocol to use TLS to connect to the LDAP service, for example:</p> <pre><code>LDAP_SERVER_URL = 'ldaps://192.168.0.1:636/'\n</code></pre>"},{"location":"config/ldap_in_pro/","title":"Configure Seafile Pro Edition to use LDAP","text":""},{"location":"config/ldap_in_pro/#how-does-ldap-user-management-work-in-seafile","title":"How does LDAP User Management work in Seafile","text":"<p>When Seafile is integrated with LDAP, users in the system can be divided into two tiers:</p> <ul> <li> <p>Users within Seafile's internal user database. Some attributes are attached to these users, such as whether it's a system admin user, whether it's activated.</p> </li> <li> <p>Users in LDAP server. These are all the intended users of Seafile inside the LDAP server. Seafile doesn't manipulate these users directly. It has to import them into its internal database before setting attributes on them.</p> </li> </ul> <p>When Seafile counts the number of users in the system, it only counts the activated users in its internal database.</p>"},{"location":"config/ldap_in_pro/#basic-ldap-integration","title":"Basic LDAP Integration","text":"<p>The only requirement for Seafile to use LDAP for authentication is that there must be a unique identifier for each user in the LDAP server. This id should also be user-friendly as the users will use it as username when login. Below are some usual options for this unique identifier:</p> <ul> <li>Email address: this is the most common choice. Most organizations assign unique email address for each member.</li> <li>UserPrincipalName: this is a user attribute only available in Active Directory. It's format is <code>user-login-name@domain-name</code>, e.g. <code>john@example.com</code>. It's not a real email address, but it works fine as the unique identifier.</li> </ul> <p>The identifier is stored in table <code>social_auth_usersocialauth</code> to map the identifier to internal user ID in Seafile. When this ID is changed in LDAP for a user, you only need to update <code>social_auth_usersocialauth</code> table</p>"},{"location":"config/ldap_in_pro/#integration-configuration","title":"Integration Configuration","text":"<p>Add the following options to <code>seahub_settings.py</code>. Examples are as follows:</p> <pre><code>ENABLE_LDAP = True\nLDAP_SERVER_URL = 'ldap://192.168.0.1'       \nLDAP_BASE_DN = 'ou=test,dc=seafile,dc=ren'                     \nLDAP_ADMIN_DN = 'administrator@example.com'  \nLDAP_ADMIN_PASSWORD = 'yourpassword'         \nLDAP_PROVIDER = 'ldap'                                     \nLDAP_LOGIN_ATTR = 'email'                                                            \nLDAP_CONTACT_EMAIL_ATTR = ''                \nLDAP_USER_ROLE_ATTR = ''                     \nLDAP_USER_FIRST_NAME_ATTR = 'givenName'     \nLDAP_USER_LAST_NAME_ATTR = 'sn'              \nLDAP_USER_NAME_REVERSE = False               \nLDAP_FILTER = 'memberOf=CN=testgroup,OU=test,DC=seafile,DC=ren' \n</code></pre> <p>Meaning of some options:</p> variable description <code>LDAP_SERVER_URL</code> The URL of LDAP server <code>LDAP_BASE_DN</code> The root node of users who can log in to Seafile in the LDAP server <code>LDAP_ADMIN_DN</code> DN of the administrator used to query the LDAP server for information. For OpenLDAP, it may be <code>cn=admin,dc=example,dc=com</code> <code>LDAP_ADMIN_PASSWORD</code> Password of <code>LDAP_ADMIN_DN</code> <code>LDAP_PROVIDER</code> Identify the source of the user, used in the table <code>social_auth_usersocialauth</code>, defaults to 'ldap' <code>LDAP_LOGIN_ATTR</code> User's attribute used to log in to Seafile. It should be a unique identifier for the user in LDAP server. Learn more about this id from the descriptions at the beginning of this section. <code>LDAP_CONTACT_EMAIL_ATTR</code> LDAP user's <code>contact_email</code> attribute <code>LDAP_USER_ROLE_ATTR</code> LDAP user's role attribute <code>LDAP_USER_FIRST_NAME_ATTR</code> Attribute for user's first name. It's <code>\"givenName\"</code> by default. <code>LDAP_USER_LAST_NAME_ATTR</code> Attribute for user's last name. It's <code>\"sn\"</code> by default. <code>LDAP_USER_NAME_REVERSE</code> In some languages, such as Chinese, the display order of the first and last name is reversed. Set this option if you need it. <code>LDAP_FILTER</code> Additional filter conditions. Users who meet the filter conditions can log in, otherwise they cannot log in. <p>Tips for choosing <code>LDAP_BASE_DN</code> and <code>LDAP_ADMIN_DN</code>:</p> <ul> <li> <p>To determine the <code>LDAP_BASE_DN</code>, you first have to navigate your organization hierachy on the domain controller GUI.</p> <ul> <li> <p>If you want to allow all users to use Seafile, you can use <code>cn=users,dc=yourdomain,dc=com</code> as <code>LDAP_BASE_DN</code> (with proper adjustment for your own needs).</p> </li> <li> <p>If you want to limit users to a certain OU (Organization Unit), you run <code>dsquery</code> command on the domain controller to find out the DN for this OU. For example, if the OU is <code>staffs</code>, you can run <code>dsquery ou -name staff</code>. More information can be found here.</p> </li> </ul> </li> <li> <p>AD supports <code>user@domain.name</code> format for the <code>LDAP_ADMIN_DN</code> option. For example you can use administrator@example.com for <code>LDAP_ADMIN_DN</code>. Sometime the domain controller doesn't recognize this format. You can still use <code>dsquery</code> command to find out user's DN. For example, if the user name is 'seafileuser', run <code>dsquery user -name seafileuser</code>. More information here.</p> </li> </ul>"},{"location":"config/ldap_in_pro/#setting-up-ldap-user-sync-optional","title":"Setting Up LDAP User Sync (optional)","text":"<p>In Seafile Pro, except for importing users into internal database when they log in, you can also configure Seafile to periodically sync user information from LDAP server into the internal database.</p> <p>User's full name, department and contact email address can be synced to internal database. Users can use this information to more easily search for a specific user. User's Windows or Unix login id can be synced to the internal database. This allows the user to log in with its familiar login id. When a user is removed from LDAP, the corresponding user in Seafile will be deactivated. Otherwise, he could still sync files with Seafile client or access the web interface. After synchronization is complete, you can see the user's full name, department and contact email on its profile page.</p>"},{"location":"config/ldap_in_pro/#sync-configuration-items","title":"Sync configuration items","text":"<p>Add the following options to <code>seahub_settings.py</code>. Examples are as follows:</p> <pre><code># Basic configuration items\nENABLE_LDAP = True\n......\n\n# ldap user sync options.\nLDAP_SYNC_INTERVAL = 60                  \nENABLE_LDAP_USER_SYNC = True             \nLDAP_USER_OBJECT_CLASS = 'person'\nLDAP_DEPT_ATTR = ''                      \nLDAP_UID_ATTR = ''                               \nLDAP_AUTO_REACTIVATE_USERS = True        \nLDAP_USE_PAGED_RESULT = False           \nIMPORT_NEW_USER = True                   \nACTIVATE_USER_WHEN_IMPORT = True         \nDEACTIVE_USER_IF_NOTFOUND = False        \nENABLE_EXTRA_USER_INFO_SYNC = True       \n</code></pre> <p>Meaning of some options:</p> Variable Description LDAP_SYNC_INTERVAL The interval to sync. Unit is minutes. Defaults to 60 minutes. ENABLE_LDAP_USER_SYNC set to \"true\" if you want to enable ldap user synchronization LDAP_USER_OBJECT_CLASS This is the name of the class used to search for user objects. In Active Directory, it's usually \"person\". The default value is \"person\". LDAP_DEPT_ATTR Attribute for department info. LDAP_UID_ATTR Attribute for Windows login name. If this is synchronized, users can also log in with their Windows login name. In AD, the attribute <code>sAMAccountName</code> can be used as <code>UID_ATTR</code>. The attribute will be stored as login_id in Seafile (in seahub_db.profile_profile table). LDAP_AUTO_REACTIVATE_USERS Whether to auto activate deactivated user, default by 'true' LDAP_USE_PAGED_RESULT Whether to use pagination extension. It is useful when you have more than 1000 users in LDAP server. IMPORT_NEW_USER Whether to import new users when sync user. ACTIVATE_USER_WHEN_IMPORT Whether to activate the user automatically when imported. DEACTIVE_USER_IF_NOTFOUND set to \"true\" if you want to deactivate a user when he/she was deleted in AD server. ENABLE_EXTRA_USER_INFO_SYNC Enable synchronization of additional user information, including user's full name, department, and Windows login name, etc."},{"location":"config/ldap_in_pro/#importing-users-without-activating-them","title":"Importing Users without Activating Them","text":"<p>The users imported with the above configuration will be activated by default. For some organizations with large number of users, they may want to import user information (such as user full name) without activating the imported users. Activating all imported users will require licenses for all users in LDAP, which may not be affordable.</p> <p>Seafile provides a combination of options for such use case. You can modify below option in <code>seahub_settings.py</code>:</p> <pre><code>ACTIVATE_USER_WHEN_IMPORT = False\n</code></pre> <p>This prevents Seafile from activating imported users. Then, add below option to <code>seahub_settings.py</code>:</p> <pre><code>ACTIVATE_AFTER_FIRST_LOGIN = True\n</code></pre> <p>This option will automatically activate users when they login to Seafile for the first time.</p>"},{"location":"config/ldap_in_pro/#reactivating-users","title":"Reactivating Users","text":"<p>When you set the <code>DEACTIVE_USER_IF_NOTFOUND</code> option, a user will be deactivated when he/she is not found in LDAP server. By default, even after this user reappears in the LDAP server, it won't be reactivated automatically. This is to prevent auto reactivating a user that was manually deactivated by the system admin.</p> <p>However, sometimes it's desirable to auto reactivate such users. You can modify below option in <code>seahub_settings.py</code>:</p> <pre><code>LDAP_AUTO_REACTIVATE_USERS = True\n</code></pre>"},{"location":"config/ldap_in_pro/#manually-trigger-synchronization","title":"Manually Trigger Synchronization","text":"<p>To test your LDAP sync configuration, you can run the sync command manually.</p> <p>To trigger LDAP sync manually:</p> <pre><code>cd seafile-server-latest\n./pro/pro.py ldapsync\n</code></pre> <p>For Seafile Docker</p> <pre><code>docker exec -it seafile /opt/seafile/seafile-server-latest/pro/pro.py ldapsync\n</code></pre>"},{"location":"config/ldap_in_pro/#setting-up-ldap-group-sync-optional","title":"Setting Up LDAP Group Sync (optional)","text":""},{"location":"config/ldap_in_pro/#how-it-works","title":"How It Works","text":"<p>The importing or syncing process maps groups from LDAP directory server to groups in Seafile's internal database. This process is one-way.</p> <ul> <li> <p>Any changes to groups in the database won't propagate back to LDAP;</p> </li> <li> <p>Any changes to groups in the database, except for \"setting a member as group admin\", will be overwritten in the next LDAP sync operation. If you want to add or delete members, you can only do that on LDAP server.</p> </li> <li> <p>The creator of imported groups will be set to the system admin.</p> </li> </ul> <p>There are two modes of operation:</p> <ul> <li> <p>Periodical: the syncing process will be executed in a fixed interval</p> </li> <li> <p>Manual: there is a script you can run to trigger the syncing once</p> </li> </ul>"},{"location":"config/ldap_in_pro/#configuration","title":"Configuration","text":"<p>Before enabling LDAP group sync, you should have configured LDAP authentication. See Basic LDAP Integration for details.</p> <p>The following are LDAP group sync related options:</p> <pre><code># ldap group sync options.\nENABLE_LDAP_GROUP_SYNC = True            # Whether to enable group sync\nLDAP_GROUP_OBJECT_CLASS = 'group'        # This is the name of the class used to search for group objects.\nLDAP_GROUP_MEMBER_ATTR = 'member'        # The attribute field to use when loading the group's members. \n                                         # For most directory servers, the attributes is \"member\" \n                                         # which is the default value.For \"posixGroup\", it should be set to \"memberUid\".\nLDAP_USER_ATTR_IN_MEMBERUID = 'uid'      # The user attribute set in 'memberUid' option, \n                                         # which is used in \"posixGroup\".The default value is \"uid\".\nLDAP_GROUP_UUID_ATTR = 'objectGUID'      # Used to uniquely identify groups in LDAP\nLDAP_GROUP_FILTER = ''                   # An additional filter to use when searching group objects.\n                                         # If it's set, the final filter used to run search is \"(&amp;(objectClass=GROUP_OBJECT_CLASS)(GROUP_FILTER))\";\n                                         # otherwise the final filter would be \"(objectClass=GROUP_OBJECT_CLASS)\".\nLDAP_USE_GROUP_MEMBER_RANGE_QUERY = False   # When a group contains too many members, \n                                         # AD will only return part of them. Set this option to TRUE\n                                         # to make LDAP sync work with large groups.\nDEL_GROUP_IF_NOT_FOUND = False           # Set to \"true\", sync process will delete the group if not found it in LDAP server.\nLDAP_SYNC_GROUP_AS_DEPARTMENT = False    # Whether to sync groups as top-level departments in Seafile.\n                                         # Learn more about departments in Seafile [here](https://help.seafile.com/sharing_collaboration/departments/).\nLDAP_DEPT_NAME_ATTR = ''                 # Used to get the department name.\n</code></pre> <p>Meaning of some options:</p> variable description ENABLE_LDAP_GROUP_SYNC Whether to enable group sync. LDAP_GROUP_OBJECT_CLASS This is the name of the class used to search for group objects. LDAP_GROUP_MEMBER_ATTR The attribute field to use when loading the group's members. For most directory servers, the attribute is \"member\" which is the default value. For \"posixGroup\", it should be set to \"memberUid\". LDAP_USER_ATTR_IN_MEMBERUID The user attribute set in 'memberUid' option, which is used in \"posixGroup\". The default value is \"uid\". LDAP_GROUP_UUID_ATTR Used to uniquely identify groups in LDAP. LDAP_GROUP_FILTER An additional filter to use when searching group objects. If it's set, the final filter used to run search is <code>(&amp;(objectClass=GROUP_OBJECT_CLASS)(GROUP_FILTER))</code>; otherwise the final filter would be <code>(objectClass=GROUP_OBJECT_CLASS)</code>. LDAP_USER_GROUP_MEMBER_RANGE_QUERY When a group contains too many members, AD will only return part of them. Set this option to TRUE to make LDAP sync work with large groups. DEL_GROUP_IF_NOT_FOUND Set to \"true\", sync process will delete the group if not found in the LDAP server. LDAP_SYNC_GROUP_AS_DEPARTMENT Whether to sync groups as top-level departments in Seafile. Learn more about departments in Seafile here. LDAP_DEPT_NAME_ATTR Used to get the department name. <p>Tip</p> <ul> <li> <p>The search base for groups is the option <code>LDAP_BASE_DN</code>.</p> </li> <li> <p>Some LDAP server, such as Active Directory, allows a group to be a member of another group. This is called \"group nesting\". If we find a nested group B in group A, we should recursively add all the members from group B into group A. And group B should still be imported a separate group. That is, all members of group B are also members in group A.</p> </li> <li> <p>In some LDAP server, such as OpenLDAP, it's common practice to use Posix groups to store group membership. To import Posix groups as Seafile groups, set <code>LDAP_GROUP_OBJECT_CLASS</code> option to <code>posixGroup</code>. A <code>posixGroup</code> object in LDAP usually contains a multi-value attribute for the list of member UIDs. The name of this attribute can be set with the <code>LDAP_GROUP_MEMBER_ATTR</code> option. It's <code>MemberUid</code> by default. The value of the <code>MemberUid</code> attribute is an ID that can be used to identify a user, which corresponds to an attribute in the user object. The name of this ID attribute is usually <code>uid</code>, but can be set via the <code>LDAP_USER_ATTR_IN_MEMBERUID</code> option. Note that <code>posixGroup</code> doesn't support nested groups.</p> </li> </ul>"},{"location":"config/ldap_in_pro/#sync-ou-as-departments","title":"Sync OU as Departments","text":"<p>A department in Seafile is a special group. In addition to what you can do with a group, there are two key new features for departments:</p> <ul> <li> <p>Department supports hierarchy. A department can have any levels of sub-departments.</p> </li> <li> <p>Department can have storage quota.</p> </li> </ul> <p>Seafile supports syncing OU (Organizational Units) from AD/LDAP to departments. The sync process keeps the hierarchical structure of the OUs.</p> <p>Options for syncing departments from OU:</p> <pre><code>LDAP_SYNC_DEPARTMENT_FROM_OU = True      # Whether to enable sync departments from OU.\nLDAP_DEPT_NAME_ATTR = 'description'      # Used to get the department name.\nLDAP_CREATE_DEPARTMENT_LIBRARY = False   # If you decide to sync the group as a department,\n                                         # you can set this option to \"true\". In this way, when \n                                         # the group is synchronized for the first time, a library\n                                         # is automatically created for the department, and the \n                                         # library's name is the department's name.\nLDAP_DEPT_REPO_PERM = 'rw'               # Set the permissions of the department repo, default permission is 'rw'.\nLDAP_DEFAULT_DEPARTMENT_QUOTA = -2       # You can set a default space quota for each department\n                                         # when you synchronize a group for the first time. The \n                                         # quota is set to unlimited if this option is not set.\n                                         # Unit is MB.\nDEL_DEPARTMENT_IF_NOT_FOUND = False      # Set to \"true\", sync process will deleted the department if not found it in LDAP server.\n</code></pre>"},{"location":"config/ldap_in_pro/#periodical-and-manual-sync","title":"Periodical and Manual Sync","text":"<p>Periodical sync won't happen immediately after you restart seafile server. It gets scheduled after the first sync interval. For example if you set sync interval to 30 minutes, the first auto sync will happen after 30 minutes you restarts. To sync immediately, you need to manually trigger it.</p> <p>After the sync is run, you should see log messages like the following in logs/seafevents.log. And you should be able to see the groups in system admin page.</p> <pre><code>[2023-03-30 18:15:05,109] [DEBUG] create group 1, and add dn pair CN=DnsUpdateProxy,CN=Users,DC=Seafile,DC=local&lt;-&gt;1 success.\n[2023-03-30 18:15:05,145] [DEBUG] create group 2, and add dn pair CN=Domain Computers,CN=Users,DC=Seafile,DC=local&lt;-&gt;2 success.\n[2023-03-30 18:15:05,154] [DEBUG] create group 3, and add dn pair CN=Domain Users,CN=Users,DC=Seafile,DC=local&lt;-&gt;3 success.\n[2023-03-30 18:15:05,164] [DEBUG] create group 4, and add dn pair CN=Domain Admins,CN=Users,DC=Seafile,DC=local&lt;-&gt;4 success.\n[2023-03-30 18:15:05,176] [DEBUG] create group 5, and add dn pair CN=RAS and IAS Servers,CN=Users,DC=Seafile,DC=local&lt;-&gt;5 success.\n[2023-03-30 18:15:05,186] [DEBUG] create group 6, and add dn pair CN=Enterprise Admins,CN=Users,DC=Seafile,DC=local&lt;-&gt;6 success.\n[2023-03-30 18:15:05,197] [DEBUG] create group 7, and add dn pair CN=dev,CN=Users,DC=Seafile,DC=local&lt;-&gt;7 success.\n</code></pre> <p>To trigger LDAP sync manually,</p> <pre><code>cd seafile-server-latest\n./pro/pro.py ldapsync\n</code></pre> <p>For Seafile Docker</p> <pre><code>docker exec -it seafile /opt/seafile/seafile-server-latest/pro/pro.py ldapsync\n</code></pre>"},{"location":"config/ldap_in_pro/#advanced-ldap-integration-options","title":"Advanced LDAP Integration Options","text":""},{"location":"config/ldap_in_pro/#multiple-base","title":"Multiple BASE","text":"<p>Multiple base DN is useful when your company has more than one OUs to use Seafile. You can specify a list of base DN in the <code>LDAP_BASE_DN</code> option. The DNs are separated by \";\", e.g.</p> <pre><code>LDAP_BASE_DN = 'ou=developers,dc=example,dc=com;ou=marketing,dc=example,dc=com'\n</code></pre>"},{"location":"config/ldap_in_pro/#additional-search-filter","title":"Additional Search Filter","text":"<p>Search filter is very useful when you have a large organization but only a portion of people want to use Seafile. The filter can be given by setting <code>LDAP_FILTER</code> option. The value of this option follows standard LDAP search filter syntax (https://msdn.microsoft.com/en-us/library/aa746475(v=vs.85).aspx).</p> <p>The final filter used for searching for users is <code>(&amp;($LOGIN_ATTR=*)($LDAP_FILTER))</code>. <code>$LOGIN_ATTR</code> and <code>$LDAP_FILTER</code> will be replaced by your option values.</p> <p>For example, add below option to <code>seahub_settings.py</code>:</p> <pre><code>LDAP_FILTER = 'memberOf=CN=group,CN=developers,DC=example,DC=com'\n</code></pre> <p>The final search filter would be <code>(&amp;(mail=*)(memberOf=CN=group,CN=developers,DC=example,DC=com))</code></p> <p>The case of attribute names in the above example is significant. The <code>memberOf</code> attribute is only available in Active Directory</p>"},{"location":"config/ldap_in_pro/#limiting-seafile-users-to-a-group-in-active-directory","title":"Limiting Seafile Users to a Group in Active Directory","text":"<p>You can use the <code>LDAP_FILTER</code> option to limit user scope to a certain AD group.</p> <ol> <li> <p>First, you should find out the DN for the group. Again, we'll use the <code>dsquery</code> command on the domain controller. For example, if group name is 'seafilegroup', run <code>dsquery group -name seafilegroup</code>.</p> </li> <li> <p>Add below option to <code>seahub_settings.py</code>:</p> </li> </ol> <pre><code>LDAP_FILTER = 'memberOf={output of dsquery command}'\n</code></pre>"},{"location":"config/ldap_in_pro/#using-tls-connection-to-ldap-server","title":"Using TLS connection to LDAP server","text":"<p>If your LDAP service supports TLS connections, you can configure <code>LDAP_SERVER_URL</code> as the access address of the ldaps protocol to use TLS to connect to the LDAP service, for example:</p> <pre><code>LDAP_SERVER_URL = 'ldaps://192.168.0.1:636/'\n</code></pre>"},{"location":"config/ldap_in_pro/#use-paged-results-extension","title":"Use paged results extension","text":"<p>LDAP protocol version 3 supports \"paged results\" (PR) extension. When you have large number of users, this option can greatly improve the performance of listing users. Most directory server nowadays support this extension.</p> <p>In Seafile Pro Edition, add this option to <code>seahub_settings.py</code> to enable PR:</p> <pre><code>LDAP_USE_PAGED_RESULT = True\n</code></pre>"},{"location":"config/ldap_in_pro/#follow-referrals","title":"Follow referrals","text":"<p>Seafile Pro Edition supports auto following referrals in LDAP search. This is useful for partitioned LDAP or AD servers, where users may be spreaded on multiple directory servers. For more information about referrals, you can refer to this article.</p> <p>Note: If you get the error like <code>Invalid credentials</code>, you can try to set the <code>LDAP_FOLLOW_REFERRALS = False</code> to solve the problem:</p> <pre><code>LDAP_FOLLOW_REFERRALS = False\n</code></pre>"},{"location":"config/ldap_in_pro/#configure-multi-ldap-servers","title":"Configure Multi-ldap Servers","text":"<p>Seafile Pro Edition supports multi-ldap servers, you can configure two ldap servers to work with seafile. Multi-ldap servers mean that, when get or search ldap user, it will iterate all configured ldap servers until a match is found; When listing all ldap users, it will iterate all ldap servers to get all users; For Ldap sync it will sync all user/group info in all configured ldap servers to seafile.</p> <p>Currently, only two LDAP servers are supported.</p> <p>If you want to use multi-ldap servers, please replace <code>LDAP</code> in the options with <code>MULTI_LDAP_1</code>, and then add them to <code>seahub_settings.py</code>, for example:</p> <pre><code># Basic config options\nENABLE_LDAP = True\n......\n\n# Multi ldap config options\nENABLE_MULTI_LDAP = True\nMULTI_LDAP_1_SERVER_URL = 'ldap://192.168.0.2'\nMULTI_LDAP_1_BASE_DN = 'ou=test,dc=seafile,dc=top'\nMULTI_LDAP_1_ADMIN_DN = 'administrator@example.top'\nMULTI_LDAP_1_ADMIN_PASSWORD = 'Hello@123'\nMULTI_LDAP_1_PROVIDER = 'ldap1'\nMULTI_LDAP_1_LOGIN_ATTR = 'userPrincipalName'\n\n# Optional configs\nMULTI_LDAP_1_USER_FIRST_NAME_ATTR = 'givenName'\nMULTI_LDAP_1_USER_LAST_NAME_ATTR = 'sn'\nMULTI_LDAP_1_USER_NAME_REVERSE = False\nENABLE_MULTI_LDAP_1_EXTRA_USER_INFO_SYNC = True\n\nMULTI_LDAP_1_FILTER = 'memberOf=CN=testgroup,OU=test,DC=seafile,DC=ren' \nMULTI_LDAP_1_USE_PAGED_RESULT = False\nMULTI_LDAP_1_FOLLOW_REFERRALS = True\nENABLE_MULTI_LDAP_1_USER_SYNC = True\nENABLE_MULTI_LDAP_1_GROUP_SYNC = True\nMULTI_LDAP_1_SYNC_DEPARTMENT_FROM_OU = True\n\nMULTI_LDAP_1_USER_OBJECT_CLASS = 'person'\nMULTI_LDAP_1_DEPT_ATTR = ''\nMULTI_LDAP_1_UID_ATTR = ''\nMULTI_LDAP_1_CONTACT_EMAIL_ATTR = ''\nMULTI_LDAP_1_USER_ROLE_ATTR = ''\nMULTI_LDAP_1_AUTO_REACTIVATE_USERS = True\n\nMULTI_LDAP_1_GROUP_OBJECT_CLASS = 'group'\nMULTI_LDAP_1_GROUP_FILTER = ''\nMULTI_LDAP_1_GROUP_MEMBER_ATTR = 'member'\nMULTI_LDAP_1_GROUP_UUID_ATTR = 'objectGUID'\nMULTI_LDAP_1_CREATE_DEPARTMENT_LIBRARY = False\nMULTI_LDAP_1_DEPT_REPO_PERM = 'rw'\nMULTI_LDAP_1_DEFAULT_DEPARTMENT_QUOTA = -2\nMULTI_LDAP_1_SYNC_GROUP_AS_DEPARTMENT = False\nMULTI_LDAP_1_USE_GROUP_MEMBER_RANGE_QUERY = False\nMULTI_LDAP_1_USER_ATTR_IN_MEMBERUID = 'uid'\nMULTI_LDAP_1_DEPT_NAME_ATTR = ''\n......\n</code></pre> <p>!!! note:     There are still some shared config options are used for all LDAP servers, as follows:</p> <pre><code>```python\n# Common user sync options\nLDAP_SYNC_INTERVAL = 60\nIMPORT_NEW_USER = True                   # Whether to import new users when sync user\nACTIVATE_USER_WHEN_IMPORT = True         # Whether to activate the user when importing new user\nDEACTIVE_USER_IF_NOTFOUND = False        # Set to \"true\" if you want to deactivate a user \n                                        # when he/she was deleted in AD server.\n\n# Common group sync options\nDEL_GROUP_IF_NOT_FOUND = False           # Set to \"true\", sync process will delete the group if not found it in LDAP server.\nDEL_DEPARTMENT_IF_NOT_FOUND = False      # Set to \"true\", sync process will deleted the department if not found it in LDAP server.\n```\n</code></pre>"},{"location":"config/ldap_in_pro/#sso-and-ldap-users-use-the-same-uid","title":"SSO and LDAP users use the same uid","text":"<p>If you sync users from LDAP to Seafile, when the user login via SSO (ADFS or OAuth or Shibboleth), you want Seafile to find the existing account for this user instead of creating a new one, you can set</p> <pre><code>SSO_LDAP_USE_SAME_UID = True\n</code></pre> <p>Here the UID means the unique user ID, in LDAP it is the attribute you use for <code>LDAP_LOGIN_ATTR</code> (not <code>LDAP_UID_ATTR</code>), in ADFS it is <code>uid</code> attribute. You need make sure you use the same attribute for the two settings</p> <p>On this basis, if you only want users to login using SSO and not through LDAP, you can set</p> <pre><code>USE_LDAP_SYNC_ONLY = True\n</code></pre>"},{"location":"config/ldap_in_pro/#importing-roles-from-ldap","title":"Importing Roles from LDAP","text":"<p>Seafile Pro Edition supports syncing roles from LDAP or Active Directory.</p> <p>To enable this feature, add below option to <code>seahub_settings.py</code>, e.g.</p> <pre><code>LDAP_USER_ROLE_ATTR = 'title'\n</code></pre> <p><code>LDAP_USER_ROLE_ATTR</code> is the attribute field to configure roles in LDAP. You can write a custom function to map the role by creating a file <code>seahub_custom_functions.py</code> under conf/ and edit it like:</p> <pre><code># -*- coding: utf-8 -*-\n\n# The AD roles attribute returns a list of roles (role_list).\n# The following function use the first entry in the list.\ndef ldap_role_mapping(role):\n    if 'staff' in role:\n        return 'Staff'\n    if 'guest' in role:\n        return 'Guest'\n    if 'manager' in role:\n        return 'Manager'\n\n# From version 11.0.11-pro, you can define the following function\n# to calculate a role from the role_list.\ndef ldap_role_list_mapping(role_list):\n    if not role_list:\n        return ''\n    for role in role_list:\n        if 'staff' in role:\n            return 'Staff'\n        if 'guest' in role:\n            return 'Guest'\n        if 'manager' in role:\n            return 'Manager'\n</code></pre> <p>You should only define one of the two functions</p> <p>You can rewrite the function (in python) to make your own mapping rules. If the file or function doesn't exist, the first entry in role_list will be synced.</p>"},{"location":"config/multi_institutions/","title":"Multiple Organization/Institution User Management","text":"<p>Starting from version 5.1, you can add institutions into Seafile and assign users into institutions. Each institution can have one or more administrators. This feature is to ease user administration when multiple organizations (universities) share a single Seafile instance. Unlike multi-tenancy, the users are not-isolated. A user from one institution can share files with another institution.</p>"},{"location":"config/multi_institutions/#turn-on-the-feature","title":"Turn on the feature","text":"<p>In <code>seahub_settings.py</code>, add <code>MULTI_INSTITUTION = True</code> to enable multi-institution feature, and add</p> <pre><code>    EXTRA_MIDDLEWARE += (\n        'seahub.institutions.middleware.InstitutionMiddleware',\n    )\n</code></pre> <p>Please replease <code>+=</code> to <code>=</code> if <code>EXTRA_MIDDLEWARE</code> is not defined</p>"},{"location":"config/multi_institutions/#add-institutions-and-institution-admins","title":"Add institutions and institution admins","text":"<p>After restarting Seafile, a system admin can add institutions by adding institution name in admin panel. He can also click into an institution, which will list all users whose <code>profile.institution</code> match the name.</p>"},{"location":"config/multi_institutions/#assign-users-to-institutions","title":"Assign users to institutions","text":"<p>If you are using Shibboleth, you can map a Shibboleth attribute into institution. For example, the following configuration maps organization attribute to institution.</p> <pre><code>SHIBBOLETH_ATTRIBUTE_MAP = {\n    \"givenname\": (False, \"givenname\"),\n    \"sn\": (False, \"surname\"),\n    \"mail\": (False, \"contact_email\"),\n    \"organization\": (False, \"institution\"),\n}\n</code></pre>"},{"location":"config/multi_tenancy/","title":"Multi-Tenancy Support","text":"<p>Multi-tenancy feature is designed for hosting providers that what to host several customers in a single Seafile instance. You can create multi-organizations. Organizations is separated from each other. Users can't share libraries between organizations.</p>"},{"location":"config/multi_tenancy/#seafile-config","title":"Seafile Config","text":""},{"location":"config/multi_tenancy/#seafileconf","title":"seafile.conf","text":"<pre><code>[general]\nmulti_tenancy = true\n</code></pre>"},{"location":"config/multi_tenancy/#seahub_settingspy","title":"seahub_settings.py","text":"<pre><code>CLOUD_MODE = True\nMULTI_TENANCY = True\n\nORG_MEMBER_QUOTA_ENABLED = True\n\nORG_ENABLE_ADMIN_CUSTOM_NAME = True  # Default is True, meaning organization name can be customized\nORG_ENABLE_ADMIN_CUSTOM_LOGO = False  # Default is False, if set to True, organization logo can be customized\n\nENABLE_MULTI_ADFS = True  # Default is False, if set to True, support per organization custom ADFS/SAML2 login\nSAML_ATTRIBUTE_MAPPING = {\n    'name': ('display_name', ),\n    'mail': ('contact_email', ),\n    ...\n}\n</code></pre>"},{"location":"config/multi_tenancy/#usage","title":"Usage","text":"<p>An organization can be created via system admin in \u201cadmin panel-&gt;organization-&gt;Add organization\u201d.</p> <p>Every organization has an URL prefix. This field is for future usage. When a user create an organization, an URL like org1 will be automatically assigned.</p> <p>After creating an organization, the first user will become the admin of that organization. The organization admin can add other users. Note, the system admin can't add users.</p>"},{"location":"config/multi_tenancy/#adfssaml-single-sign-on-integration-in-multi-tenancy","title":"ADFS/SAML single sign-on integration in multi-tenancy","text":""},{"location":"config/multi_tenancy/#preparation-for-adfssaml","title":"Preparation for ADFS/SAML","text":"<p>1) Prepare SP(Seafile) certificate directory and SP certificates:</p> <p>Create sp certs dir</p> <pre><code>$ mkdir -p /opt/seafile-data/seafile/seahub-data/certs\n</code></pre> <p>The SP certificate can be generated by the openssl command, or you can apply to the certificate manufacturer, it is up to you. For example, generate the SP certs using the following command:</p> <pre><code>$ cd /opt/seafile-data/seafile/seahub-data/certs\n$ openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout sp.key -out sp.crt\n</code></pre> <p>The <code>days</code> option indicates the validity period of the generated certificate. The unit is day. The system admin needs to update the certificate regularly</p> <p>Note</p> <p>If certificates are not placed in <code>/opt/seafile-data/seafile/seahub-data/certs</code>, you need to add the following configuration in seahub_settings.py:</p> <pre><code>SAML_CERTS_DIR = '/path/to/certs'\n</code></pre> <p>2) Add the following configuration to seahub_settings.py and then restart Seafile:</p> <pre><code>ENABLE_MULTI_ADFS = True\nSAML_ATTRIBUTE_MAPPING = {\n    'name': ('display_name', ),\n    'mail': ('contact_email', ),\n    ...\n}\n</code></pre>"},{"location":"config/multi_tenancy/#integration-with-adfssaml-single-sign-on","title":"Integration with ADFS/SAML single sign-on","text":"<p>Please refer to this document.</p>"},{"location":"config/oauth/","title":"OAuth Authentication","text":""},{"location":"config/oauth/#oauth","title":"OAuth","text":"<p>Before using OAuth, you should first register an OAuth2 client application on your authorization server, then add some configurations to seahub_settings.py.</p>"},{"location":"config/oauth/#register-an-oauth2-client-application","title":"Register an OAuth2 client application","text":"<p>Here we use Github as an example. First you should register an OAuth2 client application on Github, official document from Github is very detailed.</p>"},{"location":"config/oauth/#configuration","title":"Configuration","text":"<p>Add the folllowing configurations to seahub_settings.py:</p> <pre><code>ENABLE_OAUTH = True\n\n# If create new user when he/she logs in Seafile for the first time, defalut `True`.\nOAUTH_CREATE_UNKNOWN_USER = True\n\n# If active new user when he/she logs in Seafile for the first time, defalut `True`.\nOAUTH_ACTIVATE_USER_AFTER_CREATION = True\n\n# Usually OAuth works through SSL layer. If your server is not parametrized to allow HTTPS, some method will raise an \"oauthlib.oauth2.rfc6749.errors.InsecureTransportError\". Set this to `True` to avoid this error.\nOAUTH_ENABLE_INSECURE_TRANSPORT = True\n\n# Client id/secret generated by authorization server when you register your client application.\nOAUTH_CLIENT_ID = \"your-client-id\"\nOAUTH_CLIENT_SECRET = \"your-client-secret\"\n\n# Callback url when user authentication succeeded. Note, the redirect url you input when you register your client application MUST be exactly the same as this value.\nOAUTH_REDIRECT_URL = 'http{s}://example.com/oauth/callback/'\n\n# The following should NOT be changed if you are using Github as OAuth provider.\nOAUTH_PROVIDER_DOMAIN = 'github.com' \nOAUTH_PROVIDER = 'github.com'\n\nOAUTH_AUTHORIZATION_URL = 'https://github.com/login/oauth/authorize'\nOAUTH_TOKEN_URL = 'https://github.com/login/oauth/access_token'\nOAUTH_USER_INFO_URL = 'https://api.github.com/user'\nOAUTH_SCOPE = [\"user\",]\nOAUTH_ATTRIBUTE_MAP = {\n    \"id\": (True, \"email\"),  # Please keep the 'email' option unchanged to be compatible with the login of users of version 11.0 and earlier.\n    \"name\": (False, \"name\"),\n    \"email\": (False, \"contact_email\"),\n    \"uid\": (True, \"uid\"),   # Seafile v11.0 + \n}\n</code></pre>"},{"location":"config/oauth/#more-explanations-about-the-settings","title":"More explanations about the settings","text":"<p>OAUTH_PROVIDER  /  OAUTH_PROVIDER_DOMAIN</p> <p><code>OAUTH_PROVIDER_DOMAIN</code> will be deprecated, and it can be replaced by <code>OAUTH_PROVIDER</code>. This variable is used in the database to identify third-party providers, either as a domain or as an easy-to-remember string less than 32 characters. </p> <p>OAUTH_ATTRIBUTE_MAP</p> <p>This variables describes which claims from the response of the user info endpoint are to be filled into which attributes of the new Seafile user. The format is showing like below:</p> <pre><code>    OAUTH_ATTRIBUTE_MAP = {\n        &lt;:Attribute in the OAuth provider&gt;: (&lt;:Is required or not in Seafile?&gt;, &lt;:Attribute in Seafile &gt;)\n    }\n</code></pre> <p>If the remote resource server, like Github, uses email to identify an unique user too, Seafile will use Github id directorily, the OAUTH_ATTRIBUTE_MAP setting for Github should be like this:</p> <pre><code>    OAUTH_ATTRIBUTE_MAP = {\n        \"id\": (True, \"email\"), # it is deprecated\n        \"uid / id / username\": (True, \"uid\") \n\n        # extra infos you want to update to Seafile\n        \"name\": (False, \"name\"),\n        \"email\": (False, \"contact_email\"),  \n    }\n</code></pre> <p>The key part <code>id</code> stands for an unique identifier of user in Github, this tells Seafile which attribute remote resoure server uses to indentify its user. The value part <code>True</code> stands for if this field is mandatory by Seafile.</p> <p>Since 11.0 version, Seafile use <code>uid</code> as the external unique identifier of the user. It stores <code>uid</code> in table <code>social_auth_usersocialauth</code> and map it to internal unique identifier used in Seafile. Different OAuth systems have different attributes, which may be: <code>id</code> or <code>uid</code> or <code>username</code>, etc.  And the id/email config <code>id: (True, email)</code>  is deprecated. </p> <p>If you upgrade from a version below 11.0, you need to have both fields configured, i.e., you configuration should be like:</p> <pre><code>    OAUTH_ATTRIBUTE_MAP = {\n        \"id\": (True, \"email\"),\n        \"uid\": (True, \"uid\") ,\n        \"name\": (False, \"name\"),\n        \"email\": (False, \"contact_email\"),  \n    }\n</code></pre> <p>In this way, when a user login, Seafile will first use \"id -&gt; email\" map to find the old user and then create \"uid -&gt; uid\" map for this old user. After all users login once, you can delete the configuration  <code>\"id\": (True, \"email\")</code>.</p> <p>If you use a newly deployed 11.0+ Seafile instance, you don't need the <code>\"id\": (True, \"email\")</code> item. Your configuration should be like:</p> <pre><code>    OAUTH_ATTRIBUTE_MAP = {\n        \"uid\": (True, \"uid\") ,\n        \"name\": (False, \"name\"),\n        \"email\": (False, \"contact_email\"),  \n    }\n</code></pre>"},{"location":"config/oauth/#sample-settings","title":"Sample settings","text":"GoogleGithubGitLabAzure Cloud <pre><code>ENABLE_OAUTH = True\nOAUTH_ENABLE_INSECURE_TRANSPORT = True\n\nOAUTH_CLIENT_ID = \"your-client-id\"\nOAUTH_CLIENT_SECRET = \"your-client-secret\"\nOAUTH_REDIRECT_URL = 'http{s}://example.com/oauth/callback/'\n\n# The following shoud NOT be changed if you are using Google as OAuth provider.\nOAUTH_PROVIDER_DOMAIN = 'google.com'\nOAUTH_AUTHORIZATION_URL = 'https://accounts.google.com/o/oauth2/v2/auth'\nOAUTH_TOKEN_URL = 'https://www.googleapis.com/oauth2/v4/token'\nOAUTH_USER_INFO_URL = 'https://www.googleapis.com/oauth2/v1/userinfo'\nOAUTH_SCOPE = [\n    \"openid\",\n    \"https://www.googleapis.com/auth/userinfo.email\",\n    \"https://www.googleapis.com/auth/userinfo.profile\",\n]\nOAUTH_ATTRIBUTE_MAP = {\n    \"sub\": (True, \"uid\"),\n    \"name\": (False, \"name\"),\n    \"email\": (False, \"contact_email\"),\n}\n</code></pre> <p>Note</p> <p>For Github, <code>email</code> is not the unique identifier for an user, but <code>id</code> is in most cases, so we use <code>id</code> as settings example in our manual. As Seafile uses email to identify an unique user account for now, so we combine <code>id</code> and <code>OAUTH_PROVIDER_DOMAIN</code>, which is github.com in your case, to an email format string and then create this account if not exist.</p> <pre><code>ENABLE_OAUTH = True\nOAUTH_ENABLE_INSECURE_TRANSPORT = True\n\nOAUTH_CLIENT_ID = \"your-client-id\"\nOAUTH_CLIENT_SECRET = \"your-client-secret\"\nOAUTH_REDIRECT_URL = 'http{s}://example.com/oauth/callback/'\n\nOAUTH_PROVIDER_DOMAIN = 'github.com'\nOAUTH_AUTHORIZATION_URL = 'https://github.com/login/oauth/authorize'\nOAUTH_TOKEN_URL = 'https://github.com/login/oauth/access_token'\nOAUTH_USER_INFO_URL = 'https://api.github.com/user'\nOAUTH_SCOPE = [\"user\",]\nOAUTH_ATTRIBUTE_MAP = {\n    \"id\": (True, 'uid'),\n    \"email\": (False, \"contact_email\"),\n    \"name\": (False, \"name\"),\n}\n</code></pre> <p>Note</p> <p>To enable OAuth via GitLab. Create an application in GitLab (under Admin area-&gt;Applications).</p> <p>Fill in required fields:</p> <ul> <li> <p>Name: a name you specify</p> </li> <li> <p>Redirect URI: The callback url see below <code>OAUTH_REDIRECT_URL</code></p> </li> <li> <p>Trusted: Skip confirmation dialog page. Select this to not ask the user if he wants to authorize seafile to receive access to his/her account data.</p> </li> <li> <p>Scopes: Select <code>openid</code> and <code>read_user</code> in the scopes list.</p> </li> </ul> <p>Press submit and copy the client id and secret you receive on the confirmation page and use them in this template for your seahub_settings.py</p> <pre><code>ENABLE_OAUTH = True\nOAUTH_CLIENT_ID = \"your-client-id\"\nOAUTH_CLIENT_SECRET = \"your-client-secret\"\nOAUTH_REDIRECT_URL = \"https://your-seafile/oauth/callback/\"\n\nOAUTH_PROVIDER_DOMAIN = 'your-domain'\nOAUTH_AUTHORIZATION_URL = 'https://gitlab.your-domain/oauth/authorize'\nOAUTH_TOKEN_URL = 'https://gitlab.your-domain/oauth/token'\nOAUTH_USER_INFO_URL = 'https://gitlab.your-domain/api/v4/user'\nOAUTH_SCOPE = [\"openid\", \"read_user\"]\nOAUTH_ATTRIBUTE_MAP = {\n    \"email\": (True, \"uid\"),\n    \"name\": (False, \"name\")\n}\n</code></pre> <p>Note</p> <p>For users of Azure Cloud, as there is no <code>id</code> field returned from Azure Cloud's user info endpoint, so we use a special configuration for <code>OAUTH_ATTRIBUTE_MAP</code> setting (others are the same as Github/Google). Please see this tutorial for the complete deployment process of OAuth against Azure Cloud.</p> <pre><code>OAUTH_ATTRIBUTE_MAP = {\n    \"email\": (True, \"uid\"),\n    \"name\": (False, \"name\")\n}\n</code></pre>"},{"location":"config/ocm/","title":"Open Cloud Mesh","text":"<p>From 8.0.0, Seafile supports OCM protocol. With OCM, user can share library to other server which enabled OCM too.</p> <p>Seafile currently supports sharing between Seafile servers with version greater than 8.0, and sharing from NextCloud to Seafile since 9.0.</p> <p>These two functions cannot be enabled at the same time</p>"},{"location":"config/ocm/#configuration","title":"Configuration","text":"<p>Add the following configuration to <code>seahub_settings.py</code>.</p> Sharing between Seafile serversSharing from NextCloud to Seafile <pre><code># Enable OCM\nENABLE_OCM = True\nOCM_PROVIDER_ID = '71687320-6219-47af-82f3-32012707a5ae' # the unique id of this server\nOCM_REMOTE_SERVERS = [\n    {\n        \"server_name\": \"dev\",\n        \"server_url\": \"https://seafile-domain-1/\", # should end with '/'\n    },\n    {\n        \"server_name\": \"download\",\n        \"server_url\": \"https://seafile-domain-2/\", # should end with '/'\n    },\n]\n</code></pre> <pre><code># Enable OCM\nENABLE_OCM_VIA_WEBDAV = True\nOCM_PROVIDER_ID = '71687320-6219-47af-82f3-32012707a5ae' # the unique id of this server\nOCM_REMOTE_SERVERS = [\n    {\n        \"server_name\": \"nextcloud\",\n        \"server_url\": \"https://nextcloud-domain-1/\", # should end with '/'\n    }\n]\n</code></pre> <p>OCM_REMOTE_SERVERS is a list of servers that you allow your users to share libraries with</p>"},{"location":"config/ocm/#usage","title":"Usage","text":""},{"location":"config/ocm/#share-library-to-other-server","title":"Share library to other server","text":"<p>In the library sharing dialog jump to \"Share to other server\", you can share this library to users of another server with \"Read-Only\" or \"Read-Write\" permission. You can also view shared records and cancel sharing. </p>"},{"location":"config/ocm/#view-be-shared-libraries","title":"View be shared libraries","text":"<p>You can jump to \"Shared from other servers\" page to view the libraries shared by other servers and cancel the sharing. </p> <p>And enter the library to view, download or upload files. </p>"},{"location":"config/remote_user/","title":"SSO using Remote User","text":"<p>Starting from 7.0.0, Seafile can integrate with various Single Sign On systems via a proxy server. Examples include Apache as Shibboleth proxy, or LemonLdap as a proxy to LDAP servers, or Apache as Kerberos proxy. Seafile can retrieve user information from special request headers (HTTP_REMOTE_USER, HTTP_X_AUTH_USER, etc.) set by the proxy servers.</p> <p>After the proxy server (Apache/Nginx) is successfully authenticated, the user information is set to the request header, and Seafile creates and logs in the user based on this information.</p> <p>Make sure that the proxy server has a corresponding security mechanism to protect against forgery request header attacks</p> <p>Please add the following settings to <code>conf/seahub_settings.py</code> to enable this feature.</p> <pre><code>ENABLE_REMOTE_USER_AUTHENTICATION = True\n\n# Optional, HTTP header, which is configured in your web server conf file,\n# used for Seafile to get user's unique id, default value is 'HTTP_REMOTE_USER'.\nREMOTE_USER_HEADER = 'HTTP_REMOTE_USER'\n\n# Optional, when the value of HTTP_REMOTE_USER is not a valid email address\uff0c\n# Seafile will build a email-like unique id from the value of 'REMOTE_USER_HEADER'\n# and this domain, e.g. user1@example.com.\nREMOTE_USER_DOMAIN = 'example.com'\n\n# Optional, whether to create new user in Seafile system, default value is True.\n# If this setting is disabled, users doesn't preexist in the Seafile DB cannot login.\n# The admin has to first import the users from external systems like LDAP.\nREMOTE_USER_CREATE_UNKNOWN_USER = True\n\n# Optional, whether to activate new user in Seafile system, default value is True.\n# If this setting is disabled, user will be unable to login by default.\n# the administrator needs to manually activate this user.\nREMOTE_USER_ACTIVATE_USER_AFTER_CREATION = True\n\n# Optional, map user attribute in HTTP header and Seafile's user attribute.\nREMOTE_USER_ATTRIBUTE_MAP = {\n    'HTTP_DISPLAYNAME': 'name',\n    'HTTP_MAIL': 'contact_email',\n\n    # for user info\n    \"HTTP_GIVENNAME\": 'givenname',\n    \"HTTP_SN\": 'surname',\n    \"HTTP_ORGANIZATION\": 'institution',\n\n    # for user role\n    'HTTP_SHIBBOLETH_AFFILIATION': 'affiliation',\n}\n\n# Map affiliation to user role. Though the config name is SHIBBOLETH_AFFILIATION_ROLE_MAP,\n# it is not restricted to Shibboleth\nSHIBBOLETH_AFFILIATION_ROLE_MAP = {\n    'employee@uni-mainz.de': 'staff',\n    'member@uni-mainz.de': 'staff',\n    'student@uni-mainz.de': 'student',\n    'employee@hu-berlin.de': 'guest',\n    'patterns': (\n        ('*@hu-berlin.de', 'guest1'),\n        ('*@*.de', 'guest2'),\n        ('*', 'guest'),\n    ),\n}\n</code></pre> <p>Then restart Seafile.</p>"},{"location":"config/roles_permissions/","title":"Roles and Permissions Support","text":"<p>You can add/edit roles and permission for users. A role is just a group of users with some pre-defined permissions, you can toggle user roles in user list page at admin panel. For most permissions, the meaning can be easily obtained from the variable name. The following is a further detailed introduction to some variables.</p> <ul> <li> <p><code>role_quota</code> is used to set quota for a certain role of users. For example, we can set the quota of employee to 100G by adding <code>'role_quota': '100g'</code>, and leave other role of users to the default quota.</p> <p>After set <code>role_quote</code>, it will take affect once a user with such a role login into Seafile. You can also manually change <code>seafile-db.RoleQuota</code>, if you want to see the effect immediately.</p> </li> <li> <p><code>can_add_public_repo</code> is to set whether a role can create a public library (shared by all login users), default is <code>False</code>. </p> <p>Since version 11.0.9 pro, <code>can_share_repo</code> is added to limit users' ability to share a library</p> <p>The <code>can_add_public_repo</code> option will not take effect if you configure global <code>CLOUD_MODE = True</code></p> </li> <li> <p><code>can_create_wiki</code> and <code>can_publish_wiki</code> are used to control whether a role can create a Wiki and publish a Wiki. (A published Wiki have a special URL and can be visited by anonymous users)</p> </li> <li> <p><code>storage_ids</code> permission is used for assigning storage backends to users with specific role. More details can be found in multiple storage backends.</p> </li> <li> <p><code>upload_rate_limit</code> and <code>download_rate_limit</code> are added to limit upload and download speed for users with different roles.</p> <p>Note</p> <p>After configured the rate limit, run the following command in the <code>seafile-server-latest</code> directory to make the configuration take effect:</p> <pre><code>./seahub.sh python-env python3 seahub/manage.py set_user_role_upload_download_rate_limit\n</code></pre> </li> <li> <p><code>can_drag_drop_folder_to_sync</code>: allow or deny user to sync folder by draging and droping</p> </li> <li> <p><code>can_export_files_via_mobile_client</code>: allow or deny user to export files in using mobile client</p> </li> </ul> <p>Seafile comes with two build-in roles <code>default</code> and <code>guest</code>, a default user is a normal user with permissions as followings:</p> <pre><code>    'default': {\n        'can_add_repo': True,\n        'can_share_repo': True,\n        'can_add_group': True,\n        'can_view_org': True,\n        'can_add_public_repo': False,\n        'can_use_global_address_book': True,\n        'can_generate_share_link': True,\n        'can_generate_upload_link': True,\n        'can_send_share_link_mail': True,\n        'can_invite_guest': False,\n        'can_drag_drop_folder_to_sync': True,\n        'can_connect_with_android_clients': True,\n        'can_connect_with_ios_clients': True,\n        'can_connect_with_desktop_clients': True,\n        'can_export_files_via_mobile_client': True,\n        'storage_ids': [],\n        'role_quota': '',\n        'can_create_wiki': True,\n        'can_publish_wiki': True,\n        'upload_rate_limit': 0,  # unit: kb/s\n        'download_rate_limit': 0,\n        'monthly_rate_limit': '',\n        'monthly_rate_limit_per_user': '',\n        'can_choose_office_suite': True,\n        'monthly_ai_credit_per_user': -1,\n        'can_use_sso_in_multi_tenancy': True,\n    },\n</code></pre> <p>While a guest user can only read files/folders in the system, here are the permissions for a guest user:</p> <pre><code>    'guest': {\n        'can_add_repo': False,\n        'can_share_repo': False,\n        'can_add_group': False,\n        'can_view_org': False,\n        'can_add_public_repo': False,\n        'can_use_global_address_book': False,\n        'can_generate_share_link': False,\n        'can_generate_upload_link': False,\n        'can_send_share_link_mail': False,\n        'can_invite_guest': False,\n        'can_drag_drop_folder_to_sync': False,\n        'can_connect_with_android_clients': False,\n        'can_connect_with_ios_clients': False,\n        'can_connect_with_desktop_clients': False,\n        'can_export_files_via_mobile_client': False,\n        'storage_ids': [],\n        'role_quota': '',\n        'can_create_wiki': False,\n        'can_publish_wiki': False,\n        'upload_rate_limit': 0,\n        'download_rate_limit': 0,\n        'monthly_rate_limit': '',\n        'monthly_rate_limit_per_user': '',\n        'can_choose_office_suite': False,\n        'can_use_sso_in_multi_tenancy': False,\n    },\n</code></pre>"},{"location":"config/roles_permissions/#edit-build-in-roles","title":"Edit build-in roles","text":"<p>If you want to edit the permissions of build-in roles, e.g. default users can invite guest, guest users can view repos in organization, you can add following lines to <code>seahub_settings.py</code> with corresponding permissions set to <code>True</code>.</p> <pre><code>ENABLED_ROLE_PERMISSIONS = {\n    'default': {\n        'can_add_repo': True,\n        'can_share_repo': True,\n        'can_add_group': True,\n        'can_view_org': True,\n        'can_add_public_repo': False,\n        'can_use_global_address_book': True,\n        'can_generate_share_link': True,\n        'can_generate_upload_link': True,\n        'can_send_share_link_mail': True,\n        'can_invite_guest': False,\n        'can_drag_drop_folder_to_sync': True,\n        'can_connect_with_android_clients': True,\n        'can_connect_with_ios_clients': True,\n        'can_connect_with_desktop_clients': True,\n        'can_export_files_via_mobile_client': True,\n        'storage_ids': [],\n        'role_quota': '',\n        'can_create_wiki': True,\n        'can_publish_wiki': True,\n        'upload_rate_limit': 2000,  # unit: kb/s\n        'download_rate_limit': 4000,\n        'monthly_rate_limit': '',\n        'monthly_rate_limit_per_user': '',\n        'can_choose_office_suite': True,\n        'monthly_ai_credit_per_user': -1,\n        'can_use_sso_in_multi_tenancy': True,\n    },\n    'guest': {\n        'can_add_repo': False,\n        'can_share_repo': False,\n        'can_add_group': False,\n        'can_view_org': False,\n        'can_add_public_repo': False,\n        'can_use_global_address_book': False,\n        'can_generate_share_link': False,\n        'can_generate_upload_link': False,\n        'can_send_share_link_mail': False,\n        'can_invite_guest': False,\n        'can_drag_drop_folder_to_sync': False,\n        'can_connect_with_android_clients': False,\n        'can_connect_with_ios_clients': False,\n        'can_connect_with_desktop_clients': False,\n        'can_export_files_via_mobile_client': False,\n        'storage_ids': [],\n        'role_quota': '',\n        'can_create_wiki': False,\n        'can_publish_wiki': False,\n        'upload_rate_limit': 100,\n        'download_rate_limit': 200,\n        'monthly_rate_limit': '',\n        'monthly_rate_limit_per_user': '',\n        'can_choose_office_suite': False,\n        'can_use_sso_in_multi_tenancy': False,\n    }\n}\n</code></pre>"},{"location":"config/roles_permissions/#more-about-guest-invitation-feature","title":"More about guest invitation feature","text":"<p>An user who has <code>can_invite_guest</code> permission can invite people outside of the organization as guest.</p> <p>In order to use this feature, in addition to granting <code>can_invite_guest</code> permission to the user, add the  following line to <code>seahub_settings.py</code>,</p> <pre><code>ENABLE_GUEST_INVITATION = True\n\n# invitation expire time\nINVITATIONS_TOKEN_AGE = 72 # hours\n</code></pre> <p>After restarting, users who have <code>can_invite_guest</code> permission will see \"Invite People\" section at sidebar of home page.</p> <p>Users can invite a guest user by providing his/her email address, system will email the invite link to the user.</p> <p>Tip</p> <p>If you want to block certain email addresses for the invitation, you can define a blacklist, e.g.</p> <pre><code>INVITATION_ACCEPTER_BLACKLIST = [\"a@a.com\", \"*@a-a-a.com\", r\".*@(foo|bar).com\", ]\n</code></pre> <p>After that, email address \"a@a.com\", any email address ends with \"@a-a-a.com\" and any email address ends with \"@foo.com\" or \"@bar.com\" will not be allowed.</p>"},{"location":"config/roles_permissions/#add-custom-roles","title":"Add custom roles","text":"<p>If you want to add a new role and assign some users with this role, e.g. new role <code>employee</code> can invite guest and can create public library and have all other permissions a default user has, you can add following lines to <code>seahub_settings.py</code></p> <pre><code>ENABLED_ROLE_PERMISSIONS = {\n    'default': {\n        'can_add_repo': True,\n        'can_share_repo': True,\n        'can_add_group': True,\n        'can_view_org': True,\n        'can_add_public_repo': False,\n        'can_use_global_address_book': True,\n        'can_generate_share_link': True,\n        'can_generate_upload_link': True,\n        'can_send_share_link_mail': True,\n        'can_invite_guest': False,\n        'can_drag_drop_folder_to_sync': True,\n        'can_connect_with_android_clients': True,\n        'can_connect_with_ios_clients': True,\n        'can_connect_with_desktop_clients': True,\n        'can_export_files_via_mobile_client': True,\n        'storage_ids': [],\n        'role_quota': '',\n        'can_create_wiki': True,\n        'can_publish_wiki': True,\n        'upload_rate_limit': 2000,  # unit: kb/s\n        'download_rate_limit': 4000,\n        'monthly_rate_limit': '',\n        'monthly_rate_limit_per_user': '',\n        'can_choose_office_suite': True,\n        'monthly_ai_credit_per_user': -1,\n        'can_use_sso_in_multi_tenancy': True,\n    },\n    'guest': {\n        'can_add_repo': False,\n        'can_share_repo': False,\n        'can_add_group': False,\n        'can_view_org': False,\n        'can_add_public_repo': False,\n        'can_use_global_address_book': False,\n        'can_generate_share_link': False,\n        'can_generate_upload_link': False,\n        'can_send_share_link_mail': False,\n        'can_invite_guest': False,\n        'can_drag_drop_folder_to_sync': False,\n        'can_connect_with_android_clients': False,\n        'can_connect_with_ios_clients': False,\n        'can_connect_with_desktop_clients': False,\n        'can_export_files_via_mobile_client': False,\n        'storage_ids': [],\n        'role_quota': '',\n        'can_create_wiki': False,\n        'can_publish_wiki': False,\n        'upload_rate_limit': 100,\n        'download_rate_limit': 200,\n        'monthly_rate_limit': '',\n        'monthly_rate_limit_per_user': '',\n        'can_choose_office_suite': False,\n        'can_use_sso_in_multi_tenancy': False,\n    },\n    'employee': {\n        'can_add_repo': True,\n        'can_share_repo': True,\n        'can_add_group': True,\n        'can_view_org': True,\n        'can_add_public_repo': True,\n        'can_use_global_address_book': True,\n        'can_generate_share_link': True,\n        'can_generate_upload_link': True,\n        'can_send_share_link_mail': True,\n        'can_invite_guest': True,\n        'can_drag_drop_folder_to_sync': True,\n        'can_connect_with_android_clients': True,\n        'can_connect_with_ios_clients': True,\n        'can_connect_with_desktop_clients': True,\n        'can_export_files_via_mobile_client': True,\n        'storage_ids': [],\n        'role_quota': '',\n        'can_create_wiki': True,\n        'can_publish_wiki': True,\n        'upload_rate_limit': 500,\n        'download_rate_limit': 800,\n        'monthly_rate_limit': '',\n        'monthly_rate_limit_per_user': '',\n        'can_choose_office_suite': True,\n        'monthly_ai_credit_per_user': -1, \n        'can_use_sso_in_multi_tenancy': True,\n    },\n}\n</code></pre>"},{"location":"config/saml2/","title":"SAML 2.0 Authentication","text":"<p>In this document, we use Microsoft Azure SAML single sign-on app and Microsoft on-premise ADFS to show how Seafile integrate SAML 2.0. Other SAML 2.0 provider should be similar.</p>"},{"location":"config/saml2/#preparations-for-saml-20","title":"Preparations for SAML 2.0","text":"<p>First, install xmlsec1 package:</p> <pre><code>$ apt update\n$ apt install xmlsec1\n$ apt install dnsutils  # For multi-tenancy feature\n</code></pre> <p>Second, prepare SP(Seafile) certificate directory and SP certificates:</p> <p>Create certs dir</p> <pre><code>$ mkdir -p /opt/seafile/seahub-data/certs\n</code></pre> <p>The SP certificate can be generated by the openssl command, or you can apply to the certificate manufacturer, it is up to you. For example, generate the SP certs using the following command:</p> <pre><code>$ cd /opt/seafile/seahub-data/certs\n$ openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout sp.key -out sp.crt\n</code></pre> <p>The <code>days</code> option indicates the validity period of the generated certificate. The unit is day. The system admin needs to update the certificate regularly</p>"},{"location":"config/saml2/#integration-with-adfssaml-single-sign-on","title":"Integration with ADFS/SAML single sign-on","text":""},{"location":"config/saml2/#microsoft-azure-saml-single-sign-on-app","title":"Microsoft Azure SAML single sign-on app","text":"<p>If you use Microsoft Azure SAML app to achieve single sign-on, please follow the steps below:</p> <p>First, add SAML single sign-on app and assign users, refer to: add an Azure AD SAML application, create and assign users.</p> <p>Second, setup the Identifier, Reply URL, and Sign on URL of the SAML app based on your service URL, refer to: enable single sign-on for saml app. The format of the Identifier, Reply URL, and Sign on URL are: https://example.com/saml2/metadata/, https://example.com/saml2/acs/, https://example.com/, e.g.:</p> <p></p> <p>Next, edit saml attributes &amp; claims. Keep the default attributes &amp; claims of SAML app unchanged, the uid attribute must be added, the mail and name attributes are optional, e.g.:</p> <p></p> <p>Next, download the base64 format SAML app's certificate and rename to idp.crt:</p> <p></p> <p>and put it under the certs directory(<code>/opt/seafile/seahub-data/certs</code>).</p> <p>Next, copy the metadata URL of the SAML app:</p> <p></p> <p>and paste it into the <code>SAML_REMOTE_METADATA_URL</code> option in seahub_settings.py, e.g.:</p> <pre><code>SAML_REMOTE_METADATA_URL = 'https://login.microsoftonline.com/xxx/federationmetadata/2007-06/federationmetadata.xml?appid=xxx'   # copy from SAML app\n</code></pre> <p>Next, add <code>ENABLE_ADFS_LOGIN</code>, <code>LOGIN_REDIRECT_URL</code> and <code>SAML_ATTRIBUTE_MAPPING</code> options to seahub_settings.py, and then restart Seafile, e.g:</p> <pre><code>ENABLE_ADFS_LOGIN = True\nSAML_ATTRIBUTE_MAPPING = {\n    'name': ('display_name', ),\n    'mail': ('contact_email', ),\n    'seafile_groups': ('', ), # Optional, set this attribute if you need to synchronize groups/departments.\n    ...\n\n}\nSAML_REMOTE_METADATA_URL = 'https://login.microsoftonline.com/xxx/federationmetadata/2007-06/federationmetadata.xml?appid=xxx'   # copy from SAML app\n</code></pre> <p>Note</p> <ul> <li>If the xmlsec1 binary is not located in <code>/usr/bin/xmlsec1</code>, you need to add the following configuration in seahub_settings.py:</li> </ul> <pre><code>SAML_XMLSEC_BINARY_PATH = '/path/to/xmlsec1'\n</code></pre> <p>View where the xmlsec1 binary is located:</p> <pre><code>$ which xmlsec1\n</code></pre> <ul> <li>If certificates are not placed in <code>/opt/seafile/seahub-data/certs</code>, you need to add the following configuration in seahub_settings.py:</li> </ul> <pre><code>SAML_CERTS_DIR = '/path/to/certs'\n</code></pre> <p>Finally, open the browser and enter the Seafile login page, click <code>Single Sign-On</code>, and use the user assigned to SAML app to perform a SAML login test.</p>"},{"location":"config/saml2/#on-premise-adfs","title":"On-premise ADFS","text":"<p>If you use Microsoft ADFS to achieve single sign-on, please follow the steps below:</p> <p>First, please make sure the following preparations are done:</p> <ol> <li> <p>A Windows Server with ADFS installed. For configuring and installing ADFS you can see this article.</p> </li> <li> <p>A valid SSL certificate for ADFS server, and here we use <code>temp.adfs.com</code> as the domain name example.</p> </li> <li> <p>A valid SSL certificate for Seafile server, and here we use <code>demo.seafile.com</code> as the domain name example.</p> </li> </ol> <p>Second, download the base64 format certificate and upload it:</p> <ul> <li> <p>Navigate to the AD FS management window. In the left sidebar menu, navigate to Services &gt; Certificates. </p> </li> <li> <p>Locate the Token-signing certificate. Right-click the certificate and select View Certificate.</p> </li> </ul> <p></p> <ul> <li> <p>In the dialog box, select the Details tab.</p> </li> <li> <p>Click Copy to File.</p> </li> <li> <p>In the Certificate Export Wizard that opens, click Next.</p> </li> <li> <p>Select Base-64 encoded X.509 (.CER), then click Next.</p> </li> <li> <p>Named it idp.crt, then click Next.</p> </li> <li> <p>Click Finish to complete the download.</p> </li> <li> <p>And then put it under the certs directory(<code>/opt/seafile/seahub-data/certs</code>).</p> </li> </ul> <p>Next, add the following configurations to seahub_settings.py and then restart Seafile:</p> <pre><code>ENABLE_ADFS_LOGIN = True\nSAML_ATTRIBUTE_MAPPING = {\n    'name': ('display_name', ),\n    'mail': ('contact_email', ),\n    'seafile_groups': ('', ), # Optional, set this attribute if you need to synchronize groups/departments.\n    ...\n}\nSAML_REMOTE_METADATA_URL = 'https://temp.adfs.com/federationmetadata/2007-06/federationmetadata.xml'   # The format of the ADFS federation metadata URL is: `https://{your ADFS domain name}/federationmetadata/2007-06/federationmetadata.xml`\n</code></pre> <p>Next, add relying party trust:</p> <ul> <li> <p>Log into the ADFS server and open the ADFS management.</p> </li> <li> <p>Under Actions, click Add Relying Party Trust.</p> </li> <li> <p>On the Welcome page, choose Claims aware and click Start.</p> </li> <li> <p>Select Import data about the relying party published online or on a local network, type your metadate url in Federation metadata address (host name or URL), and then click Next. Your metadate url format is: <code>https://example.com/saml2/metadata/</code>, e.g.:</p> </li> </ul> <p></p> <ul> <li> <p>On the Specify Display Name page type a name in Display name, e.g. <code>Seafile</code>, under Notes type a description for this relying party trust, and then click Next.</p> </li> <li> <p>In the Choose an access control policy window, select Permit everyone, then click Next.</p> </li> <li> <p>Review your settings, then click Next. </p> </li> <li> <p>Click Close. </p> </li> </ul> <p>Next, create claims rules:</p> <ul> <li> <p>Open the ADFS management, click Relying Party Trusts.</p> </li> <li> <p>Right-click your trust, and then click Edit Claim Issuance Policy.</p> </li> <li> <p>On the Issuance Transform Rules tab click Add Rules.</p> </li> <li> <p>Click the Claim rule template dropdown menu and select Send LDAP Attributes as Claims, and then click Next. </p> </li> <li> <p>In the Claim rule name field, type the display name for this rule, such as Seafile Claim rule. Click the Attribute store dropdown menu and select Active Directory. In the LDAP Attribute column, click the dropdown menu and select User-Principal-Name. In the Outgoing Claim Type column, click the dropdown menu and select UPN. And then click Finish.</p> </li> <li> <p>Click Add Rule again. </p> </li> <li> <p>Click the Claim rule template dropdown menu and select Transform an Incoming Claim, and then click Next. </p> </li> <li> <p>In the Claim rule name field, type the display name for this rule, such as UPN to Name ID. Click the Incoming claim type dropdown menu and select UPN(It must match the Outgoing Claim Type in rule <code>Seafile Claim rule</code>). Click the Outgoing claim type dropdown menu and select Name ID. Click the Outgoing name ID format dropdown menu and select Email. And then click Finish.</p> </li> <li> <p>Click OK to add both new rules.</p> </li> </ul> <p>When creating claims rule, you can also select other LDAP Attributes, such as E-Mail-Addresses, depending on your ADFS service</p> <p>Finally, open the browser and enter the Seafile login page, click <code>Single Sign-On</code> to perform ADFS login test.</p>"},{"location":"config/seafevents-conf/","title":"Configurable Options","text":"<p>In the file <code>seafevents.conf</code>:</p> <pre><code>[STATISTICS]\n## must be \"true\" to enable statistics\nenabled = true\n\n[SEAHUB EMAIL]\n## must be \"true\" to enable user email notifications when there are new unread notifications\nenabled = true\n\n## interval of sending Seahub email. Can be s(seconds), m(minutes), h(hours), d(days)\ninterval = 30m\n\n[FILE HISTORY]\nenabled = true\nthreshold = 5\nsuffix = md,txt,...\n\n## From seafile 7.0.0\n## Recording file history to database for fast access is enabled by default for 'Markdown, .txt, ppt, pptx, doc, docx, xls, xlsx'. \n## After enable the feature, the old histories version for markdown, doc, docx files will not be list in the history page.\n## (Only new histories that stored in database will be listed) But the users can still access the old versions in the library snapshots.\n## For file types not listed in the suffix , histories version will be scanned from the library history as before.\n## The feature default is enable. You can set the 'enabled = false' to disable the feature.\n\n## The 'threshold' is the time threshold for recording the historical version of a file, in minutes, the default is 5 minutes. \n## This means that if the interval between two adjacent file saves is less than 5 minutes, the two file changes will be merged and recorded as a historical version. \n## When set to 0, there is no time limit, which means that each save will generate a separate historical version.\n\n## If you need to modify the file list format, you can add 'suffix = md, txt, ...' configuration items to achieve.\n</code></pre>"},{"location":"config/seafevents-conf/#the-following-configurations-for-pro-edition-only","title":"The following configurations for Pro Edition only","text":"<pre><code>[AUDIT]\n## Audit log is disabled default.\n## Leads to additional SQL tables being filled up, make sure your SQL server is able to handle it.\nenabled = true\n\n[INDEX FILES]\n## must be \"true\" to enable search\nenabled = true\n\n## The interval the search index is updated. Can be s(seconds), m(minutes), h(hours), d(days)\ninterval=10m\n\n## From Seafile 6.3.0 pro, in order to speed up the full-text search speed, you should setup\nhighlight = fvh\n\n## If true, indexes the contents of office/pdf files while updating search index\n## Note: If you change this option from \"false\" to \"true\", then you need to clear the search index and update the index again.\n## Refer to file search manual for details.\nindex_office_pdf=false\n\n## The default size limit for doc, docx, ppt, pptx, xls, xlsx and pdf files. Files larger than this will not be indexed.\n## Since version 6.2.0\n## Unit: MB\noffice_file_size_limit = 10\n\n## From 9.0.7 pro, Seafile supports connecting to Elasticsearch through username and password, you need to configure username and password for the Elasticsearch server\nusername = elastic           # username to connect to Elasticsearch\npassword = elastic_password  # password to connect to Elasticsearch\n\n## From 9.0.7 pro, Seafile supports connecting to elasticsearch via HTTPS, you need to configure HTTPS for the Elasticsearch server\nscheme = https               # The default is http. If the Elasticsearch server is not configured with HTTPS, the scheme and cafile do not need to be configured\ncafile = path/to/cert.pem    # The certificate path for user authentication. If the Elasticsearch server does not enable certificate authentication, do not need to be configured\n\n## From version 11.0.5 Pro, you can custom ElasticSearch index names for distinct instances when intergrating multiple Seafile servers to a single ElasticSearch Server.\nrepo_status_index_name = your-repo-status-index-name  # default is `repo_head`\nrepo_files_index_name = your-repo-files-index-name    # default is `repofiles`\n\n## The default loglevel is `warning`.\n## Since version 11.0.4\nloglevel = info\n\n[EVENTS PUBLISH]\n## must be \"true\" to enable publish events messages\nenabled = false\n## message format: repo-update\\t{{repo_id}}}\\t{{commit_id}}\n## Currently only support redis message queue\nmq_type = redis\n\n[AUTO DELETION]\nenabled = true     # Default is false, when enabled, users can use file auto deletion feature\ninterval = 86400   # The unit is second(s), the default frequency is one day, that is, it runs once a day\n\n[SEASEARCH]\nenabled = true # Default is false, when enabled, seafile can use SeaSearch as the search engine\nseasearch_url = http://seasearch:4080 # If your SeaSearch server deploy on another machine, replace it to the truth address\nseasearch_token = &lt;your auth token&gt; # base64 code consist of `username:password`\ninterval = 10m # The interval the search index is updated. Can be s(seconds), m(minutes), h(hours), d(days)\n</code></pre>"},{"location":"config/seafile-conf/","title":"Seafile.conf settings","text":"<p>Important</p> <p>Every entry in this configuration file is case-sensitive.</p> <p>You need to restart Seafile docker image so that your changes take effect.</p>"},{"location":"config/seafile-conf/#storage-quota-setting","title":"Storage Quota Setting","text":"<p>You may set a default quota (e.g. 2GB) for all users. To do this, just add the following lines to <code>seafile.conf</code> file</p> <pre><code>[quota]\n# default user quota in GB, integer only\ndefault = 2\n</code></pre> <p>This setting applies to all users. If you want to set quota for a specific user, you may log in to seahub website as administrator, then set it in \"System Admin\" page.</p> <p>Since Pro 10.0.9 version, you can set the maximum number of files allowed in a library, and when this limit is exceeded, files cannot be uploaded to this library. There is no limit by default.</p> <pre><code>[quota]\nlibrary_file_limit = 100000\n</code></pre>"},{"location":"config/seafile-conf/#default-history-length-limit","title":"Default history length limit","text":"<p>If you don't want to keep all file revision history, you may set a default history length limit for all libraries.</p> <pre><code>[history]\nkeep_days = days of history to keep\n</code></pre>"},{"location":"config/seafile-conf/#default-trash-expiration-time","title":"Default trash expiration time","text":"<p>The default time for automatic cleanup of the libraries trash is 30 days. You can modify this time by adding the following configuration\uff1a</p> <pre><code>[library_trash]\nexpire_days = 60\n</code></pre>"},{"location":"config/seafile-conf/#seafile-fileserver-configuration","title":"Seafile fileserver configuration","text":"<p>The configuration of seafile fileserver is in the <code>[fileserver]</code> section of the file <code>seafile.conf</code></p> <p>You can set the number of worker threads to server http requests. Default value is 10, which is a good value for most use cases.</p> <pre><code>[fileserver]\nworker_threads = 15\n</code></pre> <p>Change upload/download settings.</p> <pre><code>[fileserver]\n# Set maximum upload file size to 200M.\n# If not configured, there is no file size limit for uploading.\nmax_upload_size=200\n\n# Set maximum download directory size to 200M.\n# Default is 100M.\nmax_download_dir_size=200\n</code></pre> <p>After a file is uploaded via the web interface, or the cloud file browser in the client, it needs to be divided into fixed size blocks and stored into storage backend. We call this procedure \"indexing\". By default, the file server uses 1 thread to sequentially index the file and store the blocks one by one. This is suitable for most cases. But if you're using S3/Ceph/Swift backends, you may have more bandwidth in the storage backend for storing multiple blocks in parallel. We provide an option to define the number of concurrent threads in indexing:</p> <pre><code>[fileserver]\nmax_indexing_threads = 10\n</code></pre> <p>When users upload files in the web interface (seahub), file server divides the file into fixed size blocks. Default blocks size for web uploaded files is 8MB. The block size can be set here.</p> <pre><code>[fileserver]\n#Set block size to 2MB\nfixed_block_size=2\n</code></pre> <p>When users upload files in the web interface, file server assigns an token to authorize the upload operation. This token is valid for 1 hour by default. When uploading a large file via WAN, the upload time can be longer than 1 hour. You can change the token expire time to a larger value.</p> <pre><code>[fileserver]\n#Set uploading time limit to 3600s\nweb_token_expire_time=3600\n</code></pre> <p>You can download a folder as a zip archive from seahub, but some zip software on windows doesn't support UTF-8, in which case you can use the \"windows_encoding\" settings to solve it.</p> <pre><code>[zip]\n# The file name encoding of the downloaded zip file.\nwindows_encoding = iso-8859-1\n</code></pre> <p>The \"httptemp\" directory contains temporary files created during file upload and zip download. In some cases the temporary files are not cleaned up after the file transfer was interrupted. Starting from 7.1.5 version, file server will regularly scan the \"httptemp\" directory to remove files created long time ago.</p> <pre><code>[fileserver]\n# After how much time a temp file will be removed. The unit is in seconds. Default to 3 days.\nhttp_temp_file_ttl = x\n# File scan interval. The unit is in seconds. Default to 1 hour.\nhttp_temp_scan_interval = x\n</code></pre> <p>You can set the maximum number of files contained in a library that can be synced by the Seafile client. The default is 100000. When you download a repo, Seafile client will request fs id list, and you can control the timeout period of this request through <code>fs_id_list_request_timeout</code> configuration, which defaults to 5 minutes. These two options are added to prevent long fs-id-list requests from overloading the server. You can set both options to -1, to allow unlimited size and timeout.</p> <pre><code>[fileserver]\nmax_sync_file_count = 100000\nfs_id_list_request_timeout = 300\n</code></pre> <p>If you use object storage as storage backend, when a large file is frequently downloaded, the same blocks need to be fetched from the storage backend to Seafile server. This may waste bandwith and cause high load on the internal network. Since Seafile Pro 8.0.5 version, we add block caching to improve the situation. </p> <ul> <li>To enable this feature, set <code>use_block_cache</code> option in the <code>[fileserver]</code> group. It's not enabled by default. </li> <li>The <code>block_cache_size_limit</code> option is used to limit the size of the cache. Its default value is 10GB. The blocks are cached in <code>seafile-data/block-cache</code> directory. When the total size of cached files exceeds the limit, seaf-server will clean up older files until the size reduces to 70% of the limit. The cleanup interval is 5 minutes. You have to have a good estimate on how much space you need for the cache directory. Otherwise on frequent downloads this directory can be quickly filled up.</li> <li>The <code>block_cache_file_types</code> configuration is used to choose the file types that are cached. <code>block_cache_file_types</code> the default value is mp4;mov.</li> </ul> <p><pre><code>[fileserver]\nuse_block_cache = true\n# Set block cache size limit to 100MB\nblock_cache_size_limit = 100\nblock_cache_file_types = mp4;mov\n</code></pre> When a large number of files are uploaded through the web page and API, it will be expensive to calculate block IDs based on the block contents. Since Seafile-pro-9.0.6, you can add the <code>skip_block_hash</code> option to use a random string as block ID.</p> <p>Warning</p> <p>This option will prevent fsck from checking block content integrity. You should specify <code>--shallow</code> option to fsck to not check content integrity.</p> <pre><code>[fileserver]\nskip_block_hash = true\n</code></pre> <p>If you want to limit the type of files when uploading files, since Seafile Pro 10.0.0 version, you can set <code>file_ext_white_list</code> option in the <code>[fileserver]</code> group. This option is a list of file types, only the file types in this list are allowed to be uploaded. It's not enabled by default. </p> <pre><code>[fileserver]\nfile_ext_white_list = md;mp4;mov\n</code></pre> <p>Since seafile 10.0.1, when you use go fileserver, you can set <code>upload_limit</code> and <code>download_limit</code> option in the <code>[fileserver]</code> group to limit the speed of file upload and download. It's not enabled by default. </p> <pre><code>[fileserver]\n# The unit is in KB/s.\nupload_limit = 100\ndownload_limit = 100\n</code></pre> <p>Since Seafile 11.0.7 Pro, you can ask file server to check virus for every file uploaded with web APIs. Find more options about virus scanning at virus scan.</p> <pre><code>[fileserver]\n# default is false\ncheck_virus_on_web_upload = true\n</code></pre> <p>Since Seafile 12.0.4, after the upload is completed by the client, seafile server will check whether the uploaded blocks are complete. Ii's enabled by default.</p> <pre><code>[fileserver]\n# default is true\nverify_client_blocks_after_sync = true\n</code></pre>"},{"location":"config/seafile-conf/#database-configuration","title":"Database configuration","text":"<p>The configurations of database are stored in the <code>[database]</code> section.</p> <p>From Seafile 11.0, the SQLite is not supported</p> <pre><code>[database]\ntype=mysql\nhost=127.0.0.1\nuser=root\npassword=root\ndb_name=seafile_db\nconnection_charset=utf8\nmax_connections=100\n</code></pre> <p>When you configure seafile server to use MySQL, the default connection pool size is 100, which should be enough for most use cases.</p> <p>Since Seafile 10.0.2, you can enable the encrypted connections to the MySQL server by adding the following configuration options:</p> <pre><code>[database]\nuse_ssl = true\nskip_verify = false\nca_path = /etc/mysql/ca.pem\n</code></pre> <p>When set <code>use_ssl</code> to true and <code>skip_verify</code> to false, it will check whether the MySQL server certificate is legal through the CA configured in <code>ca_path</code>. The <code>ca_path</code> is a trusted CA certificate path for signing MySQL server certificates. When <code>skip_verify</code> is true, there is no need to add the <code>ca_path</code> option. The MySQL server certificate won't be verified at this time.</p>"},{"location":"config/seafile-conf/#file-locking-pro-edition-only","title":"File Locking (Pro edition only)","text":"<p>The Seafile Pro server auto expires file locks after some time, to prevent a locked file being locked for too long. The expire time can be tune in seafile.conf file.</p> <pre><code>[file_lock]\ndefault_expire_hours = 6\n</code></pre> <p>The default is 12 hours.</p> <p>Since Seafile-pro-9.0.6, you can add cache for getting locked files (reduce server load caused by sync clients). Since Pro Edition 12, this option is enabled by default.</p> <pre><code>[file_lock]\nuse_locked_file_cache = true\n</code></pre> <p>At the same time, you also need to configure the following memcache options for the cache to take effect:</p> <pre><code>[memcached]\nmemcached_options = --SERVER=&lt;the IP of Memcached Server&gt; --POOL-MIN=10 --POOL-MAX=100\n</code></pre>"},{"location":"config/seafile-conf/#storage-backends","title":"Storage Backends","text":"<p>You may configure Seafile to use various kinds of object storage backends.</p> <ul> <li>S3 or S3-compatible object storage</li> <li>Ceph RADOS</li> <li>OpenStack Swift</li> </ul> <p>You may also configure Seafile to use multiple storage backends at the same time.</p>"},{"location":"config/seafile-conf/#cluster","title":"Cluster","text":"<p>When you deploy Seafile in a cluster, you should add the following configuration:</p> <pre><code>[cluster]\nenabled = true\n</code></pre> <p>Tip</p> <p>Since version 12, if you use Docker to deploy cluster, this option is no longer needed.</p>"},{"location":"config/seafile-conf/#enable-slow-log","title":"Enable Slow Log","text":"<p>Since Seafile-pro-6.3.10, you can enable seaf-server's RPC slow log to do performance analysis.The slow log is enabled by default.</p> <p>If you want to configure related options, add the options to seafile.conf:</p> <pre><code>[slow_log]\n# default to true\nenable_slow_log = true\n# the unit of all slow log thresholds is millisecond.\n# default to 5000 milliseconds, only RPC queries processed for longer than 5000 milliseconds will be  logged.\nrpc_slow_threshold = 5000\n</code></pre> <p>You can find <code>seafile_slow_rpc.log</code> in <code>logs/slow_logs</code>. You can also use log-rotate to rotate the log files. You just need to send <code>SIGUSR2</code> to <code>seaf-server</code> process. The slow log file will be closed and reopened.</p> <p>Since 9.0.2 Pro, the signal to trigger log rotation has been changed to <code>SIGUSR1</code>. This signal will trigger rotation for all log files opened by seaf-server. You should change your log rotate settings accordingly.</p>"},{"location":"config/seafile-conf/#enable-access-log","title":"Enable Access Log","text":"<p>Even though Nginx logs all requests with certain details, such as url, response code, upstream process time, it's sometimes desirable to have more context about the requests, such as the user id for each request. Such information can only be logged from file server itself. Since 9.0.2 Pro, access log feature is added to fileserver.</p> <p>To enable access log, add below options to seafile.conf:</p> <pre><code>[fileserver]\n# default to false. If enabled, fileserver-access.log will be written to log directory.\nenable_access_log = true\n</code></pre> <p>The log format is as following:</p> <pre><code>start time - user id - url - response code - process time\n</code></pre> <p>You can use <code>SIGUSR1</code> to trigger log rotation.</p>"},{"location":"config/seafile-conf/#go-fileserver","title":"Go Fileserver","text":"<p>Seafile 9.0 introduces a new fileserver implemented in Go programming language. To enable it, you can set the options below in seafile.conf:</p> <pre><code>[fileserver]\nuse_go_fileserver = true\n</code></pre> <p>Go fileserver has 3 advantages over the traditional fileserver implemented in C language:</p> <ol> <li>Better performance when syncing libraries with large number of files. With C fileserver, syncing large libraries may consume all the worker threads in the server and make the service slow. There is a config option <code>max_sync_file_count</code> to limit the size of library to be synced. The default is 100K. With Go fileserver you can set this option to a much higher number, such as 1 million.</li> <li>Downloading zipped folders on the fly. And there is no limit on the size of the downloaded folder. With C fileserver, the server has to first create a zip file for the downloaded folder then send it to the client. With Go fileserver, the zip file can be created while transferring to the client. The option <code>max_download_dir_size</code> is thus no longer needed by Go fileserver.</li> <li>Since version 10.0 you can also set upload/download rate limits.</li> </ol> <p>Go fileserver caches fs objects in memory. On the one hand, it avoids repeated creation and destruction of repeatedly accessed objects; on the other hand it will also slow down the speed at which objects are released, which will prevent go's gc mechanism from consuming too much CPU time. You can set the size of memory used by fs cache through the following options.</p> <pre><code>[fileserver]\n# The unit is in M. Default to 2G.\nfs_cache_limit = 100\n</code></pre> <p>Since Pro 12.0.10 version, you can set the max threads of fs-id-list requests. When you download a repo, Seafile client will request fs id list, and you can control the maximum concurrency for handling fs-id-list requests in the go fileserver through <code>fs_id_list_max_threads</code> configuration, which defaults to 10. <pre><code>[fileserver]\nfs_id_list_max_threads = 20\n</code></pre></p>"},{"location":"config/seafile-conf/#profiling-go-fileserver-performance","title":"Profiling Go Fileserver Performance","text":"<p>Since Seafile 9.0.7, you can enable the profile function of go fileserver by adding the following configuration options:</p> <pre><code># profile_password is required, change it for your need\n[fileserver]\nenable_profiling = true\nprofile_password = 8kcUz1I2sLaywQhCRtn2x1\n</code></pre> <p>This interface can be used through the pprof tool provided by Go language. See https://pkg.go.dev/net/http/pprof for details. Note that you have to first install Go on the client that issues the below commands. The password parameter should match the one you set in the configuration.</p> <pre><code>go tool pprof http://localhost:8082/debug/pprof/heap?password=8kcUz1I2sLaywQhCRtn2x1\ngo tool pprof http://localhost:8082/debug/pprof/profile?password=8kcUz1I2sLaywQhCRtn2x1\n</code></pre>"},{"location":"config/seahub_customization/","title":"Seahub customization","text":""},{"location":"config/seahub_customization/#customize-seahub-logo-and-css","title":"Customize Seahub Logo and CSS","text":"<p>Create customize folder</p> Deploy in DockerDeploy from binary packages <pre><code>mkdir -p /opt/seafile-data/seahub/media/custom\n</code></pre> <pre><code>mkdir /opt/seafile/seafile-server-latest/seahub/media/custom\n</code></pre> <p>During upgrading, Seafile upgrade script will create symbolic link automatically to preserve your customization.</p>"},{"location":"config/seahub_customization/#customize-logo","title":"Customize Logo","text":"<p>Add your logo file to <code>custom/</code></p> <p>Overwrite <code>LOGO_PATH</code> in <code>seahub_settings.py</code></p> <pre><code>LOGO_PATH = 'custom/mylogo.png'\n</code></pre> <p>Default width and height for logo is 149px and 32px, you may need to change that according to yours.</p> <pre><code>LOGO_WIDTH = 149\nLOGO_HEIGHT = 32\n</code></pre>"},{"location":"config/seahub_customization/#customize-favicon","title":"Customize Favicon","text":"<p>Add your favicon file to <code>custom/</code></p> <p>Overwrite <code>FAVICON_PATH</code> in <code>seahub_settings.py</code></p> <pre><code>FAVICON_PATH = 'custom/favicon.png'\n</code></pre>"},{"location":"config/seahub_customization/#customize-seahub-css","title":"Customize Seahub CSS","text":"<p>Add your css file to <code>custom/</code>, for example, <code>custom.css</code></p> <p>Overwrite <code>BRANDING_CSS</code> in <code>seahub_settings.py</code></p> <pre><code>BRANDING_CSS = 'custom/custom.css'\n</code></pre>"},{"location":"config/seahub_customization/#customize-help-page","title":"Customize help page","text":"Deploy in DockerDeploy from binary packages <pre><code>mkdir -p /opt/seafile-data/seahub/media/custom/templates/help/\ncd /opt/seafile-data/seahub/media/custom\ncp ../../help/templates/help/base.html templates/help/\n</code></pre> <pre><code>mkdir /opt/seafile/seafile-server-latest/seahub/media/custom/templates/help/\ncd /opt/seafile/seafile-server-latest/seahub/media/custom\ncp ../../help/templates/help/base.html templates/help/\n</code></pre> <p>For example, modify the <code>templates/help/base.html</code> file and save it. You will see the new help page.</p> <p>Note</p> <p>There are some more help pages available for modifying, you can find the list of the html file here</p>"},{"location":"config/seahub_customization/#add-an-extra-note-in-sharing-dialog","title":"Add an extra note in sharing dialog","text":"<p>You can add an extra note in sharing dialog in seahub_settings.py</p> <pre><code>ADDITIONAL_SHARE_DIALOG_NOTE = {\n    'title': 'Attention! Read before shareing files:',\n    'content': 'Do not share personal or confidential official data with **.'\n}\n</code></pre> <p>Result:</p> <p></p>"},{"location":"config/seahub_customization/#add-custom-navigation-items","title":"Add custom navigation items","text":"<p>Since Pro 7.0.9, Seafile supports adding some custom navigation entries to the home page for quick access. This requires you to add the following configuration information to the <code>conf/seahub_settings.py</code> configuration file:</p> <pre><code>CUSTOM_NAV_ITEMS = [\n    {'icon': 'sf2-icon-star',\n     'desc': 'Custom navigation 1',\n     'link': 'https://www.seafile.com'\n    },\n    {'icon': 'sf2-icon-wiki-view',\n     'desc': 'Custom navigation 2',\n     'link': 'https://www.seafile.com/help'\n    },\n    {'icon': 'sf2-icon-wrench',\n     'desc': 'Custom navigation 3',\n     'link': 'http://www.example.com'\n    },\n]\n</code></pre> <p>Note</p> <p>The <code>icon</code> field currently only supports icons in Seafile that begin with <code>sf2-icon</code>. You can find the list of icons here</p> <p>Then restart the Seahub service to take effect.</p> <p>Once you log in to the Seafile system homepage again, you will see the new navigation entry under the <code>Tools</code> navigation bar on the left.</p>"},{"location":"config/seahub_customization/#add-more-links-to-about-dialog","title":"Add more links to about dialog","text":"<pre><code>ADDITIONAL_ABOUT_DIALOG_LINKS = {\n    'seafile': 'https://example.seahub.com/seahub',\n    'dtable-web': 'https://example.seahub.com/dtable-web'\n}\n</code></pre> <p>Result:</p> <p></p>"},{"location":"config/seahub_settings_py/","title":"Seahub Settings","text":"<p>Tip</p> <p>You can also modify most of the config items via web interface. The config items are saved in database table (seahub-db/constance_config). They have a higher priority over the items in config files. If you want to disable settings via web interface, you can add <code>ENABLE_SETTINGS_VIA_WEB = False</code> to <code>seahub_settings.py</code>.</p>"},{"location":"config/seahub_settings_py/#sending-email-notifications-on-seahub","title":"Sending Email Notifications on Seahub","text":"<p>Refer to email sending documentation.</p>"},{"location":"config/seahub_settings_py/#security-settings","title":"Security settings","text":"<pre><code># For security consideration, please set to match the host/domain of your site, e.g., ALLOWED_HOSTS = ['.example.com'].\n# Please refer https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts for details.\nALLOWED_HOSTS = ['.myseafile.com']\n\n\n# Whether to use a secure cookie for the CSRF cookie\n# https://docs.djangoproject.com/en/3.2/ref/settings/#csrf-cookie-secure\nCSRF_COOKIE_SECURE = True\n\n# The value of the SameSite flag on the CSRF cookie\n# https://docs.djangoproject.com/en/3.2/ref/settings/#csrf-cookie-samesite\nCSRF_COOKIE_SAMESITE = 'Strict'\n\n# https://docs.djangoproject.com/en/3.2/ref/settings/#csrf-trusted-origins\nCSRF_TRUSTED_ORIGINS = ['https://www.myseafile.com']\n</code></pre>"},{"location":"config/seahub_settings_py/#user-management-options","title":"User management options","text":"<p>The following options affect user registration, password and session.</p> <pre><code># Enalbe or disalbe registration on web. Default is `False`.\nENABLE_SIGNUP = False\n\n# Activate or deactivate user when registration complete. Default is `True`.\n# If set to `False`, new users need to be activated by admin in admin panel.\nACTIVATE_AFTER_REGISTRATION = False\n\n# Whether to send email when a system admin adding a new member. Default is `True`.\nSEND_EMAIL_ON_ADDING_SYSTEM_MEMBER = True\n\n# Whether to send email when a system admin resetting a user's password. Default is `True`.\nSEND_EMAIL_ON_RESETTING_USER_PASSWD = True\n\n# Send system admin notify email when user registration is complete. Default is `False`.\nNOTIFY_ADMIN_AFTER_REGISTRATION = True\n\n# Remember days for login. Default is 7\nLOGIN_REMEMBER_DAYS = 7\n\n# Attempt limit before showing a captcha when login.\nLOGIN_ATTEMPT_LIMIT = 3\n\n# deactivate user account when login attempts exceed limit\n# Since version 5.1.2 or pro 5.1.3\nFREEZE_USER_ON_LOGIN_FAILED = False\n\n# default False, only check USER_PASSWORD_MIN_LENGTH\n# when True, check password strength level, STRONG(or above) is allowed\nUSER_STRONG_PASSWORD_REQUIRED = False\n\n# Force user to change password when admin add/reset a user.\n# Added in 5.1.1, deafults to True.\nFORCE_PASSWORD_CHANGE = True\n\n# Age of cookie, in seconds (default: 2 weeks).\nSESSION_COOKIE_AGE = 60 * 60 * 24 * 7 * 2\n\n# Whether a user's session cookie expires when the Web browser is closed.\nSESSION_EXPIRE_AT_BROWSER_CLOSE = False\n\n# Whether to save the session data on every request. Default is `False`\nSESSION_SAVE_EVERY_REQUEST = False\n\n# In old version, if you use Single Sign On, the password is not saved in Seafile.\n# Users can't use WebDAV because Seafile can't check whether the password is correct.\n# Since version 6.3.8, you can enable this option to let user's to specific a password for WebDAV login.\n# Users login via SSO can use this password to login in WebDAV.\n# Enable the feature. pycryptodome should be installed first.\n# sudo pip install pycryptodome==3.12.0\nENABLE_WEBDAV_SECRET = True\nWEBDAV_SECRET_MIN_LENGTH = 8\n\n# LEVEL for the password, based on four types of input:\n# num, upper letter, lower letter, other symbols\n# '3' means password must have at least 3 types of the above.\nWEBDAV_SECRET_STRENGTH_LEVEL = 1\n\n\n# Since version 7.0.9, you can force a full user to log in with a two factor authentication.\n# The prerequisite is that the administrator should 'enable two factor authentication' in the 'System Admin -&gt; Settings' page.\n# Then you can add the following configuration information to the configuration file.\nENABLE_FORCE_2FA_TO_ALL_USERS = True\n\n# Enable two factor authentication for accounts. Defaults to `False`.\n# Since version 6.0\nENABLE_TWO_FACTOR_AUTH = True\n\n# Enable a user to change password in 'settings' page. Default to `True`\n# Since version 6.2.11\nENABLE_CHANGE_PASSWORD = True\n\n# If show contact email when search user.\nENABLE_SHOW_CONTACT_EMAIL_WHEN_SEARCH_USER = True\n</code></pre>"},{"location":"config/seahub_settings_py/#single-sign-on","title":"Single Sign On","text":"<pre><code># Enable authentication with ADFS\n# Default is False\n# Since 6.0.9\nENABLE_ADFS_LOGIN = True\n\n# Force user login through ADFS/OAuth instead of email and password\n# Default is False\n# Since 11.0.7, in version 12.0, it also controls users via OAuth\nDISABLE_ADFS_USER_PWD_LOGIN = True\n\n# Enable authentication wit Kerberos\n# Default is False\nENABLE_KRB5_LOGIN = True\n\n# Enable authentication with Shibboleth\n# Default is False\nENABLE_SHIBBOLETH_LOGIN = True\n\n# Enable a user associated with SSO account to change/reset local password in 'settings' page. Default to `True`.\n# Change it to false to disable SSO account to change local password\nENABLE_SSO_USER_CHANGE_PASSWORD = True\n\n# Enable client to open an external browser for single sign on\n# When it is false, the old buitin browser is opened for single sign on\n# When it is true, the default browser of the operation system is opened\n# The benefit of using system browser is that it can support hardware 2FA\n# Since 11.0.0, and sync client 9.0.5, drive client 3.0.8\nCLIENT_SSO_VIA_LOCAL_BROWSER = True   # default is False\nCLIENT_SSO_UUID_EXPIRATION = 5 * 60   # in seconds\n</code></pre>"},{"location":"config/seahub_settings_py/#library-snapshot-label-feature","title":"Library snapshot label feature","text":"<pre><code># Turn on this option to let users to add a label to a library snapshot. Default is `False`\nENABLE_REPO_SNAPSHOT_LABEL = False\n</code></pre>"},{"location":"config/seahub_settings_py/#library-options","title":"Library options","text":"<p>Options for libraries:</p> <pre><code># if enable create encrypted library\nENABLE_ENCRYPTED_LIBRARY = True\n\n# version for encrypted library\n# should only be `2` or `4`.\n# version 3 is insecure (using AES128 encryption) so it's not supported any more.\n# refer to https://manual.seafile.com/latest/administration/security_features/#how-does-an-encrypted-library-work\n# for the difference between version 2 and 4.\nENCRYPTED_LIBRARY_VERSION = 2\n\n# Since version 12, you can choose password hash algorithm for new encrypted libraries.\n# The password is used to encrypt the encryption key. So using a secure password hash algorithm to\n# prevent brute-force password guessing is important.\n# Before version 12, a fixed algorithm (PBKDF2-SHA256 with 1000 iterations) is used.\n#\n# Currently two hash algorithms are supported.\n#  - PBKDF2: The only available parameter is the number of iterations. You need to increase the\n#    the number of iterations over time, as GPUs are more and more used for such calculation.\n#    The default number of iterations is 1000. As of 2023, the recommended iterations is 600,000.\n#  - Argon2id: Secure hash algorithm that has high cost even for GPUs. There are 3 parameters that\n#    can be set: time cost, memory cost, and parallelism degree. The parameters are seperated by commas,\n#    e.g. \"2,102400,8\", which the default parameters used in Seafile. Learn more about this algorithm\n#    on https://github.com/P-H-C/phc-winner-argon2 .\n#\n# Note that only sync client &gt;= 9.0.9 and SeaDrive &gt;= 3.0.12 supports syncing libraries created with these algorithms.\nENCRYPTED_LIBRARY_PWD_HASH_ALGO = \"argon2id\"\nENCRYPTED_LIBRARY_PWD_HASH_PARAMS = \"2,102400,8\"\n# ENCRYPTED_LIBRARY_PWD_HASH_ALGO = \"pbkdf2_sha256\"\n# ENCRYPTED_LIBRARY_PWD_HASH_PARAMS = \"600000\"\n\n# mininum length for password of encrypted library\nREPO_PASSWORD_MIN_LENGTH = 8\n\n# force use password when generate a share/upload link (since version 8.0.9)\nSHARE_LINK_FORCE_USE_PASSWORD = False\n\n# mininum length for password for share link (since version 4.4)\nSHARE_LINK_PASSWORD_MIN_LENGTH = 8\n\n# LEVEL for the password of a share/upload link\n# based on four types of input:\n# num, upper letter, lower letter, other symbols\n# '3' means password must have at least 3 types of the above. (since version 8.0.9)\nSHARE_LINK_PASSWORD_STRENGTH_LEVEL = 3\n\n# Default expire days for share link (since version 6.3.8)\n# Once this value is configured, the user can no longer generate an share link with no expiration time.\n# If the expiration value is not set when the share link is generated, the value configured here will be used.\nSHARE_LINK_EXPIRE_DAYS_DEFAULT = 5\n\n# minimum expire days for share link (since version 6.3.6)\n# SHARE_LINK_EXPIRE_DAYS_MIN should be less than SHARE_LINK_EXPIRE_DAYS_DEFAULT (If the latter is set).\nSHARE_LINK_EXPIRE_DAYS_MIN = 3 # default is 0, no limit.\n\n# maximum expire days for share link (since version 6.3.6)\n# SHARE_LINK_EXPIRE_DAYS_MIN should be greater than SHARE_LINK_EXPIRE_DAYS_DEFAULT (If the latter is set).\nSHARE_LINK_EXPIRE_DAYS_MAX = 8 # default is 0, no limit.\n\n# Default expire days for upload link (since version 7.1.6)\n# Once this value is configured, the user can no longer generate an upload link with no expiration time.\n# If the expiration value is not set when the upload link is generated, the value configured here will be used.\nUPLOAD_LINK_EXPIRE_DAYS_DEFAULT = 5\n\n# minimum expire days for upload link (since version 7.1.6)\n# UPLOAD_LINK_EXPIRE_DAYS_MIN should be less than UPLOAD_LINK_EXPIRE_DAYS_DEFAULT (If the latter is set).\nUPLOAD_LINK_EXPIRE_DAYS_MIN = 3 # default is 0, no limit.\n\n# maximum expire days for upload link (since version 7.1.6)\n# UPLOAD_LINK_EXPIRE_DAYS_MAX should be greater than UPLOAD_LINK_EXPIRE_DAYS_DEFAULT (If the latter is set).\nUPLOAD_LINK_EXPIRE_DAYS_MAX = 8 # default is 0, no limit.\n\n# force user login when view file/folder share link (since version 6.3.6)\nSHARE_LINK_LOGIN_REQUIRED = True\n\n# enable water mark when view(not edit) file in web browser (since version 6.3.6)\nENABLE_WATERMARK = True\n\n# Disable sync with any folder. Default is `False`\n# NOTE: since version 4.2.4\nDISABLE_SYNC_WITH_ANY_FOLDER = True\n\n# Enable or disable library history setting\nENABLE_REPO_HISTORY_SETTING = True\n\n# Enable or disable user share library to any group\n# Since version 6.2.0\nENABLE_SHARE_TO_ALL_GROUPS = True\n\n# Enable or disable user to clean trash (default is True)\n# Since version 6.3.6\nENABLE_USER_CLEAN_TRASH = True\n\n# Add a report abuse button on download links. (since version 7.1.0)\n# Users can report abuse on the share link page, fill in the report type, contact information, and description.\n# Default is false.\nENABLE_SHARE_LINK_REPORT_ABUSE = True\n</code></pre> <p>Options for online file preview:</p> <pre><code># Online preview maximum file size, defaults to 30M.\nFILE_PREVIEW_MAX_SIZE = 30 * 1024 * 1024\n\n# Extensions of previewed text files.\n# NOTE: since version 6.1.1\nTEXT_PREVIEW_EXT = \"\"\"ac, am, bat, c, cc, cmake, cpp, cs, css, diff, el, h, html,\nhtm, java, js, json, less, make, org, php, pl, properties, py, rb,\nscala, script, sh, sql, txt, text, tex, vi, vim, xhtml, xml, log, csv,\ngroovy, rst, patch, go\"\"\"\n\n\n# Seafile only generates thumbnails for images smaller than the following size.\n# Since version 6.3.8 pro, suport the psd online preview.\nTHUMBNAIL_IMAGE_SIZE_LIMIT = 30 # MB\n</code></pre>"},{"location":"config/seahub_settings_py/#map-service","title":"Map service","text":"<p>Options for map service:</p> <pre><code># The map service currently relies on the Google Maps API and requires two API keys.\nGOOGLE_MAP_KEY = '&lt;replace with your Google Maps API Key&gt;'\nSERVER_GOOGLE_MAP_KEY = '&lt;replace with your Google Maps API Key&gt;'\n</code></pre> <p>Required scope of the API keys</p> <p>To safeguard your Google API Keys from abuse, restrict their usage. However, even with restrictions in place, abuse remains a risk\u2014especially since <code>GOOGLE_MAP_KEY</code> must be included in your source code and is therefore publicly accessible. Additionally, heavy use of the maps plugin may increase your Google billing, so monitor your spending closely.</p> Key Application restriction API restriction <code>GOOGLE_MAP_KEY</code> Restrict to your Server URL,like <code>https://cloud.seafile.io</code> Maps Javascript API <code>SERVER_GOOGLE_MAP_KEY</code> No website restriction Geocoding API"},{"location":"config/seahub_settings_py/#cloud-mode","title":"Cloud Mode","text":"<p>You should enable cloud mode if you use Seafile with an unknown user base. It disables the organization tab in Seahub's website to ensure that users can't access the user list. Cloud mode provides some nice features like sharing content with unregistered users and sending invitations to them. Therefore you also want to enable user registration. Through the global address book (since version 4.2.3) you can do a search for every user account. So you probably want to disable it.</p> <pre><code># Enable cloude mode and hide `Organization` tab.\nCLOUD_MODE = True\n\n# Disable global address book\nENABLE_GLOBAL_ADDRESSBOOK = False\n</code></pre>"},{"location":"config/seahub_settings_py/#other-options","title":"Other options","text":"<pre><code># Disable settings via Web interface in system admin-&gt;settings\n# Default is True\n# Since 5.1.3\nENABLE_SETTINGS_VIA_WEB = False\n\n# Choices can be found here:\n# http://en.wikipedia.org/wiki/List_of_tz_zones_by_name\n# although not all choices may be available on all operating systems.\n# If running in a Windows environment this must be set to the same as your\n# system time zone.\nTIME_ZONE = 'UTC'\n\n# Language code for this installation. All choices can be found here:\n# http://www.i18nguy.com/unicode/language-identifiers.html\n# Default language for sending emails.\nLANGUAGE_CODE = 'en'\n\n# Custom language code choice.\nLANGUAGES = (\n    ('en', 'English'),\n    ('zh-cn', '\u7b80\u4f53\u4e2d\u6587'),\n    ('zh-tw', '\u7e41\u9ad4\u4e2d\u6587'),\n)\n\n# Set this to your website/company's name. This is contained in email notifications and welcome message when user login for the first time.\nSITE_NAME = 'Seafile'\n\n# Browser tab's title\nSITE_TITLE = 'Private Seafile'\n\n# Whether enable the feature Wiki (requires sdoc integration). Default is `True`\nENABLE_WIKI = True\n\n# Max number of files when user upload file/folder.\n# Since version 6.0.4\nMAX_NUMBER_OF_FILES_FOR_FILEUPLOAD = 500\n\n# Control the language that send email. Default to user's current language.\n# Since version 6.1.1\nSHARE_LINK_EMAIL_LANGUAGE = ''\n\n# Interval for browser requests unread notifications\n# Since PRO 6.1.4 or CE 6.1.2\nUNREAD_NOTIFICATIONS_REQUEST_INTERVAL = 3 * 60 # seconds\n\n# Whether to allow user to delete account, change login password or update basic user\n# info on profile page.\n# Since PRO 6.3.10\nENABLE_DELETE_ACCOUNT = False\nENABLE_UPDATE_USER_INFO = False\nENABLE_CHANGE_PASSWORD = False\n\n# Get web api auth token on profile page.\nENABLE_GET_AUTH_TOKEN_BY_SESSION = True\n\n# Since 8.0.6 CE/PRO version.\n# Url redirected to after user logout Seafile.\n# Usually configured as Single Logout url.\nLOGOUT_REDIRECT_URL = 'https://www.example-url.com'\n\n\n# Enable system admin add T&amp;C, all users need to accept terms before using. Defaults to `False`.\n# Since version 6.0\nENABLE_TERMS_AND_CONDITIONS = True\n</code></pre>"},{"location":"config/seahub_settings_py/#pro-edition-only-options","title":"Pro edition only options","text":"<pre><code># Allow administrator to view user's file in UNENCRYPTED libraries\n# through Libraries page in System Admin. Default is False.\nENABLE_SYS_ADMIN_VIEW_REPO = True\n\n# For un-login users, providing an email before downloading or uploading on shared link page.\n# Since version 5.1.4\nENABLE_SHARE_LINK_AUDIT = True\n\n# Check virus after upload files to shared upload links. Defaults to `False`.\n# Since version 6.0\nENABLE_UPLOAD_LINK_VIRUS_CHECK = True\n\n# Send email to these email addresses when a virus is detected.\n# This list can be any valid email address, not necessarily the emails of Seafile user.\n# Since version 6.0.8\nVIRUS_SCAN_NOTIFY_LIST = ['user_a@seafile.com', 'user_b@seafile.com']\n</code></pre>"},{"location":"config/seahub_settings_py/#restful-api","title":"RESTful API","text":"<pre><code># API throttling related settings. Enlarger the rates if you got 429 response code during API calls.\nREST_FRAMEWORK = {\n    'DEFAULT_THROTTLE_RATES': {\n        'ping': '600/minute',\n        'anon': '5/minute',\n        'user': '300/minute',\n    },\n    'UNICODE_JSON': False,\n}\n\n# Throtting whitelist used to disable throttle for certain IPs.\n# e.g. REST_FRAMEWORK_THROTTING_WHITELIST = ['127.0.0.1', '192.168.1.1']\n# Please make sure `REMOTE_ADDR` header is configured in Nginx conf according to https://manual.seafile.com/13.0/setup_binary/ce/deploy_with_nginx.html.\nREST_FRAMEWORK_THROTTING_WHITELIST = []\n</code></pre>"},{"location":"config/seahub_settings_py/#seahub-custom-functions","title":"Seahub Custom Functions","text":"<p>Since version 6.2, you can define a custom function to modify the result of user search function.</p> <p>For example, if you want to limit user only search users in the same institution, you can define <code>custom_search_user</code> function in <code>{seafile install path}/conf/seahub_custom_functions/__init__.py</code></p> <p>Code example:</p> <pre><code>import os\nimport sys\n\ncurrent_path = os.path.dirname(os.path.abspath(__file__))\nseahub_dir = os.path.join(current_path, \\\n        '../../seafile-server-latest/seahub/seahub')\nsys.path.append(seahub_dir)\n\nfrom seahub.profile.models import Profile\ndef custom_search_user(request, emails):\n\n    institution_name = ''\n\n    username = request.user.username\n    profile = Profile.objects.get_profile_by_user(username)\n    if profile:\n        institution_name = profile.institution\n\n    inst_users = [p.user for p in\n            Profile.objects.filter(institution=institution_name)]\n\n    filtered_emails = []\n    for email in emails:\n        if email in inst_users:\n            filtered_emails.append(email)\n\n    return filtered_emails\n</code></pre> <p>You should NOT change the name of <code>custom_search_user</code> and <code>seahub_custom_functions/__init__.py</code></p> <p>Since version 6.2.5 pro, if you enable the ENABLE_SHARE_TO_ALL_GROUPS feather on sysadmin settings page, you can also define a custom function to return the groups a user can share library to.</p> <p>For example, if you want to let a user to share library to both its groups and the groups of user <code>test@test.com</code>, you can define a <code>custom_get_groups</code> function in <code>{seafile install path}/conf/seahub_custom_functions/__init__.py</code></p> <p>Code example:</p> <pre><code>import os\nimport sys\n\ncurrent_path = os.path.dirname(os.path.abspath(__file__))\nseaserv_dir = os.path.join(current_path, \\\n        '../../seafile-server-latest/seafile/lib64/python2.7/site-packages')\nsys.path.append(seaserv_dir)\n\ndef custom_get_groups(request):\n\n    from seaserv import ccnet_api\n\n    groups = []\n    username = request.user.username\n\n    # for current user\n    groups += ccnet_api.get_groups(username)\n\n    # for 'test@test.com' user\n    groups += ccnet_api.get_groups('test@test.com')\n\n    return groups\n</code></pre> <p>You should NOT change the name of <code>custom_get_groups</code> and <code>seahub_custom_functions/__init__.py</code></p> <p>Tip</p> <ul> <li>You need to restart seahub so that your changes take effect.</li> </ul> Deploy in DockerDeploy from binary packages <pre><code>docker compose restart\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\n./seahub.sh restart\n</code></pre> <ul> <li>If your changes don't take effect, You may need to delete 'seahub_setting.pyc'. (A cache file)</li> </ul>"},{"location":"config/sending_email/","title":"Sending Email Notifications on Seahub","text":""},{"location":"config/sending_email/#types-of-email-sending-in-seafile","title":"Types of Email Sending in Seafile","text":"<p>There are currently five types of emails sent in Seafile:</p> <ul> <li>User resets his/her password</li> <li>System admin adds new member</li> <li>System admin resets user password</li> <li>User sends file/folder share and upload link</li> <li>Reminder of unread notifications</li> </ul> <p>The first four types of email are sent immediately. The last type is sent by a background task running periodically.</p>"},{"location":"config/sending_email/#options-of-email-sending","title":"Options of Email Sending","text":"<p>Please add the following lines to <code>seahub_settings.py</code> to enable email sending.</p> <pre><code>EMAIL_USE_TLS = True\nEMAIL_HOST = 'smtp.example.com'        # smpt server\nEMAIL_HOST_USER = 'username@example.com'    # username and domain\nEMAIL_HOST_PASSWORD = 'password'    # password\nEMAIL_PORT = 587\nDEFAULT_FROM_EMAIL = EMAIL_HOST_USER\nSERVER_EMAIL = EMAIL_HOST_USER\n</code></pre> <p>Note</p> <ul> <li> <p>If your email service still does not work, you can checkout the log file <code>logs/seahub.log</code> to see what may cause the problem. For a complete email notification list, please refer to email notification list.</p> </li> <li> <p>If you want to use the email service without authentication leaf <code>EMAIL_HOST_USER</code> and <code>EMAIL_HOST_PASSWORD</code> blank (<code>''</code>). (But notice that the emails then will be sent without a <code>From:</code> address.)</p> </li> <li> <p>About using SSL connection (using port 465)</p> <ul> <li>Port 587 is being used to establish a connection using STARTTLS and port 465 is being used to establish an SSL connection.  Starting from Django 1.8, it supports both.</li> <li>If you want to use SSL on port 465, set <code>EMAIL_USE_SSL = True</code> instead of <code>EMAIL_USE_TLS</code>.</li> </ul> </li> </ul>"},{"location":"config/sending_email/#change-reply-to-of-email","title":"Change <code>reply to</code> of email","text":"<p>You can change the reply to field of email by add the following settings to seahub_settings.py. This only affects email sending for file share link.</p> <pre><code># Set reply-to header to user's email or not, defaults to ``False``. For details,\n# please refer to http://www.w3.org/Protocols/rfc822/\nADD_REPLY_TO_HEADER = True\n</code></pre>"},{"location":"config/sending_email/#config-background-email-sending-task","title":"Config background email sending task","text":"<p>The background task will run periodically to check whether an user have new unread notifications. If there are any, it will send a reminder email to that user. The background email sending task is controlled by <code>seafevents.conf</code>.</p> <pre><code>[SEAHUB EMAIL]\n\n## must be \"true\" to enable user email notifications when there are new unread notifications\nenabled = true\n\n## interval of sending seahub email. Can be s(seconds), m(minutes), h(hours), d(days)\ninterval = 30m\n</code></pre>"},{"location":"config/sending_email/#add-smime-signature-to-email","title":"Add S/MIME signature to email","text":"<p>If you want the email signed by S/MIME, please add the config in <code>seahub_settings.py</code></p> <p><pre><code>ENABLE_SMIME = True\nSMIME_CERTS_DIR = /opt/seafile/seahub-data/smime-certs # including cert.pem and private_key.pem\n</code></pre> The certificate can be generated by the openssl command, or you can apply to the certificate manufacturer, it is up to you. For example, generate the certs using the following command:</p> <pre><code>mkdir -p /opt/seafile/seahub-data/smime-certs\ncd /opt/seafile/seahub-data/smime-certs\nopenssl req -x509 -newkey rsa:4096 -keyout private_key.pem -outform PEM -out cert.pem -days 3650 -nodes\n</code></pre> <p>Tip</p> <p>Some email clients may not verify the email signed by certs generated by command line. So it's better to apply the certs from a manufacture</p>"},{"location":"config/sending_email/#customize-email-messages","title":"Customize email messages","text":"<p>The simplest way to customize the email messages is setting the <code>SITE_NAME</code> variable in <code>seahub_settings.py</code>. If it is not enough for your case, you can customize the email templates.</p> <p>Tip</p> <p>Subject line may vary between different releases, this is based on Release 5.0.0. Restart Seahub so that your changes take effect.</p>"},{"location":"config/sending_email/#the-email-base-template","title":"The email base template","text":"<p>seahub/seahub/templates/email_base.html</p> <p>Tip</p> <p>You can copy email_base.html to <code>seahub-data/custom/templates/email_base.html</code> and modify the new one. In this way, the customization will be maintained after upgrade.</p>"},{"location":"config/sending_email/#user-resets-hisher-password","title":"User resets his/her password","text":"<p>Subject</p> <p>seahub/seahub/auth/forms.py line:127</p> <pre><code>        send_html_email(_(\"Reset Password on %s\") % site_name,\n                  email_template_name, c, None, [user.username])\n</code></pre> <p>Body</p> <p>seahub/seahub/templates/registration/password_reset_email.html</p> <p>Tip</p> <p>You can copy password_reset_email.html to <code>seahub-data/custom/templates/registration/password_reset_email.html</code> and modify the new one. In this way, the customization will be maintained after upgrade.</p>"},{"location":"config/sending_email/#system-admin-adds-new-member","title":"System admin adds new member","text":"<p>Subject</p> <p>seahub/seahub/views/sysadmin.py line:424</p> <pre><code>send_html_email(_(u'Password has been reset on %s') % SITE_NAME,\n            'sysadmin/user_reset_email.html', c, None, [email])\n</code></pre> <p>Body</p> <p>seahub/seahub/templates/sysadmin/user_add_email.html</p> <p>Tip</p> <p>You can copy user_add_email.html to <code>seahub-data/custom/templates/sysadmin/user_add_email.html</code> and modify the new one. In this way, the customization will be maintained after upgrade.</p>"},{"location":"config/sending_email/#system-admin-resets-user-password","title":"System admin resets user password","text":"<p>Subject</p> <p>seahub/seahub/views/sysadmin.py line:1224</p> <pre><code>send_html_email(_(u'Password has been reset on %s') % SITE_NAME,\n            'sysadmin/user_reset_email.html', c, None, [email])\n</code></pre> <p>Body</p> <p>seahub/seahub/templates/sysadmin/user_reset_email.html</p> <p>Tip</p> <p>You can copy user_reset_email.html to <code>seahub-data/custom/templates/sysadmin/user_reset_email.html</code> and modify the new one. In this way, the customization will be maintained after upgrade.</p>"},{"location":"config/sending_email/#user-sends-filefolder-share-link","title":"User sends file/folder share link","text":"<p>Subject</p> <p>seahub/seahub/share/views.py line:913</p> <pre><code>try:\n    if file_shared_type == 'f':\n        c['file_shared_type'] = _(u\"file\")\n        send_html_email(_(u'A file is shared to you on %s') % SITE_NAME,\n                        'shared_link_email.html',\n                        c, from_email, [to_email],\n                        reply_to=reply_to\n                        )\n    else:\n        c['file_shared_type'] = _(u\"directory\")\n        send_html_email(_(u'A directory is shared to you on %s') % SITE_NAME,\n                        'shared_link_email.html',\n                        c, from_email, [to_email],\n                        reply_to=reply_to)\n</code></pre> <p>Body</p> <p>seahub/seahub/templates/shared_link_email.html</p> <p>seahub/seahub/templates/shared_upload_link_email.html</p> <p>Tip</p> <p>You can copy shared_link_email.html to <code>seahub-data/custom/templates/shared_link_email.html</code> and modify the new one. In this way, the customization will be maintained after upgrade.</p>"},{"location":"config/sending_email/#reminder-of-unread-notifications","title":"Reminder of unread notifications","text":"<p>Subject</p> <pre><code>send_html_email(_('New notice on %s') % settings.SITE_NAME,\n                                'notifications/notice_email.html', c,\n                                None, [to_user])\n</code></pre> <p>Body</p> <p>seahub/seahub/notifications/templates/notifications/notice_email.html</p>"},{"location":"config/shibboleth_authentication/","title":"Shibboleth Authentication","text":"<p>Shibboleth is a widely used single sign on (SSO) protocol. Seafile supports authentication via Shibboleth. It allows users from another organization to log in to Seafile without registering an account on the service provider.</p> <p>In this documentation, we assume the reader is familiar with Shibboleth installation and configuration. For introduction to Shibboleth concepts, please refer to https://shibboleth.atlassian.net/wiki/spaces/CONCEPT/overview .</p> <p>Shibboleth Service Provider (SP) should be installed on the same server as the Seafile server. The official SP from https://shibboleth.net/ is implemented as an Apache module. The module handles all Shibboleth authentication details. Seafile server receives authentication information (username) from HTTP request. The username then can be used as login name for the user.</p> <p>Seahub provides a special URL to handle Shibboleth login. The URL is <code>https://your-seafile-domain/sso</code>. Only this URL needs to be configured under Shibboleth protection. All other URLs don't go through the Shibboleth module. The overall workflow for a user to login with Shibboleth is as follows:</p> <ol> <li>In the Seafile login page, there is a separate \"Single Sign-On\" login button. When the user clicks the button, she/he will be redirected to <code>https://your-seafile-domain/sso</code>.</li> <li>Since that URL is controlled by Shibboleth, the user will be redirected to IdP for login. After the user logs in, she/he will be redirected back to <code>https://your-seafile-domain/sso</code>.</li> <li>This time the Shibboleth module passes the request to Seahub. Seahub reads the user information from the request(<code>HTTP_REMOTE_USER</code> header)  and brings the user to her/his home page.</li> <li>All later access to Seahub will not pass through the Shibboleth module. Since Seahub keeps session information internally, the user doesn't need to login again until the session expires.</li> </ol> <p>Since Shibboleth support requires Apache, if you want to use Nginx, you need two servers, one for non-Shibboleth access, another configured with Apache to allow Shibboleth login. In a cluster environment, you can configure your load balancer to direct traffic to different server according to URL. Only the URL <code>https://your-seafile-domain/sso</code> needs to be directed to Apache.</p> <p>The configuration includes 3 steps:</p> <ol> <li>Install and configure Shibboleth Service Provider;</li> <li>Configure Apache;</li> <li>Configure Seahub.</li> </ol>"},{"location":"config/shibboleth_authentication/#install-and-configure-shibboleth-service-provider","title":"Install and Configure Shibboleth Service Provider","text":"<p>We use CentOS 7 as example.</p>"},{"location":"config/shibboleth_authentication/#configure-apache","title":"Configure Apache","text":"<p>You should create a new virtual host configuration for Shibboleth. And then restart Apache.</p> <pre><code>&lt;IfModule mod_ssl.c&gt;\n    &lt;VirtualHost _default_:443&gt;\n        ServerName your-seafile-domain\n        DocumentRoot /var/www\n        Alias /media /opt/seafile/seafile-server-latest/seahub/media\n\n        ErrorLog ${APACHE_LOG_DIR}/seahub.error.log\n        CustomLog ${APACHE_LOG_DIR}/seahub.access.log combined\n\n        SSLEngine on\n        SSLCertificateFile  /path/to/ssl-cert.pem\n        SSLCertificateKeyFile /path/to/ssl-key.pem\n\n        &lt;Location /Shibboleth.sso&gt;\n            SetHandler shib\n            AuthType shibboleth\n            ShibRequestSetting requireSession 1\n            Require valid-user\n        &lt;/Location&gt;\n\n        &lt;Location /sso&gt;\n            SetHandler shib\n            AuthType shibboleth\n            ShibUseHeaders On\n            ShibRequestSetting requireSession 1\n            Require valid-user\n        &lt;/Location&gt;\n\n        RewriteEngine On\n        &lt;Location /media&gt;\n            Require all granted\n        &lt;/Location&gt;\n\n        # seafile fileserver\n        ProxyPass /seafhttp http://127.0.0.1:8082\n        ProxyPassReverse /seafhttp http://127.0.0.1:8082\n        RewriteRule ^/seafhttp - [QSA,L]\n\n        # seahub\n        SetEnvIf Authorization \"(.*)\" HTTP_AUTHORIZATION=$1\n        ProxyPass / http://127.0.0.1:8000/\n        ProxyPassReverse / http://127.0.0.1:8000/\n\n        # for http\n        # RequestHeader set REMOTE_USER %{REMOTE_USER}e\n        # for https\n        RequestHeader set REMOTE_USER %{REMOTE_USER}s\n    &lt;/VirtualHost&gt;\n&lt;/IfModule&gt;\n</code></pre>"},{"location":"config/shibboleth_authentication/#install-and-configure-shibboleth","title":"Install and Configure Shibboleth","text":"<p>Installation and configuration of Shibboleth is out of the scope of this documentation. You can refer to the official Shibboleth document.</p>"},{"location":"config/shibboleth_authentication/#configure-shibbolethsp","title":"Configure Shibboleth(SP)","text":""},{"location":"config/shibboleth_authentication/#shibboleth2xml","title":"shibboleth2.xml","text":"<p>Open <code>/etc/shibboleth/shibboleth2.xml</code> and change some property. After you have done all the followings, don't forget to restart Shibboleth(SP)</p>"},{"location":"config/shibboleth_authentication/#applicationdefaults-element","title":"<code>ApplicationDefaults</code> element","text":"<p>Change <code>entityID</code> and <code>REMOTE_USER</code> property:</p> <pre><code>&lt;!-- The ApplicationDefaults element is where most of Shibboleth's SAML bits are defined. --&gt;\n&lt;ApplicationDefaults entityID=\"https://your-seafile-domain/sso\"\n    REMOTE_USER=\"mail\"\n    cipherSuites=\"DEFAULT:!EXP:!LOW:!aNULL:!eNULL:!DES:!IDEA:!SEED:!RC4:!3DES:!kRSA:!SSLv2:!SSLv3:!TLSv1:!TLSv1.1\"&gt;\n</code></pre> <p>Seahub extracts the username from the <code>REMOTE_USER</code> environment variable. So you should modify your SP's shibboleth2.xml config file, so that Shibboleth translates your desired attribute into <code>REMOTE_USER</code> environment variable.</p> <p>In Seafile, only one of the following two attributes can be used for username: <code>eppn</code>, and <code>mail</code>. <code>eppn</code> stands for \"Edu Person Principal Name\". It is usually the UserPrincipalName attribute in Active Directory. It's not necessarily a valid email address. <code>mail</code> is the user's email address. You should set <code>REMOTE_USER</code> to either one of these attributes.</p>"},{"location":"config/shibboleth_authentication/#sso-element","title":"<code>SSO</code> element","text":"<p>Change <code>entityID</code> property:</p> <pre><code>&lt;!--\nConfigures SSO for a default IdP. To properly allow for &gt;1 IdP, remove\nentityID property and adjust discoveryURL to point to discovery service.\nYou can also override entityID on /Login query string, or in RequestMap/htaccess.\n--&gt;\n&lt;SSO entityID=\"https://your-IdP-domain\"&gt;\n     &lt;!--discoveryProtocol=\"SAMLDS\" discoveryURL=\"https://wayf.ukfederation.org.uk/DS\"--&gt;\n  SAML2\n&lt;/SSO&gt;\n</code></pre>"},{"location":"config/shibboleth_authentication/#metadataprovider-element","title":"<code>MetadataProvider</code> element","text":"<p>Change <code>url</code> and <code>backingFilePath</code> property:</p> <pre><code>&lt;!-- Example of remotely supplied batch of signed metadata. --&gt;\n&lt;MetadataProvider type=\"XML\" validate=\"true\"\n            url=\"http://your-IdP-metadata-url\"\n      backingFilePath=\"your-IdP-metadata.xml\" maxRefreshDelay=\"7200\"&gt;\n    &lt;MetadataFilter type=\"RequireValidUntil\" maxValidityInterval=\"2419200\"/&gt;\n    &lt;MetadataFilter type=\"Signature\" certificate=\"fedsigner.pem\" verifyBackup=\"false\"/&gt;\n</code></pre>"},{"location":"config/shibboleth_authentication/#attribute-mapxml","title":"attribute-map.xml","text":"<p>Open <code>/etc/shibboleth/attribute-map.xml</code> and change some property. After you have done all the followings, don't forget to restart Shibboleth(SP)</p>"},{"location":"config/shibboleth_authentication/#attribute-element","title":"<code>Attribute</code> element","text":"<p>Uncomment attribute elements for getting more user info:</p> <pre><code>&lt;!-- Older LDAP-defined attributes (SAML 2.0 names followed by SAML 1 names)... --&gt;\n&lt;Attribute name=\"urn:oid:2.16.840.1.113730.3.1.241\" id=\"displayName\"/&gt;\n&lt;Attribute name=\"urn:oid:0.9.2342.19200300.100.1.3\" id=\"mail\"/&gt;\n\n&lt;Attribute name=\"urn:mace:dir:attribute-def:displayName\" id=\"displayName\"/&gt;\n&lt;Attribute name=\"urn:mace:dir:attribute-def:mail\" id=\"mail\"/&gt;\n</code></pre>"},{"location":"config/shibboleth_authentication/#upload-shibbolethsps-metadata","title":"Upload Shibboleth(SP)'s metadata","text":"<p>After restarting Apache, you should be able to get the Service Provider metadata by accessing https://your-seafile-domain/Shibboleth.sso/Metadata. This metadata should be uploaded to the Identity Provider (IdP) server.</p>"},{"location":"config/shibboleth_authentication/#configure-seahub","title":"Configure Seahub","text":"<p>Add the following configuration to seahub_settings.py.</p> <pre><code>ENABLE_SHIB_LOGIN = True\nSHIBBOLETH_USER_HEADER = 'HTTP_REMOTE_USER'\n# basic user attributes\nSHIBBOLETH_ATTRIBUTE_MAP = {\n    \"HTTP_DISPLAYNAME\": (False, \"display_name\"),\n    \"HTTP_MAIL\": (False, \"contact_email\"),\n}\nEXTRA_MIDDLEWARE = (\n    'shibboleth.middleware.ShibbolethRemoteUserMiddleware',\n)\nEXTRA_AUTHENTICATION_BACKENDS = (\n    'shibboleth.backends.ShibbolethRemoteUserBackend',\n)\n</code></pre> <p>Seahub can process additional user attributes from Shibboleth. These attributes are saved into Seahub's database, as user's properties. They're all not mandatory. The internal user properties Seahub now supports are:</p> <ul> <li>givenname</li> <li>surname</li> <li>contact_email: used for sending notification email to user if username is not a valid email address (like eppn).</li> <li>institution: used to identify user's institution</li> </ul> <p>You can specify the mapping between Shibboleth attributes and Seahub's user properties in seahub_settings.py:</p> <pre><code>SHIBBOLETH_ATTRIBUTE_MAP  = {\n    \"HTTP_GIVENNAME\": (False, \"givenname\"),\n    \"HTTP_SN\": (False, \"surname\"),\n    \"HTTP_MAIL\": (False, \"contact_email\"),\n    \"HTTP_ORGANIZATION\": (False, \"institution\"),\n}\n</code></pre> <p>In the above config, the hash key is Shibboleth attribute name, the second element in the hash value is Seahub's property name. You can adjust the Shibboleth attribute name for your own needs. </p> <p>You may have to change attribute-map.xml in your Shibboleth SP, so that the desired attributes are passed to Seahub. And you have to make sure the IdP sends these attributes to the SP</p> <p>We also added an option <code>SHIB_ACTIVATE_AFTER_CREATION</code> (defaults to <code>True</code>) which control the user status after shibboleth connection. If this option set to <code>False</code>, user will be inactive after connection, and system admins will be notified by email to activate that account.</p>"},{"location":"config/shibboleth_authentication/#affiliation-and-user-role","title":"Affiliation and user role","text":"<p>Shibboleth has a field called affiliation. It is a list like: <code>employee@uni-mainz.de;member@uni-mainz.de;faculty@uni-mainz.de;staff@uni-mainz.de.</code></p> <p>We are able to set user role from Shibboleth. Details about user role, please refer to Roles and Permissions</p> <p>To enable this, modify <code>SHIBBOLETH_ATTRIBUTE_MAP</code> above and add <code>Shibboleth-affiliation</code> field, you may need to change <code>Shibboleth-affiliation</code> according to your Shibboleth SP attributes.</p> <pre><code>SHIBBOLETH_ATTRIBUTE_MAP  = {\n    \"HTTP_GIVENNAME\": (False, \"givenname\"),\n    \"HTTP_SN\": (False, \"surname\"),\n    \"HTTP_MAIL\": (False, \"contact_email\"),\n    \"HTTP_ORGANIZATION\": (False, \"institution\"),\n    \"HTTP_SHIBBOLETH_AFFILIATION\": (False, \"affiliation\"),\n}\n</code></pre> <p>Then add new config to define affiliation role map,</p> <pre><code>SHIBBOLETH_AFFILIATION_ROLE_MAP = {\n    'employee@uni-mainz.de': 'staff',\n    'member@uni-mainz.de': 'staff',\n    'student@uni-mainz.de': 'student',\n    'employee@hu-berlin.de': 'guest',\n    'patterns': (\n        ('*@hu-berlin.de', 'guest1'),\n        ('*@*.de', 'guest2'),\n        ('*', 'guest'),\n    ),\n}\n</code></pre> <p>After Shibboleth login, Seafile should calcualte user's role from affiliation and SHIBBOLETH_AFFILIATION_ROLE_MAP.</p>"},{"location":"config/shibboleth_authentication/#custom-set-user-role","title":"Custom set user role","text":"<p>If you are unable to set user roles by obtaining affiliation information, or if you wish to have a more customized way of setting user roles, you can add the following configuration to achieve this.</p> <p>For example, set all users whose email addresses end with <code>@seafile.com</code> as <code>default</code>, and set other users as <code>guest</code>.</p> <p>First, update the <code>SHIBBOLETH_ATTRIBUTE_MAP</code> configuration in seahub_settings.py, and add <code>HTTP_REMOTE_USER</code>.</p> <pre><code>SHIBBOLETH_ATTRIBUTE_MAP = {\n    ....\n    \"HTTP_REMOTE_USER\": (False, \"remote_user\"),\n    ....\n}\n</code></pre> <p>Then, create <code>/opt/seafile/conf/seahub_custom_functions/__init__.py</code> file and add the following code. <pre><code># function name `custom_shibboleth_get_user_role` should NOT be changed\ndef custom_shibboleth_get_user_role(shib_meta):\n\n    remote_user = shib_meta.get('remote_user', '')\n    if not remote_user:\n        return ''\n\n    remote_user = remote_user.lower()\n    if remote_user.endswith('@seafile.com'):\n        return 'default'\n    else:\n        return 'guest'\n</code></pre></p>"},{"location":"config/shibboleth_authentication/#verify","title":"Verify","text":"<p>After restarting Apache and Seahub service (<code>./seahub.sh restart</code>), you can then test the shibboleth login workflow.</p>"},{"location":"config/shibboleth_authentication/#debug","title":"Debug","text":"<p>If you encountered problems when login, follow these steps to get debug info (for Seafile pro 6.3.13).</p>"},{"location":"config/shibboleth_authentication/#add-this-setting-to-seahub_settingspy","title":"Add this setting to <code>seahub_settings.py</code>","text":"<pre><code>DEBUG = True\n</code></pre>"},{"location":"config/shibboleth_authentication/#change-seafiles-code","title":"Change Seafile's code","text":"<p>Open <code>seafile-server-latest/seahub/thirdpart/shibboleth/middleware.py</code></p> <p>Insert the following code in line 59</p> <pre><code>    assert False\n</code></pre> <p>Insert the following code in line 65</p> <pre><code>if not username:\n    assert False\n</code></pre> <p>The complete code after these changes is as follows:</p> <pre><code>#Locate the remote user header.\n# import pprint; pprint.pprint(request.META)\ntry:\n    username = request.META[SHIB_USER_HEADER]\nexcept KeyError:\n    assert False\n    # If specified header doesn't exist then return (leaving\n    # request.user set to AnonymousUser by the\n    # AuthenticationMiddleware).\n    return\n\nif not username:\n    assert False\n\np_id = ccnet_api.get_primary_id(username)\nif p_id is not None:\n    username = p_id\n</code></pre> <p>Then restart Seafile and relogin, you will see debug info in web page.</p>"},{"location":"config/single_sign_on/","title":"Single Sign On support in Seafile","text":"<p>Seafile supports most of the popular single-sign-on authentication protocols. Some are included in Community Edition, some are only in Pro Edition.</p> <p>In the Community Edition:</p> <ul> <li>Shibboleth</li> <li>OAuth</li> <li>Remote User (Proxy Server)</li> <li>Auto Login to SeaDrive on Windows</li> </ul> <p>Kerberos authentication can be integrated by using Apache as a proxy server and follow the instructions in Remote User Authentication and Auto Login SeaDrive on Windows.</p> <p>In Pro Edition:</p> <ul> <li>ADFS or SAML 2.0</li> </ul>"},{"location":"develop/","title":"Develop Documents","text":"<p>Build Seafile</p> <ul> <li>How to Build Seafile</li> <li>How to Setup Development Environment</li> </ul> <p>Seafile Open API</p> <ul> <li>Seafile Web API</li> <li>Seafile PHP API</li> </ul> <p>Seafile Implement Details</p> <ul> <li>Seafile Data Model</li> </ul>"},{"location":"develop/build_seafile/","title":"How to Build Seafile","text":"<p>You can build Seafile from our source code package or from the Github repo directly.</p> <p>Client</p> <ul> <li>Linux</li> <li>Max OS X</li> <li>Windows</li> </ul> <p>Server</p> <ul> <li>Build Seafile server</li> </ul>"},{"location":"develop/data_model/","title":"Data Model","text":"<p>Seafile internally uses a data model similar to GIT's. It consists of <code>Repo</code>, <code>Commit</code>, <code>FS</code>, and <code>Block</code>.</p> <p>Seafile's high performance comes from the architectural design: stores file metadata in object storage (or file system), while only stores small amount of metadata about the libraries in relational database. An overview of the architecture can be depicted as below. We'll describe the data model in more details.</p> <p></p>"},{"location":"develop/data_model/#repo","title":"Repo","text":"<p>A repo is also called a library. Every repo has an unique id (UUID), and attributes like description, creator, password.</p> <p>The metadata for a repo is stored in <code>seafile_db</code> database and the commit objects (see description in later section).</p> <p>There are a few tables in the <code>seafile_db</code> database containing important information about each repo.</p> <ul> <li><code>Repo</code>: contains the ID for each repo.</li> <li><code>RepoOwner</code>: contains the owner id for each repo.</li> <li><code>RepoInfo</code>: it is a \"cache\" table for fast access to repo metadata stored in the commit object. It includes repo name, update time, last modifier.</li> <li><code>RepoSize</code>: the total size of all files in the repo.</li> <li><code>RepoFileCount</code>: the file count in the repo.</li> <li><code>RepoHead</code>: contains the \"head commit ID\". This ID points to the head commit in the storage, which will be described in the next section.</li> </ul>"},{"location":"develop/data_model/#commit","title":"Commit","text":"<p>Commit objects save the change history of a repo. Each update from the web interface, or sync upload operation will create a new commit object. A commit object contains the following information: commit ID, library name, creator of this commit (a.k.a. the modifier), creation time of this commit (a.k.a. modification time), root fs object ID, parent commit ID.</p> <p>The root fs object ID points to the root FS object, from which we can traverse a file system snapshot for the repo.</p> <p>The parent commit ID points to the last commit previous to the current commit. The <code>RepoHead</code> table contains the latest head commit ID for each repo. From this head commit, we can traverse the repo history.</p> <p>If you use file system as storage backend, commit objects are stored in the path <code>seafile-data/storage/commits/&lt;repo_id&gt;</code>. If you use object storage, commit objects are stored in the <code>commits</code> bucket.</p>"},{"location":"develop/data_model/#fs","title":"FS","text":"<p>There are two types of FS objects, <code>SeafDir Object</code> and <code>Seafile Object</code>. <code>SeafDir Object</code> represents a directory, and <code>Seafile Object</code> represents a file.</p> <p>The <code>SeafDir</code> object contains metadata for each file/sub-folder, which includes name, last modification time, last modifier, size, and object ID. The object ID points to another <code>SeafDir</code> or <code>Seafile</code> object. The <code>Seafile</code> object contains a block list, which is a list of block IDs for the file.</p> <p>The FS object IDs are calculated based on the contents of the object. That means if a folder or a file is not changed, the same objects will be reused across multiple commits. This allow us to create snapshots very efficiently.</p> <p>If you use file system as storage backend, commit objects are stored in the path <code>seafile-data/storage/fs/&lt;repo_id&gt;</code>. If you use object storage, commit objects are stored in the <code>fs</code> bucket.</p>"},{"location":"develop/data_model/#block","title":"Block","text":"<p>A file is further divided into blocks with variable lengths. We use Content Defined Chunking algorithm to divide file into blocks. A clear overview of this algorithm can be found at http://pdos.csail.mit.edu/papers/lbfs:sosp01/lbfs.pdf. On average, a block's size is around 8MB.</p> <p>This mechanism makes it possible to deduplicate data between different versions of frequently updated files, improving storage efficiency. It also enables transferring data to/from multiple servers in parallel.</p> <p>If you use file system as storage backend, commit objects are stored in the path <code>seafile-data/storage/blocks/&lt;repo_id&gt;</code>. If you use object storage, commit objects are stored in the <code>blocks</code> bucket.</p>"},{"location":"develop/data_model/#virtual-repo","title":"Virtual Repo","text":"<p>A \"virtual repo\" is a special repo that will be created in the cases below:</p> <ul> <li>A folder in a library is shared.</li> <li>A folder in a library is synced selectively from the sync client.</li> </ul> <p>A virtual repo can be understood as a view for part of the data in its parent library. For example, when sharing a folder, the virtual repo only provides access to the shared folder in that library. Virtual repo use the same underlying data as the parent library. So virtual repos use the same <code>fs</code> and <code>blocks</code> storage location as its parent.</p> <p>Virtual repo has its own change history. So it has separate <code>commits</code> storage location from its parent. The changes in virtual repo and its parent repo will be bidirectional merged. So that changes from each side can be seen from another.</p> <p>There is a <code>VirtualRepo</code> table in <code>seafile_db</code> database. It contains the folder path in the parent repo for each virtual repo.</p>"},{"location":"develop/linux/","title":"Linux","text":""},{"location":"develop/linux/#preparation","title":"Preparation","text":"<p>The following list is what you need to install on your development machine. You should install all of them before you build Seafile.</p> <p>Package names are according to Ubuntu 24.04. For other Linux distros, please find their corresponding names yourself.</p> <ul> <li>autotools-dev</li> <li>libevent-dev ( 2.0 or later )</li> <li>libcurl4-openssl-dev  (1.0.0 or later)</li> <li>libgtk2.0-dev ( 2.24 or later)</li> <li>uuid-dev</li> <li>intltool (0.40 or later)</li> <li>libsqlite3-dev (3.7 or later)</li> <li>libjansson-dev</li> <li>valac</li> <li>git</li> <li>cmake</li> <li>libtool</li> <li>libssl-dev</li> <li>libargon2-dev</li> <li>libglib2.0-dev</li> <li>libwebsockets-dev</li> <li>qtwebengine5-dev</li> <li>libqt5webkit5-dev</li> <li>qtbase5-dev</li> <li>qtchooser</li> <li>qttools5-dev</li> <li>qttools5-dev-tools</li> <li>qtwayland5</li> </ul>"},{"location":"develop/linux/#ubuntu","title":"Ubuntu","text":"<pre><code>sudo apt-get install build-essential autotools-dev libtool libevent-dev libcurl4-openssl-dev libgtk2.0-dev uuid-dev intltool libsqlite3-dev valac git libjansson-dev cmake libwebsockets-dev qtchooser qtbase5-dev libqt5webkit5-dev qttools5-dev qttools5-dev-tools libssl-dev libargon2-dev libglib2.0-dev qtwebengine5-dev qtwayland5\n</code></pre>"},{"location":"develop/linux/#building","title":"Building","text":"<p>First you should get the latest source of libsearpc/seafile/seafile-client:</p> <p>Download the source code of the latest tag from</p> <ul> <li>https://github.com/haiwen/libsearpc (use v3.2-latest)</li> <li>https://github.com/haiwen/seafile</li> <li>https://github.com/haiwen/seafile-client</li> </ul> <p>For example, if the latest released seafile client is 9.0.15, then just use the v9.0.15 tags of the three projects.</p> <pre><code>git clone --branch v3.2-latest https://github.com/haiwen/libsearpc.git\ngit clone --branch v9.0.15 https://github.com/haiwen/seafile.git\ngit clone --branch v9.0.15 https://github.com/haiwen/seafile-client.git\n</code></pre> <p>To build Seafile client, you need first build libsearpc and seafile.</p>"},{"location":"develop/linux/#set-paths","title":"set paths","text":"<pre><code>export PREFIX=/usr\nexport PKG_CONFIG_PATH=\"$PREFIX/lib/pkgconfig:$PKG_CONFIG_PATH\"\nexport PATH=\"$PREFIX/bin:$PATH\"\n</code></pre>"},{"location":"develop/linux/#libsearpc","title":"libsearpc","text":"<pre><code>cd libsearpc\n./autogen.sh\n./configure --prefix=$PREFIX\nmake\nsudo make install\ncd ..\n</code></pre>"},{"location":"develop/linux/#seafile","title":"seafile","text":"<pre><code>cd seafile\n./autogen.sh\n./configure --prefix=$PREFIX --enable-ws=yes\nmake\nsudo make install\ncd ..\n</code></pre> <p>If you don't need notification server, you can set <code>--enable-ws=no</code> to disable notification server.</p>"},{"location":"develop/linux/#seafile-client","title":"seafile-client","text":"<pre><code>cd seafile-client\ncmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$PREFIX .\nmake\nsudo make install\ncd ..\n</code></pre>"},{"location":"develop/linux/#custom-prefix","title":"custom prefix","text":"<p>when installing to a custom <code>$PREFIX</code>, i.e. <code>/opt</code>, you may need a script to set the path variables correctly</p> <pre><code>cat &gt;$PREFIX/bin/seafile-applet.sh &lt;&lt;END\n#!/bin/bash\nexport LD_LIBRARY_PATH=\"$PREFIX/lib:$LD_LIBRARY_PATH\"\nexport PATH=\"$PREFIX/bin:$PATH\"\nexec seafile-applet $@\nEND\ncat &gt;$PREFIX/bin/seaf-cli.sh &lt;&lt;'END'\nexport LD_LIBRARY_PATH=\"$PREFIX/lib:$LD_LIBRARY_PATH\"\nexport PATH=\"$PREFIX/bin:$PATH\"\nexport PYTHONPATH=$PREFIX/lib/python3.12/site-packages\nexec seaf-cli \"$@\"\nEND\nchmod +x $PREFIX/bin/seafile-applet.sh $PREFIX/bin/seaf-cli.sh\n</code></pre> <p>you can now start the client with <code>$PREFIX/bin/seafile-applet.sh</code>.</p>"},{"location":"develop/osx/","title":"macOS","text":""},{"location":"develop/osx/#environment-setup","title":"Environment Setup","text":"<p>The following setups are required for building and packaging Sync Client on macOS:</p> <ul> <li>XCode 13.2 (or later)<ul> <li>After installing XCode, you can start XCode once so that it automatically installs the rest of the components.</li> </ul> </li> <li>Qt 6.2</li> <li>MacPorts<ul> <li>Modify /opt/local/etc/macports/macports.conf to add configuration <code>universal_archs arm64 x86_64</code>. Specifies the architecture on which MapPorts is compiled.</li> <li>Modify /opt/local/etc/macports/variants.conf to add configuration <code>+universal</code>. MacPorts installs universal versions of all ports.</li> <li>Install other dependencies: <code>sudo port install autoconf automake pkgconfig libtool glib2 libevent vala openssl git jansson cmake libwebsockets argon2</code>.</li> </ul> </li> <li>Certificates<ul> <li>Create certificate signing requests for certification, see https://developer.apple.com/help/account/create-certificates/create-a-certificate-signing-request.</li> <li>Create a Developer ID Application certificate and a Developer ID Installer certificate, see https://developer.apple.com/help/account/create-certificates/create-developer-id-certificates. Install them to the login keychain.</li> <li>Install the Developer ID Intermediate Certificate (Developer ID - G2), from https://www.apple.com/certificateauthority/</li> </ul> </li> <li>dropDMG</li> <li>bash environments<ul> <li>add following lines to the ~/.bash_profile file:<pre><code>export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/opt/local/lib/pkgconfig:/usr/local/lib/pkgconfig\nexport PATH=/opt/local/bin:/usr/local/bin:/opt/local/Library/Frameworks/Python.framework/Versions/3.10/bin:$PATH\nexport LDFLAGS=\"-L/opt/local/lib -L/usr/local/lib\"\nexport CFLAGS=\"-I/opt/local/include -I/usr/local/include\"\nexport CPPFLAGS=\"-I/opt/local/include -I/usr/local/include\"\nexport LD_LIBRARY_PATH=/opt/lib:/usr/local/lib:/opt/local/lib/:/usr/local/lib/:$LD_LIBRARY_PATH\n\nQT_BASE=$HOME/Qt/6.2.4/macos\nexport PATH=$QT_BASE/bin:$PATH\nexport PKG_CONFIG_PATH=$QT_BASE/lib/pkgconfig:$PKG_CONFIG_PATH\nexport NOTARIZE_APPLE_ID=\"Your notarize account\"\nexport NOTARIZE_PASSWORD=\"Your notarize password\"\nexport NOTARIZE_TEAM_ID=\"Your notarize team id\"\n</code></pre> </li> </ul> </li> </ul>"},{"location":"develop/osx/#building-sync-client","title":"Building Sync Client","text":"<p>Following directory structures are expected when building Sync Client:</p> <pre><code>seafile-workspace/\nseafile-workspace/libsearpc/\nseafile-workspace/seafile/\nseafile-workspace/seafile-client/\n</code></pre> <p>The source code of these projects can be downloaded at github.com/haiwen/libsearpc, github.com/haiwen/seafile, and github.com/haiwen/seafile-client.</p>"},{"location":"develop/osx/#building","title":"Building","text":"<p>Note: the building commands have been included in the packaging script, you can skip building commands while packaging.</p> <p>To build libsearpc:</p> <pre><code>$ cd seafile-workspace/libsearpc/\n$ ./autogen.sh\n$ ./configure --disable-compile-demo --enable-compile-universal=yes\n$ make\n$ make install\n</code></pre> <p>To build seafile:</p> <pre><code>$ cd seafile-workspace/seafile/\n$ ./autogen.sh\n$ ./configure --disable-fuse --enable-compile-universal=yes\n$ make\n$ make install\n</code></pre> <p>To build seafile-client:</p> <pre><code>$ cd seafile-workspace/seafile-client/\n$ cmake -GXcode -B. -S.\n$ xcodebuild -target seafile-applet -configuration Release\n</code></pre>"},{"location":"develop/osx/#packaging","title":"Packaging","text":"<ol> <li>Update the CERT_ID in seafile-workspace/seafile/scripts/build/build-mac-local-py3.py to the ID of Developer ID Application.</li> <li>Run the packaging script: <code>python3 build-mac-local-py3.py --brand=\"\" --version=1.0.0 --nostrip --universal</code></li> </ol>"},{"location":"develop/rpi/","title":"How to Build Seafile Server Release Package","text":"<p>From Seafile 11.0, you can build Seafile release package with seafile-build script. You can check the README.md file in the same folder for detailed instructions.</p> <p>The <code>seafile-build.sh</code> compatible with more platforms, including Raspberry Pi, arm-64, x86-64.</p> <p>Old version is below:</p> <p>Table of contents:</p> <ul> <li>Setup the build environment</li> <li>Install packages</li> <li>Compile development libraries</li> <li>Install Python libraries</li> <li>Prepare source code</li> <li>Fetch git tags and prepare source tarballs</li> <li>Run the packaging script</li> <li>Test the built package</li> <li>Test a fresh install</li> <li>Test upgrading</li> </ul>"},{"location":"develop/rpi/#setup-the-build-environment","title":"Setup the build environment","text":"<p>Requirements:</p> <ul> <li>A raspberry pi with raspian distribution installed.</li> </ul>"},{"location":"develop/rpi/#install-packages","title":"Install packages","text":"<pre><code>sudo apt-get install build-essential\nsudo apt-get install libevent-dev libcurl4-openssl-dev libglib2.0-dev uuid-dev intltool libsqlite3-dev libmysqlclient-dev libarchive-dev libtool libjansson-dev valac libfuse-dev re2c flex python-setuptools cmake\n</code></pre>"},{"location":"develop/rpi/#compile-development-libraries","title":"Compile development libraries","text":""},{"location":"develop/rpi/#libevhtp","title":"libevhtp","text":"<p>libevhtp is a http server libary on top of libevent. It's used in seafile file server.</p> <pre><code>git clone https://www.github.com/haiwen/libevhtp.git\ncd libevhtp\ncmake -DEVHTP_DISABLE_SSL=ON -DEVHTP_BUILD_SHARED=OFF .\nmake\nsudo make install\n</code></pre> <p>After compiling all the libraries, run <code>ldconfig</code> to update the system libraries cache:</p> <pre><code>sudo ldconfig\n</code></pre>"},{"location":"develop/rpi/#install-python-libraries","title":"Install python libraries","text":"<p>Create a new directory <code>/home/pi/dev/seahub_thirdpart</code>:</p> <pre><code>mkdir -p ~/dev/seahub_thirdpart\n</code></pre> <p>Download these tarballs to <code>/tmp/</code>:</p> <ul> <li>pytz</li> <li>Django</li> <li>django-statici18n</li> <li>djangorestframework</li> <li>django_compressor</li> <li>jsonfield</li> <li>django-post_office</li> <li>gunicorn</li> <li>flup</li> <li>chardet</li> <li>python-dateutil</li> <li>six</li> <li>django-picklefield</li> <li>django-constance</li> <li>jdcal</li> <li>et_xmlfile</li> <li>openpyxl</li> <li>futures</li> <li>django-formtools</li> <li>qrcode</li> </ul> <p>Install all these libaries to <code>/home/pi/dev/seahub_thirdpart</code>:</p> <pre><code>cd ~/dev/seahub_thirdpart\nexport PYTHONPATH=.\npip install -t ~/dev/seahub_thirdpart/ /tmp/pytz-2016.1.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/Django-1.8.10.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/django-statici18n-1.1.3.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/djangorestframework-3.3.2.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/django_compressor-1.4.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/jsonfield-1.0.3.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/django-post_office-2.0.6.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/gunicorn-19.4.5.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/flup-1.0.2.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/chardet-2.3.0.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/python-dateutil-1.5.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/six-1.9.0.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/django-picklefield-0.3.2.tar.gz\nwget -O /tmp/django_constance.zip https://github.com/haiwen/django-constance/archive/bde7f7c.zip\npip install -t ~/dev/seahub_thirdpart/ /tmp/django_constance.zip\npip install -t ~/dev/seahub_thirdpart/ /tmp/jdcal-1.2.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/et_xmlfile-1.0.1.tar.gz\npip install -t ~/dev/seahub_thirdpart/ /tmp/openpyxl-2.3.0.tar.gz\n</code></pre>"},{"location":"develop/rpi/#prepare-seafile-source-code","title":"Prepare seafile source code","text":"<p>To build seafile server, there are four sub projects involved:</p> <ul> <li>libsearpc</li> <li>ccnet-server</li> <li>seafile-server</li> <li>seahub</li> </ul> <p>The build process has two steps:</p> <ul> <li>First, fetch the tags of each projects, and make a soruce tarball for each of them.</li> <li>Then run a <code>build-server.py</code> script to build the server package from the source tarballs.</li> </ul>"},{"location":"develop/rpi/#fetch-git-tags-and-prepare-source-tarballs","title":"Fetch git tags and prepare source tarballs","text":"<p>Seafile manages the releases in tags on github.</p> <p>Assume we are packaging for seafile server 6.0.1, then the tags are:</p> <ul> <li>ccnet-server, seafile-server, and seahub would all have a <code>v6.0.1-sever</code> tag.</li> <li>libsearpc would have the <code>v3.0-latest</code> tag (libsearpc has been quite stable and basically has no further development, so the tag is always <code>v3.0-latest</code>)</li> </ul> <p>First setup the <code>PKG_CONFIG_PATH</code> enviroment variable (So we don't need to make and make install libsearpc/ccnet/seafile into the system):</p> <pre><code>export PKG_CONFIG_PATH=/home/pi/dev/seafile/lib:$PKG_CONFIG_PATH\nexport PKG_CONFIG_PATH=/home/pi/dev/libsearpc:$PKG_CONFIG_PATH\nexport PKG_CONFIG_PATH=/home/pi/dev/ccnet:$PKG_CONFIG_PATH\n</code></pre>"},{"location":"develop/rpi/#libsearpc","title":"libsearpc","text":"<pre><code>cd ~/dev\ngit clone https://github.com/haiwen/libsearpc.git\ncd libsearpc\ngit reset --hard v3.0-latest\n./autogen.sh\n./configure\nmake dist\n</code></pre>"},{"location":"develop/rpi/#ccnet","title":"ccnet","text":"<pre><code>cd ~/dev\ngit clone https://github.com/haiwen/ccnet-server.git\ncd ccnet\ngit reset --hard v6.0.1-server\n./autogen.sh\n./configure\nmake dist\n</code></pre>"},{"location":"develop/rpi/#seafile","title":"seafile","text":"<pre><code>cd ~/dev\ngit clone https://github.com/haiwen/seafile-server.git\ncd seafile\ngit reset --hard v6.0.1-server\n./autogen.sh\n./configure\nmake dist\n</code></pre>"},{"location":"develop/rpi/#seahub","title":"seahub","text":"<pre><code>cd ~/dev\ngit clone https://github.com/haiwen/seahub.git\ncd seahub\ngit reset --hard v6.0.1-server\n./tools/gen-tarball.py --version=6.0.1 --branch=HEAD\n</code></pre>"},{"location":"develop/rpi/#seafobj","title":"seafobj","text":"<pre><code>cd ~/dev\ngit clone https://github.com/haiwen/seafobj.git\ncd seafobj\ngit reset --hard v6.0.1-server\nmake dist\n</code></pre>"},{"location":"develop/rpi/#seafdav","title":"seafdav","text":"<pre><code>cd ~/dev\ngit clone https://github.com/haiwen/seafdav.git\ncd seafdav\ngit reset --hard v6.0.1-server\nmake\n</code></pre>"},{"location":"develop/rpi/#copy-the-source-tar-balls-to-the-same-folder","title":"Copy the source tar balls to the same folder","text":"<pre><code>mkdir ~/seafile-sources\ncp ~/dev/libsearpc/libsearpc-&lt;version&gt;-tar.gz ~/seafile-sources\ncp ~/dev/ccnet/ccnet-&lt;version&gt;-tar.gz ~/seafile-sources\ncp ~/dev/seafile/seafile-&lt;version&gt;-tar.gz ~/seafile-sources\ncp ~/dev/seahub/seahub-&lt;version&gt;-tar.gz ~/seafile-sources\n\ncp ~/dev/seafobj/seafobj.tar.gz ~/seafile-sources\ncp ~/dev/seafdav/seafdav.tar.gz ~/seafile-sources\n</code></pre>"},{"location":"develop/rpi/#run-the-packaging-script","title":"Run the packaging script","text":"<p>Now we have all the tarballs prepared, we can run the <code>build-server.py</code> script to build the server package.</p> <pre><code>mkdir ~/seafile-server-pkgs\n~/dev/seafile/scripts/build-server.py --libsearpc_version=&lt;libsearpc_version&gt; --ccnet_version=&lt;ccnet_version&gt; --seafile_version=&lt;seafile_version&gt; --seahub_version=&lt;seahub_version&gt; --srcdir=  --thirdpartdir=/home/pi/dev/seahub_thirdpart --srcdir=/home/pi/seafile-sources --outputdir=/home/pi/seafile-server-pkgs\n</code></pre> <p>After the script finisheds, we would get a <code>seafile-server_6.0.1_pi.tar.gz</code> in <code>~/seafile-server-pkgs</code> folder.</p>"},{"location":"develop/rpi/#test-the-built-package","title":"Test the built package","text":""},{"location":"develop/rpi/#test-a-fresh-install","title":"Test a fresh install","text":"<p>The test should cover these steps at least:</p> <ul> <li>The setup process is ok</li> <li>After <code>seafile.sh start</code> and <code>seahub.sh start</code>, you can login from a browser.</li> <li>Uploading/Downloading files through a web browser works correctly.</li> <li>Seafile WebDAV server works correctly</li> </ul>"},{"location":"develop/rpi/#test-upgrading-from-a-previous-version","title":"Test upgrading from a previous version","text":"<ul> <li>Download the package of the previous version seafile server, and setup it.</li> <li>Upgrading according to the manual</li> <li>After the upgrade, check the functionality is ok:</li> <li>Uploading/Downloading files through a web browser works correctly.</li> <li>Seafile WebDAV server works correctly</li> </ul>"},{"location":"develop/server/","title":"Server development","text":"<p>This is the document for deploying Seafile open source development environment in Ubuntu 2204 docker container.</p>"},{"location":"develop/server/#create-persistent-directories","title":"Create persistent directories","text":"<p>Login a linux server as <code>root</code> user, then:</p> <pre><code>mkdir -p /root/seafile-ce-docker/source-code\nmkdir -p /root/seafile-ce-docker/conf\nmkdir -p /root/seafile-ce-docker/logs\nmkdir -p /root/seafile-ce-docker/mysql-data\nmkdir -p /root/seafile-ce-docker/seafile-data/library-template\n</code></pre>"},{"location":"develop/server/#run-a-container","title":"Run a container","text":"<p>After install docker, start a container to deploy seafile open source development environment.</p> <pre><code>docker run --mount type=bind,source=/root/seafile-ce-docker/source-code,target=/root/dev/source-code \\\n           --mount type=bind,source=/root/seafile-ce-docker/conf,target=/root/dev/conf \\\n           --mount type=bind,source=/root/seafile-ce-docker/logs,target=/root/dev/logs \\\n           --mount type=bind,source=/root/seafile-ce-docker/seafile-data,target=/root/dev/seafile-data \\\n           --mount type=bind,source=/root/seafile-ce-docker/mysql-data,target=/var/lib/mysql \\\n           -it -p 8000:8000 -p 8082:8082 -p 3000:3000 --name seafile-ce-env ubuntu:22.04 bash\n</code></pre> <p>Note, the following commands are all executed in the seafile-ce-env docker container.</p>"},{"location":"develop/server/#update-source-and-install-dependencies","title":"Update Source and Install Dependencies.","text":"<p>Update base system and install base dependencies:</p> <pre><code>apt-get update &amp;&amp; apt-get upgrade -y\n\napt-get install -y ssh libevent-dev libcurl4-openssl-dev libglib2.0-dev uuid-dev intltool libsqlite3-dev libmysqlclient-dev libarchive-dev libtool libjansson-dev valac libfuse-dev python3-dateutil cmake re2c flex sqlite3 python3-pip python3-simplejson git libssl-dev libldap2-dev libonig-dev vim vim-scripts wget cmake gcc autoconf automake mysql-client librados-dev libxml2-dev curl sudo telnet netcat unzip netbase ca-certificates apt-transport-https build-essential libxslt1-dev libffi-dev libpcre3-dev libz-dev xz-utils nginx pkg-config poppler-utils libmemcached-dev sudo ldap-utils libldap2-dev libjwt-dev\n</code></pre> <p>Install Node 16 from nodesource:</p> <pre><code>curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg\necho \"deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_16.x nodistro main\" | sudo tee /etc/apt/sources.list.d/nodesource.list\napt-get install -y nodejs\n</code></pre> <p>Install other Python 3 dependencies:</p> <pre><code>apt-get install -y python3 python3-dev python3-pip python3-setuptools python3-ldap\n\npython3 -m pip install --upgrade pip\n\npip3 install Django==4.2.* django-statici18n==2.3.* django_webpack_loader==1.7.* django_picklefield==3.1 django_formtools==2.4 django_simple_captcha==0.6.* djangosaml2==1.5.* djangorestframework==3.14.* python-dateutil==2.8.* pyjwt==2.6.* pycryptodome==3.16.* python-cas==1.6.* pysaml2==7.2.* requests==2.28.* requests_oauthlib==1.3.* future==0.18.* gunicorn==20.1.* mysqlclient==2.1.* qrcode==7.3.* pillow==10.2.* chardet==5.1.* cffi==1.15.1 captcha==0.5.* openpyxl==3.0.* Markdown==3.4.* bleach==5.0.* python-ldap==3.4.* sqlalchemy==2.0.18 redis mock pytest pymysql configparser pylibmc django-pylibmc nose exam splinter pytest-django\n</code></pre>"},{"location":"develop/server/#install-mariadb-and-create-databases","title":"Install MariaDB and Create Databases","text":"<pre><code>apt-get install -y mariadb-server\nservice mariadb start\nmysqladmin -u root password your_password\n</code></pre> <p>sql for create databases</p> <pre><code>mysql -uroot -pyour_password -e \"CREATE DATABASE ccnet CHARACTER SET utf8;\"\nmysql -uroot -pyour_password -e \"CREATE DATABASE seafile CHARACTER SET utf8;\"\nmysql -uroot -pyour_password -e \"CREATE DATABASE seahub CHARACTER SET utf8;\"\n</code></pre>"},{"location":"develop/server/#download-source-code","title":"Download Source Code","text":"<pre><code>cd ~/\ncd ~/dev/source-code\n\ngit clone https://github.com/haiwen/libevhtp.git\ngit clone https://github.com/haiwen/libsearpc.git\ngit clone https://github.com/haiwen/seafile-server.git\ngit clone https://github.com/haiwen/seafevents.git\ngit clone https://github.com/haiwen/seafobj.git\ngit clone https://github.com/haiwen/seahub.git\n\ncd libevhtp/\ngit checkout tags/1.1.7 -b tag-1.1.7\n\ncd ../libsearpc/\ngit checkout tags/v3.3-latest -b tag-v3.3-latest\n\ncd ../seafile-server\ngit checkout tags/v11.0.5-server -b tag-v11.0.5-server\n\ncd ../seafevents\ngit checkout tags/v11.0.5-server -b tag-v11.0.5-server\n\ncd ../seafobj\ngit checkout tags/v11.0.5-server -b tag-v11.0.5-server\n\ncd ../seahub\ngit checkout tags/v11.0.5-server -b tag-v11.0.5-server\n</code></pre>"},{"location":"develop/server/#compile-and-install-seaf-server","title":"Compile and Install seaf-server","text":"<pre><code>cd ../libevhtp\ncmake -DEVHTP_DISABLE_SSL=ON -DEVHTP_BUILD_SHARED=OFF .\nmake\nmake install\nldconfig\n\ncd ../libsearpc\n./autogen.sh\n./configure\nmake\nmake install\nldconfig\n\ncd ../seafile-server\n./autogen.sh\n./configure --disable-fuse\nmake\nmake install\nldconfig\n</code></pre>"},{"location":"develop/server/#create-conf-files","title":"Create Conf Files","text":"<pre><code>cd ~/dev/conf\n\ncat &gt; ccnet.conf  &lt;&lt;EOF\n[Database]\nENGINE = mysql\nHOST = localhost\nPORT = 3306\nUSER = root\nPASSWD = 123456\nDB = ccnet\nCONNECTION_CHARSET = utf8\nCREATE_TABLES = true\nEOF\n\ncat &gt; seafile.conf  &lt;&lt;EOF\n[database]\ntype = mysql\nhost = localhost\nport = 3306\nuser = root\npassword = 123456\ndb_name = seafile\nconnection_charset = utf8\ncreate_tables = true\nEOF\n\ncat &gt; seafevents.conf  &lt;&lt;EOF\n[DATABASE]\ntype = mysql\nusername = root\npassword = 123456\nname = seahub\nhost = localhost\nEOF\n\ncat &gt; seahub_settings.py  &lt;&lt;EOF\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'seahub',\n        'USER': 'root',\n        'PASSWORD': '123456',\n        'HOST': 'localhost',\n        'PORT': '3306',\n    }\n}\nFILE_SERVER_ROOT = 'http://127.0.0.1:8082'\nSERVICE_URL = 'http://127.0.0.1:8000'\nEOF\n</code></pre>"},{"location":"develop/server/#start-seaf-server","title":"Start seaf-server","text":"<pre><code>seaf-server -F /root/dev/conf -d /root/dev/seafile-data -l /root/dev/logs/seafile.log &gt;&gt; /root/dev/logs/seafile.log 2&gt;&amp;1 &amp;\n</code></pre>"},{"location":"develop/server/#start-seafevents-and-seahub","title":"Start seafevents and seahub","text":""},{"location":"develop/server/#prepare-environment-variables","title":"Prepare environment variables","text":"<pre><code>export CCNET_CONF_DIR=/root/dev/conf\nexport SEAFILE_CONF_DIR=/root/dev/seafile-data\nexport SEAFILE_CENTRAL_CONF_DIR=/root/dev/conf\nexport SEAHUB_DIR=/root/dev/source-code/seahub\nexport SEAHUB_LOG_DIR=/root/dev/logs\nexport PYTHONPATH=/usr/local/lib/python3.10/dist-packages/:/usr/local/lib/python3.10/site-packages/:/root/dev/source-code/:/root/dev/source-code/seafobj/:/root/dev/source-code/seahub/thirdpart:$PYTHONPATH\n</code></pre>"},{"location":"develop/server/#start-seafevents","title":"Start seafevents","text":"<pre><code>cd /root/dev/source-code/seafevents/\npython3 main.py --loglevel=debug --logfile=/root/dev/logs/seafevents.log --config-file /root/dev/conf/seafevents.conf &gt;&gt; /root/dev/logs/seafevents.log 2&gt;&amp;1 &amp;\n</code></pre>"},{"location":"develop/server/#start-seahub","title":"Start seahub","text":""},{"location":"develop/server/#create-seahub-database-tables","title":"Create seahub database tables","text":"<pre><code>cd /root/dev/source-code/seahub/\npython3 manage.py migrate\n</code></pre>"},{"location":"develop/server/#create-user","title":"Create user","text":"<pre><code>python3 manage.py createsuperuser\n</code></pre>"},{"location":"develop/server/#start-seahub_1","title":"Start seahub","text":"<pre><code>python3 manage.py runserver 0.0.0.0:8000\n</code></pre> <p>Then, you can visit http://127.0.0.1:8000/  to use Seafile.</p>"},{"location":"develop/server/#the-final-directory-structure","title":"The Final Directory Structure","text":""},{"location":"develop/server/#more","title":"More","text":""},{"location":"develop/server/#deploy-frontend-development-environment","title":"Deploy Frontend Development Environment","text":"<p>For deploying frontend development enviroment, you need:</p> <p>1, checkout seahub to master branch</p> <pre><code>cd /root/dev/source-code/seahub\n\ngit fetch origin master:master\ngit checkout master\n</code></pre> <p>2, add the following configration to /root/dev/conf/seahub_settings.py</p> <pre><code>import os\nPROJECT_ROOT = '/root/dev/source-code/seahub'\nWEBPACK_LOADER = {\n    'DEFAULT': {\n        'BUNDLE_DIR_NAME': 'frontend/',\n        'STATS_FILE': os.path.join(PROJECT_ROOT,\n                                   'frontend/webpack-stats.dev.json'),\n    }\n}\nDEBUG = True\n</code></pre> <p>3, install js modules</p> <pre><code>cd /root/dev/source-code/seahub/frontend\n\nnpm install\n</code></pre> <p>4, npm run dev</p> <pre><code>cd /root/dev/source-code/seahub/frontend\n\nnpm run dev\n</code></pre> <p>5, start seaf-server and seahub</p>"},{"location":"develop/translation/","title":"Translation","text":""},{"location":"develop/translation/#seahub-seafile-server-71-and-above","title":"Seahub (Seafile Server 7.1 and above)","text":""},{"location":"develop/translation/#translate-and-try-locally","title":"Translate and try locally","text":"<p>1. Locate the translation files in the seafile-server-latest/seahub directory:</p> <ul> <li>For Seahub (except Markdown editor): <code>/locale/&lt;lang-code&gt;/LC_MESSAGES/django.po</code>\u00a0  and  \u00a0<code>/locale/&lt;lang-code&gt;/LC_MESSAGES/djangojs.po</code></li> <li>For Markdown editor: <code>/media/locales/&lt;lang-code&gt;/seafile-editor.json</code></li> </ul> <p>For example, if you want to improve the Russian translation, find the corresponding strings to be edited in either of the following three files: </p> <ul> <li><code>/seafile-server-latest/seahub/locale/ru/LC_MESSAGES/django.po</code></li> <li><code>/seafile-server-latest/seahub/locale/ru/LC_MESSAGES/djangojs.po</code></li> <li><code>/seafile-server-latest/seahub/media/locales/ru/seafile-editor.json</code></li> </ul> <p>If there is no translation for your language, create a new folder matching your language code and copy-paste the contents of another language folder in your newly created one. (Don't copy from the 'en' folder because the files therein do not contain the strings to be translated.) </p> <p>2. Edit the files using an UTF-8 editor.</p> <p>3. Save your changes. </p> <p>4. (Only necessary when you created a new language code folder) Add a new entry for your language to the language block in the <code>/seafile-server-latest/seahub/seahub/settings.py</code> file and save it. </p> <pre><code>LANGUAGES = (\n    ...\n    ('ru', '\u0420\u0443\u0441\u0441\u043a\u0438\u0439'),\n    ...\n)\n</code></pre> <p>5. (Only necessary when you edited either django.po or djangojs.po) Apply the changes made in django.po and djangojs.po by running the following two commands in <code>/seafile-server-latest/seahub/locale/&lt;lang-code&gt;/LC_MESSAGES</code>:</p> <ul> <li><code>msgfmt -o django.mo django.po</code></li> <li><code>msgfmt -o djangojs.mo djangojs.po</code></li> </ul> <p>Note: msgfmt is included in the gettext package.</p> <p>Additionally, run the following two commands in the seafile-server-latest directory:</p> <ul> <li><code>./seahub.sh python-env python3 seahub/manage.py compilejsi18n -l &lt;lang-code&gt;</code></li> <li><code>./seahub.sh python-env python3 seahub/manage.py collectstatic --noinput -i admin -i termsandconditions --no-post-process</code></li> </ul> <p>6. Restart Seahub to load changes made in django.po and djangojs.po; reload the Markdown editor to check your modifications in the seafile-editor.json file.</p>"},{"location":"develop/translation/#submit-your-translation","title":"Submit your translation","text":"<p>Please submit translations via Transifex: https://www.transifex.com/projects/p/seahub/</p> <p>Steps:</p> <ol> <li>Create a free account on Transifex (https://www.transifex.com/). </li> <li>Send a request to join the language translation. </li> <li>After accepted by the project maintainer, then you can upload your file or translate online.</li> </ol>"},{"location":"develop/translation/#faq","title":"FAQ","text":""},{"location":"develop/translation/#filenotfounderror","title":"FileNotFoundError","text":"<p><code>FileNotFoundError</code> occurred when executing the command <code>manage.py collectstatic</code>.</p> <pre><code>FileNotFoundError: [Errno 2] No such file or directory: '/opt/seafile/seafile-server-latest/seahub/frontend/build'\n</code></pre> <p>Steps:</p> <ol> <li> <p>Modify <code>STATICFILES_DIRS</code> in <code>/opt/seafile/seafile-server-latest/seahub/seahub/settings.py</code> manually</p> <pre><code>STATICFILES_DIRS = (\n    # Put strings here, like \"/home/html/static\" or \"C:/www/django/static\".\n    # Always use forward slashes, even on Windows.\n    # Don't forget to use absolute paths, not relative paths.\n    '%s/static' % PROJECT_ROOT,\n#    '%s/frontend/build' % PROJECT_ROOT,\n)\n</code></pre> </li> <li> <p>Execute the command</p> <pre><code>./seahub.sh python-env python3 seahub/manage.py collectstatic --noinput -i admin -i termsandconditions --no-post-process\n</code></pre> </li> <li> <p>Restore <code>STATICFILES_DIRS</code> manually</p> <p>```python STATICFILES_DIRS = (     # Put strings here, like \"/home/html/static\" or \"C:/www/django/static\".     # Always use forward slashes, even on Windows.     # Don't forget to use absolute paths, not relative paths.     '%s/static' % PROJECT_ROOT,     '%s/frontend/build' % PROJECT_ROOT, )</p> </li> <li> <p>Restart Seahub</p> <pre><code>./seahub.sh restart\n</code></pre> </li> </ol> <p>This issue has been fixed since version 11.0</p>"},{"location":"develop/web_api_v2.1/","title":"Web API","text":""},{"location":"develop/web_api_v2.1/#seafile-web-api","title":"Seafile Web API","text":"<p>The API document can be accessed in the following location:</p> <ul> <li>https://seafile-api.readme.io/  (New)</li> <li>https://download.seafile.com/published/web-api/home.md (Old)</li> </ul>"},{"location":"develop/web_api_v2.1/#admin-only","title":"Admin Only","text":"<p>The Admin API document can be accessed in the following location:</p> <ul> <li>https://seafile-api.readme.io/  (New)</li> </ul>"},{"location":"develop/windows/","title":"Windows","text":""},{"location":"develop/windows/#environment-setup","title":"Environment Setup","text":"<p>The following setups are required for building and packaging Sync Client on Windows:</p> <ul> <li>Visual Studio 2019<ul> <li>Desktop development with C++<ul> <li>MSVC v142</li> <li>Windows 10 SDK (10.0.19041.0) (installed by default, not used)</li> <li>Windows 10 SDK (10.0.18362.0)</li> </ul> </li> <li>Universal Windows Platform development<ul> <li>Windows 10 SDK (10.0.18362.0)</li> </ul> </li> </ul> </li> <li>Qt 6.5<ul> <li>MSVC 2019 64-bit</li> <li>Qt 5 Compatibility Module</li> <li>Qt Positioning</li> <li>Qt Serial Port</li> <li>Qt WebChannel</li> <li>Qt WebEngine</li> </ul> </li> <li>Qt VS Tools</li> <li> <p>vcpkg (it is recommended to update to the latest version)</p> <p>Note: Dependencies will be automatically downloaded and compiled when building VS projects.</p> </li> <li> <p>Python 3.7</p> </li> <li>wix<ul> <li>install to C:\\wix</li> </ul> </li> <li>Paraffin<ul> <li>copy Paraffin.exe to C:\\wix\\bin</li> </ul> </li> <li>Breakpad</li> <li> <p>Certificates</p> <ul> <li>install to C:\\certs</li> </ul> <p>Note: certificates for Windows application are issued by third-party certificate authority.</p> </li> </ul>"},{"location":"develop/windows/#breakpad","title":"Breakpad","text":"<p>Support for Breakpad can be added by running following steps:</p> <ul> <li> <p>install gyp tool</p> <pre><code>$ git clone --depth=1 git@github.com:chromium/gyp.git\n$ python setup.py install\n</code></pre> </li> <li> <p>compile breakpad</p> <pre><code>$ git clone --depth=1 git@github.com:google/breakpad.git\n$ cd breakpad\n$ git clone https://github.com/google/googletest.git testing\n$ cd ..\n# create vs solution, this may throw an error \"module collections.abc has no attribute OrderedDict\", you should open the msvs.py and replace 'collections.abc' with 'collections'.\n$ gyp \u2013-no-circular-check breakpad\\src\\client\\windows\\breakpad_client.gyp\n</code></pre> <ul> <li>open breakpad_client.sln and configure C++ Language Standard to C++17 and C/C++ ---&gt; Code Generation ---&gt; Runtime Library to Multi-threaded DLL (/MD)</li> <li>build breakpad</li> </ul> </li> <li> <p>compile dump_syms tool</p> <p>create vs solution</p> <pre><code>gyp \u2013-no-circular-check breakpad\\src\\tools\\windows\\tools_windows.gyp\n</code></pre> <ul> <li>open tools_windows.sln and build tools_windows</li> <li>Insert #include in the source file about unique_ptr compilation error and recompile.</li> <li>build dump_syms</li> <li>Copy C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\Common7\\IDE\\Remote Debugger\\x64\\msdia140.dll to breakpad\\src\\tools\\windows\\Release.</li> </ul> </li> <li> <p>copy VC merge modules</p> <pre><code>copy C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Redist\\MSVC\\v142\\MergeModules\\MergeModules\\Microsoft_VC142_CRT_x64.msm C:\\packagelib\n</code></pre> </li> </ul>"},{"location":"develop/windows/#building-sync-client","title":"Building Sync Client","text":"<p>Following directory structures are expected when building Sync Client:</p> <pre><code>seafile-workspace/\nseafile-workspace/libsearpc/\nseafile-workspace/seafile/\nseafile-workspace/seafile-client/\nseafile-workspace/seafile-shell-ext/\n</code></pre> <p>The source code of these projects can be downloaded at github.com/haiwen/libsearpc, github.com/haiwen/seafile, github.com/haiwen/seafile-client, and github.com/haiwen/seafile-shell-ext.</p>"},{"location":"develop/windows/#building","title":"Building","text":"<p>Note: the building commands have been included in the packaging script, you can skip building commands while packaging.</p> <p>To build libsearpc:</p> <pre><code>$ cd seafile-workspace/libsearpc/\n$ devenv libsearpc.sln /build \"Release|x64\"\n</code></pre> <p>To build seafile</p> <pre><code>$ cd seafile-workspace/seafile/\n$ devenv seafile.sln /build \"Release|x64\"\n$ devenv msi/custom/seafile_custom.sln /build \"Release|x64\"\n</code></pre> <p>To build seafile-client</p> <pre><code>$ cd seafile-workspace/seafile-client/\n$ devenv third_party/quazip/quazip.sln /build \"Release|x64\"\n$ devenv seafile-client.sln /build \"Release|x64\"\n</code></pre> <p>To build seafile-shell-ext</p> <pre><code>$ cd seafile-workspace/seafile-shell-ext/\n$ devenv extensions/seafile_ext.sln /build \"Release|x64\"\n$ devenv seadrive-thumbnail-ext/seadrive_thumbnail_ext.sln /build \"Release|x64\"\n</code></pre>"},{"location":"develop/windows/#packaging","title":"Packaging","text":"<ol> <li>Update the CERTFILE configure in seafile-workspace/seafile/scripts/build/build-msi-vs.py .</li> <li>Run commands:<pre><code>$ cd seafile-workspace/seafile-client/third_party/quazip\n$ devenv quazip.sln /build Release|x64\n$ cd seafile-workspace/seafile/scripts/build\n$ python build-msi-vs.py 1.0.0\n</code></pre> </li> </ol>"},{"location":"extension/distributed_indexing/","title":"Distributed indexing","text":"<p>If you use a cluster to deploy Seafile, you can use distributed indexing to realize real-time indexing and improve indexing efficiency. The indexing process is as follows:</p> <p></p>"},{"location":"extension/distributed_indexing/#install-redis-and-modify-configuration-files","title":"Install redis and modify configuration files","text":""},{"location":"extension/distributed_indexing/#1-install-redis-on-all-frontend-nodes","title":"1. Install redis on all frontend nodes","text":"<p>Tip</p> <p>If you use redis cloud service, skip this step and modify the configuration files directly</p> UbuntuCentOS <pre><code>$ apt install redis-server\n</code></pre> <pre><code>$ yum install redis\n</code></pre>"},{"location":"extension/distributed_indexing/#2-install-python-redis-third-party-package-on-all-frontend-nodes","title":"2. Install python redis third-party package on all frontend nodes","text":"<pre><code>$ pip install redis\n</code></pre>"},{"location":"extension/distributed_indexing/#3-modify-the-seafeventsconf-on-all-frontend-nodes","title":"3. Modify the <code>seafevents.conf</code> on all frontend nodes","text":"<p>Add the following config items</p> <pre><code>[EVENTS PUBLISH]\nmq_type=redis   # must be redis\nenabled=true\n\n[REDIS]\nserver=127.0.0.1   # your redis server host\nport=6379          # your redis server port\npassword=xxx       # your redis server password, if not password, do not set this item\n</code></pre>"},{"location":"extension/distributed_indexing/#4-modify-the-seafeventsconf-on-the-backend-node","title":"4. Modify the <code>seafevents.conf</code> on the backend node","text":"<p>Disable the scheduled indexing task, because the scheduled indexing task and the distributed indexing task conflict.</p> <pre><code>[INDEX FILES]\nenabled=true\n     |\n     V\nenabled=false   \n</code></pre>"},{"location":"extension/distributed_indexing/#5-restart-seafile","title":"5. Restart Seafile","text":"Deploy in DockerDeploy from binary packages <pre><code>docker exec -it seafile bash\ncd /scripts\n./seafile.sh restart &amp;&amp; ./seahub.sh restart\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\n./seafile.sh restart &amp;&amp; ./seahub.sh restart\n</code></pre>"},{"location":"extension/distributed_indexing/#deploy-distributed-indexing","title":"Deploy distributed indexing","text":"<p>First, prepare a index-server master node and several index-server slave nodes, the number of slave nodes depends on your needs. Copy the <code>seafile.conf</code> and the <code>seafevents.conf</code> in the <code>conf</code> directory from the Seafile frontend nodes to <code>/opt/seafile-data/seafile/conf</code> in index-server nodes. The master node and slave nodes need to read the configuration files to obtain the necessary information.</p> <pre><code>mkdir -p /opt/seafile-data/seafile/conf\nmkdir -p /opt/seafile\n</code></pre> <p>Then download <code>.env</code> and <code>index-server.yml</code> to <code>/opt/seafile</code> in all index-server nodes.</p> <pre><code>cd /opt/seafile\nwget https://manual.seafile.com/12.0/repo/docker/index-server/index-server.yml\nwget -O .env https://manual.seafile.com/12.0/repo/docker/index-server/env\n</code></pre> <p>Modify mysql configurations in <code>.env</code>.</p> <pre><code>SEAFILE_MYSQL_DB_HOST=127.0.0.1\nSEAFILE_MYSQL_DB_PORT=3306\nSEAFILE_MYSQL_DB_USER=seafile\nSEAFILE_MYSQL_DB_PASSWORD=PASSWORD\n\nCLUSTER_MODE=master\n</code></pre> <p>Note</p> <p>CLUSTER_MODE needs to be configured as <code>master</code> on the master node, and needs to be configured as <code>worker</code> on the slave nodes.</p> <p>Next, create a configuration file <code>index-master.conf</code> in the <code>conf</code> directory of the master node, e.g.</p> <pre><code>[DEFAULT]\nmq_type=redis      # must be redis\n\n[REDIS]\nserver=127.0.0.1   # your redis server host\nport=6379          # your redis server port\npassword=xxx       # your redis server password, if not password, do not set this item\n</code></pre> <p>Start master node.</p> <pre><code>docker compose up -d\n</code></pre> <p>Next, create a configuration file <code>index-worker.conf</code> in the <code>conf</code> directory of all slave nodes, e.g.</p> <pre><code>[DEFAULT]\nmq_type=redis      # must be redis\nindex_workers=2    # number of threads to create/update indexes, you can increase this value according to your needs\n\n[REDIS]\nserver=127.0.0.1   # your redis server host\nport=6379          # your redis server port\npassword=xxx       # your redis server password, if not password, do not set this item\n</code></pre> <p>Start all slave nodes.</p> <pre><code>docker compose up -d\n</code></pre>"},{"location":"extension/distributed_indexing/#some-commands-in-distributed-indexing","title":"Some commands in distributed indexing","text":"<p>Rebuild search index, first execute the command in the Seafile node:</p> <pre><code>cd /opt/seafile/seafile-server-last/\n./pro/pro.py search --clear\n</code></pre> <p>Then execute the command in the index-server master node:</p> <pre><code>docker exec -it index-server bash\n/opt/seafile/index-server/index-server.sh restore-all-repo\n</code></pre> <p>List the number of indexing tasks currently remaining, execute the command in the index-server master node:</p> <pre><code>/opt/seafile/index-server/index-server.sh show-all-task\n</code></pre>"},{"location":"extension/fuse/","title":"FUSE extension","text":"<p>Files in the seafile system are split to blocks, which means what are stored on your seafile server are not complete files, but blocks. This design faciliates effective data deduplication.</p> <p>However, administrators sometimes want to access the files directly on the server. You can use seaf-fuse to do this.</p> <p><code>Seaf-fuse</code> is an implementation of the FUSE virtual filesystem. In a word, it mounts all the seafile files to a folder (which is called the '''mount point'''), so that you can access all the files managed by seafile server, just as you access a normal folder on your server.</p> <p>Note</p> <ul> <li>Encrypted folders can't be accessed by seaf-fuse.</li> <li>Currently the implementation is '''read-only''', which means you can't modify the files through the mounted folder.</li> <li>On debian/centos systems, you need to be in the \"fuse\" group to have the permission to mount a FUSE folder.</li> </ul>"},{"location":"extension/fuse/#use-seaf-fuse-in-docker-based-deployment","title":"Use seaf-fuse in Docker based deployment","text":"<p>Assume we want to mount to <code>/opt/seafile-fuse</code> in host.</p>"},{"location":"extension/fuse/#modify-seafile-serveryml","title":"Modify seafile-server.yml","text":"<p>Add the following content</p> <pre><code>  seafile:\n    ...\n    volumes:\n      ...\n      - type: bind\n        source: /opt/seafile-fuse\n        target: /seafile-fuse\n        bind:\n          propagation: rshared\n    privileged: true\n    cap_add:\n      - SYS_ADMIN\n</code></pre>"},{"location":"extension/fuse/#start-seaf-fuse-with-the-script-in-docker","title":"Start seaf-fuse with the script in docker","text":"<p>Start Seafile server and enter the container</p> <pre><code>docker compose up -d\n\ndocker exec -it seafile bash\n</code></pre> <p>Start seaf-fuse in the container</p> <pre><code>cd /opt/seafile/seafile-server-latest/\n\n./seaf-fuse.sh start /seafile-fuse\n</code></pre>"},{"location":"extension/fuse/#use-seaf-fuse-in-binary-based-deployment","title":"Use seaf-fuse in binary based deployment","text":"<p>Assume we want to mount to <code>/data/seafile-fuse</code>.</p>"},{"location":"extension/fuse/#create-the-folder-as-the-mount-point","title":"Create the folder as the mount point","text":"<pre><code>mkdir -p /data/seafile-fuse\n</code></pre>"},{"location":"extension/fuse/#start-seaf-fuse-with-the-script","title":"Start seaf-fuse with the script","text":"<p>Before start seaf-fuse, you should have started seafile server with <code>./seafile.sh start</code></p> <pre><code>./seaf-fuse.sh start /data/seafile-fuse\n</code></pre> <p>seaf-fuse supports standard mount options for FUSE. For example, you can specify ownership for the mounted folder:</p> <pre><code>./seaf-fuse.sh start -o uid=&lt;uid&gt; /data/seafile-fuse\n</code></pre> <p>The fuse enables the block cache function by default to cache block objects, thereby reducing access to backend storage, but this function will occupy local disk space. Since Seafile-pro-10.0.0, you can disable block cache by adding following options:</p> <pre><code>./seaf-fuse.sh start --disable-block-cache /data/seafile-fuse\n</code></pre> <p>You can find the complete list of supported options in <code>man fuse</code>.</p>"},{"location":"extension/fuse/#stop-seaf-fuse","title":"Stop seaf-fuse","text":"<pre><code>./seaf-fuse.sh stop\n</code></pre>"},{"location":"extension/fuse/#contents-of-the-mounted-folder","title":"Contents of the mounted folder","text":""},{"location":"extension/fuse/#the-top-level-folder","title":"The top level folder","text":"<p>Now you can list the content of <code>/data/seafile-fuse</code>.</p> <pre><code>$ ls -lhp /data/seafile-fuse\n\ndrwxr-xr-x 2 root root 4.0K Jan  1  2015 abc@abc.com/\ndrwxr-xr-x 2 root root 4.0K Jan  4  2015 foo@foo.com/\ndrwxr-xr-x 2 root root 4.0K Jan  1  2015 plus@plus.com/\ndrwxr-xr-x 2 root root 4.0K Jan  1  2015 sharp@sharp.com/\ndrwxr-xr-x 2 root root 4.0K Jan  3  2015 test@test.com/\n</code></pre> <ul> <li>The top level folder contains many subfolders, each of which corresponds to a user</li> </ul>"},{"location":"extension/fuse/#the-folder-for-each-user","title":"The folder for each user","text":"<pre><code>$ ls -lhp /data/seafile-fuse/abc@abc.com\n\ndrwxr-xr-x 2 root root  924 Jan  1  1970 5403ac56-5552-4e31-a4f1-1de4eb889a5f_Photos/\ndrwxr-xr-x 2 root root 1.6K Jan  1  1970 a09ab9fc-7bd0-49f1-929d-6abeb8491397_My Notes/\n</code></pre> <p>From the above list you can see, under the folder of a user there are subfolders, each of which represents a library of that user, and has a name of this format: '''{library_id}-{library-name}'''.</p>"},{"location":"extension/fuse/#the-folder-for-a-library","title":"The folder for a library","text":"<pre><code>$ ls -lhp /data/seafile-fuse/abc@abc.com/5403ac56-5552-4e31-a4f1-1de4eb889a5f_Photos/\n\n-rw-r--r-- 1 root root 501K Jan  1  2015 image.png\n-rw-r--r-- 1 root root 501K Jan  1  2015 sample.jpng\n</code></pre>"},{"location":"extension/fuse/#if-you-get-a-permission-denied-error","title":"If you get a \"Permission denied\" error","text":"<p>If you get an error message saying \"Permission denied\" when running <code>./seaf-fuse.sh start</code>, most likely you are not in the \"fuse group\". You should:</p> <ul> <li> <p>Add yourself to the fuse group <pre><code>sudo usermod -a -G fuse &lt;your-user-name&gt;\n</code></pre></p> </li> <li> <p>Logout your shell and login again</p> </li> <li>Now try <code>./seaf-fuse.sh start &lt;path&gt;</code>again.</li> </ul>"},{"location":"extension/libreoffice_online/","title":"Integrate Seafile with Collabora Online (LibreOffice Online)","text":""},{"location":"extension/libreoffice_online/#setup-collaboraonline","title":"Setup CollaboraOnline","text":"<p>Deployment Tips</p> <p>The steps from this guide only cover installing collabora as another container on the same docker host that your seafile docker container is on. Please make sure your host have sufficient cores and RAM. </p> <p>If you want to install on another host please refer the collabora documentation for instructions. Then you should follow here to configure <code>seahub_settings.py</code> to enable online office.</p> <p>Note</p> <p>To integrate LibreOffice with Seafile, you have to enable HTTPS in your Seafile server:</p> Deploy in DockerDeploy from binary packages <p>Modify <code>.env</code> file:</p> <pre><code>SEAFILE_SERVER_PROTOCOL=https\n</code></pre> <p>Please follow the links to enable https by Nginx</p> <p>Download the <code>collabora.yml</code></p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/collabora.yml\n</code></pre> <p>Insert <code>collabora.yml</code> to field <code>COMPOSE_FILE</code> lists (i.e., <code>COMPOSE_FILE='...,collabora.yml'</code>) and add the relative options in <code>.env</code></p> <pre><code>COLLABORA_IMAGE=collabora/code:24.04.5.1.1 # image of LibreOffice\nCOLLABORA_PORT=6232 # expose port\nCOLLABORA_USERNAME=&lt;your LibreOffice admin username&gt;\nCOLLABORA_PASSWORD=&lt;your LibreOffice admin password&gt;\nCOLLABORA_ENABLE_ADMIN_CONSOLE=true # enable admin console or not\nCOLLABORA_REMOTE_FONT= # remote font url\nCOLLABORA_ENABLE_FILE_LOGGING=false # use file logs or not, see FQA\n</code></pre>"},{"location":"extension/libreoffice_online/#config-seafile","title":"Config Seafile","text":"<p>Add following config option to seahub_settings.py:</p> <pre><code>OFFICE_SERVER_TYPE = 'CollaboraOffice'\nENABLE_OFFICE_WEB_APP = True\nOFFICE_WEB_APP_BASE_URL = 'http://collabora:9980/hosting/discovery'\n\n# Expiration of WOPI access token\n# WOPI access token is a string used by Seafile to determine the file's\n# identity and permissions when use LibreOffice Online view it online\n# And for security reason, this token should expire after a set time period\nWOPI_ACCESS_TOKEN_EXPIRATION = 30 * 60   # seconds\n\n# List of file formats that you want to view through LibreOffice Online\n# You can change this value according to your preferences\n# And of course you should make sure your LibreOffice Online supports to preview\n# the files with the specified extensions\nOFFICE_WEB_APP_FILE_EXTENSION = ('odp', 'ods', 'odt', 'xls', 'xlsb', 'xlsm', 'xlsx','ppsx', 'ppt', 'pptm', 'pptx', 'doc', 'docm', 'docx')\n\n# Enable edit files through LibreOffice Online\nENABLE_OFFICE_WEB_APP_EDIT = True\n\n# types of files should be editable through LibreOffice Online\nOFFICE_WEB_APP_EDIT_FILE_EXTENSION = ('odp', 'ods', 'odt', 'xls', 'xlsb', 'xlsm', 'xlsx','ppsx', 'ppt', 'pptm', 'pptx', 'doc', 'docm', 'docx')\n</code></pre> <p>Then restart Seafile.</p> <p>Click an office file in Seafile web interface, you will see the online preview rendered by CollaboraOnline. Here is an example:</p> <p></p>"},{"location":"extension/libreoffice_online/#trouble-shooting","title":"Trouble shooting","text":"<p>Understanding how the integration work will help you debug the problem. When a user visits a file page:</p> <ol> <li>(seahub-&gt;browser) Seahub will generate a page containing an iframe and send it to the browser</li> <li>(browser-&gt;CollaboraOnline) With the iframe, the browser will try to load the file preview page from the CollaboraOnline</li> <li>(CollaboraOnline-&gt;seahub) CollaboraOnline receives the request and sends a request to Seahub to get the file content</li> <li>(CollaboraOnline-&gt;browser) CollaboraOnline sends the file preview page to the browser.</li> </ol>"},{"location":"extension/libreoffice_online/#faq","title":"FAQ","text":""},{"location":"extension/libreoffice_online/#about-logs","title":"About logs","text":"<p>CollaboraOnline container will output the logs in the stdout, you can use following command to access it</p> <pre><code>docker logs seafile-collabora\n</code></pre> <p>If you would like to use file to save log (i.e., a <code>.log</code> file), you can modify <code>.env</code> with following statment, and remove the notes in the <code>collabora.yml</code></p> <pre><code># .env\nCOLLABORA_ENABLE_FILE_LOGGING=True\nCOLLABORA_PATH=/opt/collabora # path of the collabora logs\n</code></pre> <pre><code># collabora.yml\n# remove the following notes\n...\nservices:\n    collabora:\n        ...\n        volumes:\n            - \"${COLLABORA_PATH:-/opt/collabora}/logs:/opt/cool/logs/\" # chmod 777 needed\n        ...\n...\n</code></pre> <p>Create the logs directory, and restart Seafile server</p> <pre><code>mkdir -p /opt/collabora\nchmod 777 /opt/collabora\ndocker compose down\ndocker compose up -d\n</code></pre>"},{"location":"extension/libreoffice_online/#collaboraonline-server-on-a-separate-host","title":"CollaboraOnline server on a separate host","text":"<p>For independent deployment of CollaboraOnline on a single server, please refer to the official documentation. After a successful deployment, you only need to specify the values of the following fields in <code>seahub_settings.py</code> and then restart the service. <pre><code>OFFICE_SERVER_TYPE = 'CollaboraOffice'\nENABLE_OFFICE_WEB_APP = True\nOFFICE_WEB_APP_BASE_URL = 'https://&lt;Your CollaboraOnline host url&gt;/hosting/discovery'\nWOPI_ACCESS_TOKEN_EXPIRATION = 30 * 60   \nENABLE_OFFICE_WEB_APP_EDIT = True\n</code></pre></p>"},{"location":"extension/metadata-server/","title":"Metadata server","text":"<p>Metadata server aims to provide metadata management for your libraries, so as to better understand the relevant information of your libraries.</p>"},{"location":"extension/metadata-server/#deployment","title":"Deployment","text":"<p>Prerequisites</p> <p>The startup of Metadata server requires using Redis as the cache server (it should be the default cache server in Seafile 13.0). So you must deploy Redis for Seafile, then modify <code>seafile.conf</code>, <code>seahub_settings.py</code> and <code>seafevents.conf</code> to enable it before deploying metadata server.</p> <p>Warning</p> <p>Please make sure your Seafile service has been deployed before deploying Metadata server. This is because Metadata server needs to read Seafile's configuration file <code>seafile.conf</code>. If you deploy Metadata server before or at the same time with Seafile, it may not be able to detect <code>seafile.conf</code> and fail to start.</p>"},{"location":"extension/metadata-server/#download-docker-compose-file","title":"Download docker-compose file","text":"<p>Please download the file by following command:</p> Deploy in the same machine with SeafileStandalone <p>Note</p> <p>You have to download this file to the directory same as <code>seafile-server.yml</code></p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/md-server.yml\n</code></pre> <p>Note</p> <p>For standalone deployment (usually used in cluster deployment), the metadata server only supports Seafile using the storage backend such as S3. </p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/metadata-server/md-server.yml\nwget -O .env https://manual.seafile.com/13.0/repo/docker/metadata-server/env\n</code></pre>"},{"location":"extension/metadata-server/#modify-env","title":"Modify <code>.env</code>","text":"<p>Metadata server read all configurations from environtment and does not need a dedicated configuration file, and you don't need to add additional variables to your <code>.env</code> (except for standalone deployment) to get the metadata server started, because it will read the exact same configuration as the Seafile server (including <code>JWT_PRIVATE_KEY</code> ) and keep the repository metadata locally (default <code>/opt/seafile-data/seafile/md-data</code>). But you still need to modify the <code>COMPOSE_FILE</code> list in <code>.env</code>, and add <code>md-server.yml</code> to enable the metadata server:</p> <pre><code>COMPOSE_FILE='...,md-server.yml'\n</code></pre> <p>To facilitate your deployment, we still provide two different configuration solutions for your reference:</p>"},{"location":"extension/metadata-server/#example-env-for-seafile-data-is-stored-locally","title":"Example <code>.env</code> for Seafile data is stored locally","text":"<p>In this case you don't need to add any additional configuration to your <code>.env</code>. You can also specify image version, maximum local cache size, etc.</p> <pre><code>MD_IMAGE=seafileltd/seafile-md-server:13.0-latest\nMD_MAX_CACHE_SIZE=1GB\n</code></pre>"},{"location":"extension/metadata-server/#example-env-for-seafile-data-is-stored-in-the-storage-backend-eg-s3","title":"Example <code>.env</code> for  Seafile data is stored in the storage backend (e.g., S3)","text":"<p>First you need to create a bucket for metadata on your S3 storage backend provider. Then add or modify the following information to <code>.env</code>:</p> <pre><code>MD_IMAGE=seafileltd/seafile-md-server:13.0-latest\nMD_STORAGE_TYPE=s3\nS3_MD_BUCKET=...\nS3_KEY_ID=&lt;your-key-id&gt;\nS3_SECRET_KEY=&lt;your-secret-key&gt;\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=false\nS3_AWS_REGION=us-east-1\nS3_HOST=\nS3_USE_HTTPS=true\nS3_SSE_C_KEY=\n</code></pre> <p>Data for Seafile server should be accessible for Metadata server</p> <p>In order to correctly obtain metadata information, you must ensure that the data of your Seafile server can be correctly accessed. In the case of deploying Metadata server and Seafile server together, Metadata server will be able to automatically obtain the configuration information of Seafile server, so you don't need to worry about this. But if your Metadata server is deployed in Standalone (usually in a cluster environment), then you need to ensure that the description of the Seafile server storage part in the <code>.env</code> deployed by Metadata server needs to be consistent with the <code>.env</code> deployed by Seafile server (e.g., <code>SEAF_SERVER_STORAGE_TYPE</code>), and can access the configuration file information of Seafile server (e.g., <code>seafile.conf</code>) to ensure that Metadata server can correctly obtain data from Seafile server.</p>"},{"location":"extension/metadata-server/#list-of-environment-variables-for-metadata-server","title":"List of environment variables for Metadata server","text":"<p>The following table is all the related environment variables with Metadata server:</p> Variables Description Required <code>JWT_PRIVATE_KEY</code> The JWT key used to connect with Seafile server Required <code>MD_MAX_CACHE_SIZE</code> The maximum cache size. Optional, default <code>1GB</code> <code>REDIS_HOST</code> Your Redis service host. Optional, default <code>redis</code> <code>REDIS_PORT</code> Your Redis service port. Optional, default <code>6379</code> <code>REDIS_PASSWORD</code> Your Redis access password. Optional <code>MD_STORAGE_TYPE</code> Where the metadata storage in. Available options are <code>disk</code> (local storage) and <code>s3</code> <code>disk</code> <code>S3_MD_BUCKET</code> Your S3 bucket name for the bucket storing metadata Required when using S3 (<code>MD_STORAGE_TYPE=s3</code>) <code>MD_CHECK_UPDATE_INTERVAL</code> The interval for updating metadata of the repository <code>30m</code> <code>MD_FILE_COUNT_LIMIT</code> The maximum number of files in a repository that the metadata feature allows. If the number of files in a repository exceeds this value, the metadata management function will not be enabled for the repository. For a repository with metadata management enabled, if the number of records in it reaches this value but there are still some files that are not recorded in metadata server, the metadata management of the unrecorded files will be skipped. <code>100000</code> <p>In addition, there are some environment variables related to S3 authorization, please refer to the part with <code>S3_</code> prefix in this table (the buckets name for Seafile are also needed).</p> <p>Metadata server supports Redis only</p> <p>To enable metadata feature, you have to use Redis for cache, as the <code>CACHE_PROVIDER</code> must be set to <code>redis</code> in your <code>.env</code></p>"},{"location":"extension/metadata-server/#modify-seahub_settingspy","title":"Modify <code>seahub_settings.py</code>","text":"<p>To enable metadata server in Seafile, please add the following field in your <code>seahub_settings.py</code>:</p> Deploy in the same machine with SeafileStandalone <pre><code>ENABLE_METADATA_MANAGEMENT = True\nMETADATA_SERVER_URL = 'http://seafile-md-server:8084'\n</code></pre> <pre><code>ENABLE_METADATA_MANAGEMENT = True\nMETADATA_SERVER_URL = 'http://&lt;your metadata-server host&gt;:8084'\n</code></pre>"},{"location":"extension/metadata-server/#start-service","title":"Start service","text":"<p>You can use following command to start metadata server (and the Seafile service also have to restart):</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre>"},{"location":"extension/metadata-server/#verify-metadata-server-and-enable-it-in-the-seafile","title":"Verify Metadata server and enable it in the Seafile","text":"<ol> <li> <p>Check container log for <code>seafile-md-server</code>, you can see the following message if it runs fine:</p> <p><pre><code>$docker logs -f seafile-md-server\n\n[md-server] [2025-03-27 02:30:55] [INFO] Created data links\n[md-server] [2025-03-27 02:30:55] [INFO] Database initialization completed\n[md-server] [2025-03-27 02:30:55] [INFO] Starting Metadata server\n</code></pre> 2. Check the <code>seafevents.log</code> and <code>seahub.log</code>, as you can see the following information in <code>seafevents.log</code> and no error log is reported in <code>seahub.log</code>:</p> <pre><code>[2025-02-23 06:08:05] [INFO] seafevents.repo_metadata.index_worker:134 refresh_lock refresh_thread Starting refresh locks\n[2025-02-23 06:08:05] [INFO] seafevents.repo_metadata.slow_task_handler:61 worker_handler slow_task_handler_thread_0 starting update metadata work\n[2025-02-23 06:08:05] [INFO] seafevents.repo_metadata.slow_task_handler:61 worker_handler slow_task_handler_thread_1 starting update metadata work\n[2025-02-23 06:08:05] [INFO] seafevents.repo_metadata.slow_task_handler:61 worker_handler slow_task_handler_thread_2 starting update metadata work\n</code></pre> </li> <li> <p>Switch Enable extended properties in button Settings</p> <p></p> </li> <li> <p>Finally, you can see the metadata of your library in views tab</p> <p></p> </li> </ol>"},{"location":"extension/metadata-server/#directory-structure","title":"Directory structure","text":"<p>When you deploy Seafile server and Metadata server to the same machine, Metadata server will use the same persistence directory (e.g. /opt/seafile-data) as Seafile server. Metadata server will use the following directories or files:</p> <ul> <li><code>/opt/seafile-data/seafile/md-data</code>: Metadata server data and cache</li> <li><code>/opt/seafile-data/seafile/logs/seaf-md-server</code>: The logs directory of Metadata server, consist of a running log and an access log.</li> </ul>"},{"location":"extension/notification-server/","title":"Notification Server Overview","text":"<p>Currently, the status updates of files and libraries on the client and web interface are based on polling the server. The latest status cannot be reflected in real time on the client due to polling delays. The client needs to periodically refresh the library modification, file locking, subdirectory permissions and other information, which causes additional performance overhead to the server.</p> <p>When a directory is opened on the web interface, the lock status of the file cannot be updated in real time, and the page needs to be refreshed.</p> <p>The notification server uses websocket protocol and maintains a two-way communication connection with the client or the web interface. When the above changes occur, seaf-server will notify the notification server of the changes. Then the notification server can notify the client or the web interface in real time. This not only improves the real-time performance, but also reduces the performance overhead of the server.</p>"},{"location":"extension/notification-server/#supported-update-reminder-types","title":"Supported update reminder types","text":"<ol> <li>The library has been updated.</li> <li>File lock status changes under the library.</li> <li>Directory permission changes under the library.</li> </ol>"},{"location":"extension/notification-server/#how-to-configure-and-run","title":"How to configure and run","text":"<p>Since Seafile 12.0, we use a separate Docker image to deploy the notification server. First download <code>notification-server.yml</code> to Seafile directory:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/notification-server.yml\n</code></pre> <p>Modify <code>.env</code>, and insert <code>notification-server.yml</code> into <code>COMPOSE_FILE</code>:</p> <pre><code>COMPOSE_FILE='seafile-server.yml,caddy.yml,notification-server.yml'\n</code></pre> <p>then add or modify <code>ENABLE_NOTIFICATION_SERVER</code> and <code>NOTIFICATION_SERVER_URL</code>:</p> <pre><code>ENABLE_NOTIFICATION_SERVER=true\n</code></pre> <p>Finally, You can run notification server with the following command:</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre>"},{"location":"extension/notification-server/#checking-notification-server-status","title":"Checking notification server status","text":"<p>When the notification server is working, you can access <code>http://127.0.0.1:8083/ping</code> from your browser, which will answer <code>{\"ret\": \"pong\"}</code>. If you have a proxy configured, you can access <code>https://seafile.example.com/notification/ping</code> from your browser instead.</p>"},{"location":"extension/notification-server/#compatible-client","title":"Compatible client","text":"<ol> <li>Seadrive 3.0.1 or later.</li> <li>Seafile client 8.0.11 or later.</li> </ol> <p>If the client works with notification server, there should be a log message in seafile.log or seadrive.log.</p> <pre><code>Notification server is enabled on the remote server xxxx\n</code></pre>"},{"location":"extension/notification-server/#notification-server-in-seafile-cluster","title":"Notification Server in Seafile cluster","text":"<p>There is no additional features for notification server in the Pro Edition. It works the same as in community edition.</p> <p>If you enable clustering, You need to deploy notification server on one of the servers, or a separate server. The load balancer should forward websockets requests to this node.</p> <p>Download <code>.env</code> and <code>notification-server.yml</code> to notification server directory:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/notification-server/notification-server.yml\nwget -O .env https://manual.seafile.com/13.0/repo/docker/notification-server/env\n</code></pre> <p>Then modify the <code>.env</code> file according to your environment. The following fields are needed to be modified:</p> variable description <code>SEAFILE_MYSQL_DB_HOST</code> Seafile MySQL host <code>SEAFILE_MYSQL_DB_USER</code> Seafile MySQL user, default is <code>seafile</code> <code>SEAFILE_MYSQL_DB_PASSWORD</code> Seafile MySQL password <code>TIME_ZONE</code> Time zone <code>JWT_PRIVATE_KEY</code> JWT key, the same as the config in Seafile <code>.env</code> file <code>SEAFILE_SERVER_HOSTNAME</code> Seafile host name <code>SEAFILE_SERVER_PROTOCOL</code> http or https <p>Now, you can run notification server with the following command:</p> <pre><code>docker compose up -d\n</code></pre> <p>then you need to modify the <code>.env</code> on the host deployed Seafile:</p> <pre><code>ENABLE_NOTIFICATION_SERVER=true\nNOTIFICATION_SERVER_URL=http://&lt;your notification server host&gt;:8083\nINNER_NOTIFICATION_SERVER_URL=$NOTIFICATION_SERVER_URL\n</code></pre> <p>Difference between <code>NOTIFICATION_SERVER_URL</code> and <code>INNER_NOTIFICATION_SERVER_URL</code></p> <ul> <li><code>NOTIFICATION_SERVER_URL</code>: used to do the connection between client (i.e., user's browser) and notification server</li> <li><code>INNER_NOTIFICATION_SERVER_URL</code>: used to do the connection between Seafile server and notification server</li> </ul> <p>Finally, you need to configure load balancer according to the following forwarding rules:</p> <ol> <li>Forward <code>/notification/ping</code> requests to notification server via http protocol.</li> <li>Forward websockets requests with URL prefix <code>/notification</code> to notification server.</li> </ol> <p>Here is a configuration that uses haproxy to support notification server. Haproxy version needs to be &gt;= 2.0. You should use similar configurations for other load balancers.</p> <pre><code>#/etc/haproxy/haproxy.cfg\n\n# Other existing haproxy configurations\n......\n\nfrontend seafile\n    bind 0.0.0.0:80\n    mode http\n    option httplog\n    option dontlognull\n    option forwardfor\n    acl notif_ping_request  url_sub -i /notification/ping\n    acl ws_requests  url -i /notification\n    acl hdr_connection_upgrade hdr(Connection)  -i upgrade\n    acl hdr_upgrade_websocket  hdr(Upgrade)     -i websocket\n    use_backend ws_backend if hdr_connection_upgrade hdr_upgrade_websocket\n    use_backend notif_ping_backend if notif_ping_request\n    use_backend ws_backend if ws_requests\n    default_backend backup_nodes\n\nbackend backup_nodes\n    cookie SERVERID insert indirect nocache\n    server seafileserver01 192.168.0.137:80\n\nbackend notif_ping_backend\n    option forwardfor\n    server ws 192.168.0.137:8083\n\nbackend ws_backend\n    option forwardfor # This sets X-Forwarded-For\n    server ws 192.168.0.137:8083\n</code></pre>"},{"location":"extension/office_web_app/","title":"Office Online Server","text":"<p>In Seafile Professional Server Version 4.4.0 (or above), you can use Microsoft Office Online Server (formerly named Office Web Apps) to preview documents online. Office Online Server provides the best preview for all Office format files. It also support collaborative editing of Office files directly in the web browser. For organizations with Microsoft Office Volume License, it's free to use Office Online Server. For more information about Office Online Server and how to deploy it, please refer to https://technet.microsoft.com/en-us/library/jj219455(v=office.16).aspx.</p> <p>Seafile only supports Office Online Server 2016 and above</p> <p>To use Office Online Server for preview, please add following config option to seahub_settings.py.</p> <pre><code># Enable Office Online Server\nENABLE_OFFICE_WEB_APP = True\n\n# Url of Office Online Server's discovery page\n# The discovery page tells Seafile how to interact with Office Online Server when view file online\n# You should change `http://example.office-web-app.com` to your actual Office Online Server server address\nOFFICE_WEB_APP_BASE_URL = 'http://example.office-web-app.com/hosting/discovery'\n\n# Expiration of WOPI access token\n# WOPI access token is a string used by Seafile to determine the file's\n# identity and permissions when use Office Online Server view it online\n# And for security reason, this token should expire after a set time period\nWOPI_ACCESS_TOKEN_EXPIRATION = 60 * 60 * 24 # seconds\n\n# List of file formats that you want to view through Office Online Server\n# You can change this value according to your preferences\n# And of course you should make sure your Office Online Server supports to preview\n# the files with the specified extensions\nOFFICE_WEB_APP_FILE_EXTENSION = ('ods', 'xls', 'xlsb', 'xlsm', 'xlsx','ppsx', 'ppt',\n    'pptm', 'pptx', 'doc', 'docm', 'docx')\n\n# Enable edit files through Office Online Server\nENABLE_OFFICE_WEB_APP_EDIT = True\n\n# types of files should be editable through Office Online Server\n# Note, Office Online Server 2016 is needed for editing docx\nOFFICE_WEB_APP_EDIT_FILE_EXTENSION = ('xlsx', 'pptx', 'docx')\n\n\n# HTTPS authentication related (optional)\n\n# Server certificates\n# Path to a CA_BUNDLE file or directory with certificates of trusted CAs\n# NOTE: If set this setting to a directory, the directory must have been processed using the c_rehash utility supplied with OpenSSL.\nOFFICE_WEB_APP_SERVER_CA = '/path/to/certfile'\n\n\n# Client certificates\n# You can specify a single file (containing the private key and the certificate) to use as client side certificate\nOFFICE_WEB_APP_CLIENT_PEM = 'path/to/client.pem'\n\n# or you can specify these two file path to use as client side certificate\nOFFICE_WEB_APP_CLIENT_CERT = 'path/to/client.cert'\nOFFICE_WEB_APP_CLIENT_KEY = 'path/to/client.key'\n</code></pre> <p>Then restart</p> <pre><code>./seafile.sh restart\n./seahub.sh restart\n</code></pre> <p>After you click the document you specified in seahub_settings.py, you will see the new preview page.</p> <p></p>"},{"location":"extension/office_web_app/#trouble-shooting","title":"Trouble shooting","text":"<p>Understanding how the web app integration works is going to help you debugging the problem. When a user visits a file page:</p> <ol> <li>(seahub-&gt;browser) Seahub will generate a page containing an iframe and send it to the browser</li> <li>(browser-&gt;office online server) With the iframe, the browser will try to load the file preview page from the office online server</li> <li>(office online server-&gt;seahub) office online server receives the request and sends a request to Seahub to get the file content</li> <li>(office online server-&gt;browser) office online server sends the file preview page to the browser.</li> </ol> <p>Please check the Nginx log for Seahub (for step 3) and Office Online Server to see which step is wrong.</p> <p>Warning</p> <p>You should make sure you have configured at least a few GB of paging files in your Windows system. Otherwise the IIS worker processes may die randomly when handling Office Online requests.</p>"},{"location":"extension/only_office/","title":"OnlyOffice","text":"<p>Seafile supports OnlyOffice to view/edit office files online. In order to use OnlyOffice, you must first deploy an OnlyOffice server. </p> <p>Deployment Tips</p> <p>You can deploy OnlyOffice to the same machine as Seafile (only support deploying with Docker with sufficient cores and RAM) using the <code>onlyoffice.yml</code> provided by Seafile according to this document, or you can deploy it to a different machine according to OnlyOffice official document.</p>"},{"location":"extension/only_office/#deployment-of-onlyoffice","title":"Deployment of OnlyOffice","text":"<p>Download the <code>onlyoffice.yml</code></p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/onlyoffice.yml\n</code></pre> <p>insert <code>onlyoffice.yml</code> into <code>COMPOSE_FILE</code> list (i.e., <code>COMPOSE_FILE='...,onlyoffice.yml'</code>), and add the following configurations of onlyoffice in <code>.env</code> file.</p> <pre><code># OnlyOffice image\nONLYOFFICE_IMAGE=onlyoffice/documentserver:8.1.0.1\n\n# Persistent storage directory of OnlyOffice\nONLYOFFICE_VOLUME=/opt/onlyoffice\n\n# OnlyOffice document server port\nONLYOFFICE_PORT=6233\n\n# jwt secret, generated by `pwgen -s 40 1` \nONLYOFFICE_JWT_SECRET=&lt;your jwt secret&gt;\n</code></pre> <p>Note</p> <p>From Seafile 12.0, OnlyOffice's JWT verification will be forced to enable. Secure communication between Seafile and OnlyOffice is granted by a shared secret. You can get the JWT secret by following command</p> <pre><code>pwgen -s 40 1\n</code></pre> <p>Also modify <code>seahub_settings.py</code></p> <pre><code>ENABLE_ONLYOFFICE = True\nONLYOFFICE_APIJS_URL = 'https://seafile.example.com:6233/web-apps/apps/api/documents/api.js'\nONLYOFFICE_JWT_SECRET = '&lt;your jwt secret&gt;'\n\n# NOTE\n# The following two configurations, do NOT need to configure them explicitly.\n# The default values are as follows.\n# If you have custom needs, you can also configure them, which will override the default values.\nONLYOFFICE_FILE_EXTENSION = ('doc', 'docx', 'ppt', 'pptx', 'xls', 'xlsx', 'odt', 'fodt', 'odp', 'fodp', 'ods', 'fods', 'ppsx', 'pps', 'csv')\nONLYOFFICE_EDIT_FILE_EXTENSION = ('docx', 'pptx', 'xlsx', 'csv')\nOFFICE_PREVIEW_MAX_SIZE = 30 * 1024 * 1024 # preview size, 30 MB\n</code></pre> <p>Tip</p> <p>By default OnlyOffice will use port 6233 used for communication between Seafile and Document Server, You can modify the bound port by specifying <code>ONLYOFFICE_PORT</code>, and the port in the term <code>ONLYOFFICE_APIJS_URL</code> in <code>seahub_settings.py</code> should be modified together.</p>"},{"location":"extension/only_office/#advanced-custom-settings-of-onlyoffice","title":"Advanced: Custom settings of OnlyOffice","text":"<p>The following configuration options are only for OnlyOffice experts. You can create and mount a custom configuration file called <code>local-production-linux.json</code> to force some settings.</p> <pre><code>nano local-production-linux.json\n</code></pre> <p>For example, you can configure OnlyOffice to automatically save by copying the following code block in this file:</p> <pre><code>{\n  \"services\": {\n    \"CoAuthoring\": {\n      \"autoAssembly\": {\n        \"enable\": true,\n        \"interval\": \"5m\"\n      }\n    }\n  },\n  \"FileConverter\": {\n    \"converter\": {\n      \"downloadAttemptMaxCount\": 3\n    }\n  }\n}\n</code></pre> <p>Mount this config file into your onlyoffice block in <code>onlyoffice.yml</code>:</p> <pre><code>service:\n  ...\n  onlyoffice:\n    ...\n    volumes:\n      ...\n      - &lt;Your path to local-production-linux.json&gt;:/etc/onlyoffice/documentserver/local-production-linux.json\n...\n</code></pre> <p>For more information you can check the official documentation: https://api.onlyoffice.com/editors/signature/ and https://github.com/ONLYOFFICE/Docker-DocumentServer#available-configuration-parameters</p>"},{"location":"extension/only_office/#restart-seafile-docker-instance-and-test-that-onlyoffice-is-running","title":"Restart Seafile-docker instance and test that OnlyOffice is running","text":"<pre><code>docker-compose down\ndocker-compose up -d\n</code></pre> <p>Success</p> <p>After the installation process is finished, visit this page to make sure you have deployed OnlyOffice successfully: <code>http{s}://{your Seafile server's domain or IP}:6233/welcome</code>, you will get Document Server is running info at this page.</p>"},{"location":"extension/only_office/#faq","title":"FAQ","text":""},{"location":"extension/only_office/#download-failed","title":"Download failed","text":"<p>Firstly, run <code>docker logs -f seafile-onlyoffice</code>, then open an office file. After the \"Download failed.\" error appears on the page, observe the logs for the following error:</p> <pre><code>==&gt; /var/log/onlyoffice/documentserver/converter/out.log &lt;==\n...\nError: DNS lookup {local IP} (family:undefined, host:undefined) is not allowed. Because, It is a private IP address.\n...\n</code></pre> <p>If it shows this error message and you haven't enabled JWT while using a local network, then it's likely due to an error triggered proactively by OnlyOffice server for enhanced security. (https://github.com/ONLYOFFICE/DocumentServer/issues/2268#issuecomment-1600787905)</p> <p>So, as mentioned in the post, we highly recommend you enabling JWT in your integrations to fix this problem.</p>"},{"location":"extension/only_office/#the-document-security-token-is-not-correctly-formed","title":"The document security token is not correctly formed","text":"<p>Starting from OnlyOffice Docker-DocumentServer version 7.2, JWT is enabled by default on OnlyOffice server.</p> <p>So, for security reason, please Configure OnlyOffice to use JWT Secret.</p>"},{"location":"extension/only_office/#onlyoffice-on-a-separate-host-and-url","title":"OnlyOffice on a separate host and URL","text":"<p>For independent deployment of OnlyOffice on a single server, please refer to the official documentation. After a successful deployment, you only need to specify the values of the following fields in <code>seahub_settings.py</code> and then restart the service.</p> <pre><code>ENABLE_ONLYOFFICE = True\nONLYOFFICE_APIJS_URL = 'http{s}://&lt;Your OnlyOffice host url&gt;/web-apps/apps/api/documents/api.js'\nONLYOFFICE_JWT_SECRET = '&lt;your jwt secret&gt;'\nOFFICE_PREVIEW_MAX_SIZE = 30 * 1024 * 1024\n</code></pre>"},{"location":"extension/only_office/#about-ssl","title":"About SSL","text":"<p>For deployments using the <code>onlyoffice.yml</code> file in this document, SSL is primarily handled by the <code>Caddy</code>. If the OnlyOffice document server and Seafile server are not on the same machine, please refer to the official document to configure SSL for OnlyOffice.</p>"},{"location":"extension/seafile-ai/","title":"Seafile AI extension","text":"<p>From Seafile 13, users can enable Seafile AI to support the following features:</p> <p>Prerequisites of Seafile AI deployment</p> <p>To deploy Seafile AI, you have to deploy metadata server extension firstly. Then you can follow this manual to deploy Seafile AI.</p> <ul> <li>File tags, file and image summaries, text translation, sdoc writing assistance</li> <li>Given an image, generate its corresponding tags (including objects, weather, color, etc.)</li> <li>Detect faces in images and encode them</li> <li>Detect text in images (OCR)</li> </ul> <p>AIGC statement in Seafile</p> <p>With the help of large language models and face recognition models and algorithm development, Seafile AI supports image recognition and text generation. The generated content is diverse and random, and users need to identify the generated content. Seafile will not be responsible for AI-generated content (AIGC).</p> <p>At the same time, Seafile AI supports the use of custom LLM and face recognition models. Different large language models will have different impacts on AIGC (including functions and performance), so Seafile will not be responsible for the corresponding rate (i.e., tokens/s), token consumption, and generated content. Including but not limited to</p> <ul> <li>Basic model (including model basic algorithm)</li> <li>Parameter quantity</li> <li>Quantization level</li> </ul> <p>When users use their own OpenAI-compatibility-API LLM service (e.g., LM studio, Ollama) and use self-ablated or abliterated models, Seafile will not be responsible for possible bugs (such as infinite loops outputting the same meaningless content). At the same time, Seafile does not recommend using documents such as SeaDoc to evaluate the performance of ablated models.</p>"},{"location":"extension/seafile-ai/#deploy-seafile-ai-basic-service","title":"Deploy Seafile AI basic service","text":""},{"location":"extension/seafile-ai/#deploy-seafile-ai-on-the-host-with-seafile","title":"Deploy Seafile AI on the host with Seafile","text":"<p>The Seafile AI basic service will use API calls to external large language model service to implement file labeling, file and image summaries, text translation, and sdoc writing assistance.</p> <p>Seafile AI requires Redis cache</p> <p>In order to deploy Seafile AI correctly, you have to use Redis as the cache. Please set <code>CACHE_PROVIDER=redis</code> in <code>.env</code> and set Redis related configuration information correctly.</p> <ol> <li> <p>Download <code>seafile-ai.yml</code></p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/seafile-ai.yml\n</code></pre> </li> <li> <p>Modify <code>.env</code>, insert or modify the following fields:</p> OpenAIDeepseekAzure OpenAIOllamaHuggingFaceSelf-proxy ServerOther <pre><code>COMPOSE_FILE='...,seafile-ai.yml' # add seafile-ai.yml\n\nENABLE_SEAFILE_AI=true\nSEAFILE_AI_LLM_TYPE=openai\nSEAFILE_AI_LLM_KEY=&lt;your openai LLM access key&gt;\nSEAFILE_AI_LLM_MODEL=gpt-4o-mini # recommend\n</code></pre> <pre><code>COMPOSE_FILE='...,seafile-ai.yml' # add seafile-ai.yml\n\nENABLE_SEAFILE_AI=true\nSEAFILE_AI_LLM_TYPE=deepseek\nSEAFILE_AI_LLM_KEY=&lt;your LLM access key&gt;\nSEAFILE_AI_LLM_MODEL=deepseek-chat # recommend\n</code></pre> <pre><code>COMPOSE_FILE='...,seafile-ai.yml' # add seafile-ai.yml\n\nENABLE_SEAFILE_AI=true\nSEAFILE_AI_LLM_TYPE=azure\nSEAFILE_AI_LLM_URL= # your deployment url, leave blank to use default endpoint\nSEAFILE_AI_LLM_KEY=&lt;your API key&gt;\nSEAFILE_AI_LLM_MODEL=&lt;your deployment name&gt;\n</code></pre> <pre><code>COMPOSE_FILE='...,seafile-ai.yml' # add seafile-ai.yml\n\nENABLE_SEAFILE_AI=true\nSEAFILE_AI_LLM_TYPE=ollama\nSEAFILE_AI_LLM_URL=&lt;your LLM endpoint&gt;\nSEAFILE_AI_LLM_KEY=&lt;your LLM access key&gt;\nSEAFILE_AI_LLM_MODEL=&lt;your model-id&gt;\n</code></pre> <pre><code>COMPOSE_FILE='...,seafile-ai.yml' # add seafile-ai.yml\n\nENABLE_SEAFILE_AI=true\nSEAFILE_AI_LLM_TYPE=huggingface\nSEAFILE_AI_LLM_URL=&lt;your huggingface API endpoint&gt;\nSEAFILE_AI_LLM_KEY=&lt;your huggingface API key&gt;\nSEAFILE_AI_LLM_MODEL=&lt;model provider&gt;/&lt;model-id&gt;\n</code></pre> <pre><code>COMPOSE_FILE='...,seafile-ai.yml' # add seafile-ai.yml\n\nENABLE_SEAFILE_AI=true\nSEAFILE_AI_LLM_TYPE=proxy\nSEAFILE_AI_LLM_URL=&lt;your proxy url&gt;\nSEAFILE_AI_LLM_KEY=&lt;your proxy virtual key&gt; # optional\nSEAFILE_AI_LLM_MODEL=&lt;model-id&gt;\n</code></pre> <p>Seafile AI utilizes LiteLLM to interact with LLM services. For a complete list of supported LLM providers, please refer to this documentation. Then fill the following fields in your <code>.env</code>:</p> <pre><code>COMPOSE_FILE='...,seafile-ai.yml' # add seafile-ai.yml\nENABLE_SEAFILE_AI=true\n\n# according to your situation\nSEAFILE_AI_LLM_TYPE=...\nSEAFILE_AI_LLM_URL=...\nSEAFILE_AI_LLM_KEY=...\nSEAFILE_AI_LLM_MODEL=...\n</code></pre> <p>For example, if you are using a LLM service with OpenAI-compatible endpoints, you should set <code>SEAFILE_AI_LLM_TYPE</code> to <code>other</code> or <code>openai</code>, and set other LLM configuration items accurately.</p> <p>About model selection</p> <p>Seafile AI supports using large model providers from LiteLLM or large model services with OpenAI-compatible endpoints. Therefore, Seafile AI is compatible with most custom large model services except the default model (gpt-4o-mini), but in order to ensure the normal use of Seafile AI features, you need to select a multimodal large model (such as supporting image input and recognition)</p> </li> <li> <p>Restart Seafile server:</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre> </li> </ol>"},{"location":"extension/seafile-ai/#deploy-seafile-ai-on-another-host-to-seafile","title":"Deploy Seafile AI on another host to Seafile","text":"<ol> <li> <p>Download <code>seafile-ai.yml</code> and <code>.env</code>:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/seafile-ai/seafile-ai.yml\nwget -O .env https://manual.seafile.com/13.0/repo/docker/seafile-ai/env\n</code></pre> </li> <li> <p>Modify <code>.env</code> in the host will deploy Seafile AI according to following table</p> variable description <code>SEAFILE_VOLUME</code> The volume directory of thumbnail server data <code>JWT_PRIVATE_KEY</code> JWT key, the same as the config in Seafile <code>.env</code> file <code>INNER_SEAHUB_SERVICE_URL</code> Intranet URL for accessing Seahub component, like <code>http://&lt;your Seafile server intranet IP&gt;</code>. <code>REDIS_HOST</code> Redis server host <code>REDIS_PORT</code> Redis server port <code>REDIS_PASSWORD</code> Redis server password <code>SEAFILE_AI_LLM_TYPE</code> Large Language Model (LLM) Type. Default is <code>openai</code>. <code>SEAFILE_AI_LLM_URL</code> LLM API endpoint. <code>SEAFILE_AI_LLM_KEY</code> LLM API key. <code>SEAFILE_AI_LLM_MODEL</code> LLM model id (or name). Default is gpt-4o-mini <code>FACE_EMBEDDING_SERVICE_URL</code> Face embedding service url <p>then start your Seafile AI server:</p> <pre><code>docker compose up -d\n</code></pre> </li> <li> <p>Modify <code>.env</code> in the host deployed Seafile</p> <pre><code>SEAFILE_AI_SERVER_URL=http://&lt;your seafile ai host&gt;:8888\n</code></pre> <p>then restart your Seafile server</p> <pre><code>docker compose down &amp;&amp; docker compose up -d\n</code></pre> </li> </ol>"},{"location":"extension/seafile-ai/#deploy-face-embedding-service-optional","title":"Deploy face embedding service (Optional)","text":"<p>The face embedding service is used to detect and encode faces in images and is an extension component of Seafile AI. Generally, we recommend that you deploy the service on a machine with a GPU and a graphics card driver that supports OnnxRuntime (so it can also be deployed on a different machine from the Seafile AI base service). Currently, the Seafile AI face embedding service only supports the following modes:</p> <ul> <li>Nvidia GPU, which will use the CUDA 12.4 acceleration environment (at least the minimum Nvidia Geforce 531.18 driver) and requires the installation of the Nvidia container toolkit.</li> </ul> <ul> <li>Pure CPU mode</li> </ul> <p>If you plan to deploy these face embeddings in an environment using a GPU, you need to make sure your graphics card is in the range supported by the acceleration environment (e.g., CUDA 12.4 is supported) and correctly mapped in <code>/dev/dri</code> directory. So in some case, the cloud servers and WSL under some driver versions may not be supported.</p> <ol> <li> <p>Download Docker compose files</p> CUDACPU <pre><code>wget -O face-embedding.yml https://manual.seafile.com/13.0/repo/docker/face-embedding/cuda.yml\n</code></pre> <pre><code>wget -O face-embedding.yml https://manual.seafile.com/13.0/repo/docker/face-embedding/cpu.yml\n</code></pre> </li> </ol> <ol> <li> <p>Modify <code>.env</code>, insert or modify the following fields:</p> <pre><code>COMPOSE_FILE='...,face-embedding.yml' # add face-embedding.yml\n\nFACE_EMBEDDING_VOLUME=/opt/face_embedding\n</code></pre> </li> <li> <p>Restart Seafile server</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre> </li> <li> <p>Enable face recognition in the repo's settings:</p> <p></p> </li> </ol>"},{"location":"extension/seafile-ai/#deploy-the-face-embedding-service-on-a-different-machine-than-the-seafile-ai-basic-service","title":"Deploy the face embedding service on a different machine than the Seafile AI basic service","text":"<p>Since the face embedding service may need to be deployed on some hosts with GPU(s), it may not be deployed together with the Seafile AI basic service. At this time, you should make some changes to the Docker compose file so that the service can be accessed normally.</p> <ol> <li> <p>Modify <code>.yml</code> file, delete the commented out lines to expose the service port:</p> <pre><code>services:\n    face-embedding:\n    ...\n    ports:\n        - 8886:8886\n</code></pre> </li> <li> <p>Modify the <code>.env</code> of where deployed Seafile AI:</p> <pre><code>FACE_EMBEDDING_SERVICE_URL=http://&lt;your face embedding service host&gt;:8886\n</code></pre> </li> <li> <p>Make sure <code>JWT_PRIVATE_KEY</code> has set in the <code>.env</code> for face embedding and is same as the Seafile server</p> </li> <li> <p>Restart Seafile server</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre> </li> </ol>"},{"location":"extension/seafile-ai/#persistent-volume-and-model-management","title":"Persistent volume and model management","text":"<p>By default, the persistent volume is <code>/opt/face_embedding</code>. It will consist of two subdirectories:</p> <ul> <li><code>/opt/face_embedding/logs</code>: Contains the startup log and access log of the face embedding</li> <li><code>/opt/face_embedding/models</code>: Contains the model files of the face embedding. It will automatically obtain the latest applicable models at each startup. These models are hosted by our Hugging Face repository. Of course, you can also manually download your own models on this directory (If you fail to automatically pull the model, you can also manually download it).</li> </ul>"},{"location":"extension/seafile-ai/#customizing-model-serving-access-keys","title":"Customizing model serving access keys","text":"<p>By default, the access key used by the face embedding is the same as that used by the Seafile server, which is <code>JWT_PRIVATE_KEY</code>. At some point, this will have to be modified for security reasons. If you need to customize the access key for the face embedding, you can do the following steps:</p> <ol> <li> <p>Modify <code>.env</code> file for both face embedding and Seafile AI:</p> <pre><code>FACE_EMBEDDING_SERVICE_KEY=&lt;your customizing access keys&gt;\n</code></pre> </li> <li> <p>Restart Seafile server</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre> </li> </ol>"},{"location":"extension/seafile-ai/#advanced-operations","title":"Advanced operations","text":""},{"location":"extension/seafile-ai/#enable-ai-usage-statistics","title":"Enable AI usage statistics","text":"<p>Seafile supports counting users' AI usage (how many tokens are used) and setting monthly AI quotas for users.</p> <ol> <li> <p>Open <code>$SEAFILE_VOLUME/seafile/conf/seahub_settings.py</code> and add AI prices (i.e., how much per token) informations:</p> <pre><code>AI_PRICES = {\n\"gpt-4o-mini\": { # replace gpt-4o-mini to your model name\n    \"input_tokens_1k\": 0.0011, # input price per token\n    \"output_tokens_1k\": 0.0044 # output price per token\n    }\n}\n</code></pre> </li> <li> <p>Refer management of roles and permission to specify <code>monthly_ai_credit_per_user</code> (<code>-1</code> is unlimited), and the unit should be the same as in <code>AI_PRICES</code>.</p> <p><code>monthly_ai_credit_per_user</code> for organization user</p> <p>For organizational team users, <code>monthly_ai_credit_per_user</code> will apply to the entire team. For example, when <code>monthly_ai_credit_per_user</code> is set to <code>2</code> (unit of doller for example) and there are 10 members in the team, all members in the team will share the quota of \\(2\\times10=20\\$\\).</p> </li> </ol>"},{"location":"extension/setup_seadoc/","title":"SeaDoc Integration","text":"<p>SeaDoc is an extension of Seafile that providing an online collaborative document editor.</p> <p>SeaDoc designed around the following key ideas:</p> <ul> <li>An expressive easy to use editor</li> <li>A review and approval workflow to better control how contents changes</li> <li>Inter-document linking for connecting related contents</li> <li>AI integration that streamlines content generation, summarization, and management</li> <li>Comprehensive APIs for automating document generating and processing</li> </ul> <p>SeaDoc excels at:</p> <ul> <li>Authoring product and technical documents</li> <li>Creating knowledge base articles and online manuals</li> <li>Building internal Wikis</li> </ul>"},{"location":"extension/setup_seadoc/#architecture","title":"Architecture","text":"<p>The SeaDoc archticture is demonstrated as below:</p> <p></p> <p>Here is the workflow when a user open sdoc file in browser</p> <ol> <li>When a user open a sdoc file in the browser, a file loading request will be sent to Caddy, and Caddy proxy the request to SeaDoc server (see Seafile instance archticture for the details).</li> <li>SeaDoc server will send the file's content back if it is already cached, otherwise SeaDoc server will sends a request to Seafile server.</li> <li>Seafile server loads the content, then sends it to SeaDoc server and write it to the cache at the same time.</li> <li>After SeaDoc receives the content, it will be sent to the browser.</li> </ol>"},{"location":"extension/setup_seadoc/#deployment-seadoc","title":"Deployment SeaDoc","text":"<p>Default extension in Docker deployment</p> <p>This extension is already installed by default when deploying Seafile (single-node mode) by Docker. </p> <p>If you would like to remove it, you can undo the steps in this section (i.e., remove the <code>seadoc.yml</code> in the field <code>COMPOSE_FILE</code> and set <code>ENABLE_SEADOC</code> to <code>false</code>) </p> <p>The easiest way to deployment SeaDoc is to deploy it with Seafile server on the same host using the same Docker network. If in some situations, you need to deployment SeaDoc standalone, you can follow the next section.</p> <ol> <li> <p>Download the <code>seadoc.yml</code> to <code>/opt/seafile</code></p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/seadoc.yml\n</code></pre> </li> <li> <p>Modify <code>.env</code>, and insert <code>seadoc.yml</code> into <code>COMPOSE_FILE</code>, and enable SeaDoc server</p> <pre><code>COMPOSE_FILE='seafile-server.yml,caddy.yml,seadoc.yml'\n\nENABLE_SEADOC=true\n</code></pre> </li> <li> <p>Start SeaDoc server server with the following command</p> <pre><code>docker compose up -d\n</code></pre> </li> </ol> <p>Now you can use SeaDoc!</p>"},{"location":"extension/setup_seadoc/#deploy-seadoc-standalone","title":"Deploy SeaDoc standalone","text":"<p>If you deploy Seafile in a cluster or if you deploy Seafile with binary package, you need to setup SeaDoc as a standalone service. Here are the steps:</p> <ol> <li> <p>Download and modify the <code>.env</code> and <code>seadoc.yml</code> files to directory <code>/opt/seadoc</code></p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/seadoc/seadoc.yml\nwget -O .env https://manual.seafile.com/13.0/repo/docker/seadoc/env\n</code></pre> </li> <li> <p>Then modify the <code>.env</code> file according to your environment. The following fields are needed to be modified:</p> variable description <code>SEADOC_VOLUME</code> The volume directory of SeaDoc data <code>SEAFILE_MYSQL_DB_HOST</code> Seafile MySQL host <code>SEAFILE_MYSQL_DB_USER</code> Seafile MySQL user, default is <code>seafile</code> <code>SEAFILE_MYSQL_DB_PASSWORD</code> Seafile MySQL password <code>TIME_ZONE</code> Time zone <code>JWT_PRIVATE_KEY</code> JWT key, the same as the config in Seafile <code>.env</code> file <code>SEAFILE_SERVER_HOSTNAME</code> Seafile host name <code>SEAFILE_SERVER_PROTOCOL</code> http or https </li> <li> <p>(Optional) By default, SeaDoc server will bind to port 80 on the host machine. If the port is already taken by another service, you have to change the listening port of SeaDoc:</p> <p>Modify <code>seadoc.yml</code></p> <pre><code>services:\n    seadoc:\n    ...\n    ports:\n        - \"&lt;your SeaDoc server port&gt;:80\"\n...\n</code></pre> </li> <li> <p>Add a reverse proxy for SeaDoc server. In cluster environtment, it means you need to add reverse proxy rules at load balance. Here, we use Nginx as an example  (please replace <code>127.0.0.1:80</code> to <code>host:port</code> of your Seadoc server)</p> </li> </ol> NginxApache <pre><code>...\nserver {\n    ...\n\n    location /sdoc-server/ {\n        proxy_pass         http://127.0.0.1:80/;\n        proxy_redirect     off;\n        proxy_set_header   Host              $host;\n        proxy_set_header   X-Real-IP         $remote_addr;\n        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Host  $server_name;\n        proxy_set_header   X-Forwarded-Proto $scheme;\n\n        client_max_body_size 100m;\n    }\n\n    location /socket.io {\n        proxy_pass http://127.0.0.1:80;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_redirect off;\n\n        proxy_buffers 8 32k;\n        proxy_buffer_size 64k;\n\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header X-NginX-Proxy true;\n    }\n}\n</code></pre> <pre><code>    &lt;Location /sdoc-server/&gt;\n        ProxyPass \"http://127.0.0.1:80/\"\n        ProxyPassReverse \"http://127.0.0.1:80/\"\n    &lt;/Location&gt;\n\n    &lt;Location /socket.io/&gt;\n        # Since Apache HTTP Server 2.4.47\n        ProxyPass \"http://127.0.0.1:80/socket.io/\" upgrade=websocket\n    &lt;/Location&gt;\n</code></pre> <ol> <li> <p>Start SeaDoc server server with the following command</p> <pre><code>docker compose up -d\n</code></pre> </li> <li> <p>Modify Seafile server's configuration and start SeaDoc server</p> <p>Warning</p> <p>After using a reverse proxy, your SeaDoc service will be located at the <code>/sdoc-server</code> path of your reverse proxy (i.e. <code>xxx.example.com/sdoc-server</code>). For example:</p> <ul> <li>Proxy server host: xxx.example.com</li> <li>SeaDoc server: seadoc.example.com:8888</li> </ul> <p>Then <code>SEADOC_SERVER_URL</code> will be <pre><code>http{s}://xxx.example.com/sdoc-server\n</code></pre></p> <p>Modify <code>.env</code> in your Seafile-server host:</p> <pre><code>ENABLE_SEADOC=true\nSEADOC_SERVER_URL=https://seafile.example.com/sdoc-server\n</code></pre> <p>Restart Seafile server</p> Deploy in Docker (including cluster mode)Deploy from binary packages <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\n./seahub.sh restart\n</code></pre> </li> </ol>"},{"location":"extension/setup_seadoc/#seadoc-directory-structure","title":"SeaDoc directory structure","text":"<p><code>/opt/seadoc-data</code></p> <p>Placeholder spot for shared volumes. You may elect to store certain persistent information outside of a container, in our case we keep various log files outside. This allows you to rebuild containers easily without losing important information.</p> <ul> <li>/opt/seadoc-data/logs: This is the directory for SeaDoc logs.</li> </ul>"},{"location":"extension/setup_seadoc/#database-used-by-seadoc","title":"Database used by SeaDoc","text":"<p>SeaDoc used one database table <code>seahub_db.sdoc_operation_log</code> to store operation logs. The database table is cleaned automatically.</p>"},{"location":"extension/setup_seadoc/#common-issues-when-settings-up-seadoc","title":"Common issues when settings up SeaDoc","text":""},{"location":"extension/setup_seadoc/#server-is-disconnected-reconnecting-error-when-open-a-sdoc","title":"\"Server is disconnected. Reconnecting\u2026\" error when open a sdoc","text":"<p>This is because websocket for sdoc-server has not been properly configured. If you use the default Caddy proxy, it should be setup correctly.</p> <p>But if you use your own proxy, you need to make sure it properly proxy <code>your-sdoc-server-domain/socket.io</code> to <code>sdoc-server-docker-image-address/socket.io</code></p>"},{"location":"extension/setup_seadoc/#load-doc-content-error-when-open-a-sdoc","title":"\"Load doc content error\" when open a sdoc","text":"<p>This is because the browser cannot correctly load content from sdoc-server. Make sure</p> <ul> <li>SEADOC_SERVER_URL is correctly set in <code>.env</code></li> <li>Make sure sdoc-server can be accessed via the browser.</li> </ul> <p>You can open developer console of the browser to further debug the issue.</p>"},{"location":"extension/thumbnail-server/","title":"Thumbnail Server Overview","text":"<p>Since Seafile 13.0, a new component thumbnail server is added. Thumbnail server can create thumbnails for images, videos, PDFs and other file types. Thumbnail server uses a task queue based architecture, it can better handle workloads than thumbnail generating inside Seahub component.</p> <p>Use this feature by forwarding thumbnail requests directly to thumbnail server via caddy or a reverse proxy.</p>"},{"location":"extension/thumbnail-server/#how-to-configure-and-run","title":"How to configure and run","text":"<p>First download <code>thumbnail-server.yml</code> to Seafile directory:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/thumbnail-server.yml\n</code></pre> <p>Modify <code>.env</code>, and insert <code>thumbnail-server.yml</code> into <code>COMPOSE_FILE</code>:</p> <pre><code>COMPOSE_FILE='seafile-server.yml,caddy.yml,thumbnail-server.yml'\n</code></pre> <p>Add following configuration in <code>seahub_settings.py</code> to enable thumbnail for videos:</p> <pre><code># video thumbnails (disabled by default)\nENABLE_VIDEO_THUMBNAIL = True\n</code></pre> <p>Finally, You can run thumbnail server with the following command:</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre>"},{"location":"extension/thumbnail-server/#thumbnail-server-in-seafile-cluster","title":"Thumbnail Server in Seafile cluster","text":"<p>There is no additional features for thumbnail server in the Pro Edition. It works the same as in community edition.</p> <p>If you enable clustering, You need to deploy thumbnail server on one of the servers, or a separate server. The load balancer should forward websockets requests to this node.</p> <p>Download <code>.env</code> and <code>thumbnail-server.yml</code> to thumbnail server directory:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/thumbnail-server/thumbnail-server.yml\nwget -O .env https://manual.seafile.com/13.0/repo/docker/thumbnail-server/env\n</code></pre> <p>Then modify the <code>.env</code> file according to your environment. The following fields are needed to be modified:</p> variable description <code>SEAFILE_VOLUME</code> The volume directory of thumbnail server data <code>SEAFILE_MYSQL_DB_HOST</code> Seafile MySQL host <code>SEAFILE_MYSQL_DB_USER</code> Seafile MySQL user, default is <code>seafile</code> <code>SEAFILE_MYSQL_DB_PASSWORD</code> Seafile MySQL password <code>TIME_ZONE</code> Time zone <code>JWT_PRIVATE_KEY</code> JWT key, the same as the config in Seafile <code>.env</code> file <code>INNER_SEAHUB_SERVICE_URL</code> Intranet URL for accessing Seahub component, like <code>http://&lt;your Seafile server intranet IP&gt;</code>. <code>SEAF_SERVER_STORAGE_TYPE</code> What kind of the Seafile data for storage. Available options are <code>disk</code> (i.e., local disk), <code>s3</code> and <code>multiple</code> (see the details of multiple storage backends) <code>S3_COMMIT_BUCKET</code> S3 storage backend commit objects bucket <code>S3_FS_BUCKET</code> S3 storage backend fs objects bucket <code>S3_BLOCK_BUCKET</code> S3 storage backend block objects bucket <code>S3_KEY_ID</code> S3 storage backend key ID <code>S3_SECRET_KEY</code> S3 storage backend secret key <code>S3_AWS_REGION</code> Region of your buckets <code>S3_HOST</code> Host of your buckets <code>S3_USE_HTTPS</code> Use HTTPS connections to S3 if enabled <code>S3_USE_V4_SIGNATURE</code> Use the v4 protocol of S3 if enabled <code>S3_PATH_STYLE_REQUEST</code> This option asks Seafile to use URLs like <code>https://192.168.1.123:8080/bucketname/object</code> to access objects. In Amazon S3, the default URL format is in virtual host style, such as <code>https://bucketname.s3.amazonaws.com/object</code>. But this style relies on advanced DNS server setup. So most self-hosted storage systems only implement the path style format. <code>S3_SSE_C_KEY</code> A string of 32 characters can be generated by openssl rand -base64 24. It can be any 32-character long random string. It's required to use V4 authentication protocol and https if you enable SSE-C. <p>Then you can run thumbnail server with the following command:</p> <pre><code>docker compose up -d\n</code></pre> <p>You need to configure load balancer according to the following forwarding rules:</p> <ol> <li>Forward <code>/thumbnail</code> requests to thumbnail server via http protocol.</li> </ol> <p>Here is a configuration that uses haproxy to support thumbnail server. Haproxy version needs to be &gt;= 2.0. You should use similar configurations for other load balancers.</p> <pre><code>#/etc/haproxy/haproxy.cfg\n\n# Other existing haproxy configurations\n......\n\nfrontend seafile\n    bind 0.0.0.0:80\n    mode http\n    option httplog\n    option dontlognull\n    option forwardfor\n    acl thumbnail_request url_sub -i /thumbnail/\n    use_backend thumbnail_backend if thumbnail_request\n    default_backend backup_nodes\n\nbackend backup_nodes\n    cookie SERVERID insert indirect nocache\n    server seafileserver01 192.168.0.2:80\n\nbackend thumbnail_backend\n    option forwardfor\n    server thumbnail 192.168.0.9:80\n</code></pre> <p>Thumbnail server has to access Seafile' storage</p> <p>The thumbnail server needs to access Seafile storage.</p> <ul> <li> <p>If you use local storage, you need to mount the <code>/opt/seafile-data</code> directory of the Seafile node to the thumbnail node, and set <code>SEAFILE_VOLUME</code> to the mounted directory correctly.</p> </li> <li> <p>If you use single backend S3 storage, please correctly set relative environment vairables in <code>.env</code>.</p> </li> <li> <p>If you are using multiple storage backends, you have to copy the <code>seafile.conf</code> of the Seafile node to the <code>/opt/seafile-data/seafile/conf</code> directory of the thumbnail node, and set <code>SEAF_SERVER_STORAGE_TYPE=multiple</code> in <code>.env</code>.</p> </li> </ul>"},{"location":"extension/thumbnail-server/#thumbnail-server-directory-structure","title":"Thumbnail server directory structure","text":"<p><code>/opt/seafile-data</code></p> <p>Placeholder spot for shared volumes. You may elect to store certain persistent information outside of a container, in our case we keep various log files outside. This allows you to rebuild containers easily without losing important information.</p> <ul> <li>/opt/seafile-data/conf: This is the directory for config files.</li> <li>/opt/seafile-data/logs: This is the directory for logs.</li> <li>/opt/seafile-data/seafile-data: This is the directory for seafile storage (if you use local storage).</li> <li>/opt/seafile-data/seahub-data/thumbnail: This is the directory for thumbnail files.</li> </ul>"},{"location":"extension/virus_scan/","title":"Virus Scan","text":"<p>Seafile can scan uploaded files for malicious content in the background. When configured to run periodically, the scan process scans all existing libraries on the server. In each scan, the process only scans newly uploaded/updated files since the last scan. For each file, the process executes a user-specified virus scan command to check whether the file is a virus or not. Most anti-virus programs provide command line utility for Linux.</p> <p>To enable this feature, add the following options to <code>seafile.conf</code>:</p> <pre><code>[virus_scan]\nscan_command = (command for checking virus)\nvirus_code = (command exit codes when file is virus)\nnonvirus_code = (command exit codes when file is not virus)\nscan_interval = (scanning interval, in unit of minutes, default to 60 minutes)\n</code></pre> <p>More details about the options:</p> <ul> <li>On Linux/Unix, most virus scan commands returns specific exit codes for virus and non-virus. You should consult the manual of your anti-virus program for more information.</li> </ul> <p>An example for ClamAV (http://www.clamav.net/) is provided below:</p> <pre><code>[virus_scan]\nscan_command = clamscan\nvirus_code = 1\nnonvirus_code = 0\n</code></pre> <p>To test whether your configuration works, you can trigger a scan manually:</p> <pre><code>cd seafile-server-latest\n./pro/pro.py virus_scan\n</code></pre> <p>If a virus was detected, you can see scan records and delete infected files on the Virus Scan page in the admin area. </p> <p>Note</p> <p>If you directly use clamav command line tool to scan files, scanning files will takes a lot of time. If you want to speed it up, we recommend to run Clamav as a daemon. Please refer to Run ClamAV as a Daemon</p> <p>When run Clamav as a daemon, the <code>scan_command</code> should be <code>clamdscan</code> in <code>seafile.conf</code>. An example for Clamav-daemon is provided below: <pre><code>[virus_scan]\nscan_command = clamdscan\nvirus_code = 1\nnonvirus_code = 0\n</code></pre></p> <p>Since Pro edition 6.0.0, a few more options are added to provide finer grained control for virus scan.</p> <pre><code>[virus_scan]\n......\nscan_size_limit = (size limit for files to be scanned) # The unit is MB.\nscan_skip_ext = (a comma (',') separated list of file extensions to be ignored)\nthreads = (number of concurrent threads for scan, one thread for one file, default to 4)\n</code></pre> <p>The file extensions should start with '.'. The extensions are case insensitive. By default, files with following extensions will be ignored:</p> <pre><code>.bmp, .gif, .ico, .png, .jpg, .mp3, .mp4, .wav, .avi, .rmvb, .mkv\n</code></pre> <p>The list you provide will override default list.</p>"},{"location":"extension/virus_scan/#scanning-files-on-upload","title":"Scanning Files on Upload","text":"<p>You may also configure Seafile to scan files for virus upon the files are uploaded. This only works for files uploaded via web interface or web APIs. Files uploaded with syncing or SeaDrive clients cannot be scanned on upload due to performance consideration.</p> <p>You may scan files uploaded from shared upload links by adding the option below to <code>seahub_settings.py</code>:</p> <pre><code>ENABLE_UPLOAD_LINK_VIRUS_CHECK = True\n</code></pre> <p>Since Pro Edition 11.0.7, you may scan all uploaded files via web APIs by adding the option below to <code>seafile.conf</code>:</p> <pre><code>[fileserver]\ncheck_virus_on_web_upload = true\n</code></pre>"},{"location":"extension/virus_scan_with_clamav/","title":"Deploy ClamAV with Seafile","text":""},{"location":"extension/virus_scan_with_clamav/#deploy-with-docker","title":"Deploy with Docker","text":"<p>If your Seafile server is deployed using Docker, we also recommend that you use Docker to deploy ClamAV by following the steps below, otherwise you can deploy it from  binary package of ClamAV.</p>"},{"location":"extension/virus_scan_with_clamav/#download-clamavyml-and-insert-to-docker-compose-lists-in-env","title":"Download clamav.yml and insert to Docker-compose lists in .env","text":"<p>Download <code>clamav.yml</code></p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/pro/clamav.yml\n</code></pre> <p>Modify <code>.env</code>, insert <code>clamav.yml</code> to field <code>COMPOSE_FILE</code></p> <pre><code>COMPOSE_FILE='seafile-server.yml,caddy.yml,clamav.yml'\n</code></pre>"},{"location":"extension/virus_scan_with_clamav/#modify-seafileconf","title":"Modify seafile.conf","text":"<p>Add the following statements to seafile.conf</p> <pre><code>[virus_scan]\nscan_command = clamdscan\nvirus_code = 1\nnonvirus_code = 0\nscan_interval = 5\nscan_size_limit = 20\nthreads = 2\n</code></pre>"},{"location":"extension/virus_scan_with_clamav/#restart-docker-container","title":"Restart docker container","text":"<pre><code>docker compose down\ndocker compose up -d \n</code></pre> <p>Wait some minutes until Clamav finished initializing.</p> <p>Now Clamav can be used.</p>"},{"location":"extension/virus_scan_with_clamav/#use-clamav-in-binary-based-deployment","title":"Use ClamAV in binary based deployment","text":""},{"location":"extension/virus_scan_with_clamav/#install-clamav-daemon-clamav-freshclam","title":"Install clamav-daemon &amp; clamav-freshclam","text":"<pre><code>apt-get install clamav-daemon clamav-freshclam\n</code></pre> <p>You should run Clamd with a root permission to scan any files.  Edit the conf <code>/etc/clamav/clamd.conf</code>,change the following line:</p> <pre><code>LocalSocketGroup root\nUser root\n</code></pre>"},{"location":"extension/virus_scan_with_clamav/#start-the-clamav-daemon","title":"Start the clamav-daemon","text":"<pre><code>systemctl start clamav-daemon\n</code></pre> <p>Test the software</p> <pre><code>$ curl https://secure.eicar.org/eicar.com.txt | clamdscan -\n</code></pre> <p>The output must include:</p> <pre><code>stream: Eicar-Test-Signature FOUND\n</code></pre>"},{"location":"extension/virus_scan_with_kav4fs/","title":"Virus Scan with kav4fs","text":""},{"location":"extension/virus_scan_with_kav4fs/#prerequisite","title":"Prerequisite","text":"<p>Assume you have installed Kaspersky Anti-Virus for Linux File Server on the Seafile Server machine.</p> <p>If the user that runs Seafile Server is not root, it should have sudoers privilege to avoid writing password when running kav4fs-control. Add following content to /etc/sudoers:</p> <pre><code>&lt;user of running seafile server&gt;    ALL=(ALL:ALL) ALL\n&lt;user of running seafile server&gt; ALL=NOPASSWD: /opt/kaspersky/kav4fs/bin/kav4fs-control\n</code></pre>"},{"location":"extension/virus_scan_with_kav4fs/#script","title":"Script","text":"<p>As the return code of kav4fs cannot reflect the file scan result, we use a shell wrapper script to parse the scan output and based on the parse result to return different return codes to reflect the scan result.</p> <p>Save following contents to a file such as <code>kav4fs_scan.sh</code>:</p> <pre><code>#!/bin/bash\n\nTEMP_LOG_FILE=`mktemp /tmp/XXXXXXXXXX`\nVIRUS_FOUND=1\nCLEAN=0\nUNDEFINED=2\nKAV4FS='/opt/kaspersky/kav4fs/bin/kav4fs-control'\nif [ ! -x $KAV4FS ]\nthen\n    echo \"Binary not executable\"\n    exit $UNDEFINED\nfi\n\nsudo $KAV4FS --scan-file \"$1\" &gt; $TEMP_LOG_FILE\nif [ \"$?\" -ne 0 ]\nthen\n    echo \"Error due to check file '$1'\"\n    exit 3\nfi\nTHREATS_C=`grep 'Threats found:' $TEMP_LOG_FILE|cut -d':' -f 2|sed 's/ //g'`\nRISKWARE_C=`grep 'Riskware found:' $TEMP_LOG_FILE|cut -d':' -f 2|sed 's/ //g'`\nINFECTED=`grep 'Infected:' $TEMP_LOG_FILE|cut -d':' -f 2|sed 's/ //g'`\nSUSPICIOUS=`grep 'Suspicious:' $TEMP_LOG_FILE|cut -d':' -f 2|sed 's/ //g'`\nSCAN_ERRORS_C=`grep 'Scan errors:' $TEMP_LOG_FILE|cut -d':' -f 2|sed 's/ //g'`\nPASSWORD_PROTECTED=`grep 'Password protected:' $TEMP_LOG_FILE|cut -d':' -f 2|sed 's/ //g'`\nCORRUPTED=`grep 'Corrupted:' $TEMP_LOG_FILE|cut -d':' -f 2|sed 's/ //g'`\n\nrm -f $TEMP_LOG_FILE\n\nif [ $THREATS_C -gt 0 -o $RISKWARE_C -gt 0 -o $INFECTED -gt 0 -o $SUSPICIOUS -gt 0 ]\nthen\n    exit $VIRUS_FOUND\nelif [ $SCAN_ERRORS_C -gt 0 -o $PASSWORD_PROTECTED -gt 0 -o $CORRUPTED -gt 0 ]\nthen\n    exit $UNDEFINED\nelse\n    exit $CLEAN\nfi\n</code></pre> <p>Grant execute permissions for the script (make sure it is owned by the user Seafile is running as):</p> <pre><code>chmod u+x kav4fs_scan.sh\n</code></pre> <p>The meaning of the script return code:</p> <pre><code>1: found virus\n0: no virus\nother: scan failed\n</code></pre>"},{"location":"extension/virus_scan_with_kav4fs/#configuration","title":"Configuration","text":"<p>Add following content to <code>seafile.conf</code>:</p> <pre><code>[virus_scan]\nscan_command = &lt;absolute path of kav4fs_scan.sh&gt;\nvirus_code = 1\nnonvirus_code = 0\nscan_interval = &lt;scanning interval, in unit of minutes, default to 60 minutes&gt;\n</code></pre>"},{"location":"extension/webdav/","title":"WebDAV extension","text":"<p>In the document below, we assume your seafile installation folder is <code>/opt/seafile</code>.</p>"},{"location":"extension/webdav/#config-webdav-extension","title":"Config WebDAV extension","text":"<p>The configuration file is <code>/opt/seafile-data/seafile/conf/seafdav.conf</code> (for deploying from binary packages, it should be <code>/opt/seafile/conf/seafdav.conf</code>). If it is not created already, you can just create the file.</p> <pre><code>[WEBDAV]\n\n# Default is false. Change it to true to enable SeafDAV server.\nenabled = true\n\nport = 8080\ndebug = true\n\n# If you deploy seafdav behind nginx/apache, you need to modify \"share_name\".\nshare_name = /seafdav\n\n# SeafDAV uses Gunicorn as web server.\n# This option maps to Gunicorn's 'workers' setting. https://docs.gunicorn.org/en/stable/settings.html?#workers\n# By default it's set to 5 processes.\nworkers = 5\n\n# This option maps to Gunicorn's 'timeout' setting. https://docs.gunicorn.org/en/stable/settings.html?#timeout\n# By default it's set to 1200 seconds, to support large file uploads.\ntimeout = 1200\n</code></pre> <p>Every time the configuration is modified, you need to restart seafile server to make it take effect.</p> Deploy in DockerDeploy from binary packages <pre><code>docker compose restart\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest/\n./seafile.sh restart\n</code></pre> <p>Your WebDAV client would visit the Seafile WebDAV server at <code>http{s}://example.com/seafdav/</code> (for deploying from binary packages, it should be  <code>http{s}://example.com:8080/seafdav/</code>)</p> <p>In Pro edition 7.1.8 version and community edition 7.1.5, an option is added to append library ID to the library name returned by SeafDAV.</p> <pre><code>show_repo_id=true\n</code></pre>"},{"location":"extension/webdav/#proxy-only-for-deploying-from-binary-packages","title":"Proxy (only for deploying from binary packages)","text":"<p>Tip</p> <p>For deploying in Docker, the WebDAV server has been proxied in <code>/seafdav/*</code>, as you can skip this step</p> NginxApache <p>For Seafdav, the configuration of Nginx is as follows:</p> <pre><code>.....\n\n    location /seafdav {\n        rewrite ^/seafdav$ /seafdav/ permanent;\n    }\n\n    location /seafdav/ {\n        proxy_pass         http://127.0.0.1:8080/seafdav/;\n        proxy_set_header   Host $host;\n        proxy_set_header   X-Real-IP $remote_addr;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Host $server_name;\n        proxy_set_header   X-Forwarded-Proto $scheme;\n        proxy_read_timeout  1200s;\n        client_max_body_size 0;\n\ufeff\n        access_log      /var/log/nginx/seafdav.access.log seafileformat;\n        error_log       /var/log/nginx/seafdav.error.log;\n    }\n\n    location /:dir_browser {\n        proxy_pass         http://127.0.0.1:8080/:dir_browser;\n    }\n</code></pre> <p>For Seafdav, the configuration of Apache is as follows:</p> <pre><code>......\n    &lt;Location /seafdav&gt;\n        ProxyPass \"http://127.0.0.1:8080/seafdav\"\n    &lt;/Location&gt;\n</code></pre>"},{"location":"extension/webdav/#notes-on-clients","title":"Notes on Clients","text":"<p>Please first note that, there are some known performance limitation when you map a Seafile webdav server as a local file system (or network drive).</p> <ul> <li>Uploading large number of files at once is usually much slower than the syncing client. That's because each file needs to be committed separately.</li> <li>The access to the webdav server may be slow sometimes. That's because the local file system driver sends a lot of unnecessary requests to get the files' attributes.</li> </ul> <p>So WebDAV is more suitable for infrequent file access. If you want better performance, please use the sync client instead.</p> WindowsLinuxMac OS X <p>Windows Explorer supports HTTPS connection. But it requires a valid certificate on the server. It's generally recommended to use Windows Explorer to map a webdav server as network dirve. If you use a self-signed certificate, you have to add the certificate's CA into Windows' system CA store.</p> <p>On Linux you have more choices. You can use file manager such as Nautilus to connect to webdav server. Or you can use davfs2 from the command line.</p> <p>To use davfs2</p> <pre><code>sudo apt-get install davfs2\nsudo mount -t davfs -o uid=&lt;username&gt; https://example.com/seafdav /media/seafdav/\n</code></pre> <p>The -o option sets the owner of the mounted directory to  so that it's writable for non-root users. <p>It's recommended to disable LOCK operation for davfs2. You have to edit /etc/davfs2/davfs2.conf</p> <pre><code>use_locks       0\n</code></pre> <p>Finder's support for WebDAV is also not very stable and slow. So it is recommended to use a webdav client software such as Cyberduck.</p>"},{"location":"extension/webdav/#frequently-asked-questions","title":"Frequently Asked Questions","text":""},{"location":"extension/webdav/#clients-cant-connect-to-seafdav-server","title":"Clients can't connect to seafdav server","text":"<p>By default, seafdav is disabled. Check whether you have <code>enabled = true</code> in <code>seafdav.conf</code>. If not, modify it and restart seafile server.</p>"},{"location":"extension/webdav/#the-client-gets-error-404-not-found","title":"The client gets \"Error: 404 Not Found\"","text":"<p>If you deploy SeafDAV behind Nginx/Apache, make sure to change the value of <code>share_name</code> as the sample configuration above. Restart your seafile server and try again.</p>"},{"location":"extension/webdav/#cant-renamemove-filefolder","title":"Can't rename/move file/folder","text":"<p>First, check the <code>seafdav.log</code> to see if there is log like the following. <pre><code>\"MOVE ... -&gt; 502 Bad Gateway\n</code></pre></p> <p>If you have enabled debug, there will also be the following log. <pre><code>09:47:06.533 - DEBUG   : Raising DAVError 502 Bad Gateway: Source and destination must have the same scheme.\nIf you are running behind a reverse proxy, you may have to rewrite the 'Destination' header.\n(See https://github.com/mar10/wsgidav/issues/183)\n\n09:47:06.533 - DEBUG   : Caught (502, \"Source and destination must have the same scheme.\\nIf you are running behind a reverse proxy, you may have to rewrite the 'Destination' header.\\n(See https://github.com/mar10/wsgidav/issues/183)\")\n</code></pre></p> <p>This issue usually occurs when you have configured HTTPS, but the request was forwarded, resulting in the <code>HTTP_X_FORWARDED_PROTO</code> value in the request received by Seafile not being HTTPS.</p> <p>You can solve this by manually changing the value of <code>HTTP_X_FORWARDED_PROTO</code>. For example, in nginx, change <pre><code>proxy_set_header X-Forwarded-Proto $scheme;\n</code></pre></p> <p>to</p> <pre><code>proxy_set_header X-Forwarded-Proto https;\n</code></pre>"},{"location":"extension/webdav/#windows-explorer-reports-file-size-exceeds-the-limit-allowed-and-cannot-be-saved","title":"Windows Explorer reports \"file size exceeds the limit allowed and cannot be saved\"","text":"<p>This happens when you map webdav as a network drive, and tries to copy a file larger than about 50MB from the network drive to a local folder.</p> <p>This is because Windows Explorer has a limit of the file size downloaded from webdav server. To make this size large, change the registry entry on the client machine. There is a registry key named <code>FileSizeLimitInBytes</code> under <code>HKEY_LOCAL_MACHINE -&gt; SYSTEM -&gt; CurrentControlSet -&gt; Services -&gt; WebClient -&gt; Parameters</code>.</p>"},{"location":"introduction/contribution/","title":"Contribution","text":""},{"location":"introduction/contribution/#licensing","title":"Licensing","text":"<p>The different components of Seafile project are released under different licenses:</p> <ul> <li>Seafile iOS client: Apache License v2</li> <li>Seafile Android client: GPLv3</li> <li>Desktop syncing client: GPLv2</li> <li>Seafile Server core: AGPLv3</li> <li>Seahub (Seafile server Web UI): Apache License v2</li> </ul>"},{"location":"introduction/contribution/#discussion","title":"Discussion","text":"<p>Forum: https://forum.seafile.com</p> <p>Follow us @seafile https://twitter.com/seafile</p>"},{"location":"introduction/contribution/#report-a-bug","title":"Report a Bug","text":"<ul> <li>Please report a bug in our forum, this is a preferred way.</li> <li>You can also report a bug in GitHub https://github.com/haiwen/seafile/issues?state=open</li> </ul>"},{"location":"introduction/file_permission_management/","title":"File permission management","text":"<p>Seafile manages files using libraries. Every library has an owner, who can share the library to other users or share it with groups. The sharing can be read-only or read-write.</p>"},{"location":"introduction/file_permission_management/#read-only-syncing","title":"Read-only syncing","text":"<p>Read-only libraries can be synced to local desktop. The modifications at the client will not be synced back. If a user has modified some file contents, he can use \"resync\" to revert the modifications.</p>"},{"location":"introduction/file_permission_management/#cascading-permissionsub-folder-permissions-pro-edition","title":"Cascading permission/Sub-folder permissions (Pro edition)","text":"<p>Sharing controls whether a user or group can see a library, while sub-folder permissions are used to modify permissions on specific folders.</p> <p>Supposing you share a library as read-only to a group and then want specific sub-folders to be read-write for a few users, you can set read-write permissions on sub-folders for some users and groups.</p> <p>Note</p> <ul> <li>Setting sub-folder permission for a user without sharing the folder or parent folder to that user will have no effect.</li> <li>Sharing a library read-only to a user and then sharing a sub-folder read-write to that user will lead to two shared items for that user. This is going to cause confusion. Use sub-folder permissions instead.</li> </ul>"},{"location":"introduction/roadmap/","title":"Roadmap","text":"<p>Please check https://www.seafile.com/en/roadmap/</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/","title":"Seafile Professional Edition Software License Agreement","text":"<p>Seafile Professional Edition SOFTWARE LICENSE AGREEMENT</p> <p>Important</p> <ul> <li> <p>READ THE FOLLOWING TERMS AND CONDITIONS CAREFULLY BEFORE YOU DOWNLOAD, INSTALL OR USE Seafile Ltd.'S PROPRIETARY SOFTWARE. </p> </li> <li> <p>BY INSTALLING OR USING THE SOFTWARE, YOU AGREE TO BE BOUND BY THE FOLLOWING TERMS AND CONDITIONS. </p> </li> <li> <p>IF YOU DO NOT AGREE TO THE FOLLOWING TERMS AND CONDITIONS, DO NOT INSTALL OR USE THE SOFTWARE.</p> </li> </ul>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#1-definitions","title":"1. DEFINITIONS","text":"<p>\"Seafile Ltd.\" means Seafile Ltd.</p> <p>\"You and Your\" means the party licensing the Software hereunder.</p> <p>\"Software\" means the computer programs provided under the terms of this license by Seafile Ltd. together with any documentation provided therewith.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#2-grant-of-rights","title":"2. GRANT OF RIGHTS","text":""},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#21-general","title":"2.1 General","text":"<p>The License granted for Software under this Agreement authorizes You on a non-exclusive basis to use the Software. The Software is licensed, not sold to You and Seafile Ltd. reserves all rights not expressly granted to You in this Agreement. The License is personal to You and may not be assigned by You to any third party.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#22-license-provisions","title":"2.2 License Provisions","text":"<p>Subject to the receipt by Seafile Ltd. of the applicable license fees, You have the right use the Software as follows:</p> <ul> <li>You may use and install the Software on an unlimited number of computers that are owned, leased, or controlled by you.</li> <li>Nothing in this Agreement shall permit you, or any third party to disclose or otherwise make available to any third party the licensed Software, source code or any portion thereof.</li> <li>You agree to indemnify, hold harmless and defend Seafile Ltd. from and against any claims or lawsuits, including attorney's fees, that arise as a result from the use of the Software;</li> <li>You do not permit further redistribution of the Software by Your end-user customers</li> </ul>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#3-no-derivative-works","title":"3. NO DERIVATIVE WORKS","text":"<p>The inclusion of source code with the License is explicitly not for your use to customize a solution or re-use in your own projects or products. The benefit of including the source code is for purposes of security auditing. You may modify the code only for emergency bug fixes that impact security or performance and only for use within your enterprise. You may not create or distribute derivative works based on the Software or any part thereof. If you need enhancements to the software features, you should suggest them to Seafile Ltd. for version improvements.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#4-ownership","title":"4. OWNERSHIP","text":"<p>You acknowledge that all copies of the Software in any form are the sole property of Seafile Ltd.. You have no right, title or interest to any such Software or copies thereof except as provided in this Agreement.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#5-confidentiality","title":"5. CONFIDENTIALITY","text":"<p>You hereby acknowledge and agreed that the Software constitute and contain valuable proprietary products and trade secrets of Seafile Ltd., embodying substantial creative efforts and confidential information, ideas, and expressions. You agree to treat, and take precautions to ensure that your employees and other third parties treat, the Software as confidential in accordance with the confidentiality requirements herein.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#6-disclaimer-of-warranties","title":"6. DISCLAIMER OF WARRANTIES","text":"<p>EXCEPT AS OTHERWISE SET FORTH IN THIS AGREEMENT THE SOFTWARE IS PROVIDED TO YOU \"AS IS\", AND Seafile Ltd. MAKES NO EXPRESS OR IMPLIED WARRANTIES WITH RESPECT TO ITS FUNCTIONALITY, CONDITION, PERFORMANCE, OPERABILITY OR USE. WITHOUT LIMITING THE FOREGOING, Seafile Ltd. DISCLAIMS ALL IMPLIED WARRANTIES INCLUDING, WITHOUT LIMITATION, ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR FREEDOM FROM INFRINGEMENT. SOME JURISDICTIONS DO NOT ALLOW THE EXCLUSION OF IMPLIED WARRANTIES, SO THE ABOVE EXCLUSIONS MAY NOT APPLY TO YOU. THE LIMITED WARRANTY HEREIN GIVES YOU SPECIFIC LEGAL RIGHTS, AND YOU MAY ALSO HAVE OTHER RIGHTS THAT VARY FROM ONE JURISDICTION TO ANOTHER.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#7-limitation-of-liability","title":"7. LIMITATION OF LIABILITY","text":"<p>YOU ACKNOWLEDGE AND AGREE THAT THE CONSIDERATION WHICH Seafile Ltd. IS CHARGING HEREUNDER DOES NOT INCLUDE ANY CONSIDERATION FOR ASSUMPTION BY Seafile Ltd. OF THE RISK OF YOUR CONSEQUENTIAL OR INCIDENTAL DAMAGES WHICH MAY ARISE IN CONNECTION WITH YOUR USE OF THE SOFTWARE. ACCORDINGLY, YOU AGREE THAT Seafile Ltd. SHALL NOT BE RESPONSIBLE TO YOU OR ANY THIRD PARTY FOR ANY LOSS-OF-PROFIT, LOST SAVINGS, INDIRECT, INCIDENTAL, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF A LICENSING OR USE OF THE SOFTWARE.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#8-indemnification","title":"8. INDEMNIFICATION","text":"<p>You agree to defend, indemnify and hold Seafile Ltd. and its employees, agents, representatives and assigns harmless from and against any claims, proceedings, damages, injuries, liabilities, costs, attorney's fees relating to or arising out of Your use of the Software or any breach of this Agreement.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#9-termination","title":"9. TERMINATION","text":"<p>Your license is effective until terminated. You may terminate it at any time by destroying the Software or returning all copies of the Software to Seafile Ltd.. Your license will terminate immediately without notice if You breach any of the terms and conditions of this Agreement, including non or incomplete payment of the license fee. Upon termination of this Agreement for any reason: You will uninstall all copies of the Software; You will immediately cease and desist all use of the Software; and will destroy all copies of the software in your possession.</p>"},{"location":"introduction/seafile_professional_sdition_software_license_agreement/#10-updates-and-support","title":"10. UPDATES AND SUPPORT","text":"<p>Seafile Ltd. has the right, but no obligation, to periodically update the Software, at its complete discretion, without the consent or obligation to You or any licensee or user.</p> <p>YOU HEREBY ACKNOWLEDGE THAT YOU HAVE READ THIS AGREEMENT, UNDERSTAND IT AND AGREE TO BE BOUND BY ITS TERMS AND CONDITIONS.</p>"},{"location":"setup/caddy/","title":"HTTPS and Caddy","text":"<p>Note</p> <p>From Seafile Docker 12.0, HTTPS will be handled by the Caddy. The default caddy image used of Seafile docker is <code>lucaslorentz/caddy-docker-proxy:2.9-alpine</code>.</p> <p>Caddy is a modern open source web server that mainly binds external traffic and internal services in seafile docker. In addition to the advantages of traditional proxy components (e.g., nginx), Caddy also makes it easier for users to complete the acquisition and update of HTTPS certificates by providing simpler configurations. </p>"},{"location":"setup/caddy/#engage-https-by-caddy","title":"Engage HTTPS by caddy","text":"<p>We provide two options for enabling HTTPS via Caddy, which mainly rely on The caddy docker proxy container from Lucaslorentz supports dynamic configuration with labels:</p> <ul> <li>With a automatically generated certificate</li> <li>Using a custom (existing) certificate</li> </ul>"},{"location":"setup/caddy/#with-a-automatically-generated-certificate","title":"With a automatically generated certificate","text":"<p>To engage HTTPS, users only needs to correctly configure the following fields in <code>.env</code>:</p> <pre><code>SEAFILE_SERVER_PROTOCOL=https\nSEAFILE_SERVER_HOSTNAME=example.com\n</code></pre> <p>After Seafile Docker startup, you can use following command to access the logs of Caddy</p> <pre><code>docker logs seafile-caddy -f\n</code></pre>"},{"location":"setup/caddy/#using-a-custom-existing-certificate","title":"Using a custom (existing) certificate","text":"<p>With the <code>caddy.yml</code>, a default volume-mount is created: <code>/opt/seafile-caddy</code> (as you can change it by modifying <code>SEAFILE_CADDY_VOLUME</code> in <code>.env</code>). By convention you should provide your certificate &amp; key files in the container host filesystem under <code>/opt/seafile-caddy/certs/</code> to make it available to caddy:</p> <pre><code>/opt/seafile-caddy/certs/\n\u251c\u2500\u2500 cert.pem  # xxx.crt in some case\n\u251c\u2500\u2500 key.pem # xxx.key in some case\n</code></pre> <p>Command to generate custom certificates</p> <p>With this command, you can generate your own custom certificates:</p> <pre><code>cd /opt/seafile-caddy/certs\nopenssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout ./key.pem -out ./cert.pem\n</code></pre> <p>Please be aware that custom certicates can not be used for ip-adresses</p> <p>Then modify <code>seafile-server.yml</code> to enable your custom certificate, by the way, we strongly recommend you to make a backup of <code>seafile-server.yml</code> before doing this:</p> <pre><code>cp seafile-server.yml seafile-server.yml.bak\nnano seafile-server.yml\n</code></pre> <p>and</p> <pre><code>services:\n  ...\n  seafile:\n    ...\n    volumes:\n      ...\n      # If you use a self-generated certificate, please add it to the Seafile server trusted directory (i.e. remove the comment symbol below)\n      # - \"/opt/seafile-caddy/certs/cert.pem:/usr/local/share/ca-certificates/cert.crt\"\n    labels:\n      caddy: ${SEAFILE_SERVER_HOSTNAME:?Variable is not set or empty} # leave this variables only\n      caddy.tls: \"/data/caddy/certs/cert.pem /data/caddy/certs/key.pem\"\n      ...\n</code></pre> <p>DNS resolution must work inside the container</p> <p>If you're using a non-public url like <code>my-custom-setup.local</code>, you have to make sure, that the docker container can resolve this DNS query. If you don't run your own DNS servers, you have to add extras_hosts to your <code>.yml</code> file.</p>"},{"location":"setup/cluster_deploy_with_docker/","title":"Seafile Docker Cluster Deployment","text":""},{"location":"setup/cluster_deploy_with_docker/#architecture","title":"Architecture","text":"<p>The Seafile cluster solution employs a 3-tier architecture:</p> <ul> <li>Load balancer tier: Distribute incoming traffic to Seafile servers. HA (high availability) can be achieved by deploying multiple load balancer instances.</li> <li>Seafile server cluster: a cluster of Seafile server instances. If one instance fails, the load balancer will stop handing traffic to it. So HA is achieved.</li> <li>Backend storage: Distributed storage cluster, e.g.  S3, Openstack Swift or Ceph.</li> </ul> <p>This architecture scales horizontally. That means, you can handle more traffic by adding more machines. The architecture is visualized in the following picture.</p> <p></p> <p>There are two main components on the Seafile server node: web server (Nginx/Apache) and Seafile app server. The web server passes requests from the clients to Seafile app server. The Seafile app servers work independently. They don't know about each other's state. That means each app server can fail independently without affecting other app server instances. The load balancer is responsible for detecting failure and re-routing requests.</p> <p>Even though Seafile app servers work independently, they still have to share some session information. All shared session information is stored in memory cache. Thus, all Seafile app servers have to connect to the same memory cache server (cluster). Since Pro Edition 11.0, both memcached and Redis can be used as memory cache. Before 11.0, only memcached is supported. More details about memory cache configuration is available later. Since Seafile 13.0, we recommend that you use Redis as a cache to adapt to new features (such as Seafile AI, Metadata management, etc.).</p> <p>The background server is the workhorse for various background tasks, including full-text indexing, office file preview, virus scanning, LDAP syncing. It should usually be run on a dedicated server for better performance. Currently only one background task server can be running in the entire cluster. If more than one background servers are running, they may conflict with each others when doing some tasks. If you need HA for background task server, you can consider using Keepalived to build a hot backup for it.</p> <p>In the seafile cluster, only one server should run the background tasks, including:</p> <ul> <li>indexing files for search</li> <li>email notification</li> <li>LDAP sync</li> <li>virus scan</li> </ul> <p>Let's assume you have three nodes in your cluster: A, B, and C.</p> <ul> <li>Node A is backend node that run background tasks.</li> <li>Node B and C are frontend nodes that serving requests from clients.</li> </ul> <p></p>"},{"location":"setup/cluster_deploy_with_docker/#cluster-requirements","title":"Cluster requirements","text":"<p>Please refer here for the details about the cluster requirements for all nodes in Seafile cluster.  In general, we recommend that each node should have at least 2G RAM and a 2-core CPU (&gt; 2GHz).</p>"},{"location":"setup/cluster_deploy_with_docker/#deploy-seafile-service","title":"Deploy Seafile service","text":""},{"location":"setup/cluster_deploy_with_docker/#deploy-the-first-seafile-frontend-node","title":"Deploy the first Seafile frontend node","text":"<ol> <li> <p>Create the mount directory</p> <pre><code>mkdir -p /opt/seafile/shared\n</code></pre> </li> <li> <p>Pulling Seafile image</p> <pre><code>docker pull seafileltd/seafile-pro-mc:13.0-latest\n</code></pre> </li> <li> <p>Download the <code>seafile-server.yml</code> and <code>.env</code></p> <pre><code>wget -O .env https://manual.seafile.com/13.0/repo/docker/cluster/env\nwget https://manual.seafile.com/13.0/repo/docker/cluster/seafile-server.yml\n</code></pre> </li> <li> <p>Modify the variables in <code>.env</code> (especially the terms like <code>&lt;...&gt;</code>). </p> </li> <li> <p>Pleace license file</p> <p>If you have a <code>seafile-license.txt</code> license file, simply put it in the volume of the Seafile container. The volumne's default path in the Compose file is <code>/opt/seafile/shared</code>. If you have modified the path, save the license file under your custom path.</p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p> </li> <li> <p>Start the Seafile docker</p> <pre><code>docker compose up -d\n</code></pre> <p>Cluster init mode</p> <p>Because <code>CLUSTER_INIT_MODE</code> is true in the <code>.env</code> file, Seafile docker will be started in init mode and generate configuration files. As the results, you can see the following lines if you trace the Seafile container (i.e., <code>docker logs seafile</code>):</p> <pre><code>---------------------------------\nThis is your configuration\n---------------------------------\n\n    server name:            seafile\n    server ip/domain:       seafile.example.com\n\n    seafile data dir:       /opt/seafile/seafile-data\n    fileserver port:        8082\n\n    database:               create new\n    ccnet database:         ccnet_db\n    seafile database:       seafile_db\n    seahub database:        seahub_db\n    database user:          seafile\n\n\nGenerating seafile configuration ...\n\ndone\nGenerating seahub configuration ...\n\n\n-----------------------------------------------------------------\nYour seafile server configuration has been finished successfully.\n-----------------------------------------------------------------\n\n\n[2024-11-21 02:22:37] Updating version stamp\nStart init\n\nInit success\n</code></pre> </li> <li> <p>After initailizing the cluster, the following fields can be removed in <code>.env</code></p> <ul> <li><code>CLUSTER_INIT_MODE</code>, must be removed from .env file</li> <li><code>CLUSTER_INIT_ES_HOST</code></li> <li><code>CLUSTER_INIT_ES_PORT</code></li> </ul> <p>Tip</p> <p>We recommend that you check that the relevant configuration files are correct and copy the <code>SEAFILE_VOLUME</code> directory before the service is officially started, because only the configuration files are generated after initialization. You can directly migrate the entire copied <code>SEAFILE_VOLUME</code> to other nodes later:</p> <pre><code>cp -r /opt/seafile/shared /opt/seafile/shared-bak\n</code></pre> </li> <li> <p>Restart the container to start the service in frontend node</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <p>Frontend node starts successfully</p> <p>After executing the above command, you can trace the logs of container <code>seafile</code> (i.e., <code>docker logs seafile</code>). You can see the following message if the frontend node starts successfully:</p> <pre><code>*** Running /etc/my_init.d/01_create_data_links.sh...\n*** Booting runit daemon...\n*** Runit started as PID 20\n*** Running /scripts/enterpoint.sh...\n2024-11-21 03:02:35 Nginx ready \n\n2024-11-21 03:02:35 This is an idle script (infinite loop) to keep container running. \n---------------------------------\n\nSeafile cluster frontend mode\n\n---------------------------------\n\n\nStarting seafile server, please wait ...\nSeafile server started\n\nDone.\n\nStarting seahub at port 8000 ...\n\nSeahub is started\n\nDone.\n</code></pre> </li> </ol>"},{"location":"setup/cluster_deploy_with_docker/#deploy-the-others-seafile-frontend-nodes","title":"Deploy the others Seafile frontend nodes","text":"<ol> <li> <p>Create the mount directory</p> <pre><code>$ mkdir -p /opt/seafile/shared\n</code></pre> </li> <li> <p>Pull Seafile image</p> </li> <li> <p>Copy <code>seafile-server.yml</code>, <code>.env</code>and configuration files from the first frontend node</p> </li> <li> <p>Start the service</p> <pre><code>docker compose up -d\n</code></pre> </li> </ol>"},{"location":"setup/cluster_deploy_with_docker/#deploy-seafile-backend-node","title":"Deploy seafile backend node","text":"<ol> <li> <p>Create the mount directory</p> <pre><code>$ mkdir -p /opt/seafile/shared\n</code></pre> </li> <li> <p>Pull Seafile image</p> </li> <li> <p>Copy <code>seafile-server.yml</code>, <code>.env</code> and configuration files from frontend node</p> <p>Note</p> <p>The configuration files from frontend node have to be put in the same path as the frontend node, i.e., <code>/opt/seafile/shared/seafile/conf/*</code></p> </li> <li> <p>Modify <code>.env</code>, set <code>CLUSTER_MODE</code> to <code>backend</code></p> </li> <li> <p>Start the service in the backend node</p> <pre><code>docker compose up -d\n</code></pre> <p>Backend node starts successfully</p> <p>After executing the above command, you can trace the logs of container <code>seafile</code> (i.e., <code>docker logs seafile</code>). You can see the following message if the backend node starts successfully:</p> <pre><code>*** Running /etc/my_init.d/01_create_data_links.sh...\n*** Booting runit daemon...\n*** Runit started as PID 21\n*** Running /scripts/enterpoint.sh...\n2024-11-21 03:11:59 Nginx ready \n2024-11-21 03:11:59 This is an idle script (infinite loop) to keep container running. \n\n---------------------------------\n\nSeafile cluster backend mode\n\n---------------------------------\n\n\nStarting seafile server, please wait ...\nSeafile server started\n\nDone.\n\nStarting seafile background tasks ...\nDone.\n</code></pre> </li> </ol>"},{"location":"setup/cluster_deploy_with_docker/#deploy-load-balance-optional","title":"Deploy load balance (Optional)","text":"<p>Note</p> <p>Since Seafile Pro server 6.0.0, cluster deployment requires \"sticky session\" settings in the load balancer. Otherwise sometimes folder download on the web UI can't work properly. Read the \"Load Balancer Setting\" section below for details</p> <p>Generally speaking, in order to better access the Seafile service, we recommend that you use a load balancing service to access the Seafile cluster and bind your domain name (such as <code>seafile.cluster.com</code>) to the load balancing service. Usually, you can use:</p> <ul> <li>Cloud service provider's load balancing service (e.g., AWS Elastic Load Balancer)</li> <li> <p>Deploy your own load balancing service, our document will give two of common load balance services:</p> <ul> <li>Nginx</li> <li>HAproxy</li> </ul> </li> </ul>"},{"location":"setup/cluster_deploy_with_docker/#aws-elastic-load-balancer-elb","title":"AWS Elastic Load Balancer (ELB)","text":"<p>In the AWS ELB management console, after you've added the Seafile server instances to the instance list, you should do two more configurations.</p> <p>First you should setup HTTP(S) listeners. Ports 443 and 80 of ELB should be forwarded to the ports 80 or 443 of the Seafile servers.</p> <p>Then you setup health check</p> <p></p> <p>Refer to AWS documentation about how to setup sticky sessions.</p>"},{"location":"setup/cluster_deploy_with_docker/#nginx","title":"Nginx","text":"<ol> <li> <p>Install Nginx in the host if you would like to deploy load balance service</p> <pre><code>sudo apt update\nsudo apt install nginx\n</code></pre> </li> <li> <p>Create the configurations file for Seafile cluster</p> <pre><code>sudo nano /etc/nginx/sites-available/seafile-cluster\n</code></pre> <p>and, add the following contents into this file:</p> <pre><code>upstream seafile_cluster {\n    server &lt;IP: your frontend node 1&gt;:80;\n    server &lt;IP: your frontend node 2&gt;:80;\n    ...\n}\n\nserver {\n    listen 80;\n    server_name &lt;your domain&gt;;\n\n    location / {\n        proxy_pass http://seafile_cluster;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        http_502 http_503 http_504;\n    }\n}\n</code></pre> </li> <li> <p>Link the configurations file to <code>sites-enabled</code> directory:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/seafile-cluster /etc/nginx/sites-enabled/\n</code></pre> </li> <li> <p>Test and enable configuration</p> <pre><code>sudo nginx -t\nsudo nginx -s reload\n</code></pre> </li> </ol>"},{"location":"setup/cluster_deploy_with_docker/#haproxy-and-keepalived-services","title":"HAproxy and Keepalived services","text":"<p>Execute the following commands on the two Seafile frontend servers:</p> <pre><code>$ apt install haproxy keepalived -y\n\n$ mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak\n\n$ cat &gt; /etc/haproxy/haproxy.cfg &lt;&lt; 'EOF'\nglobal\n    log 127.0.0.1 local1 notice\n    maxconn 4096\n    user haproxy\n    group haproxy\n\ndefaults\n    log global\n    mode http\n    retries 3\n    timeout connect 10000\n    timeout client 300000\n    timeout server 36000000\n\nlisten seafile 0.0.0.0:80\n    mode http\n    option httplog\n    option dontlognull\n    option forwardfor\n    cookie SERVERID insert indirect nocache\n    server seafile01 Front-End01-IP:8001 check port 11001 cookie seafile01\n    server seafile02 Front-End02-IP:8001 check port 11001 cookie seafile02\nEOF\n</code></pre> <p>Warning</p> <p>Please correctly modify the IP address (<code>Front-End01-IP</code> and <code>Front-End02-IP</code>) of the frontend server in the above configuration file. Other wise it cannot work properly.</p> <p>Choose one of the above two servers as the master node, and the other as the slave node.</p> <p>Perform the following operations on the master node:</p> <pre><code>$ cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; 'EOF'\n! Configuration File for keepalived\n\nglobal_defs {\n    notification_email {\n        root@localhost\n    }\n    notification_email_from keepalived@localhost\n    smtp_server 127.0.0.1\n    smtp_connect_timeout 30\n    router_id node1\n    vrrp_mcast_group4 224.0.100.18\n}\n\nvrrp_instance VI_1 {\n    state MASTER\n    interface eno1   # Set to the device name of a valid network interface on the current server, and the virtual IP will be bound to the network interface\n    virtual_router_id 50\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass seafile123\n    }\n    virtual_ipaddress {\n        172.26.154.45/24 dev eno1  # Configure to the correct virtual IP and network interface device name\n    }\n}\nEOF\n</code></pre> <p>Warning</p> <p>Please correctly configure the virtual IP address and network interface device name in the above file. Other wise it cannot work properly.</p> <p>Perform the following operations on the standby node:</p> <pre><code>$ cat &gt; /etc/keepalived/keepalived.conf &lt;&lt; 'EOF'\n! Configuration File for keepalived\n\nglobal_defs {\n    notification_email {\n        root@localhost\n    }\n    notification_email_from keepalived@localhost\n    smtp_server 127.0.0.1\n    smtp_connect_timeout 30\n    router_id node2\n    vrrp_mcast_group4 224.0.100.18\n}\n\nvrrp_instance VI_1 {\n    state BACKUP\n    interface eno1   # Set to the device name of a valid network interface on the current server, and the virtual IP will be bound to the network interface\n    virtual_router_id 50\n    priority 98\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass seafile123\n    }\n    virtual_ipaddress {\n        172.26.154.45/24 dev eno1   # Configure to the correct virtual IP and network interface device name\n    }\n}\nEOF\n</code></pre> <p>Finally, run the following commands on the two Seafile frontend servers to start the corresponding services:</p> <pre><code>$ systemctl enable --now haproxy\n$ systemctl enable --now keepalived\n</code></pre> <p>So far, Seafile cluster has been deployed.</p>"},{"location":"setup/cluster_deploy_with_docker/#https","title":"HTTPS","text":"<p>You can engaged HTTPS in your load balance service, as you can use certificates manager (e.g., Certbot) to acquire and enable HTTPS to your Seafile cluster. You have to modify the relative URLs from the prefix <code>http://</code> to <code>https://</code> in <code>seahub_settings.py</code> and <code>.env</code>, after enabling HTTPS.</p>"},{"location":"setup/cluster_deploy_with_docker/#optional-deploy-seadoc-server","title":"(Optional) Deploy SeaDoc server","text":"<p>You can follow here to deploy SeaDoc server. And then modify <code>SEADOC_SERVER_URL</code> in your <code>.env</code> file</p>"},{"location":"setup/cluster_deploy_with_k8s/","title":"Deploy Seafile cluster with Kubernetes (K8S) by K8S resources files","text":"<p>This manual explains how to deploy and run Seafile cluster on a Linux server using Kubernetes (k8s thereafter). </p>"},{"location":"setup/cluster_deploy_with_k8s/#prerequisites","title":"Prerequisites","text":""},{"location":"setup/cluster_deploy_with_k8s/#cluster-requirements","title":"Cluster requirements","text":"<p>Please refer here for the details about the cluster requirements for all nodes in Seafile cluster.  In general, we recommend that each node should have at least 2G RAM and a 2-core CPU (&gt; 2GHz).</p>"},{"location":"setup/cluster_deploy_with_k8s/#k8s-tools","title":"K8S tools","text":"<p>Two tools are suggested and can be installed with official installation guide on all nodes:</p> <ul> <li>kubectl</li> <li>k8s control plane tool (e.g., kubeadm)</li> </ul> <p>After installation, you need to start the k8s control plane service on each node and refer to the k8s official manual for creating a cluster.</p> <p>Tip</p> <p>Although we recommend installing the k8s control plane tool on each node, it does not mean that we will use each node as a control plane node, but it is a necessary tool to create or join a K8S cluster. For details, please refer to the above link about creating or joining into a cluster.</p>"},{"location":"setup/cluster_deploy_with_k8s/#create-namespace-and-secretmap","title":"Create namespace and secretMap","text":"<pre><code>kubectl create ns seafile\n\nkubectl create secret generic seafile-secret --namespace seafile \\\n--from-literal=JWT_PRIVATE_KEY='&lt;required&gt;' \\\n--from-literal=SEAFILE_MYSQL_DB_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_ADMIN_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_MYSQL_ROOT_PASSWORD='&lt;required&gt;' \\\n--from-literal=REDIS_PASSWORD='' \\\n--from-literal=S3_SECRET_KEY='' \\\n--from-literal=S3_SSE_C_KEY=''\n</code></pre>"},{"location":"setup/cluster_deploy_with_k8s/#download-k8s-yaml-files-for-seafile-cluster-without-frontend-node","title":"Download K8S YAML files for Seafile cluster (without frontend node)","text":"<pre><code>mkdir -p /opt/seafile-k8s-yaml\n\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/cluster/seafile-backend-deployment.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/cluster/seafile-persistentvolume.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/cluster/seafile-persistentvolumeclaim.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/cluster/seafile-service.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/cluster/seafile-env.yaml\n</code></pre> <p>In here we suppose you download the YAML files in <code>/opt/seafile-k8s-yaml</code>, which mainly include about:</p> <ul> <li><code>seafile-xx-deployment.yaml</code> for frontend and backend services pod management and creation, </li> <li><code>seafile-service.yaml</code> for exposing Seafile services to the external network, </li> <li><code>seafile-persistentVolume.yaml</code> for defining the location of a volume used for persistent storage on the host</li> <li><code>seafile-persistentvolumeclaim.yaml</code> for declaring the use of persistent storage in the container.</li> </ul> <p>For futher configuration details, you can refer the official documents.</p> <p>Use PV bound from a storage class</p> <p>If you would like to use automatically allocated persistent volume (PV) by a storage class, please modify <code>seafile-persistentvolumeclaim.yaml</code> and specify <code>storageClassName</code>. On the other hand, the PV defined by <code>seafile-persistentvolume.yaml</code> can be disabled:</p> <pre><code>rm /opt/seafile-k8s-yaml/seafile-persistentvolume.yaml\n</code></pre>"},{"location":"setup/cluster_deploy_with_k8s/#modify-seafile-envyaml","title":"Modify <code>seafile-env.yaml</code>","text":"<p>Similar to Docker-base deployment, Seafile cluster in K8S deployment also supports use files to configure startup progress, you can modify common environment variables by</p> <pre><code>nano /opt/seafile-k8s-yaml/seafile-env.yaml\n</code></pre>"},{"location":"setup/cluster_deploy_with_k8s/#initialize-seafile-cluster","title":"Initialize Seafile cluster","text":"<p>You can use following command to initialize Seafile cluster now (the Seafile's K8S resources will be specified in namespace <code>seafile</code> for easier management):</p> <pre><code>kubectl apply -f /opt/seafile-k8s-yaml/ -n seafile\n</code></pre> <p>About Seafile cluster initialization</p> <p>When Seafile cluster is initializing, it will run with the following conditions:</p> <ul> <li>Only have backend service (i.e., only has the Seafile backend K8S resouce file)</li> <li><code>CLUSTER_INIT_MODE=true</code></li> </ul> <p>Success</p> <p>You can get the following information through <code>kubectl logs seafile-xxxx -n seafile</code> to check the initialization process is done or not:</p> <pre><code>---------------------------------\nThis is your configuration\n---------------------------------\n\n    server name:            seafile\n    server ip/domain:       seafile.example.com\n\n    seafile data dir:       /opt/seafile/seafile-data\n    fileserver port:        8082\n\n    database:               create new\n    ccnet database:         ccnet_db\n    seafile database:       seafile_db\n    seahub database:        seahub_db\n    database user:          seafile\n\n\nGenerating seafile configuration ...\n\ndone\nGenerating seahub configuration ...\n\n\n-----------------------------------------------------------------\nYour seafile server configuration has been finished successfully.\n-----------------------------------------------------------------\n\n\n[2024-11-21 02:22:37] Updating version stamp\nStart init\n\nInit success\n</code></pre> <p>When the initialization is complete, the server will stop automaticlly (because no operations will be performed after the initialization is completed). </p> <p>We recommend that you check whether the contents of the configuration files in <code>/opt/seafile/shared/seafile/conf</code> are correct when going to next step, which are automatically generated during the initialization process.</p>"},{"location":"setup/cluster_deploy_with_k8s/#put-the-license-into-optseafileshared","title":"Put the license into <code>/opt/seafile/shared</code>","text":"<p>You have to locate the <code>/opt/seafile/shared</code> directory generated during initialization firsly, then simply put it in this path, if you have a <code>seafile-license.txt</code> license file. </p> <p>Finally you can use the <code>tar -zcvf</code> and <code>tar -zxvf</code> commands to package the entire <code>/opt/seafile/shared</code> directory of the current node, copy it to other nodes, and unpack it to the same directory to take effect on all nodes.</p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p>"},{"location":"setup/cluster_deploy_with_k8s/#download-frontend-services-yaml-and-restart-pods-to-start-seafile-server","title":"Download frontend service's YAML and restart pods to start Seafile server","text":"<ol> <li> <p>Download frontend service's YAML by:</p> <pre><code>wget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/cluster/seafile-frontend-deployment.yaml\n</code></pre> </li> <li> <p>Modify <code>seafile-env.yaml</code>, and set <code>CLUSTER_INIT_MODE</code> to <code>false</code> (i.e., disable initialization mode), then re-apply <code>seafile-env.yaml</code> again:</p> <pre><code>kubectl apply -f /opt/seafile-k8s-yaml\n</code></pre> </li> <li> <p>Run the following command to restart pods to restart Seafile cluster:</p> <p>Tip</p> <p>If you modify some configurations in <code>/opt/seafile/shared/seafile/conf</code> or YAML files in <code>/opt/seafile-k8s-yaml/</code>, you still need to restart services to make modifications.</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre> </li> </ol> <p>Sucess</p> <p>You can view the pod's log to check the startup progress is normal or not. You can see the following message if server is running normally:</p> <pre><code>*** Running /etc/my_init.d/01_create_data_links.sh...\n*** Booting runit daemon...\n*** Runit started as PID 20\n*** Running /scripts/enterpoint.sh...\n2024-11-21 03:02:35 Nginx ready \n\n2024-11-21 03:02:35 This is an idle script (infinite loop) to keep container running. \n---------------------------------\n\nSeafile cluster frontend mode\n\n---------------------------------\n\n\nStarting seafile server, please wait ...\nSeafile server started\n\nDone.\n\nStarting seahub at port 8000 ...\n\nSeahub is started\n\nDone.\n</code></pre>"},{"location":"setup/cluster_deploy_with_k8s/#uninstall-seafile-k8s","title":"Uninstall Seafile K8S","text":"<p>You can uninstall the Seafile K8S by the following command:</p> <pre><code>kubectl delete -f /opt/seafile-k8s-yaml/ -n seafile\n</code></pre>"},{"location":"setup/cluster_deploy_with_k8s/#advanced-operations","title":"Advanced operations","text":"<p>Please refer from here for futher advanced operations.</p>"},{"location":"setup/helm_chart_cluster/","title":"Deploy Seafile cluster with Kubernetes (K8S) by Seafile Helm Chart","text":"<p>This manual explains how to deploy and run Seafile cluster on a Linux server using Seafile Helm Chart (chart thereafter). You can also refer to here to use K8S resource files to deploy Seafile cluster in your K8S cluster.</p>"},{"location":"setup/helm_chart_cluster/#prerequisites","title":"Prerequisites","text":""},{"location":"setup/helm_chart_cluster/#cluster-requirements","title":"Cluster requirements","text":"<p>Please refer here for the details about the cluster requirements for all nodes in Seafile cluster. In general, we recommend that each node should have at least 2G RAM and a 2-core CPU (&gt; 2GHz).</p>"},{"location":"setup/helm_chart_cluster/#k8s-tools","title":"K8S tools","text":"<p>Two tools are suggested and can be installed with official installation guide on all nodes:</p> <ul> <li>kubectl</li> <li>k8s control plane tool (e.g., kubeadm)</li> </ul> <p>After installation, you need to start the k8s control plane service on each node and refer to the k8s official manual for creating a cluster.</p> <p>Tip</p> <p>Although we recommend installing the k8s control plane tool on each node, it does not mean that we will use each node as a control plane node, but it is a necessary tool to create or join a K8S cluster. For details, please refer to the above link about creating or joining into a cluster.</p>"},{"location":"setup/helm_chart_cluster/#install-seafile-helm-chart","title":"Install Seafile helm chart","text":"<ol> <li> <p>Create namespace</p> <pre><code>kubectl create namespace seafile\n</code></pre> </li> <li> <p>Create a secret for sensitive data</p> <pre><code>kubectl create secret generic seafile-secret --namespace seafile \\\n--from-literal=JWT_PRIVATE_KEY='&lt;required&gt;' \\\n--from-literal=SEAFILE_MYSQL_DB_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_ADMIN_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_MYSQL_ROOT_PASSWORD='&lt;required&gt;' \\\n--from-literal=REDIS_PASSWORD='' \\\n--from-literal=S3_SECRET_KEY='' \\\n--from-literal=S3_SSE_C_KEY=''\n</code></pre> <p>where the <code>JWT_PRIVATE_KEY</code> can be generate by <code>pwgen -s 40 1</code></p> </li> <li> <p>Download and modify the <code>my-values.yaml</code> according to your configurations. By the way, you can follow here for the details:</p> <pre><code>wget -O my-values.yaml https://haiwen.github.io/seafile-helm-chart/values/13.0/cluster.yaml\n\nnano my-values.yaml\n</code></pre> <p>Tip</p> <ul> <li>It is not necessary to use the <code>my-values.yaml</code> we provided (i.e., you can create an empty <code>my-values.yaml</code> and add required field, as others have defined default values in our chart), because it destroys the flexibility of deploying with Helm, but it contains some formats of how Seafile Helm Chart reads these configurations, as well as all the environment variables and secret variables that can be read directly.</li> <li> <p>In addition, you can also create a custom storageClassName for the persistence directory used by Seafile. You only need to specify <code>storageClassName</code> in the <code>seafile.config.seafileDataVolume</code> object in <code>my-values.yaml</code>:</p> <pre><code>seafile:\n  configs:\n    seafileDataVolume:\n      storageClassName: &lt;your seafile storage class name&gt;\n  ...\n</code></pre> </li> </ul> </li> <li> <p>Then install the chart use the following command:</p> <pre><code>helm repo add seafile https://haiwen.github.io/seafile-helm-chart/repo\nhelm upgrade --install seafile seafile/cluster --version 13.0 --namespace seafile --create-namespace --values my-values.yaml\n</code></pre> <p>Seafile helm chart 13.0 support variable validity checking</p> <p>Starting from Seafile helm chart 13.0, the validity of variables in <code>my-values.yaml</code> will be checked at deployment time. When there is a variable validity check that fails, you may encounter the following error message:</p> <pre><code>You have enabled &lt;Some feature&gt; but &lt;Variable&gt; is not specified and is not allowed to be empty\n</code></pre> <p>If you encounter the following message, please check the relevant configuration in <code>my-values.yaml</code>.</p> <p>Success</p> <p>After installing the chart, the cluster is going to initial progress, you can see the following message by <code>kubectl logs seafile-&lt;string&gt; -n seafile</code>:</p> <pre><code>Defaulted container \"seafile-backend\" out of: seafile-backend, set-ownership (init)\n*** Running /etc/my_init.d/01_create_data_links.sh...\n*** Booting runit daemon...\n*** Runit started as PID 15\n*** Running /scripts/enterpoint.sh...\n2025-02-13 08:58:35 Nginx ready \n2025-02-13 08:58:35 This is an idle script (infinite loop) to keep container running. \n\n---------------------------------\n\nSeafile cluster backend mode\n\n---------------------------------\n\n[2025-02-13 08:58:35] Now running setup-seafile-mysql.py in auto mode.\nChecking python on this machine ...\n\n\nverifying password of user root ...  done\n\n---------------------------------\nThis is your configuration\n---------------------------------\n\n    server name:            seafile\n    server ip/domain:       10.0.0.138\n\n    seafile data dir:       /opt/seafile/seafile-data\n    fileserver port:        8082\n\n    database:               create new\n    ccnet database:         ccnet_db\n    seafile database:       seafile_db\n    seahub database:        seahub_db\n    database user:          seafile\n\n\nGenerating seafile configuration ...\n\ndone\nGenerating seahub configuration ...\n\n----------------------------------------\nNow creating seafevents database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating ccnet database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating seafile database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating seahub database tables ...\n\n----------------------------------------\n\n\n-----------------------------------------------------------------\nYour seafile server configuration has been finished successfully.\n-----------------------------------------------------------------\n\n\n[2025-02-13 08:58:36] Updating version stamp\nStart init\n\nInit success\n</code></pre> </li> <li> <p>After the first-time startup, you have to turn off (i.e., set <code>initMode</code> to <code>false</code>) in your <code>my-values.yaml</code>, then upgrade the chart:</p> <pre><code>helm upgrade --install seafile seafile/cluster --version 13.0 --namespace seafile --create-namespace --values my-values.yaml\n</code></pre> <p>Success</p> <p>You can check any front-end node in Seafile cluster. If the following information is output, Seafile cluster will run normally in your cluster:</p> <pre><code>Defaulted container \"seafile-frontend\" out of: seafile-frontend, set-ownership (init)\n*** Running /etc/my_init.d/01_create_data_links.sh...\n*** Booting runit daemon...\n*** Runit started as PID 21\n*** Running /scripts/enterpoint.sh...\n2025-02-13 09:23:49 Nginx ready \n2025-02-13 09:23:49 This is an idle script (infinite loop) to keep container running. \n\n---------------------------------\n\nSeafile cluster frontend mode\n\n---------------------------------\n\n\nStarting seafile server, please wait ...\n[seaf-server] [2025-02-13 09:23:50] [INFO] seafile-session.c(86): fileserver: web_token_expire_time = 3600\n[seaf-server] [2025-02-13 09:23:50] [INFO] seafile-session.c(98): fileserver: max_index_processing_threads= 3\n[seaf-server] [2025-02-13 09:23:50] [INFO] seafile-session.c(111): fileserver: fixed_block_size = 8388608\n[seaf-server] [2025-02-13 09:23:50] [INFO] seafile-session.c(123): fileserver: max_indexing_threads = 1\n[seaf-server] [2025-02-13 09:23:50] [INFO] seafile-session.c(138): fileserver: put_head_commit_request_timeout = 10\n[seaf-server] [2025-02-13 09:23:50] [INFO] seafile-session.c(150): fileserver: skip_block_hash = 0\n[seaf-server] [2025-02-13 09:23:50] [INFO] ../common/seaf-utils.c(581): Use database Mysql\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(243): fileserver: worker_threads = 10\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(256): fileserver: backlog = 32\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(267): fileserver: verify_client_blocks = 1\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(289): fileserver: cluster_shared_temp_file_mode = 600\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(336): fileserver: check_virus_on_web_upload = 0\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(362): fileserver: enable_async_indexing = 0\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(374): fileserver: async_indexing_threshold = 700\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(386): fileserver: fs_id_list_request_timeout = 300\n[seaf-server] [2025-02-13 09:23:50] [INFO] http-server.c(399): fileserver: max_sync_file_count = 100000\n[seaf-server] [2025-02-13 09:23:50] [WARNING] ../common/license.c(716): License file /opt/seafile/seafile-license.txt does not exist, allow at most 3 trial users\nLicense file /opt/seafile/seafile-license.txt does not exist, allow at most 3 trial users\n[seaf-server] [2025-02-13 09:23:50] [INFO] filelock-mgr.c(1397): Cleaning expired file locks.\n[2025-02-13 09:23:52] Start Monitor \n[2025-02-13 09:23:52] Start seafevents.main \n/opt/seafile/seafile-pro-server-12.0.9/seahub/seahub/settings.py:1101: SyntaxWarning: invalid escape sequence '\\w'\nmatch = re.search('^EXTRA_(\\w+)', attr)\n/opt/seafile/seafile-pro-server-12.0.9/seahub/thirdpart/seafobj/mc.py:13: SyntaxWarning: invalid escape sequence '\\S'\nmatch = re.match('--SERVER\\\\s*=\\\\s*(\\S+)', mc_options)\nSeafile server started\n\nDone.\n\nStarting seahub at port 8000 ...\n\n\n\n----------------------------------------\nSuccessfully created seafile admin\n----------------------------------------\n\n[seafevents] [2025-02-13 09:23:55] [INFO] root:82 LDAP is not set, disable ldap sync.\n[seafevents] [2025-02-13 09:23:55] [INFO] virus_scan:51 [virus_scan] scan_command option is not found in seafile.conf, disable virus scan.\n[seafevents] [2025-02-13 09:23:55] [INFO] seafevents.app.mq_handler:127 Subscribe to channels: {'seaf_server.stats', 'seahub.stats', 'seaf_server.event', 'seahub.audit'}\n[seafevents] [2025-02-13 09:23:55] [INFO] root:534 Start counting user activity info..\n[seafevents] [2025-02-13 09:23:55] [INFO] root:547 [UserActivityCounter] update 0 items.\n[seafevents] [2025-02-13 09:23:55] [INFO] root:240 Start counting traffic info..\n[seafevents] [2025-02-13 09:23:55] [INFO] root:268 Traffic counter finished, total time: 0.0003578662872314453 seconds.\n[seafevents] [2025-02-13 09:23:55] [INFO] root:23 Start file updates sender, interval = 300 sec\n[seafevents] [2025-02-13 09:23:55] [WARNING] root:57 Can not start work weixin notice sender: it is not enabled!\n[seafevents] [2025-02-13 09:23:55] [INFO] root:131 search indexer is started, interval = 600 sec\n[seafevents] [2025-02-13 09:23:55] [INFO] root:56 seahub email sender is started, interval = 1800 sec\n[seafevents] [2025-02-13 09:23:55] [WARNING] root:17 Can not start ldap syncer: it is not enabled!\n[seafevents] [2025-02-13 09:23:55] [WARNING] root:18 Can not start virus scanner: it is not enabled!\n[seafevents] [2025-02-13 09:23:55] [INFO] root:35 Start data statistics..\n[seafevents] [2025-02-13 09:23:55] [WARNING] root:40 Can not start content scanner: it is not enabled!\n[seafevents] [2025-02-13 09:23:55] [WARNING] root:46 Can not scan repo old files auto del days: it is not enabled!\n[seafevents] [2025-02-13 09:23:55] [INFO] root:182 Start counting total storage..\n[seafevents] [2025-02-13 09:23:55] [WARNING] root:78 Can not start filename index updater: it is not enabled!\n[seafevents] [2025-02-13 09:23:55] [INFO] root:113 search wiki indexer is started, interval = 600 sec\n[seafevents] [2025-02-13 09:23:55] [INFO] root:87 Start counting file operations..\n[seafevents] [2025-02-13 09:23:55] [INFO] root:403 Start counting monthly traffic info..\n[seafevents] [2025-02-13 09:23:55] [INFO] root:491 Monthly traffic counter finished, update 0 user items, 0 org items, total time: 0.0905158519744873 seconds.\n[seafevents] [2025-02-13 09:23:55] [INFO] root:203 [TotalStorageCounter] No results from seafile-db.\n[seafevents] [2025-02-13 09:23:55] [INFO] root:169 [FileOpsCounter] Finish counting file operations in 0.09510159492492676 seconds, 0 added, 0 deleted, 0 visited, 0 modified\n\nSeahub is started\n\nDone.\n</code></pre> </li> <li> <p>If you have a <code>seafile-license.txt</code> license file, simply put it in the volume of the Seafile container. The volumne's default path in the Compose file is <code>/opt/seafile/shared</code>. If you have modified the path, save the license file under your custom path.</p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p> <p>Then restart Seafile:</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre> <p>A safer way to use your Seafile license file</p> <p>You can also create a secret resource to encrypt your license file in your K8S cluster, which is a safer way:</p> <pre><code>kubectl create secret generic seafile-license --from-file=seafile-license.txt=$PATH_TO_YOUR_LICENSE_FILE --namespace seafile\n</code></pre> <p>Then modify <code>my-values.yaml</code> to add the information extra volumes:</p> <pre><code>seafile:\n...\nextraVolumes:\n  backend:\n    - name: seafileLicense\n    volumeInfo:\n      secret:\n      secretName: seafile-license\n        items:\n          - key: seafile-license.txt\n          path: seafile-license.txt\n    subPath: seafile-license.txt\n    mountPath: /shared/seafile/seafile-license.txt\n    readOnly: true\n  frontend:\n    - name: seafileLicense\n    volumeInfo:\n      secret:\n        secretName: seafile-license\n          items:\n            - key: seafile-license.txt\n            path: seafile-license.txt\n    subPath: seafile-license.txt\n    mountPath: /shared/seafile/seafile-license.txt\n    readOnly: true\n</code></pre> <p>Finally you can upgrade your chart by:</p> <pre><code>helm upgrade --install seafile seafile/cluster --version 13.0 --namespace seafile --create-namespace --values my-values.yaml\n</code></pre> </li> </ol>"},{"location":"setup/helm_chart_cluster/#version-control","title":"Version control","text":"<p>Seafile Helm Chart is designed to provide fast deployment and version control. You can update and rollback versions using the following setps:</p> <ol> <li> <p>Update Helm repo</p> <pre><code>helm repo update\n</code></pre> <p>Tip</p> <p>When using the repo update command, this will not always take effect immediately, as the previous repo will be stored in the cache.</p> </li> <li> <p>Download (optional) and modify the new <code>my-values.yaml</code></p> <pre><code>wget -O my-values.yaml https://haiwen.github.io/seafile-helm-chart/values/&lt;seafile-version&gt;/cluster.yaml\n\nnano my-values.yaml\n</code></pre> <p>About version of Seafile Helm Chart and Seafile</p> <p>The version of Seafile Helm Chart is same as the major version of Seafile, i.e.:</p> <ul> <li>latest Seafile: 12.0.9</li> <li>latest Seafile Helm Chart release: 12.0</li> </ul> <p>By default, it will follow the latest Chart and the latest Seafile</p> </li> <li> <p>Upgrade release to a new version</p> <pre><code>helm upgrade --install seafile seafile/cluster --namespace seafile --create-namespace --values my-values.yaml --version &lt;release-version&gt;\n</code></pre> </li> <li> <p>(Rollback) if you would like rollback to your old-running release, you can use following command to rollback your current instances</p> <pre><code>helm rollback seafile -n seafile &lt;revision&gt;\n</code></pre> </li> </ol>"},{"location":"setup/helm_chart_cluster/#uninstall-chart","title":"Uninstall chart","text":"<p>You can uninstall chart by the following command:</p> <pre><code>helm delete seafile --namespace seafile\n</code></pre>"},{"location":"setup/helm_chart_cluster/#advanced-operations","title":"Advanced operations","text":"<p>Please refer from here for futher advanced operations.</p>"},{"location":"setup/helm_chart_single_node/","title":"Setup Seafile with a single K8S pod with Seafile Helm Chart","text":"<p>This manual explains how to deploy and run Seafile server on a Linux server using Seafile Helm Chart (chart thereafter) in a single pod (i.e., single node mode). Comparing to Setup by K8S resource files, deployment with helm chart can simplify the deployment process and provide more flexible deployment control, which the way we recommend in deployment with K8S.</p> <p>For specific environment and configuration requirements, please refer to the description of the Docker-based Seafile single-node deployment. Please also refer to the description of the K8S tool section in here.</p>"},{"location":"setup/helm_chart_single_node/#preparation","title":"Preparation","text":"<p>For persisting data using in the docker-base deployment, <code>/opt/seafile-data</code>, is still adopted in this manual. What's more, all K8S YAML files will be placed in <code>/opt/seafile-k8s-yaml</code> (replace it when following these instructions if you would like to use another path).</p> <p>By the way, we don't provide the deployment methods of basic services (e.g., Redis, MySQL and Elasticsearch) and seafile-compatibility components (e.g., SeaDoc) for K8S in our document. If you need to install these services in K8S format, you can refer to the rewrite method in this document.</p>"},{"location":"setup/helm_chart_single_node/#system-requirements","title":"System requirements","text":"<p>Please refer here for the details of system requirements about Seafile service. By the way, this will apply to all nodes where Seafile pods may appear in your K8S cluster. In general, we recommend that each node should have at least 2G RAM and a 2-core CPU (&gt; 2GHz).</p>"},{"location":"setup/helm_chart_single_node/#install-seafile-helm-chart","title":"Install Seafile helm chart","text":"<ol> <li> <p>Create namespace</p> <pre><code>kubectl create namespace seafile\n</code></pre> </li> <li> <p>Create a secret for sensitive data</p> Seafile ProSeafile CE <pre><code>kubectl create ns seafile\n\nkubectl create secret generic seafile-secret --namespace seafile \\\n--from-literal=JWT_PRIVATE_KEY='&lt;required&gt;' \\\n--from-literal=SEAFILE_MYSQL_DB_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_ADMIN_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_MYSQL_ROOT_PASSWORD='&lt;required&gt;' \\\n--from-literal=REDIS_PASSWORD='' \\\n--from-literal=S3_SECRET_KEY='' \\\n--from-literal=S3_SSE_C_KEY=''\n</code></pre> <pre><code>kubectl create ns seafile\n\nkubectl create secret generic seafile-secret --namespace seafile \\\n--from-literal=JWT_PRIVATE_KEY='&lt;required&gt;' \\\n--from-literal=SEAFILE_MYSQL_DB_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_ADMIN_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_MYSQL_ROOT_PASSWORD='&lt;required&gt;' \\\n--from-literal=REDIS_PASSWORD=''\n</code></pre> <p>where the <code>JWT_PRIVATE_KEY</code> can be generate by <code>pwgen -s 40 1</code></p> </li> <li> <p>Download and modify the <code>my-values.yaml</code> according to your configurations. By the way, you can follow here for the details:</p> Seafile ProSeafile CE <pre><code>wget -O my-values.yaml https://haiwen.github.io/seafile-helm-chart/values/13.0/pro.yaml\n\nnano my-values.yaml\n</code></pre> <pre><code>wget -O my-values.yaml https://haiwen.github.io/seafile-helm-chart/values/13.0/ce.yaml\n\nnano my-values.yaml\n</code></pre> <p>Tip</p> <ul> <li>It is not necessary to use the <code>my-values.yaml</code> we provided (i.e., you can create an empty <code>my-values.yaml</code> and add required field, as others have defined default values in our chart), because it destroys the flexibility of deploying with Helm, but it contains some formats of how Seafile Helm Chart reads these configurations, as well as all the environment variables and secret variables that can be read directly.</li> <li> <p>In addition, you can also create a custom storageClassName for the persistence directory used by Seafile. You only need to specify <code>storageClassName</code> in the <code>seafile.config.seafileDataVolume</code> object in <code>my-values.yaml</code>:</p> <pre><code>seafile:\n  configs:\n    seafileDataVolume:\n      storageClassName: &lt;your seafile storage class name&gt;\n  ...\n</code></pre> </li> </ul> </li> <li> <p>Then install the chart use the following command:</p> Seafile ProSeafile CE <pre><code>helm repo add seafile https://haiwen.github.io/seafile-helm-chart/repo\nhelm upgrade --install seafile seafile/pro --version 13.0 --namespace seafile --create-namespace --values my-values.yaml\n</code></pre> <pre><code>helm repo add seafile https://haiwen.github.io/seafile-helm-chart/repo\nhelm upgrade --install seafile seafile/ce --version 13.0 --namespace seafile --create-namespace --values my-values.yaml\n</code></pre> <p>Seafile helm chart 13.0 support variable validity checking</p> <p>Starting from Seafile helm chart 13.0, the validity of variables in <code>my-values.yaml</code> will be checked at deployment time. When there is a variable validity check that fails, you may encounter the following error message:</p> <pre><code>You have enabled &lt;Some feature&gt; but &lt;Variable&gt; is not specified and is not allowed to be empty\n</code></pre> <p>If you encounter the following message, please check the relevant configuration in <code>my-values.yaml</code>.</p> </li> </ol> <p>After installing the chart, the Seafile pod should startup automaticlly. </p> <p>About Seafile service</p> <p>The default service type of Seafile is LoadBalancer. You should specify K8S load balancer for Seafile or specify at least one external ip, that can be accessed from external networks.</p> <p>Important for deployment</p> <p>By default, Seafile will access the Elasticsearch (Pro only) with the specific service name: - Elasticsearch: <code>elasticsearch</code> with port 9200</p> <p>If the above services are:</p> <ul> <li>Not in your K8S pods (including using an external service)</li> <li>With different service name</li> <li>With different server port</li> </ul> <p>Please modfiy the files in <code>/opt/seafile-data/seafile/conf</code> to make correct the configurations for above services, otherwise the Seafile server cannot start normally. Then restart Seafile server:</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre>"},{"location":"setup/helm_chart_single_node/#activating-the-seafile-license-pro","title":"Activating the Seafile License (Pro)","text":"<p>If you have a <code>seafile-license.txt</code> license file, simply put it in the volume of the Seafile container. The volumne's default path in the Compose file is <code>/opt/seafile-data</code>. If you have modified the path, save the license file under your custom path.</p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p> <p>Then restart Seafile:</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre> <p>A safer way to use your Seafile license file</p> <p>You can also create a secret resource to encrypt your license file in your K8S cluster, which is a safer way:</p> <pre><code>kubectl create secret generic seafile-license --from-file=seafile-license.txt=$PATH_TO_YOUR_LICENSE_FILE --namespace seafile\n</code></pre> <p>Then modify <code>my-values.yaml</code> to add the information extra volumes:</p> <pre><code>seafile:\n...\nextraVolumes:\n  - name: seafileLicense\n  volumeInfo:\n    secret:\n    secretName: seafile-license\n      items:\n        - key: seafile-license.txt\n        path: seafile-license.txt\n    subPath: seafile-license.txt\n    mountPath: /shared/seafile/seafile-license.txt\n    readOnly: true\n</code></pre> <p>Finally you can upgrade your chart by:</p> Seafile ProSeafile CE <pre><code>helm upgrade --install seafile seafile/pro --version 13.0 --namespace seafile --create-namespace --values my-values.yaml\n</code></pre> <pre><code>helm upgrade --install seafile seafile/ce --version 13.0 --namespace seafile --create-namespace --values my-values.yaml\n</code></pre>"},{"location":"setup/helm_chart_single_node/#version-control","title":"Version control","text":"<p>Seafile Helm Chart is designed to provide fast deployment and version control. You can update and rollback versions using the following setps:</p> <ol> <li> <p>Update Helm repo</p> <pre><code>helm repo update\n</code></pre> <p>Tip</p> <p>When using the repo update command, this will not always take effect immediately, as the previous repo will be stored in the cache.</p> </li> <li> <p>Download (optional) and modify the new <code>my-values.yaml</code></p> Seafile ProSeafile CE <pre><code>wget -O my-values.yaml https://haiwen.github.io/seafile-helm-chart/values/&lt;seafile-version&gt;/pro.yaml\n\nnano my-values.yaml\n</code></pre> <pre><code>wget -O my-values.yaml https://haiwen.github.io/seafile-helm-chart/values/&lt;seafile-version&gt;/ce.yaml\n\nnano my-values.yaml\n</code></pre> <p>About version of Seafile Helm Chart and Seafile</p> <p>The version of Seafile Helm Chart is same as the major version of Seafile, i.e.:</p> <ul> <li>latest Seafile: 12.0.9</li> <li>latest Seafile Helm Chart release: 12.0</li> </ul> <p>By default, it will follow the latest Chart and the latest Seafile</p> </li> <li> <p>Upgrade release to a new version</p> Seafile ProSeafile CE <pre><code>helm upgrade --install seafile seafile/pro --namespace seafile --create-namespace --values my-values.yaml --version &lt;release-version&gt;\n</code></pre> <pre><code>helm upgrade --install seafile seafile/ce --namespace seafile --create-namespace --values my-values.yaml --version &lt;release-version&gt;\n</code></pre> </li> <li> <p>(Rollback) if you would like rollback to your old-running release, you can use following command to rollback your current instances</p> <pre><code>helm rollback seafile -n seafile &lt;revision&gt;\n</code></pre> </li> </ol>"},{"location":"setup/helm_chart_single_node/#uninstall-chart","title":"Uninstall chart","text":"<p>You can uninstall chart by the following command:</p> <pre><code>helm delete seafile --namespace seafile\n</code></pre>"},{"location":"setup/helm_chart_single_node/#advanced-operations","title":"Advanced operations","text":"<p>Please refer from here for futher advanced operations.</p>"},{"location":"setup/k8s_advanced_management/","title":"Seafile K8S advanced management","text":"<p>This document mainly describes how to manage and maintain Seafile deployed through our K8S deployment document. At the same time, if you are already proficient in using kubectl commands to manage K8S resources, you can also customize the deployment solutions we provide.</p> <p>Namespaces for Seafile K8S deployment</p> <p>Our documentation provides two deployment solutions for both single-node and cluster deployment (via Seafile Helm Chart and K8S resource files), both of which can be highly customized.</p> <p>Regardless of which deployment method you use, in our newer manuals (usually in versions after Seafile 12.0.9), Seafile-related K8S resources (including related Pods, services, and persistent volumes, etc.) are defined in the <code>seafile</code> namespace. In previous versions, you may deploy Seafile in the <code>default</code> namespace, so in this case, when referring to this document for Seafile K8S resource management, be sure to remove <code>-n seafile</code> in the command.</p>"},{"location":"setup/k8s_advanced_management/#seafile-k8s-container-management","title":"Seafile K8S Container management","text":"<p>Similar to docker installation, you can also manage containers through some kubectl commands. For example, you can use the following command to check whether the relevant resources are started successfully and whether the relevant services can be accessed normally. First, execute the following command and remember the pod name with <code>seafile-</code> as the prefix (such as <code>seafile-748b695648-d6l4g</code>)</p> <pre><code>kubectl get pods -n seafile\n</code></pre> <p>You can check a status of a pod by </p> <pre><code>kubectl logs seafile-748b695648-d6l4g -n seafile\n</code></pre> <p>and enter a container by</p> <pre><code>kubectl exec -it seafile-748b695648-d6l4g -n seafile --  bash\n</code></pre> <p>Also, you can restart the services by the following commands:</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre>"},{"location":"setup/k8s_advanced_management/#k8s-gateway-and-https","title":"K8S Gateway and HTTPS","text":"<p>Since the support of Ingress feature is frozen in the new version of K8S, this article will introduce how to use the new version of K8S feature K8S Gateway to implement Seafile service exposure and load balancing.</p> <p>Still use Nginx-Ingress</p> <p>If your K8S is still using Nginx-Ingress, you can follow here to setup ingress controller and HTTPS. We sincerely thanks Datamate to give an example to this configuration.</p> <p>For the details and features about K8S Gateway, please refer to the K8S official document, you can simpily install it by</p> <pre><code>kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.1.0/standard-install.yaml\n</code></pre> <p>The Gateway API requires configuration of three API categories in its resource model: - <code>GatewayClass</code>:\u00a0Defines a group of gateways with the same configuration, managed by the controller that implements the class. - <code>Gateway</code>:\u00a0Defines an instance of traffic handling infrastructure, which can be thought of as a load balancer. - <code>HTTPRoute</code>:\u00a0Defines HTTP-specific rules for mapping traffic from gateway listeners to representations of backend network endpoints. These endpoints are typically represented as\u00a0Services.</p>"},{"location":"setup/k8s_advanced_management/#gatewayclass","title":"GatewayClass","text":"<p>The GatewayClass resource serves the same purpose as the <code>IngressClass</code> in the old-ingress API, similar to the StorageClass in the Storage API. It defines the categories of Gateways that can be created. Typically, this resource is provided by your infrastructure platform, such as EKS or GKE. It can also be provided by a third-party Ingress Controller, such as Nginx-gateway or Istio-gateway.</p> <p>Here, we take the Nginx-gateway for the example, and you can install it with the official document. After installation, you can view the installation status with the following command:</p> <pre><code># `gc` means the `gatewayclass`, and its same as `kubectl get gatewayclass`\nkubectl get gc \n\n#NAME    CONTROLLER                                   ACCEPTED   AGE\n#nginx   gateway.nginx.org/nginx-gateway-controller   True       22s\n</code></pre> <p>Typically, after you install GatewayClass, your cloud provider will provide you with a load balancing IP, which is visible in GatewayClass. If this IP is not assigned, you can manually bind it to a IP that can be accessed from exteranl network.</p> <pre><code>kubectl edit svc nginx-gateway -n nginx-gateway\n</code></pre> <p>and modify the following section:</p> <pre><code>...\nspec:\n    ...\n    externalIPs:\n    - &lt;your external IP&gt;\n    externalTrafficPolicy: Cluster\n    ...\n...\n</code></pre>"},{"location":"setup/k8s_advanced_management/#gateway","title":"Gateway","text":"<p>Gateway is used to describe an instance of traffic processing infrastructure. Usually, Gateway defines a network endpoint that can be used to process traffic, that is, to filter, balance, split, etc. Service and other backends. For example, it can represent a cloud load balancer, or a cluster proxy server configured to accept HTTP traffic. As above, please refer to the official documentation for a detailed description of Gateway. Here is only a simple reference configuration for Seafile:</p> <pre><code># nano seafile-gateway/gateway.yaml\n\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: seafile-gateway\nspec:\n  gatewayClassName: nginx\n  listeners:\n  - name: seafile-http\n    protocol: HTTP\n    port: 80\n</code></pre>"},{"location":"setup/k8s_advanced_management/#httproute","title":"HTTPRoute","text":"<p>The HTTPRoute category specifies the routing behavior of HTTP requests from the Gateway listener to the backend network endpoints. For service backends, the implementation can represent the backend network endpoint as a service IP or a supporting endpoint of the service. it represents the configuration that will be applied to the underlying Gateway implementation. For example, defining a new HTTPRoute may result in configuring additional traffic routes in a cloud load balancer or in-cluster proxy server. As above, please refer to the official documentation for a detailed description of the HTTPRoute resource. Here is only a reference configuration solution that is only applicable to this document.</p> <pre><code># nano seafile-gateway/httproute.yaml\n\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: seafile-httproute\nspec:\n  parentRefs:\n  - group: gateway.networking.k8s.io\n    kind: Gateway\n    name: seafile-gateway\n  hostnames:\n  - \"&lt;your domain&gt;\"\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /\n    backendRefs:\n    - name: seafile\n      port: 80\n</code></pre> <p>After installing or defining GatewayClass, Gateway and HTTPRoute, you can now enable this feature by following command and view your Seafile server by the URL <code>http://seafile.example.com/</code>:</p> <pre><code>kubectl apply -f seafile-gateway -n seafile\n</code></pre>"},{"location":"setup/k8s_advanced_management/#enable-https-optional","title":"Enable HTTPS (Optional)","text":"<p>When using K8S Gateway, a common way to enable HTTPS is to add relevant information about the TLS listener in Gateway resource. You can refer here for futher details. We will provide a simple way here so that you can quickly enable HTTPS for your Seafile K8S.</p> <ol> <li> <p>Create a secret resource (<code>seafile-tls-cert</code>) for your TLS certificates:</p> <p><pre><code>kubectl create secret tls seafile-tls-cert \\\n--cert=&lt;your path to fullchain.pem&gt; \\\n--key=&lt;your path to privkey.pem&gt;\n</code></pre> 2. Use the TLS in your Gateway resource and enable HTTPS:</p> <pre><code># nano seafile-gateway/gateway.yaml\n\n...\nspec:\n  ...\n  listeners:\n    - name: seafile-http\n      ...\n      tls:\n        certificateRefs:\n        - kind: Secret\n            group: \"\"\n            name: seafile-tls-cert\n...\n</code></pre> </li> <li> <p>Modify <code>seahub_settings.py</code>:</p> <pre><code>SERVICE_URL = \"https://&lt;your domain&gt;/\"\n</code></pre> </li> <li> <p>Restart Seafile K8S Gateway:</p> <pre><code>kubectl delete -f seafile-gateway -n seafile\nkubectl apply -f seafile-gateway -n seafile\n</code></pre> <p>Now you can access your Seafile service in <code>https://&lt;your domain&gt;/</code></p> </li> </ol>"},{"location":"setup/k8s_advanced_management/#log-routing-and-aggregating-system","title":"Log routing and aggregating system","text":"<p>Similar to single-node deployment, you can browse the log files of Seafile running directly in the persistent volume directory (i.e., <code>&lt;path&gt;/seafile/logs</code>). The difference is that when using K8S to deploy a Seafile cluster (especially in a cloud environment), the persistent volume created is usually shared and synchronized for all nodes. However, the logs generated by the Seafile service do not record the specific node information where these logs are located, so browsing the files in the above folder may make it difficult to identify which node these logs are generated from. Therefore, one solution proposed here is:</p> <ol> <li> <p>Record the generated logs to the standard output. In this way, the logs can be distinguished under each node by <code>kubectl logs</code> (but all types of logs will be output together now). You can enable this feature (it should be enabled by default in K8S Seafile cluster but not in K8S single-pod Seafile) by modifing <code>SEAFILE_LOG_TO_STDOUT</code> to <code>true</code> in <code>seafile-env.yaml</code>:</p> <pre><code>...\ndata:\n  ...\n  SEAFILE_LOG_TO_STDOUT: \"true\"\n  ...\n</code></pre> <p>Then restart the Seafile server:</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre> </li> <li> <p>Since the logs in step 1 can be distinguished between nodes, but they are aggregated and output together, it is not convenient for log retrieval. So you have to route the standard output logs (i.e., distinguish logs by corresponding components name) and re-record them in a new file or upload them to a log aggregation system (e.g., Loki).</p> </li> </ol> <p>Currently in the K8S environment, the commonly used log routing plugins are:</p> <ul> <li>Fluent Bit</li> <li>Fluentd</li> <li>Logstash</li> <li>Promtail (also a part of Loki)</li> </ul> <p>Fluent Bit and Promtail are more lightweight (i.e., consume less system resources), while Promtail only supports transferring logs to Loki. Therefore, this document will mainly introduce log routing through Fluent Bit which is a fast, lightweight logs and metrics agent. It is also a CNCF graduated sub-project under the umbrella of Fluentd. Fluent Bit is licensed under the terms of the Apache License v2.0. You should deploy the Fluent Bit in your K8S cluster by following offical document firstly. Then modify Fluent-Bit pod settings to mount a new directory to load the configuration files:</p> <pre><code>#kubectl edit ds fluent-bit\n\n...\nspec:\n    ...\n    spec:\n        ...\n        containers:\n        - name: fluent-bit\n          volumeMounts:\n            ...\n            - mountPath: /fluent-bit/etc/seafile\n              name: fluent-bit-seafile\n            - mountPath: /\n        ...\n    ...\n    volumes:\n    ...\n    - hostPath:\n        path: /opt/fluent-bit\n      name: fluent-bit-seafile\n</code></pre> <p>and</p> <pre><code>#kubectl edit cm fluent-bit\n\ndata:\n    ...\n    fluent-bit.conf: |\n        [SERVICE]\n            ...\n            Parsers_File /fluent-bit/etc/seafile/confs/parsers.conf\n        ...\n        @INCLUDE /fluent-bit/etc/seafile/confs/*-log.conf\n</code></pre> <p>For example in here, we use <code>/opt/fluent-bit/confs</code> (it has to be non-shared). What's more, the parsers will be defined in <code>/opt/fluent-bit/confs/parsers.conf</code>, and for each type log (e.g., seahub's log, seafevent's log) will be defined in <code>/opt/fluent-bit/confs/*-log.conf</code>. Each <code>.conf</code> file defines several Fluent-Bit data pipeline components:</p> Pipeline Description Required/Optional INPUT Specifies where and how Fluent-Bit can get the original log information, and assigns a tag for each log record after read. Required PARSER Parse the read log records. For K8S Docker runtime logs, they are usually in Json format. Required FILTER Filters and selects log records with a specified tag, and assigns a new tag to new records. Optional OUTPUT tells Fluent-Bit what format the log records for the specified tag will be in and where to output them (such as file, Elasticsearch, Loki, etc.). Required <p>Warning</p> <p>For PARSER, it can only be stored in <code>/opt/fluent-bit/confs/parsers.conf</code>, otherwise the Fluent-Bit cannot startup normally.</p>"},{"location":"setup/k8s_advanced_management/#inputer","title":"Inputer","text":"<p>According to the above, a container will generate a log file (usually in <code>/var/log/containers/&lt;container-name&gt;-xxxxxx.log</code>), so you need to prepare an importer and add the following information (for more details, please refer to offical document about TAIL inputer) in <code>/opt/fluent-bit/confs/seafile-log.conf</code>:</p> <pre><code>[INPUT]\n    Name              tail\n    Path              /var/log/containers/seafile-frontend-*.log\n    Buffer_Chunk_Size 2MB\n    Buffer_Max_Size   10MB\n    Docker_Mode       On\n    Docker_Mode_Flush 5\n    Tag               seafile.*\n    Parser            Docker # for definition, please see the next section as well\n\n[INPUT]\n    Name              tail\n    Path              /var/log/containers/seafile-backend-*.log\n    Buffer_Chunk_Size 2MB\n    Buffer_Max_Size   10MB\n    Docker_Mode       On\n    Docker_Mode_Flush 5\n    Tag               seafile.*\n    Parser            Docker\n</code></pre> <p>The above defines two importers, which are used to monitor seafile-frontend and seafile-backend services respectively. The reason why they are written together here is that for a node, you may not know when it will run the frontend service and when it will run the backend service, but they have the same tag prefix <code>seafile.</code>.</p>"},{"location":"setup/k8s_advanced_management/#parser","title":"Parser","text":"<p>Each input has to use a parser to parse the logs and pass them to the filter. Here, a parser named <code>Docker</code> is created to parse the logs generated by the K8S-docker-runtime container. The parser is placed in <code>/opt/fluent-bit/confs/parser.conf</code> (for more details, please refer to offical document about JSON parser):</p> <pre><code>[PARSER]\n    Name        Docker\n    Format      json\n    Time_Key    time\n    Time_Format %Y-%m-%dT%H:%M:%S.%LZ\n</code></pre> <p>Log records after parsing</p> <p>The logs of the Docker container are saved in /var/log/containers in Json format (see the sample below), which is why we use the <code>Json</code> format in the above parser.</p> <pre><code>{\"log\":\"[seaf-server] [2025-01-17 07:43:48] [INFO] seafile-session.c(86): fileserver: web_token_expire_time = 3600\\n\",\"stream\":\"stdout\",\"time\":\"2025-01-17T07:43:48.294638442Z\"}\n{\"log\":\"[seaf-server] [2025-01-17 07:43:48] [INFO] seafile-session.c(98): fileserver: max_index_processing_threads= 3\\n\",\"stream\":\"stdout\",\"time\":\"2025-01-17T07:43:48.294810145Z\"}\n{\"log\":\"[seaf-server] [2025-01-17 07:43:48] [INFO] seafile-session.c(111): fileserver: fixed_block_size = 8388608\\n\",\"stream\":\"stdout\",\"time\":\"2025-01-17T07:43:48.294879777Z\"}\n{\"log\":\"[seaf-server] [2025-01-17 07:43:48] [INFO] seafile-session.c(123): fileserver: max_indexing_threads = 1\\n\",\"stream\":\"stdout\",\"time\":\"2025-01-17T07:43:48.295002479Z\"}\n{\"log\":\"[seaf-server] [2025-01-17 07:43:48] [INFO] seafile-session.c(138): fileserver: put_head_commit_request_timeout = 10\\n\",\"stream\":\"stdout\",\"time\":\"2025-01-17T07:43:48.295082733Z\"}\n{\"log\":\"[seaf-server] [2025-01-17 07:43:48] [INFO] seafile-session.c(150): fileserver: skip_block_hash = 0\\n\",\"stream\":\"stdout\",\"time\":\"2025-01-17T07:43:48.295195843Z\"}\n{\"log\":\"[seaf-server] [2025-01-17 07:43:48] [INFO] ../common/seaf-utils.c(553): Use database Mysql\\n\",\"stream\":\"stdout\",\"time\":\"2025-01-17T07:43:48.29704895Z\"}\n</code></pre> <p>When these logs are obtained by the importer and parsed by the parser, they will become independent log records with the following fields:</p> <ul> <li><code>log</code>: The original log content (i.e., same as you seen in <code>kubectl logs seafile-xxx -n seafile</code>) and an extra line break at the end (i.e., <code>\\n</code>). This is also the field we need to save or upload to the log aggregation system in the end.</li> <li><code>stream</code>: The original log come from. <code>stdout</code> means the standard output.</li> <li><code>time</code>: The time when the log is recorded in the corresponding stream (ISO 8601 format).</li> </ul>"},{"location":"setup/k8s_advanced_management/#filter","title":"Filter","text":"<p>Add two filters in <code>/opt/fluent-bit/confs/seafile-log.conf</code> for records filtering and routing. Here, the record_modifier filter is to select useful keys (see the contents in above tip label, only the <code>log</code> field is what we need) in the log records and rewrite_tag filter is used to route logs according to specific rules:</p> <pre><code>[FILTER]        \n    Name record_modifier\n    Match seafile.*\n    Allowlist_key log\n\n\n[FILTER]\n    Name        rewrite_tag\n    Match       seafile.*\n    Rule        $log ^.*\\[seaf-server\\].*$ seaf-server false # for seafile's logs\n    Rule        $log ^.*\\[seahub\\].*$ seahub false # for seahub's logs\n    Rule        $log ^.*\\[seafevents\\].*$ seafevents false # for seafevents' lgos\n    Rule        $log ^.*\\[seafile-slow-rpc\\].*$ seafile-slow-rpc false # for slow-rpc's logs\n</code></pre>"},{"location":"setup/k8s_advanced_management/#output-logs-to-loki","title":"Output log's to Loki","text":"<p>Loki is multi-tenant log aggregation system inspired by Prometheus. It is designed to be very cost effective and easy to operate. The Fluent-Bit loki built-in output plugin allows you to send your log or events to a Loki service. It supports data enrichment with Kubernetes labels, custom label keys and Tenant ID within others.</p> <p>Alternative Fluent-Bit Loki plugin by Grafana</p> <p>For sending logs to Loki, there are two plugins for Fluent-Bit:</p> <ul> <li>The built-in Loki plugin maintained by the Fluent-Bit officially, and we will use it in this part because it provides the most complete features.</li> <li>Grafana-loki plugin maintained by Grafana Labs.</li> </ul> <p>Due to each outputer dose not have a distinguishing marks in the configuration files (because Fluent-Bit takes each plugin as a tag workflow): </p> <ul> <li> <p>Seaf-server log: Add an outputer to <code>/opt/fluent-bit/confs/seaf-server-log.conf</code>:</p> <pre><code>[OUTPUT]\n    Name        loki\n    Match       seaf-server\n    Host        &lt;your Loki's host&gt;\n    port        &lt;your Loki's port&gt;\n    labels      job=fluentbit, node_name=&lt;your-node-name&gt;, node_id=&lt;your-node-id&gt; # node_name and node_id is optional, but recommended for identifying the source node\n</code></pre> </li> <li> <p>seahub log: Add an outputer to <code>/opt/fluent-bit/confs/seahub-log.conf</code>:</p> <pre><code>[OUTPUT]\n    Name        loki\n    Match       seahub\n    Host        &lt;your Loki's host&gt;\n    port        &lt;your Loki's port&gt;\n    labels      job=fluentbit, node_name=&lt;your-node-name&gt;, node_id=&lt;your-node-id&gt; # node_name and node_id is optional, but recommended for identifying the source node\n</code></pre> </li> <li> <p>seafevents log: Add an outputer to <code>/opt/fluent-bit/confs/seafevents-log.conf</code>:</p> <pre><code>[OUTPUT]\n    Name        loki\n    Match       seafevents\n    Host        &lt;your Loki's host&gt;\n    port        &lt;your Loki's port&gt;\n    labels      job=fluentbit, node_name=&lt;your-node-name&gt;, node_id=&lt;your-node-id&gt; # node_name and node_id is optional, but recommended for identifying the source node\n</code></pre> </li> <li> <p>seafile-slow-rpc log: Add an outputer to <code>/opt/fluent-bit/confs/seafile-slow-rpc-log.conf</code>:</p> <pre><code>[OUTPUT]\n    Name        loki\n    Match       seafile-slow-rpc\n    Host        &lt;your Loki's host&gt;\n    port        &lt;your Loki's port&gt;\n    labels      job=fluentbit, node_name=&lt;your-node-name&gt;, node_id=&lt;your-node-id&gt; # node_name and node_id is optional, but recommended for identifying the source node\n</code></pre> </li> </ul> <p>Cloud Loki instance</p> <p>If you are using a cloud Loki instance, you can follow the Fluent-Bit Loki plugin document to fill up all necessary fields. Usually, the following fields are additional needs in cloud Loki service:</p> <ul> <li><code>tls</code></li> <li><code>tls.verify</code></li> <li><code>http_user</code></li> <li><code>http_passwd</code></li> </ul>"},{"location":"setup/k8s_single_node/","title":"Setup Seafile with a single K8S pod with K8S resources files","text":"<p>This manual explains how to deploy and run Seafile server on a Linux server using Kubernetes (k8s thereafter) in a single pod (i.e., single node mode). So this document is essentially an extended description of the Docker-based Seafile single-node deployment (support both CE and Pro). </p> <p>For specific environment and configuration requirements, please refer to the description of the Docker-based Seafile single-node deployment. Please also refer to the description of the K8S tool section in here.</p>"},{"location":"setup/k8s_single_node/#system-requirements","title":"System requirements","text":"<p>Please refer here for the details of system requirements about Seafile service. By the way, this will apply to all nodes where Seafile pods may appear in your K8S cluster. In general, we recommend that each node should have at least 2G RAM and a 2-core CPU (&gt; 2GHz).</p>"},{"location":"setup/k8s_single_node/#gettings-started","title":"Gettings started","text":"<p>For persisting data using in the docker-base deployment, <code>/opt/seafile-data</code>, is still adopted in this manual. What's more, all K8S YAML files will be placed in <code>/opt/seafile-k8s-yaml</code> (replace it when following these instructions if you would like to use another path).</p> <p>By the way, we don't provide the deployment methods of basic services (e.g., Redis, MySQL and Elasticsearch) and seafile-compatibility components (e.g., SeaDoc) for K8S in our document. If you need to install these services in K8S format, you can refer to the rewrite method of this document.</p>"},{"location":"setup/k8s_single_node/#create-namespace-and-secretmap","title":"Create namespace and secretMap","text":"Seafile ProSeafile CE <pre><code>kubectl create ns seafile\n\nkubectl create secret generic seafile-secret --namespace seafile \\\n--from-literal=JWT_PRIVATE_KEY='&lt;required&gt;' \\\n--from-literal=SEAFILE_MYSQL_DB_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_ADMIN_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_MYSQL_ROOT_PASSWORD='&lt;required&gt;' \\\n--from-literal=REDIS_PASSWORD='' \\\n--from-literal=S3_SECRET_KEY='' \\\n--from-literal=S3_SSE_C_KEY=''  \n</code></pre> <pre><code>kubectl create ns seafile\n\nkubectl create secret generic seafile-secret --namespace seafile \\\n--from-literal=JWT_PRIVATE_KEY='&lt;required&gt;' \\\n--from-literal=SEAFILE_MYSQL_DB_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_ADMIN_PASSWORD='&lt;required&gt;' \\\n--from-literal=INIT_SEAFILE_MYSQL_ROOT_PASSWORD='&lt;required&gt;' \\\n--from-literal=REDIS_PASSWORD=''\n</code></pre>"},{"location":"setup/k8s_single_node/#down-load-the-yaml-files-for-seafile-server","title":"Down load the YAML files for Seafile Server","text":"Pro editionCommunity edition <pre><code>mkdir -p /opt/seafile-k8s-yaml\n\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/pro/seafile-deployment.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/pro/seafile-persistentvolume.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/pro/seafile-persistentvolumeclaim.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/pro/seafile-service.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/pro/seafile-env.yaml\n</code></pre> <pre><code>mkdir -p /opt/seafile-k8s-yaml\n\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/ce/seafile-deployment.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/ce/seafile-persistentvolume.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/ce/seafile-persistentvolumeclaim.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/ce/seafile-service.yaml\nwget -P /opt/seafile-k8s-yaml https://manual.seafile.com/13.0/repo/k8s/ce/seafile-env.yaml\n</code></pre> <p>In here we suppose you download the YAML files in <code>/opt/seafile-k8s-yaml</code>, which mainly include about:</p> <ul> <li><code>seafile-deployment.yaml</code> for Seafile server pod management and creation, </li> <li><code>seafile-service.yaml</code> for exposing Seafile services to the external network, </li> <li><code>seafile-persistentVolume.yaml</code> for defining the location of a volume used for persistent storage on the host</li> <li><code>seafile-persistentvolumeclaim.yaml</code> for declaring the use of persistent storage in the container.</li> </ul> <p>Use PV bound from a storage class</p> <p>If you would like to use automatically allocated persistent volume (PV) by a storage class, please modify <code>seafile-persistentvolumeclaim.yaml</code> and specify <code>storageClassName</code>. On the other hand, the PV defined by <code>seafile-persistentvolume.yaml</code> can be disabled:</p> <pre><code>rm /opt/seafile-k8s-yaml/seafile-persistentvolume.yaml\n</code></pre> <p>For futher configuration details, you can refer the official documents.</p>"},{"location":"setup/k8s_single_node/#modify-seafile-envyaml","title":"Modify <code>seafile-env.yaml</code>","text":"<p>Similar to Docker-base deployment, Seafile cluster in K8S deployment also supports use files to configure startup progress, you can modify common environment variables by</p> <pre><code>nano /opt/seafile-k8s-yaml/seafile-env.yaml\n</code></pre> <p>Warning</p> <p>For the fields marked with <code>&lt;...&gt;</code> are required, please make sure these items are filled in, otherwise Seafile server may not run properly. </p>"},{"location":"setup/k8s_single_node/#start-seafile-server","title":"Start Seafile server","text":"<p>You can start Seafile server and specify the resources into the namespace <code>seafile</code> for easier management by</p> <pre><code>kubectl apply -f /opt/seafile-k8s-yaml/ -n seafile\n</code></pre> <p>Important for Pro edition</p> <p>By default, Seafile (Pro) will access the Elasticsearch with the specific service name:</p> <ul> <li>Elasticsearch: <code>elasticsearch</code> with port 9200</li> </ul> <p>If the above services are:</p> <ul> <li>Not in your K8S pods (including using an external service)</li> <li>With different service name</li> <li>With different server port</li> </ul> <p>Please modfiy the files in <code>/opt/seafile-data/seafile/conf/seafevents.conf</code> to make correct the configurations for above services, otherwise the Seafile server cannot start normally. Then restart Seafile server:</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre>"},{"location":"setup/k8s_single_node/#activating-the-seafile-license-pro","title":"Activating the Seafile License (Pro)","text":"<p>If you have a <code>seafile-license.txt</code> license file, simply put it in the volume of the Seafile container. The volumne's default path in the Compose file is <code>/opt/seafile-data</code>. If you have modified the path, save the license file under your custom path.</p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p> <p>Then restart Seafile:</p> <pre><code>kubectl delete pods -n seafile $(kubectl get pods -n seafile -o jsonpath='{.items[*].metadata.name}' | grep seafile)\n</code></pre>"},{"location":"setup/k8s_single_node/#uninstall-seafile-k8s","title":"Uninstall Seafile K8S","text":"<p>You can uninstall the Seafile K8S by the following command:</p> <pre><code>kubectl delete -f /opt/seafile-k8s-yaml/ -n seafile\n</code></pre>"},{"location":"setup/k8s_single_node/#advanced-operations","title":"Advanced operations","text":"<p>Please refer from here for futher advanced operations.</p>"},{"location":"setup/migrate_backends_data/","title":"Migrate data between different backends","text":"<p>Seafile supports data migration between filesystem, s3, ceph, swift and Alibaba oss by a built-in script. Before migration, you have to ensure that both S3 hosts can be accessed normally.</p> <p>Migration to or from S3</p> <p>Since version 11, when you migrate from S3 to other storage servers or from other storage servers to S3, you have to use V4 authentication protocol. This is because version 11 upgrades to Boto3 library, which fails to list objects from S3 when it's configured to use V2 authentication protocol.</p>"},{"location":"setup/migrate_backends_data/#copy-seafileconf-and-use-new-s3-configurations","title":"Copy <code>seafile.conf</code> and use new S3 configurations","text":"<p>During the migration process, Seafile needs to know where the data will be migrated to. The easiest way is to copy the original <code>seafile.conf</code> to a new path, and then use the new S3 configurations in this file.</p> Deploy with DockerDeploy from binary package <p>Warning</p> <p>For deployment with Docker, the new <code>seafile.conf</code> has to be put in the persistent directory (e.g., <code>/opt/seafile-data/seafile.conf</code>) used by Seafile service. Otherwise the script cannot locate the new configurations file.</p> <pre><code>cp /opt/seafile-data/seafile/conf/seafile.conf /opt/seafile-data/seafile.conf\n\nnano /opt/seafile-data/seafile.conf\n</code></pre> <pre><code>cp /opt/seafile/conf/seafile.conf /opt/seafile.conf\n\nnano /opt/seafile.conf\n</code></pre> <p>Then you can follow here to use the new S3 configurations in the new <code>seafile.conf</code>. By the way, if you want to migrate to a local file system, the new <code>seafile.conf</code> configurations for S3 example is as follows:</p> <pre><code># ... other configurations\n\n[commit_object_backend]\nname = fs\ndir = /var/data_backup\n\n[fs_object_backend]\nname = fs\ndir = /var/data_backup\n\n[block_backend]\nname = fs\ndir = /var/data_backup\n</code></pre>"},{"location":"setup/migrate_backends_data/#stop-seafile-server","title":"Stop Seafile Server","text":"<p>Since the data migration process will not affect the operation of the Seafile service, if the original S3 data is operated during this process, the data may not be synchronized with the migrated data. Therefore, we recommend that you stop the Seafile service before executing the migration procedure.</p> Deploy with DockerDeploy from binary package <pre><code>docker exec -it seafile bash\ncd /opt/seafile/seafile-server-latest\n./seahub.sh stop\n./seafile.sh stop\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\n./seahub.sh stop\n./seafile.sh stop\n</code></pre>"},{"location":"setup/migrate_backends_data/#run-migratesh-to-initially-migrate-objects","title":"Run migrate.sh to initially migrate objects","text":"<p>This step will migrate most of objects from the source storage to the destination storage. You don't need to stop Seafile service at this stage as it may take quite long time to finish. Since the service is not stopped, some new objects may be added to the source storage during migration. Those objects will be handled in the next step:</p> <p>Speed-up migrating large number of objects</p> <p>If you have millions of objects in the storage (especially the fs objects), it may take quite long time to migrate all objects and more than half is using to check whether an object exists in the destination storage. In this situation, you can modify the <code>nworker</code> and <code>maxsize</code> variables in the <code>migrate.py</code>:</p> <pre><code>class ThreadPool(object):\n    def __init__(self, do_work, nworker=20):\n            self.do_work = do_work\n            self.nworker = nworker\n            self.task_queue = Queue.Queue(maxsize = 2000)\n</code></pre> <p>However, if the two values (i.e., <code>nworker</code> and <code>maxsize</code>) \u200b\u200bare too large, the improvement in data migration speed may not be obvious because the disk I/O bottleneck has been reached.</p> <p>Encrypted storage backend data (deprecated)</p> <p>If you have an encrypted storage backend, you can use this script to migrate and decrypt the data from that backend to a new one. You can add the <code>--decrypt</code> option in calling the script, which will decrypt the data while reading it, and then write the unencrypted data to the new backend:</p> <pre><code>./migrate.sh /opt --decrypt\n</code></pre> Deploy with DockerDeploy from binary package <pre><code># make sure you are in the container and in directory `/opt/seafile/seafile-server-latest`\n./migrate.sh /shared\n\n# exit container and stop it\nexit\ndocker compose down\n</code></pre> <pre><code># make sure you are in the directory `/opt/seafile/seafile-server-latest`\n./migrate.sh /opt\n</code></pre> <p>Success</p> <p>You can see the following message if the migration process is done:</p> <pre><code>2025-01-15 05:49:39,408 Start to fetch [commits] object from destination\n2025-01-15 05:49:39,422 Start to fetch [fs] object from destination\n2025-01-15 05:49:39,442 Start to fetch [blocks] object from destination\n2025-01-15 05:49:39,677 [commits] [0] objects exist in destination\n2025-01-15 05:49:39,677 Start to migrate [commits] object\n2025-01-15 05:49:39,749 [blocks] [0] objects exist in destination\n2025-01-15 05:49:39,755 Start to migrate [blocks] object\n2025-01-15 05:49:39,752 [fs] [0] objects exist in destination\n2025-01-15 05:49:39,762 Start to migrate [fs] object\n2025-01-15 05:49:40,602 Complete migrate [commits] object\n2025-01-15 05:49:40,626 Complete migrate [blocks] object\n2025-01-15 05:49:40,790 Complete migrate [fs] object\nDone.\n</code></pre>"},{"location":"setup/migrate_backends_data/#replace-the-original-seafileconf-and-start-seafile","title":"Replace the original <code>seafile.conf</code> and start Seafile","text":"<p>After running the script, we recommend that you check whether your data already exists on the new S3 storage backend server (i.e., the migration is successful, and the number and size of files should be the same). Then you can remove the file from the old S3 storage backend and replace the original <code>seafile.conf</code> from the new one:</p> Deploy with DockerDeploy from binary package <pre><code>mv /opt/seafile-data/seafile.conf /opt/seafile-data/seafile/conf/seafile.conf\n</code></pre> <pre><code>mv /opt/seafile.conf /opt/seafile/conf/seafile.conf\n</code></pre> <p>Finally, you can start Seafile server:</p> Deploy with DockerDeploy from binary package <pre><code>docker compose up -d\n</code></pre> <pre><code># make sure you are in the directory `/opt/seafile/seafile-server-latest`\n./seahub.sh start\n./seafile.sh start\n</code></pre>"},{"location":"setup/migrate_ce_to_pro_with_docker/","title":"Migrate CE to Pro with Docker","text":""},{"location":"setup/migrate_ce_to_pro_with_docker/#preparation","title":"Preparation","text":"<ol> <li>Make sure you are running a Seafile Community edition that match the latest version of pro edition. For example, if the latest pro edition is version 13.0, you should first upgrade the community edition to version 13.0.</li> <li>Purchase Seafile Professional license file.</li> <li>Download the <code>.env</code> and <code>seafile-server.yml</code> of Seafile Pro.</li> </ol> <pre><code>wget -O .env https://manual.seafile.com/13.0/repo/docker/pro/env\nwget https://manual.seafile.com/13.0/repo/docker/pro/seafile-server.yml\nwget https://manual.seafile.com/13.0/repo/docker/pro/elasticsearch.yml\n</code></pre>"},{"location":"setup/migrate_ce_to_pro_with_docker/#migrate","title":"Migrate","text":""},{"location":"setup/migrate_ce_to_pro_with_docker/#stop-the-seafile-ce","title":"Stop the Seafile CE","text":"<pre><code>docker compose down\n</code></pre> <p>Tip</p> <p>To ensure data security, it is recommended that you back up your MySQL data</p>"},{"location":"setup/migrate_ce_to_pro_with_docker/#put-your-licence-file","title":"Put your licence file","text":"<p>Copy the <code>seafile-license.txt</code> to the volume directory of the Seafile CE's data. If the directory is <code>/opt/seafile-data</code>, so you should put it in the <code>/opt/seafile-data/seafile/</code>.</p>"},{"location":"setup/migrate_ce_to_pro_with_docker/#modify-the-new-seafile-serveryml-and-env","title":"Modify the new seafile-server.yml and .env","text":"<p>Modify <code>.env</code> based on the old configurations from the old <code>.env</code> file. The following fields should be paid special attention and others should be the same as the old configurations:</p> Variable Description Default Value <code>SEAFILE_IMAGE</code> The Seafile pro docker image, which the tag must be equal to or newer than the old Seafile CE docker tag <code>seafileltd/seafile-pro-mc:13.0-latest</code> <code>SEAFILE_ELASTICSEARCH_VOLUME</code> The volume directory of Elasticsearch data <code>/opt/seafile-elasticsearch/data</code> <p>For other fileds (e.g., <code>SEAFILE_VOLUME</code>, <code>SEAFILE_MYSQL_VOLUME</code>, <code>SEAFILE_MYSQL_DB_USER</code>, <code>SEAFILE_MYSQL_DB_PASSWORD</code>), must be consistent with the old configurations.</p> <p>Tip</p> <p>For the configurations using to do the initializations (e.g, <code>INIT_SEAFILE_ADMIN_EMAIL</code>, <code>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</code>), you can remove it from <code>.env</code> as well</p>"},{"location":"setup/migrate_ce_to_pro_with_docker/#replace-seafile-serveryml-and-env","title":"Replace <code>seafile-server.yml</code> and <code>.env</code>","text":"<p>Replace the old <code>seafile-server.yml</code> and <code>.env</code> by the new and modified files, i.e. (if your old <code>seafile-server.yml</code> and <code>.env</code> are in the <code>/opt</code>)</p> <pre><code>mv -b seafile-server.yml /opt/seafile-server.yml\nmv -b .env /opt/.env\n</code></pre>"},{"location":"setup/migrate_ce_to_pro_with_docker/#modify-seafeventsconf","title":"Modify <code>seafevents.conf</code>","text":"<p>Add <code>[INDEX FILES]</code> section in <code>/opt/seafile-data/seafile/conf/seafevents.conf</code> manually:</p> <p>Additional system resource requirements</p> <p>Seafile PE docker requires a minimum of 4 cores and 4GB RAM because of Elasticsearch deployed simultaneously. If you do not have enough system resources, you can use an alternative search engine, SeaSearch, a more lightweight search engine built on open source search engine ZincSearch, as the indexer.</p> <pre><code>[INDEX FILES]\nes_host = elasticsearch\nes_port = 9200\nenabled = true\ninterval = 10m\n</code></pre>"},{"location":"setup/migrate_ce_to_pro_with_docker/#start-seafile-pro","title":"Start Seafile Pro","text":"<p>Run the following command to run the Seafile-Pro container\uff1a</p> <pre><code>docker compose up -d\n</code></pre> <p>Now you have a Seafile Professional service.</p>"},{"location":"setup/migrate_non_docker_to_docker/","title":"Migrate from non-docker Seafile deployment to docker","text":"<p>Note</p> <ul> <li>This document is written to about the single node, you have to do the following opeartions (except migtating database) in all nodes if you are using Seafile Cluster</li> <li>Normally, we only recommend that you perform the migration operation on two different machines according to the solution in this document. If you decide to perform the operation on the same machine, please pay attention to the corresponding tips in the document.</li> </ul> <p>The recommended steps to migrate from non-docker deployment to docker deployment on two different machines are:</p> <ol> <li>Upgrade your Seafile server to the latest version.</li> <li>Shutdown the Seafile, Nginx and cache server (e.g., Redis) according to your situations.</li> <li>Backup MySQL databse and Seafile libraries data.</li> <li>Deploy the Seafile Docker in the new machine.</li> <li>Recover the Seafile libraries and MySQL database in the new machine.</li> <li>Start Seafile Docker and shutdown the old MySQL (or Mariadb) according to your situations.</li> </ol>"},{"location":"setup/migrate_non_docker_to_docker/#upgrade-your-seafile-server","title":"Upgrade your Seafile server","text":"<p>You have to upgrade the version of the binary package to latest version before the migration, and ensure that the system is running normally. </p> <p>Tip</p> <p>If you running a very old version of Seafile, you can following the FAQ item to migrate to the latest version</p>"},{"location":"setup/migrate_non_docker_to_docker/#stop-basic-services-except-mysql","title":"Stop basic Services (except MySQL)","text":""},{"location":"setup/migrate_non_docker_to_docker/#stop-seafile-server","title":"Stop Seafile server","text":"<p>Run the following commands in <code>/opt/seafile/seafile-server-latest</code>:</p> <p>Note</p> <p>For installations using python virtual environment, activate it if it isn't already active:</p> <pre><code>source python-venv/bin/activate\n</code></pre> <p>Tip</p> <p>If you have integrated some components (e.g., SeaDoc) in your Seafile server, please shutdown them to avoid losting unsaved data</p> <pre><code>su seafile\n./seafile.sh stop\n./seahub.sh stop\n</code></pre>"},{"location":"setup/migrate_non_docker_to_docker/#stop-nginx-cache-server-eg-redis-elasticsearch","title":"Stop Nginx, cache server (e.g., Redis), ElasticSearch","text":"<p>You have to stop the above services to avoid losing data before migrating.</p> <pre><code>systemctl stop nginx &amp;&amp;  systemctl disable nginx\nsystemctl stop redis &amp;&amp;  systemctl disable redis\ndocker stop es &amp;&amp; docker remove es\n</code></pre>"},{"location":"setup/migrate_non_docker_to_docker/#backup-mysql-database-and-seafile-server","title":"Backup MySQL database and Seafile server","text":"<p>Please follow here to backup:</p> <ul> <li>Backing up MySQL databases</li> <li>Backing up Seafile library data</li> </ul>"},{"location":"setup/migrate_non_docker_to_docker/#deploy-the-seafile-docker","title":"Deploy the Seafile Docker","text":"<p>You can follow here to deploy Seafile with Docker, please use your old configurations when modifying <code>.env</code>, and make sure the Seafile server is running normally after deployment.</p> <p>Use external MySQL service or the old MySQL service</p> <p>This document is written to migrate from non-Docker version to Docker version Seafile between two different machines. We suggest using the Docker-compose Mariadb service (version 10.11 by default) as the database service in after-migration Seafile. If you would like to use an existed MySQL service, always in which situation you try to do migrate operation on the same host or the old MySQL service is the dependency of other services, you have to follow here to deploy Seafile.</p>"},{"location":"setup/migrate_non_docker_to_docker/#recovery-libraries-data-for-seafile-docker","title":"Recovery libraries data for Seafile Docker","text":"<p>Firstly, you should stop the Seafile server before recovering Seafile libraries data:</p> <pre><code>docker compose down\n</code></pre> <p>Then recover the data from backuped file:</p> <pre><code>cp /backup/data/* /opt/seafile-data/seafile\n</code></pre>"},{"location":"setup/migrate_non_docker_to_docker/#recover-the-database-only-for-the-new-mysql-service-used-in-seafile-docker","title":"Recover the Database (only for the new MySQL service used in Seafile docker)","text":"<ol> <li> <p>Start the database service Only:</p> <pre><code>docker compose up -d --no-deps db\n</code></pre> </li> <li> <p>Follow here to recover the database data.</p> </li> <li> <p>Exit the container and stop the Mariadb service</p> <pre><code>docker compose down\n</code></pre> </li> </ol>"},{"location":"setup/migrate_non_docker_to_docker/#restart-the-services","title":"Restart the services","text":"<p>Finally, the migration is complete. You can restart the Seafile server of Docker-base by restarting the service:</p> <pre><code>docker compose up -d\n</code></pre> <p>By the way, you can shutdown the old MySQL service, if it is not a dependency of other services, .</p>"},{"location":"setup/overview/","title":"Seafile Docker overview","text":"<p>Seafile docker based installation consist of the following components (docker images):</p> <ul> <li>Seafile server: Seafile core services, see Seafile Components for the details.</li> <li>MySQL: Database stores data related to Seafile and SeaDoc.</li> <li>Redis: Cache server.</li> <li>Caddy: Caddy server enables user to access the Seafile service (i.e., Seafile server and Sdoc server) externally and handles <code>SSL</code> configuration.</li> <li>Seafile optional extension:<ul> <li>SeaDoc Server: SeaDoc server, provide a lightweight online collaborative document editor,.</li> <li>Notification Server: Notify clients of updates of the library, providing realtime update feature.</li> <li>Metadata Server: Provide metadata management for libraries.</li> <li>Seafile AI &amp; face embedding: Users can enable Seafile AI to support features such as file tags, file and image summaries, text translation, sdoc writing assistance, generating image tags (including objects, weather, color, etc.), face detection and encoding in images, and text detection in images (OCR).</li> </ul> </li> </ul> <p></p>"},{"location":"setup/overview/#document-guidelines","title":"Document guidelines","text":""},{"location":"setup/overview/#single-node-deployment","title":"Single Node deployment","text":"<ul> <li>Deploy from Docker image:<ul> <li>Seafile CE</li> <li>Seafile Pro</li> </ul> </li> <li>Deploy from Kubernetes (K8S) with Docker-cri:<ul> <li>Deploy by Seafile Helm Chart</li> <li>Deploy by Seafile K8S resources files</li> </ul> </li> </ul>"},{"location":"setup/overview/#cluster-pro-only","title":"Cluster (Pro only)","text":"<ul> <li>Deploy from Docker</li> <li>Deploy from Kubernetes (K8S) with Docker-cri:<ul> <li>Deploy by Seafile Helm Chart</li> <li>Deploy by Seafile K8S resources files</li> </ul> </li> </ul>"},{"location":"setup/run_seafile_as_non_root_user_inside_docker/","title":"Run Seafile as non root user inside docker","text":"<p>You can use run Seafile as non root user in docker.</p> <p>First deploy Seafile with docker, and destroy the containers.</p> <pre><code>docker compose down\n</code></pre> <p>Then add the <code>NON_ROOT=true</code> to the <code>.env</code>.</p> <pre><code>NON_ROOT=true\n</code></pre> <p>Then modify <code>/opt/seafile-data/seafile/</code> permissions.</p> <pre><code>chmod -R a+rwx /opt/seafile-data/seafile/\n</code></pre> <p>Start Seafile:</p> <pre><code>docker compose up -d\n</code></pre> <p>Now you can run Seafile as <code>seafile</code> user.</p> <p>Tip</p> <p>When doing maintenance, other scripts in docker are also required to be run as <code>seafile</code> user, e.g. <code>su seafile -c ./seaf-gc.sh</code></p>"},{"location":"setup/seafile_docker_autostart/","title":"Seafile Docker autostart","text":"<p>You can use one of the following methods to start Seafile container on system bootup.</p>"},{"location":"setup/seafile_docker_autostart/#modify-docker-composeservice","title":"Modify docker-compose.service","text":"<ol> <li> <p>Add <code>docker-compose.service</code></p> <p><code>vim /etc/systemd/system/docker-compose.service</code></p> <pre><code>[Unit]\nDescription=Docker Compose Application Service\nRequires=docker.service\nAfter=docker.service\n\n[Service]\nType=forking\nRemainAfterExit=yes\nWorkingDirectory=/opt/   \nExecStart=/usr/bin/docker compose up -d\nExecStop=/usr/bin/docker compose down\nTimeoutStartSec=0\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Note</p> <p><code>WorkingDirectory</code> is the absolute path to the <code>seafile-server.yml</code> file directory.</p> </li> <li> <p>Set the <code>docker-compose.service</code> file to 644 permissions</p> <pre><code>chmod 644 /etc/systemd/system/docker-compose.service\n</code></pre> </li> <li> <p>Load autostart configuration</p> <pre><code>systemctl daemon-reload\nsystemctl enable docker-compose.service\n</code></pre> </li> </ol>"},{"location":"setup/seafile_docker_autostart/#modify-docker-files","title":"Modify Docker files","text":"<p>Add configuration <code>restart: unless-stopped</code> for each container in components of Seafile docker. Take <code>seafile-server.yml</code> for example</p> <pre><code>services:\n  db:\n    image: mariadb:10.11\n    container_name: seafile-mysql-1\n    restart: unless-stopped\n\n  redis:\n    image: redis\n    container_name: seafile-redis\n    restart: unless-stopped\n\n  elasticsearch:\n    image: elasticsearch:8.6.2\n    container_name: seafile-elasticsearch\n    restart: unless-stopped\n\n  seafile:\n    image: seafileltd/seafile-pro-mc:12.0-latest\n    container_name: seafile\n    restart: unless-stopped\n</code></pre> <p>Tip</p> <p>Add <code>restart: unless-stopped</code>, and the Seafile container will automatically start when Docker starts. If the Seafile container does not exist (execute docker compose down), the container will not start automatically.</p>"},{"location":"setup/setup_ce_by_docker/","title":"Installation of Seafile Server Community Edition with Docker","text":""},{"location":"setup/setup_ce_by_docker/#system-requirements","title":"System requirements","text":"<p>Please refer here for system requirements about Seafile CE. In general, we recommend that you have at least 2G RAM and a 2-core CPU (&gt; 2GHz).</p>"},{"location":"setup/setup_ce_by_docker/#getting-started","title":"Getting started","text":"<p>The following assumptions and conventions are used in the rest of this document:</p> <ul> <li><code>/opt/seafile</code> is the directory for store Seafile docker compose files. If you decide to put Seafile in a different directory \u2014 which you can \u2014 adjust all paths accordingly.</li> <li>Seafile uses two Docker volumes for persisting data generated in its database and Seafile Docker container. The volumes' host paths are <code>/opt/seafile-mysql</code> and <code>/opt/seafile-data</code>, respectively. It is not recommended to change these paths. If you do, account for it when following these instructions.</li> <li>All configuration and log files for Seafile and the webserver Nginx are stored in the volume of the Seafile container.</li> </ul>"},{"location":"setup/setup_ce_by_docker/#install-docker","title":"Install docker","text":"<p>Use the official installation guide for your OS to install Docker.</p>"},{"location":"setup/setup_ce_by_docker/#download-and-modify-env","title":"Download and modify <code>.env</code>","text":"<p>To deploy Seafile with Docker, you have to <code>.env</code>, <code>seafile-server.yml</code>  and <code>caddy.yml</code> in a directory (e.g., <code>/opt/seafile</code>):</p> <pre><code>mkdir /opt/seafile\ncd /opt/seafile\n\nwget -O .env https://manual.seafile.com/13.0/repo/docker/ce/env\nwget https://manual.seafile.com/13.0/repo/docker/ce/seafile-server.yml\nwget https://manual.seafile.com/13.0/repo/docker/seadoc.yml\nwget https://manual.seafile.com/13.0/repo/docker/caddy.yml\n\nnano .env\n</code></pre> <p>The following fields merit particular attention:</p> Variable Description Default Value <code>SEAFILE_VOLUME</code> The volume directory of Seafile data <code>/opt/seafile-data</code> <code>SEAFILE_MYSQL_VOLUME</code> The volume directory of MySQL data <code>/opt/seafile-mysql/db</code> <code>SEAFILE_CADDY_VOLUME</code> The volume directory of Caddy data used to store certificates obtained from Let's Encrypt's <code>/opt/seafile-caddy</code> <code>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</code> The <code>root</code> password of MySQL (Only required on first deployment) <code>SEAFILE_MYSQL_DB_HOST</code> The host of MySQL <code>db</code> <code>SEAFILE_MYSQL_DB_PORT</code> The port of MySQL <code>3306</code> <code>SEAFILE_MYSQL_DB_USER</code> The user of MySQL (<code>database</code> - <code>user</code> can be found in <code>conf/seafile.conf</code>) <code>seafile</code> <code>SEAFILE_MYSQL_DB_PASSWORD</code> The user <code>seafile</code> password of MySQL (required) <code>SEAFILE_MYSQL_DB_CCNET_DB_NAME</code> The database name of ccnet <code>ccnet_db</code> <code>SEAFILE_MYSQL_DB_SEAFILE_DB_NAME</code> The database name of seafile <code>seafile_db</code> <code>SEAFILE_MYSQL_DB_SEAHUB_DB_NAME</code> The database name of seahub <code>seahub_db</code> <code>JWT_PRIVATE_KEY</code> JWT_PRIVATE_KEY, A random string with a length of no less than 32 characters is required for Seafile, which can be generated by using <code>pwgen -s 40 1</code> (required) <code>SEAFILE_SERVER_HOSTNAME</code> Seafile server hostname or domain (required) <code>SEAFILE_SERVER_PROTOCOL</code> Seafile server protocol (http or https) <code>http</code> <code>CACHE_PROVIDER</code> The type of cache server used for Seafile. The available options are <code>redis</code> and <code>memcached</code>. Since Seafile 13, it is recommended to use <code>redis</code> as the cache service to support new features, and <code>memcached</code> will no longer be integrated into Seafile Docker by default. <code>redis</code> <code>REDIS_HOST</code> Redis server host <code>redis</code> <code>REDIS_PORT</code> Redis server port <code>6379</code> <code>REDIS_PASSWORD</code> Redis server password (none) <code>MEMCACHED_HOST</code> Memcached server host <code>memcached</code> <code>MEMCACHED_PORT</code> Memcached server port <code>11211</code> <code>TIME_ZONE</code> Time zone <code>UTC</code> <code>ENABLE_NOTIFICATION_SERVER</code> Enable (<code>true</code>) or disable (<code>false</code>) notification feature for Seafile <code>false</code> <code>NOTIFICATION_SERVER_URL</code> The notification server url (none) <code>MD_FILE_COUNT_LIMIT</code> (only valid when deployed metadata server). The maximum number of files in a repository that the metadata feature allows. If the number of files in a repository exceeds this value, the metadata management function will not be enabled for the repository. For a repository with metadata management enabled, if the number of records in it reaches this value but there are still some files that are not recorded in metadata server, the metadata management of the unrecorded files will be skipped. <code>100000</code> <code>INIT_SEAFILE_ADMIN_EMAIL</code> Admin username <code>me@example.com</code> (Recommend modifications) <code>INIT_SEAFILE_ADMIN_PASSWORD</code> Admin password <code>asecret</code> (Recommend modifications) <code>NON_ROOT</code> Run Seafile container without a root user <code>false</code>"},{"location":"setup/setup_ce_by_docker/#start-seafile-server","title":"Start Seafile server","text":"<p>Start Seafile server with the following command</p> <pre><code>docker compose up -d\n</code></pre> <p>ERROR: Named volume \"xxx\" is used in service \"xxx\" but no declaration was found in the volumes section</p> <p>You may encounter this problem when your Docker (or docker-compose) version is out of date. You can upgrade or reinstall the Docker service to solve this problem according to the Docker official documentation.</p> <p>Note</p> <p>You must run the above command in the directory with the <code>.env</code>. If <code>.env</code> file is elsewhere, please run</p> <pre><code>docker compose --env-file /path/to/.env up -d\n</code></pre> <p>Success</p> <p>After starting the services, you can see the initialization progress by tracing the logs of container <code>seafile</code> (i.e., <code>docker logs seafile -f</code>)</p> <pre><code>---------------------------------\nThis is your configuration\n---------------------------------\n\n    server name:            seafile\n    server ip/domain:       seafile.example.com\n\n    seafile data dir:       /opt/seafile/seafile-data\n    fileserver port:        8082\n\n    database:               create new\n    ccnet database:         ccnet_db\n    seafile database:       seafile_db\n    seahub database:        seahub_db\n    database user:          seafile\n\n\nGenerating seafile configuration ...\n\ndone\nGenerating seahub configuration ...\n\n----------------------------------------\nNow creating seafevents database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating ccnet database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating seafile database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating seahub database tables ...\n\n----------------------------------------\n\ncreating seafile-server-latest symbolic link ...  done\n\n-----------------------------------------------------------------\nYour seafile server configuration has been finished successfully.\n-----------------------------------------------------------------\n</code></pre> <p>And then you can see the following messages which the Seafile server starts successfully:</p> <pre><code>Starting seafile server, please wait ...\nSeafile server started\n\nDone.\n\nStarting seahub at port 8000 ...\n\n----------------------------------------\nSuccessfully created seafile admin\n----------------------------------------\n\nSeahub is started\n\nDone.\n</code></pre> <p>Finially, you can go to <code>http://seafile.example.com</code> to use Seafile.</p>"},{"location":"setup/setup_ce_by_docker/#seafile-directory-structure","title":"Seafile directory structure","text":""},{"location":"setup/setup_ce_by_docker/#path-optseafile-data","title":"Path <code>/opt/seafile-data</code>","text":"<p>Placeholder spot for shared volumes. You may elect to store certain persistent information outside of a container, in our case we keep various log files and upload directory outside. This allows you to rebuild containers easily without losing important information.</p> <ul> <li>/opt/seafile-data/seafile: This is the directory for seafile server configuration and data.<ul> <li>/opt/seafile-data/seafile/logs: This is the directory that would contain the log files of seafile server processes. For example, you can find seaf-server logs in <code>/opt/seafile-data/seafile/logs/seafile.log</code>.</li> </ul> </li> <li>/opt/seafile-data/logs: This is the directory for operating system.<ul> <li>/opt/seafile-data/logs/var-log: This is the directory that would be mounted as <code>/var/log</code> inside the container. <code>/opt/seafile-data/logs/var-log/nginx</code> contains the logs of Nginx in the Seafile container.</li> </ul> </li> </ul>"},{"location":"setup/setup_ce_by_docker/#find-logs","title":"Find logs","text":"<p>To monitor container logs (from outside of the container), please use the following commands:</p> <pre><code># if the `.env` file is in current directory:\ndocker compose logs --follow\n# if the `.env` file is elsewhere:\ndocker compose --env-file /path/to/.env logs --follow\n\n# you can also specify container name:\ndocker compose logs seafile --follow\n# or, if the `.env` file is elsewhere:\ndocker compose --env-file /path/to/.env logs seafile --follow\n</code></pre> <p>The Seafile logs are under <code>/shared/logs/seafile</code> in the docker, or <code>/opt/seafile-data/logs/seafile</code> in the server that run the docker.</p> <p>The system logs are under <code>/shared/logs/var-log</code>, or <code>/opt/seafile-data/logs/var-log</code> in the server that run the docker.</p> <p>To monitor all Seafile logs simultaneously (from outside of the container), run</p> <pre><code>sudo tail -f $(find /opt/seafile-data/ -type f -name *.log 2&gt;/dev/null)\n</code></pre>"},{"location":"setup/setup_ce_by_docker/#more-configuration-options","title":"More configuration options","text":"<p>The config files are under <code>/opt/seafile-data/seafile/conf</code>. You can modify the configurations according to configuration section</p>"},{"location":"setup/setup_ce_by_docker/#add-a-new-admin","title":"Add a new admin","text":"<p>Ensure the container is running, then enter this command:</p> <pre><code>docker exec -it seafile /opt/seafile/seafile-server-latest/reset-admin.sh\n</code></pre> <p>Enter the username and password according to the prompts. You now have a new admin account.</p>"},{"location":"setup/setup_ce_by_docker/#backup-and-recovery","title":"Backup and recovery","text":"<p>Follow the instructions in Backup and restore for Seafile Docker</p>"},{"location":"setup/setup_ce_by_docker/#garbage-collection","title":"Garbage collection","text":"<p>When files are deleted, the blocks comprising those files are not immediately removed as there may be other files that reference those blocks (due to the magic of deduplication). To remove them, Seafile requires a 'garbage collection' process to be run, which detects which blocks no longer used and purges them.</p>"},{"location":"setup/setup_ce_by_docker/#faq","title":"FAQ","text":""},{"location":"setup/setup_ce_by_docker/#seafile-service-and-container-maintenance","title":"Seafile service and container maintenance","text":"<p>Q: If I want enter into the Docker container, which command I can use?</p> <p>A: You can enter into the docker container using the command:</p> <pre><code>docker exec -it seafile /bin/bash\n</code></pre> <p>Q: I forgot the Seafile admin email address/password, how do I create a new admin account?</p> <p>A: You can create a new admin account by running</p> <pre><code>docker exec -it seafile /opt/seafile/seafile-server-latest/reset-admin.sh\n</code></pre> <p>The Seafile service must be up when running the superuser command.</p> <p>Q: If, for whatever reason, the installation fails, how do I to start from a clean slate again?</p> <p>A: Remove the directories /opt/seafile, /opt/seafile-data and /opt/seafile-mysql and start again.</p> <p>Q: Something goes wrong during the start of the containers. How can I find out more?</p> <p>A: You can view the docker logs using this command: <code>docker compose logs -f</code>.</p>"},{"location":"setup/setup_ce_by_docker/#about-cache","title":"About cache","text":"<p>Q: How Seafile use cache?</p> <p>A: Seafile uses cache to improve performance in many situations. The content includes but is not limited to user session information, avatars, profiles, records from database, etc. From Seafile Docker 13, the Redis takes the default cache server for supporting the new features (please refer the upgradte notes), which has integrated in Seafile Docker 13 and can be configured directly in environment variables in <code>.env</code> (no additional settings are required by default)</p> <p>Q: Is the Redis integrated in Seafile Docker safe? Does it have an access password?</p> <p>A: Although the Redis integrated by Seafile Docker does not have a password set by default, it can only be accessed through the Docker private network and will not expose the service port externally. Of course, you can also set a password for it if necessary. You can set <code>REDIS_PASSWORD</code> in <code>.env</code> and remove the following comment markers in <code>seafile-server.yml</code> to set the integrated Redis' password:</p> <pre><code>services:\n    ...\n    redis:\n    image: ${SEAFILE_REDIS_IMAGE:-redis}\n    container_name: seafile-redis\n    # remove the following comment markers\n    command:\n        - /bin/sh\n        - -c\n        - redis-server --requirepass \"$${REDIS_PASSWORD:?Variable is not set or empty}\"\n    networks:\n    - seafile-net\n    ...\n</code></pre> <p>Q: For some reason, I still have to use Memcached as my cache server. How can I do this?</p> <p>A: If you still want to use the Memcached (is not provided from Seafile Docker 13), just follow the steps below:</p> <ul> <li>Set <code>CACHE_PROVIDER</code> to <code>memcached</code> and modify <code>MEMCACHED_xxx</code> in <code>.env</code></li> <li>Remove the <code>redis</code> part and and the <code>redis</code> dependency in <code>seafile</code> service section in <code>seafile-server.yml</code>. </li> </ul> <p>By the way, you can make changes to the cache server after the service is started (by setting environment variables in <code>.env</code>), but the corresponding configuration files will not be updated directly (e.g., <code>seahub_settings.py</code>, <code>seafile.conf</code> and <code>seafevents.conf</code>). To avoid ambiguity, we recommend that you also update these configuration files.</p>"},{"location":"setup/setup_pro_by_docker/","title":"Installation of Seafile Server Professional Edition with Docker","text":"<p>This manual explains how to deploy and run Seafile Server Professional Edition (Seafile PE) on a Linux server using Docker and Docker Compose. The deployment has been tested for Debian/Ubuntu and CentOS, but Seafile PE should also work on other Linux distributions.</p>"},{"location":"setup/setup_pro_by_docker/#system-requirements","title":"System requirements","text":"<p>Please refer here for system requirements about Seafile PE. In general, we recommend that you have at least 4G RAM and a 4-core CPU (&gt; 2GHz).</p> <p>About license</p> <p>Seafile PE can be used without a paid license with up to three users. Licenses for more user can be purchased in the Seafile Customer Center or contact Seafile Sales at sales@seafile.com. For futher details, please refer the license page of Seafile PE.</p>"},{"location":"setup/setup_pro_by_docker/#setup","title":"Setup","text":"<p>The following assumptions and conventions are used in the rest of this document:</p> <ul> <li><code>/opt/seafile</code> is the directory of Seafile for storing Seafile docker files. If you decide to put Seafile in a different directory, adjust all paths accordingly.</li> <li>Seafile uses two Docker volumes for persisting data generated in its database and Seafile Docker container. The volumes' host paths are /opt/seafile-mysql and /opt/seafile-data, respectively. It is not recommended to change these paths. If you do, account for it when following these instructions.</li> <li>All configuration and log files for Seafile and the webserver Nginx are stored in the volume of the Seafile container.</li> </ul>"},{"location":"setup/setup_pro_by_docker/#installing-docker","title":"Installing Docker","text":"<p>Use the official installation guide for your OS to install Docker.</p>"},{"location":"setup/setup_pro_by_docker/#downloading-the-seafile-image","title":"Downloading the Seafile Image","text":"<p>Success</p> <p>Since v12.0, Seafile PE versions are hosted on DockerHub and does not require username and password to download. For older Seafile PE versions are available private docker repository (back to Seafile 7.0). You can get the username and password on the download page in the Customer Center.</p> <pre><code>docker pull seafileltd/seafile-pro-mc:13.0-latest\n</code></pre>"},{"location":"setup/setup_pro_by_docker/#downloading-and-modifying-env","title":"Downloading and Modifying <code>.env</code>","text":"<p>Seafile uses <code>.env</code>, <code>seafile-server.yml</code>  and <code>caddy.yml</code> files for configuration.</p> <pre><code>mkdir /opt/seafile\ncd /opt/seafile\n\nwget -O .env https://manual.seafile.com/13.0/repo/docker/pro/env\nwget https://manual.seafile.com/13.0/repo/docker/pro/seafile-server.yml\nwget https://manual.seafile.com/13.0/repo/docker/pro/elasticsearch.yml\nwget https://manual.seafile.com/13.0/repo/docker/seadoc.yml\nwget https://manual.seafile.com/13.0/repo/docker/caddy.yml\n\nnano .env\n</code></pre> <p>The following fields merit particular attention:</p> Variable Description Default Value <code>SEAFILE_VOLUME</code> The volume directory of Seafile data <code>/opt/seafile-data</code> <code>SEAFILE_MYSQL_VOLUME</code> The volume directory of MySQL data <code>/opt/seafile-mysql/db</code> <code>SEAFILE_CADDY_VOLUME</code> The volume directory of Caddy data used to store certificates obtained from Let's Encrypt's <code>/opt/seafile-caddy</code> <code>SEAFILE_ELASTICSEARCH_VOLUME</code> The volume directory of Elasticsearch data <code>/opt/seafile-elasticsearch/data</code> <code>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</code> The <code>root</code> password of MySQL (Only required on first deployment) <code>SEAFILE_MYSQL_DB_HOST</code> The host of MySQL <code>db</code> <code>SEAFILE_MYSQL_DB_PORT</code> The port of MySQL <code>3306</code> <code>SEAFILE_MYSQL_DB_USER</code> The user of MySQL (<code>database</code> - <code>user</code> can be found in <code>conf/seafile.conf</code>) <code>seafile</code> <code>SEAFILE_MYSQL_DB_PASSWORD</code> The user <code>seafile</code> password of MySQL (required) <code>SEAFILE_MYSQL_DB_CCNET_DB_NAME</code> The database name of ccnet <code>ccnet_db</code> <code>SEAFILE_MYSQL_DB_SEAFILE_DB_NAME</code> The database name of seafile <code>seafile_db</code> <code>SEAFILE_MYSQL_DB_SEAHUB_DB_NAME</code> The database name of seahub <code>seahub_db</code> <code>JWT_PRIVATE_KEY</code> JWT_PRIVATE_KEY, A random string with a length of no less than 32 characters is required for Seafile, which can be generated by using <code>pwgen -s 40 1</code> (required) <code>SEAFILE_SERVER_HOSTNAME</code> Seafile server hostname or domain (required) <code>SEAFILE_SERVER_PROTOCOL</code> Seafile server protocol (http or https) <code>http</code> <code>CACHE_PROVIDER</code> The type of cache server used for Seafile. The available options are <code>redis</code> and <code>memcached</code>. Since Seafile 13, it is recommended to use <code>redis</code> as the cache service to support new features, and <code>memcached</code> will no longer be integrated into Seafile Docker by default. <code>redis</code> <code>REDIS_HOST</code> Redis server host <code>redis</code> <code>REDIS_PORT</code> Redis server port <code>6379</code> <code>REDIS_PASSWORD</code> Redis server password (none) <code>MEMCACHED_HOST</code> Memcached server host <code>memcached</code> <code>MEMCACHED_PORT</code> Memcached server port <code>11211</code> <code>TIME_ZONE</code> Time zone <code>UTC</code> <code>INIT_SEAFILE_ADMIN_EMAIL</code> Synchronously set admin username during initialization me@example.com <code>INIT_SEAFILE_ADMIN_PASSWORD</code> Synchronously set admin password during initialization asecret <code>SEAF_SERVER_STORAGE_TYPE</code> What kind of the Seafile data for storage. Available options are <code>disk</code> (i.e., local disk), <code>s3</code> and <code>multiple</code> (see the details of multiple storage backends) <code>disk</code> <code>S3_COMMIT_BUCKET</code> S3 storage backend commit objects bucket (required when <code>SEAF_SERVER_STORAGE_TYPE=s3</code>) <code>S3_FS_BUCKET</code> S3 storage backend fs objects bucket (required when <code>SEAF_SERVER_STORAGE_TYPE=s3</code>) <code>S3_BLOCK_BUCKET</code> S3 storage backend block objects bucket (required when <code>SEAF_SERVER_STORAGE_TYPE=s3</code>) <code>S3_KEY_ID</code> S3 storage backend key ID (required when <code>SEAF_SERVER_STORAGE_TYPE=s3</code>) <code>S3_SECRET_KEY</code> S3 storage backend secret key (required when <code>SEAF_SERVER_STORAGE_TYPE=s3</code>) <code>S3_AWS_REGION</code> Region of your buckets <code>us-east-1</code> <code>S3_HOST</code> Host of your buckets (required when not use AWS) <code>S3_USE_HTTPS</code> Use HTTPS connections to S3 if enabled <code>true</code> <code>S3_USE_V4_SIGNATURE</code> Use the v4 protocol of S3 if enabled <code>true</code> <code>S3_PATH_STYLE_REQUEST</code> This option asks Seafile to use URLs like <code>https://192.168.1.123:8080/bucketname/object</code> to access objects. In Amazon S3, the default URL format is in virtual host style, such as <code>https://bucketname.s3.amazonaws.com/object</code>. But this style relies on advanced DNS server setup. So most self-hosted storage systems only implement the path style format. <code>false</code> <code>S3_SSE_C_KEY</code> A string of 32 characters can be generated by openssl rand -base64 24. It can be any 32-character long random string. It's required to use V4 authentication protocol and https if you enable SSE-C. (none) <code>ENABLE_NOTIFICATION_SERVER</code> Enable (<code>true</code>) or disable (<code>false</code>) notification feature for Seafile <code>false</code> <code>NOTIFICATION_SERVER_URL</code> The notification server url (none) <code>MD_FILE_COUNT_LIMIT</code> (only valid when deployed metadata server). The maximum number of files in a repository that the metadata feature allows. If the number of files in a repository exceeds this value, the metadata management function will not be enabled for the repository. For a repository with metadata management enabled, if the number of records in it reaches this value but there are still some files that are not recorded in metadata server, the metadata management of the unrecorded files will be skipped. <code>100000</code> <code>NON_ROOT</code> Run Seafile container without a root user <code>false</code> <p>Easier to configure S3 for Seafile and its components</p> <p>Since Seafile Pro 13.0, in order to facilitate users to deploy Seafile's related extension components and other services in the future, a section will be provided in <code>.env</code> to store the S3 Configurations for Seafile and some extension components (such as SeaSearch, Metadata server). You can locate it with the title bar Storage configurations for S3.</p> <p>S3 configurations in <code>.env</code> only support single S3 storage backend mode</p> <p>The Seafile server only support configuring S3 in <code>.env</code> for single S3 storage backend mode (i.e., when <code>SEAF_SERVER_STORAGE_TYPE=s3</code>). If you would like to use other storage backend (e.g., Ceph, Swift) or other settings that can only be set in <code>seafile.conf</code> (like multiple storage backends), please set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>multiple</code>, and set <code>MD_STORAGE_TYPE</code> and <code>SS_STORAGE_TYPE</code> according to your configurations.</p> <p>To conclude, set the directory permissions of the Elasticsearch volumne:</p> <pre><code>mkdir -p /opt/seafile-elasticsearch/data\nchmod 777 -R /opt/seafile-elasticsearch/data\n</code></pre>"},{"location":"setup/setup_pro_by_docker/#starting-the-docker-containers","title":"Starting the Docker Containers","text":"<p>Run docker compose in detached mode:</p> <pre><code>docker compose up -d\n</code></pre> <p>ERROR: Named volume \"xxx\" is used in service \"xxx\" but no declaration was found in the volumes section</p> <p>You may encounter this problem when your Docker (or docker-compose) version is out of date. You can upgrade or reinstall the Docker service to solve this problem according to the Docker official documentation.</p> <p>Note</p> <p>You must run the above command in the directory with the <code>.env</code>. If <code>.env</code> file is elsewhere, please run</p> <pre><code>docker compose --env-file /path/to/.env up -d\n</code></pre> <p>Success</p> <p>After starting the services, you can see the initialization progress by tracing the logs of container <code>seafile</code> (i.e., <code>docker logs seafile -f</code>)</p> <pre><code>---------------------------------\nThis is your configuration\n---------------------------------\n\n    server name:            seafile\n    server ip/domain:       seafile.example.com\n\n    seafile data dir:       /opt/seafile/seafile-data\n    fileserver port:        8082\n\n    database:               create new\n    ccnet database:         ccnet_db\n    seafile database:       seafile_db\n    seahub database:        seahub_db\n    database user:          seafile\n\n\nGenerating seafile configuration ...\n\ndone\nGenerating seahub configuration ...\n\n----------------------------------------\nNow creating seafevents database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating ccnet database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating seafile database tables ...\n\n----------------------------------------\n----------------------------------------\nNow creating seahub database tables ...\n\n----------------------------------------\n\ncreating seafile-server-latest symbolic link ...  done\n\n-----------------------------------------------------------------\nYour seafile server configuration has been finished successfully.\n-----------------------------------------------------------------\n</code></pre> <p>And then you can see the following messages which the Seafile server starts successfully:</p> <pre><code>Starting seafile server, please wait ...\nSeafile server started\n\nDone.\n\nStarting seahub at port 8000 ...\n\n----------------------------------------\nSuccessfully created seafile admin\n----------------------------------------\n\nSeahub is started\n\nDone.\n</code></pre> <p>Finially, you can go to <code>http://seafile.example.com</code> to use Seafile.</p> <p>A 502 Bad Gateway error means that the system has not yet completed the initialization</p>"},{"location":"setup/setup_pro_by_docker/#find-logs","title":"Find logs","text":"<p>To view Seafile docker logs, please use the following command</p> <pre><code>docker compose logs -f\n</code></pre> <p>The Seafile logs are under <code>/shared/logs/seafile</code> in the docker, or <code>/opt/seafile-data/logs/seafile</code> in the server that run the docker.</p> <p>The system logs are under <code>/shared/logs/var-log</code>, or <code>/opt/seafile-data/logs/var-log</code> in the server that run the docker.</p>"},{"location":"setup/setup_pro_by_docker/#activating-the-seafile-license","title":"Activating the Seafile License","text":"<p>If you have a <code>seafile-license.txt</code> license file, simply put it in the volume of the Seafile container. The volumne's default path in the Compose file is <code>/opt/seafile-data</code>. If you have modified the path, save the license file under your custom path.</p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p> <p>Then restart Seafile:</p> <pre><code>docker compose down\n\ndocker compose up -d\n</code></pre>"},{"location":"setup/setup_pro_by_docker/#seafile-directory-structure","title":"Seafile directory structure","text":""},{"location":"setup/setup_pro_by_docker/#path-optseafile-data","title":"Path <code>/opt/seafile-data</code>","text":"<p>Placeholder spot for shared volumes. You may elect to store certain persistent information outside of a container, in our case we keep various log files and upload directory outside. This allows you to rebuild containers easily without losing important information.</p> <ul> <li>/opt/seafile-data/seafile: This is the directory for seafile server configuration, logs and data.</li> <li>/opt/seafile-data/seafile/logs: This is the directory that would contain the log files of seafile server processes. For example, you can find seaf-server logs in <code>/opt/seafile-data/seafile/logs/seafile.log</code>.</li> <li>/opt/seafile-data/logs: This is the directory for operating system and Nginx logs.</li> <li>/opt/seafile-data/logs/var-log: This is the directory that would be mounted as <code>/var/log</code> inside the container. For example, you can find the nginx logs in <code>/opt/seafile-data/logs/var-log/nginx/</code>.</li> </ul>"},{"location":"setup/setup_pro_by_docker/#reviewing-the-deployment","title":"Reviewing the Deployment","text":"<p>The command <code>docker container list</code> should list the containers specified in the <code>.env</code>.</p> <p>The directory layout of the Seafile container's volume should look as follows:</p> <pre><code>$ tree /opt/seafile-data -L 2\n/opt/seafile-data\n\u251c\u2500\u2500 logs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 var-log\n\u251c\u2500\u2500 nginx\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 conf\n\u2514\u2500\u2500 seafile\n \u00a0\u00a0 \u251c\u2500\u2500 ccnet\n \u00a0\u00a0 \u251c\u2500\u2500 conf\n \u00a0\u00a0 \u251c\u2500\u2500 logs\n \u00a0\u00a0 \u251c\u2500\u2500 pro-data\n \u00a0\u00a0 \u251c\u2500\u2500 seafile-data\n \u00a0\u00a0 \u2514\u2500\u2500 seahub-data\n</code></pre> <p>All Seafile config files are stored in <code>/opt/seafile-data/seafile/conf</code>. The nginx config file is in <code>/opt/seafile-data/nginx/conf</code>.</p> <p>Any modification of a configuration file requires a restart of Seafile to take effect:</p> <pre><code>docker compose restart\n</code></pre> <p>All Seafile log files are stored in <code>/opt/seafile-data/seafile/logs</code> whereas all other log files are in <code>/opt/seafile-data/logs/var-log</code>.</p>"},{"location":"setup/setup_pro_by_docker/#backup-and-recovery","title":"Backup and Recovery","text":"<p>Follow the instructions in Backup and restore for Seafile Docker</p>"},{"location":"setup/setup_pro_by_docker/#garbage-collection","title":"Garbage Collection","text":"<p>When files are deleted, the blocks comprising those files are not immediately removed as there may be other files that reference those blocks (due to the magic of deduplication). To remove them, Seafile requires a 'garbage collection' process to be run, which detects which blocks no longer used and purges them.</p>"},{"location":"setup/setup_pro_by_docker/#faq","title":"FAQ","text":""},{"location":"setup/setup_pro_by_docker/#seafile-service-and-container-maintenance","title":"Seafile service and container maintenance","text":"<p>Q: If I want enter into the Docker container, which command I can use?</p> <p>A: You can enter into the docker container using the command:</p> <pre><code>docker exec -it seafile /bin/bash\n</code></pre> <p>Q: I forgot the Seafile admin email address/password, how do I create a new admin account?</p> <p>A: You can create a new admin account by running</p> <pre><code>docker exec -it seafile /opt/seafile/seafile-server-latest/reset-admin.sh\n</code></pre> <p>The Seafile service must be up when running the superuser command.</p> <p>Q: If, for whatever reason, the installation fails, how do I to start from a clean slate again?</p> <p>A: Remove the directories /opt/seafile, /opt/seafile-data and /opt/seafile-mysql and start again.</p> <p>Q: Something goes wrong during the start of the containers. How can I find out more?</p> <p>A: You can view the docker logs using this command: <code>docker compose logs -f</code>.</p>"},{"location":"setup/setup_pro_by_docker/#about-cache","title":"About cache","text":"<p>Q: How Seafile use cache?</p> <p>A: Seafile uses cache to improve performance in many situations. The content includes but is not limited to user session information, avatars, profiles, records from database, etc. From Seafile Docker 13, the Redis takes the default cache server for supporting the new features (please refer the upgradte notes), which has integrated in Seafile Docker 13 and can be configured directly in environment variables in <code>.env</code> (no additional settings are required by default)</p> <p>Q: Is the Redis integrated in Seafile Docker safe? Does it have an access password?</p> <p>A: Although the Redis integrated by Seafile Docker does not have a password set by default, it can only be accessed through the Docker private network and will not expose the service port externally. Of course, you can also set a password for it if necessary. You can set <code>REDIS_PASSWORD</code> in <code>.env</code> and remove the following comment markers in <code>seafile-server.yml</code> to set the integrated Redis' password:</p> <pre><code>services:\n    ...\n    redis:\n    image: ${SEAFILE_REDIS_IMAGE:-redis}\n    container_name: seafile-redis\n    # remove the following comment markers\n    command:\n        - /bin/sh\n        - -c\n        - redis-server --requirepass \"$${REDIS_PASSWORD:?Variable is not set or empty}\"\n    networks:\n    - seafile-net\n    ...\n</code></pre> <p>Q: For some reason, I still have to use Memcached as my cache server. How can I do this?</p> <p>A: If you still want to use the Memcached (is not provided from Seafile Docker 13), just follow the steps below:</p> <ul> <li>Set <code>CACHE_PROVIDER</code> to <code>memcached</code> and modify <code>MEMCACHED_xxx</code> in <code>.env</code></li> <li>Remove the <code>redis</code> part and and the <code>redis</code> dependency in <code>seafile</code> service section in <code>seafile-server.yml</code>. </li> </ul> <p>By the way, you can make changes to the cache server after the service is started (by setting environment variables in <code>.env</code>), but the corresponding configuration files will not be updated directly (e.g., <code>seahub_settings.py</code>, <code>seafile.conf</code> and <code>seafevents.conf</code>). To avoid ambiguity, we recommend that you also update these configuration files.</p>"},{"location":"setup/setup_with_an_existing_mysql_server/","title":"Deploy with an existing MySQL server","text":"<p>The entire <code>db</code> service needs to be removed (or noted) in <code>seafile-server.yml</code> if you would like to use an existing MySQL server, otherwise there is a redundant database service is running </p> <pre><code>service:\n\n  # note or remove the entire `db` service\n  #db:\n    #image: ${SEAFILE_DB_IMAGE:-mariadb:10.11}\n    #container_name: seafile-mysql\n    # ... other parts in service `db`\n\n  # do not change other services\n...\n</code></pre> <p>What's more, you have to modify the <code>.env</code> to set correctly the fields with MySQL:</p> <pre><code>SEAFILE_MYSQL_DB_HOST=192.168.0.2\nSEAFILE_MYSQL_DB_PORT=3306\nINIT_SEAFILE_MYSQL_ROOT_PASSWORD=ROOT_PASSWORD\nSEAFILE_MYSQL_DB_USER=seafile # the user name of the user you like to use for Seafile server\nSEAFILE_MYSQL_DB_PASSWORD=PASSWORD # the password of the user you like to use for Seafile server\n</code></pre> <p>Tip</p> <p><code>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</code> is needed during installation (i.e., the deployment in the first time). After Seafile is installed, the user <code>seafile</code> will be used to connect to the MySQL server (SEAFILE_MYSQL_DB_PASSWORD), then you can remove the <code>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</code>.</p>"},{"location":"setup/setup_with_ceph/","title":"Setup With Ceph","text":"<p>Ceph is a scalable distributed storage system. It's recommended to use Ceph's S3 Gateway (RGW) to integarte with Seafile. Seafile can also use Ceph's RADOS object storage layer for storage backend. But using RADOS requires to link with librados library, which may introduce library incompatibility issues during deployment. Furthermore the S3 Gateway provides easier to manage HTTP based interface. If you want to integrate with S3 gateway, please refer to \"Use S3-compatible Object Storage\" section in this documentation. The documentation below is for integrating with RADOS.</p>"},{"location":"setup/setup_with_ceph/#copy-ceph-conf-file-and-client-keyring","title":"Copy ceph conf file and client keyring","text":"<p>Seafile acts as a client to Ceph/RADOS, so it needs to access ceph cluster's conf file and keyring. You have to copy these files from a ceph admin node's /etc/ceph directory to the seafile machine.</p> <pre><code>seafile-machine# sudo scp user@ceph-admin-node:/etc/ceph/ /etc\n</code></pre>"},{"location":"setup/setup_with_ceph/#install-and-enable-memcached","title":"Install and enable memcached","text":"<p>For best performance, Seafile requires install memcached or redis and enable cache for objects. </p> <p>We recommend to allocate at least 128MB memory for object cache.</p>"},{"location":"setup/setup_with_ceph/#install-python-ceph-library","title":"Install Python Ceph Library","text":"<p>File search and WebDAV functions rely on Python Ceph library installed in the system.</p> <pre><code>sudo apt-get install python3-rados\n</code></pre>"},{"location":"setup/setup_with_ceph/#edit-seafile-configuration","title":"Edit seafile configuration","text":"<p>Edit <code>seafile.conf</code>, add the following lines:</p> <pre><code>[block_backend]\nname = ceph\nceph_config = /etc/ceph/ceph.conf\npool = seafile-blocks\n\n[commit_object_backend]\nname = ceph\nceph_config = /etc/ceph/ceph.conf\npool = seafile-commits\n\n[fs_object_backend]\nname = ceph\nceph_config = /etc/ceph/ceph.conf\npool = seafile-fs\n</code></pre> <p>You also need to add memory cache configurations</p> <p>It's required to create separate pools for commit, fs, and block objects.</p> <pre><code>ceph-admin-node# rados mkpool seafile-blocks\nceph-admin-node# rados mkpool seafile-commits\nceph-admin-node# rados mkpool seafile-fs\n</code></pre> <p>Troubleshooting librados incompatibility issues</p> <p>Since 8.0 version, Seafile bundles librados from Ceph 16. On some systems you may find Seafile fail to connect to your Ceph cluster. In such case, you can usually solve it by removing the bundled librados libraries and use the one installed in the OS.</p> <p>To do this, you have to remove a few bundled libraries:</p> <pre><code>cd seafile-server-latest/seafile/lib\nrm librados.so.2 libstdc++.so.6 libnspr4.so\n</code></pre>"},{"location":"setup/setup_with_ceph/#use-arbitary-ceph-user","title":"Use arbitary Ceph user","text":"<p>The above configuration will use the default (client.admin) user to connect to Ceph. You may want to use some other Ceph user to connect. This is supported in Seafile. To specify the Ceph user, you have to add a <code>ceph_client_id</code> option to seafile.conf, as the following:</p> <pre><code>[block_backend]\nname = ceph\nceph_config = /etc/ceph/ceph.conf\n# Sepcify Ceph user for Seafile here\nceph_client_id = seafile\npool = seafile-blocks\n\n[commit_object_backend]\nname = ceph\nceph_config = /etc/ceph/ceph.conf\n# Sepcify Ceph user for Seafile here\nceph_client_id = seafile\npool = seafile-commits\n\n[fs_object_backend]\nname = ceph\nceph_config = /etc/ceph/ceph.conf\n# Sepcify Ceph user for Seafile here\nceph_client_id = seafile\npool = seafile-fs\n\n# Memcached or Reids configs\n......\n</code></pre> <p>You can create a ceph user for seafile on your ceph cluster like this:</p> <pre><code>ceph auth add client.seafile \\\n  mds 'allow' \\\n  mon 'allow r' \\\n  osd 'allow rwx pool=seafile-blocks, allow rwx pool=seafile-commits, allow rwx pool=seafile-fs'\n</code></pre> <p>You also have to add this user's keyring path to /etc/ceph/ceph.conf:</p> <pre><code>[client.seafile]\nkeyring = &lt;path to user's keyring file&gt;\n</code></pre>"},{"location":"setup/setup_with_multiple_storage_backends/","title":"Multiple Storage Backend","text":"<p>There are some use cases that supporting multiple storage backends in Seafile server is needed. Such as:</p> <ol> <li> <p>Store different types of files into different storage backends:</p> <ul> <li>Normal files can be stored in primary storage (e.g., local disks)</li> <li>Archived files can be stored in cold storage (tapes or other backup systems)</li> </ul> </li> <li> <p>Combine multiple storage backends to extend storage scalability:</p> <ul> <li>A single NFS volume may be limited by size</li> <li>A single S3 bucket of Ceph RGW may suffer performance decrease when the number of objects become very large.</li> </ul> </li> </ol> <p>About data of library</p> <ul> <li>The library data in Seafile server are spreaded into multiple storage backends in the unit of libraries. </li> <li>All the data in a library will be located in the same storage backend. </li> <li>The mapping from library to its storage backend is stored in a database table. </li> <li>Different mapping policies can be chosen based on the use case.</li> </ul>"},{"location":"setup/setup_with_multiple_storage_backends/#how-to-engage-multiple-storage-backend","title":"How to engage multiple storage backend","text":"<p>To use this feature, you need to:</p> <ol> <li>Set <code>SEAF_SERVER_STORAGE_TYPE=multiple</code> in <code>.env</code>.</li> <li>Define storage classes in <code>seafile.conf</code>.</li> <li>Enable multiple backend feature in Seahub and choose a mapping policy.</li> </ol>"},{"location":"setup/setup_with_multiple_storage_backends/#seafile-configuration","title":"Seafile Configuration","text":"<p>As Seafile server before 6.3 version doesn't support multiple storage classes, you have to explicitly enable this new feature and define storage classes with a different syntax than how we define storage backend before.</p> <p>By default, Seafile dose not enable multiple storage classes. So, you have to create a configuration file for storage classes and specify it and enable the feature in <code>seafile.conf</code>:</p> <ol> <li> <p>Create the storage classes file:</p> <pre><code>nano /opt/seafile-date/seafile/conf\n</code></pre> <p>For the example of this file, please refer next section</p> </li> <li> <p>Modify <code>seafile.conf</code></p> <pre><code>[storage]\nenable_storage_classes = true\nstorage_classes_file = /shared/conf/seafile_storage_classes.json\n</code></pre> <ul> <li><code>enable_storage_classes</code> \uff1aIf this is set to true, the storage class feature is enabled. You must define the storage classes in a JSON file provided in the next configuration option.</li> <li><code>storage_classes_file\uff1aSpecifies</code> the path for the JSON file that contains the storage class definition.</li> </ul> <p>Tip</p> <ul> <li>Make sure you have added memory cache configurations to <code>seafile.conf</code></li> <li>Due to the Docker persistence strategy, the path of <code>storage_classes_file</code> in the Seafile container is different from the host usually, so we suggest you put this file in to the Seafile's configurations directory, and use <code>/shared/conf</code> instead of <code>/opt/seafile-date/seafile/conf</code>. Otherwise you have to add another persistent volume mapping strategy in <code>seafile-server.yml</code>. If your Seafile server is not deployed with Docker, we still suggest you put this file into the Seafile configurations file directory.</li> </ul> </li> </ol>"},{"location":"setup/setup_with_multiple_storage_backends/#exmaple-of-storage-classes-file","title":"Exmaple of storage classes file","text":"<p>The storage classes JSON file is about an array consist of objects, for each defines a storage class. The fields in the definition corresponds to the information we need to specify for a storage class:</p> Variables Descriptions <code>storage_id</code> A unique internal string ID used to identify the storage class. It is not visible to users. For example, \"primary storage\". <code>name</code> A user-visible name for the storage class. <code>is_default</code> Indicates whether this storage class is the default one. <code>commits</code> The storage used for storing commit objects for this class. <code>fs</code> The storage used for storing fs objects for this class. <code>blocks</code> The storage used for storing block objects for this class. <p>Note</p> <ul> <li><code>is_default</code> is effective in two cases: <ol> <li>When a user does not choose a mapping policy and can use this storage class for a library; </li> <li>For other mapping policies, this option only takes effect when you have existing libraries before enabling the multiple storage backend feature, which will be automatically mapped to the default storage backend.</li> </ol> </li> <li><code>commit</code>, <code>fs</code>, and <code>blocks</code> can be stored in different storages. This provides the most flexible way to define storage classes (e.g., a file system, Ceph, or S3.)</li> </ul> <p>Here is an example, which uses local file system, S3 (default), Swift and Ceph at the same time.</p> <pre><code>[\n  {\n    \"storage_id\": \"hot_storage\",\n    \"name\": \"Hot Storage\",\n    \"is_default\": true,\n    \"commits\": {\n      \"backend\": \"s3\",\n      \"bucket\": \"seafile-commits\",\n      \"key\": \"&lt;your key&gt;\",\n      \"key_id\": \"&lt;your key id&gt;\"\n    },\n    \"fs\": {\n      \"backend\": \"s3\",\n      \"bucket\": \"seafile-fs\",\n      \"key\": \"&lt;your key&gt;\",\n      \"key_id\": \"&lt;your key id&gt;\"\n    },\n    \"blocks\": {\n      \"backend\": \"s3\",\n      \"bucket\": \"seafile-blocks\",\n      \"key\": \"&lt;your key&gt;\",\n      \"key_id\": \"&lt;your key id&gt;\"\n    }\n  },\n  {\n    \"storage_id\": \"cold_storage\",\n    \"name\": \"Cold Storage\",\n    \"is_default\": false,\n    \"fs\": {\n      \"backend\": \"fs\",\n      \"dir\": \"/share/seafile/seafile-data\" // /opt/seafile/seafile-data for binary-install Seafile\n    },\n    \"commits\": {\n      \"backend\": \"fs\",\n      \"dir\": \"/share/seafile/seafile-data\"\n    },\n    \"blocks\": {\n      \"backend\": \"fs\",\n      \"dir\": \"/share/seafile/seafile-data\"\n    }\n  },\n  {\n    \"storage_id\": \"swift_storage\",\n    \"name\": \"Swift Storage\",\n    \"fs\": {\n      \"backend\": \"swift\",\n      \"tenant\": \"&lt;your tenant&gt;\",\n      \"user_name\": \"&lt;your username&gt;\",\n      \"password\": \"&lt;your password&gt;\",\n      \"container\": \"seafile-commits\",\n      \"auth_host\": \"&lt;Swift auth host&gt;:&lt;port, default 5000&gt;\",\n      \"auth_ver\": \"v2.0\"\n    },\n    \"commits\": {\n      \"backend\": \"swift\",\n      \"tenant\": \"&lt;your tenant&gt;\",\n      \"user_name\": \"&lt;your username&gt;\",\n      \"password\": \"&lt;your password&gt;\",\n      \"container\": \"seafile-commits\",\n      \"auth_host\": \"&lt;Swift auth host&gt;:&lt;port, default 5000&gt;\",\n      \"auth_ver\": \"v2.0\"\n    },\n    \"blocks\": {\n      \"backend\": \"swift\",\n      \"tenant\": \"&lt;your tenant&gt;\",\n      \"user_name\": \"&lt;your username&gt;\",\n      \"password\": \"&lt;your password&gt;\",\n      \"container\": \"seafile-commits\",\n      \"auth_host\": \"&lt;Swift auth host&gt;:&lt;port, default 5000&gt;\",\n      \"auth_ver\": \"v2.0\",\n      \"region\": \"RegionTwo\"\n    }\n  },\n  {\n    \"storage_id\": \"ceph_storage\",\n    \"name\": \"ceph Storage\",\n    \"fs\": {\n      \"backend\": \"ceph\",\n      \"ceph_config\": \"/etc/ceph/ceph.conf\",\n      \"pool\": \"seafile-fs\"\n    },\n    \"commits\": {\n      \"backend\": \"ceph\",\n      \"ceph_config\": \"/etc/ceph/ceph.conf\",\n      \"pool\": \"seafile-commits\"\n    },\n    \"blocks\": {\n      \"backend\": \"ceph\",\n      \"ceph_config\": \"/etc/ceph/ceph.conf\",\n      \"pool\": \"seafile-blocks\"\n    }\n  }\n]\n</code></pre> <p>Tip</p> <ul> <li> <p>As you may have seen, the <code>commits</code>, <code>fs</code> and <code>blocks</code> information syntax is similar to what is used in <code>[commit_object_backend]</code>, <code>[fs_object_backend]</code> and <code>[block_backend]</code> section of <code>seafile.conf</code> for a single backend storage. You can refer to the detailed syntax in the documentation for the storage you use (e.g., S3 Storage for S3).</p> </li> <li> <p>If you use file system as storage for <code>fs</code>, <code>commits</code> or <code>blocks</code>, you must explicitly provide the path for the <code>seafile-data</code> directory. The objects will be stored in <code>storage/commits</code>, <code>storage/fs</code>, <code>storage/blocks</code> under this path. </p> </li> </ul>"},{"location":"setup/setup_with_multiple_storage_backends/#library-mapping-policies","title":"Library Mapping Policies","text":"<p>Library mapping policies decide the storage class a library uses. Currently we provide 3 policies for 3 different use cases:</p> <ul> <li>User Chosen</li> <li>Role-based Mapping</li> <li>Library ID Based Mapping</li> </ul> <p>The storage class of a library is decided on creation and stored in a database table. The storage class of a library won't change if the mapping policy is changed later.</p> <p>Before choosing your mapping policy, you need to enable the storage classes feature in seahub_settings.py:</p> <pre><code>ENABLE_STORAGE_CLASSES = True\n</code></pre>"},{"location":"setup/setup_with_multiple_storage_backends/#user-chosen","title":"User Chosen","text":"<p>This policy lets the users choose which storage class to use when creating a new library. The users can select any storage class that's been defined in the JSON file.</p> <p>To use this policy, add following options in seahub_settings.py:</p> <pre><code>STORAGE_CLASS_MAPPING_POLICY = 'USER_SELECT'\n</code></pre> <p>If you enable storage class support but don't explicitly set <code>STORAGE_CLASS_MAPPING_POLIICY</code> in seahub_settings.py, this policy is used by default.</p>"},{"location":"setup/setup_with_multiple_storage_backends/#role-based-mapping","title":"Role-based Mapping","text":"<p>Due to storage cost or management considerations, sometimes a system admin wants to make different type of users use different storage backends (or classes). You can configure a user's storage classes based on their roles.</p> <p>A new option <code>storage_ids</code> is added to the role configuration in <code>seahub_settings.py</code> to assign storage classes to each role. If only one storage class is assigned to a role, the users with this role cannot choose storage class for libraries; otherwise, the users can choose a storage class if more than one class are assigned. If no storage class is assigned to a role, the default class specified in the JSON file will be used. </p> <p>Here are the sample options in seahub_settings.py to use this policy:</p> <pre><code>ENABLE_STORAGE_CLASSES = True\nSTORAGE_CLASS_MAPPING_POLICY = 'ROLE_BASED'\n\nENABLED_ROLE_PERMISSIONS = {\n    'default': {\n        'can_add_repo': True,\n        'can_add_group': True,\n        'can_view_org': True,\n        'can_use_global_address_book': True,\n        'can_generate_share_link': True,\n        'can_generate_upload_link': True,\n        'can_invite_guest': True,\n        'can_connect_with_android_clients': True,\n        'can_connect_with_ios_clients': True,\n        'can_connect_with_desktop_clients': True,\n        'storage_ids': ['old_version_id', 'hot_storage', 'cold_storage', 'a_storage'],\n    },\n    'guest': {\n        'can_add_repo': True,\n        'can_add_group': False,\n        'can_view_org': False,\n        'can_use_global_address_book': False,\n        'can_generate_share_link': False,\n        'can_generate_upload_link': False,\n        'can_invite_guest': False,\n        'can_connect_with_android_clients': False,\n        'can_connect_with_ios_clients': False,\n        'can_connect_with_desktop_clients': False,\n        'storage_ids': ['hot_storage', 'cold_storage'],\n    },\n}\n</code></pre>"},{"location":"setup/setup_with_multiple_storage_backends/#library-id-based-mapping","title":"Library ID Based Mapping","text":"<p>This policy maps libraries to storage classes based on its library ID. The ID of a library is an UUID. In this way, the data in the system can be evenly distributed among the storage classes.</p> <p>Note</p> <p>This policy is not a designed to be a complete distributed storage solution. It doesn't handle automatic migration of library data between storage classes. If you need to add more storage classes to the configuration, existing libraries will stay in their original storage classes. New libraries can be distributed among the new storage classes (backends). You still have to plan about the total storage capacity of your system at the beginning.</p> <p>To use this policy, you first add following options in seahub_settings.py:</p> <pre><code>STORAGE_CLASS_MAPPING_POLICY = 'REPO_ID_MAPPING'\n</code></pre> <p>Then you can add option <code>for_new_library</code> to the backends which are expected to store new libraries in json file:</p> <pre><code>[\n    {\n        \"storage_id\": \"new_backend\",\n        \"name\": \"New store\",\n        \"for_new_library\": true,\n        \"is_default\": false,\n        \"fs\": {\n            \"backend\": \"fs\", \n            \"dir\": \"/storage/seafile/new-data\"\n        },\n        \"commits\": {\n            \"backend\": \"fs\", \n            \"dir\": \"/storage/seafile/new-data\"\n        },\n        \"blocks\": {\n            \"backend\": \"fs\", \n            \"dir\": \"/storage/seafile/new-data\"\n        }\n    }\n]\n</code></pre>"},{"location":"setup/setup_with_multiple_storage_backends/#multiple-storage-backend-data-migration","title":"Multiple Storage Backend Data Migration","text":"<p>Migration from S3</p> <p>Since version 11, when you migrate from S3 to other storage servers, you have to use V4 authentication protocol. This is because version 11 upgrades to Boto3 library, which fails to list objects from S3 when it's configured to use V2 authentication protocol.</p> <p>Run the <code>migrate-repo.sh</code> script to migrate library data between different storage backends.</p> <pre><code>./migrate-repo.sh [repo_id] origin_storage_id destination_storage_id\n</code></pre> <ul> <li>repo_id: migrated library id</li> <li>origin_storage_id: migrated origin storage id</li> <li>destination_storage_id: migrated destination storage id</li> </ul> <p>repo_id is optional, if not specified, all libraries will be migrated.</p> <p>Specify a path prefix</p> <p>You can set the <code>OBJECT_LIST_FILE_PATH</code> environment variable to specify a path prefix to store the migrated object list before running the migration script</p> <p>For example:</p> <pre><code>export OBJECT_LIST_FILE_PATH=/opt/test\n</code></pre> <p>This will create three files in the specified path (/opt): </p> <ul> <li><code>test_4c731e5c-f589-4eaa-889f-14c00d4893cb.fs</code></li> <li><code>test_4c731e5c-f589-4eaa-889f-14c00d4893cb.commits</code> </li> <li><code>test_4c731e5c-f589-4eaa-889f-14c00d4893cb.blocks</code></li> </ul> <p>Setting the <code>OBJECT_LIST_FILE_PATH</code> environment variable has two purposes:</p> <ol> <li>If the migrated library is very large, you need to run the migration script multiple times. Setting this environment variable can skip the previously migrated objects.</li> <li>After the migration is complete, if you need to delete the objects in the origin storage, you must set this environment variable.</li> </ol>"},{"location":"setup/setup_with_multiple_storage_backends/#delete-all-objects-in-a-library-in-the-specified-storage-backend","title":"Delete All Objects In a Library In The Specified Storage Backend","text":"<p>Run the <code>remove-objs.sh</code> script (before migration, you need to set the OBJECT_LIST_FILE_PATH environment variable) to delete all objects in a library in the specified storage backend.</p> <pre><code>./remove-objs.sh repo_id storage_id\n</code></pre>"},{"location":"setup/setup_with_s3/","title":"Setup With S3 Storage","text":"<p>From Seafile 13, there are two ways to configure S3 storage (single S3 storage backend) for Seafile server:</p> <ul> <li>Environment variables (recommend since Seafile 13)</li> <li>Config file (<code>seafile.conf</code>)</li> </ul> <p>Setup note for binary packages deployment (Pro)</p> <p>If your Seafile server is deployed from binary packages, you have to do the following steps before deploying:</p> <ol> <li> <p>install <code>boto3</code> to your machine</p> <pre><code>sudo pip install boto3\n</code></pre> </li> <li> <p>Install and configure memcached or Redis. </p> <p>For best performance, Seafile requires enable memory cache for objects. We recommend to at least allocate 128MB memory for memcached or Redis.</p> <p>The configuration options differ for different S3 storage. We'll describe the configurations in separate sections. You also need to add memory cache configurations</p> </li> </ol>"},{"location":"setup/setup_with_s3/#setup-swith-environment-variables-recommend","title":"Setup swith environment variables (recommend)","text":"<p>From Seafile 13, configuring S3 from environment variables will be supported and will provide a more convenient way. You can refer to the detailed description of this part in the introduction of <code>.env</code> file. Generally, </p> <ol> <li>Prepare at least 3 buckets for Seafile (<code>S3_COMMIT_BUCKET</code>, <code>S3_FS_BUCKET</code> and <code>S3_BLOCK_BUCKET</code>). </li> <li>Set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>true</code></li> <li>Fill in the corresponding variable values in <code>.env</code> \u200b\u200baccording to the following table:</li> </ol> Variable Description Default Value <code>S3_COMMIT_BUCKET</code> S3 storage backend commit objects bucket (required) <code>S3_FS_BUCKET</code> S3 storage backend fs objects bucket (required) <code>S3_BLOCK_BUCKET</code> S3 storage backend block objects bucket (required) <code>S3_KEY_ID</code> S3 storage backend key ID (required) <code>S3_SECRET_KEY</code> S3 storage backend secret key (required) <code>S3_AWS_REGION</code> Region of your buckets <code>us-east-1</code> <code>S3_HOST</code> Host of your buckets (required when not use AWS) <code>S3_USE_HTTPS</code> Use HTTPS connections to S3 if enabled <code>true</code> <code>S3_USE_V4_SIGNATURE</code> Use the v4 protocol of S3 if enabled <code>true</code> <code>S3_PATH_STYLE_REQUEST</code> This option asks Seafile to use URLs like <code>https://192.168.1.123:8080/bucketname/object</code> to access objects. In Amazon S3, the default URL format is in virtual host style, such as <code>https://bucketname.s3.amazonaws.com/object</code>. But this style relies on advanced DNS server setup. So most self-hosted storage systems only implement the path style format. <code>false</code> <code>S3_SSE_C_KEY</code> A string of 32 characters can be generated by openssl rand -base64 24. It can be any 32-character long random string. It's required to use V4 authentication protocol and https if you enable SSE-C. (none) <p>Bucket naming conventions</p> <p>No matter if you using AWS or any other S3 compatible object storage, we recommend that you follow S3 naming rules. When you create buckets on S3, please read the S3 rules for naming first. Note, especially do not use capital letters in the name of the bucket (do not use camel-style naming, such as MyCommitObjects).</p> Good naming of a bucketBad naming of a bucket <ul> <li>seafile-commit-object</li> <li>seafile-fs-object</li> <li>seafile-block-object</li> </ul> <ul> <li>SeafileCommitObject</li> <li>seafileFSObject</li> <li>seafile block object</li> </ul> <p>About S3_SSE_C_KEY</p> <p><code>S3_SSE_C_KEY</code> is a string of 32 characters.</p> <p>You can generate sse_c_key with the following command. Note that the key doesn't have to be base64 encoded. It can be any 32-character long random string. The example just show one possible way to generate such a key.</p> <pre><code>openssl rand -base64 24\n</code></pre> <p>Howevery, if you have existing data in your S3 storage bucket, turning on the above configuration will make your data inaccessible. That's because Seafile server doesn't support encrypted and non-encrypted objects mixed in the same bucket. You have to create a new bucket, and migrate your data to it by following storage backend migration documentation.</p> <p>For other S3 support extensions</p> <p>In addition to Seafile server, the following extensions (if already installed) will share the same S3 authorization information in <code>.env</code> with Seafile server:</p> <ul> <li>SeaSearch: Enable the feature by specifying <code>SS_STORAGE_TYPE=s3</code> and <code>S3_SS_BUCKET</code></li> <li>Metadata server: Enable the feature by specifying <code>MD_STORAGE_TYPE=s3</code> and <code>S3_MD_BUCKET</code></li> </ul>"},{"location":"setup/setup_with_s3/#example-configurations","title":"Example configurations","text":"AWSExoscaleHetznerOther Public Hosted S3 StorageSelf-hosted S3 Storage <pre><code>SEAF_SERVER_STORAGE_TYPE=s3\nS3_COMMIT_BUCKET=my-commit-objects\nS3_FS_BUCKET=my-fs-objects\nS3_BLOCK_BUCKET=my-block-objects\nS3_KEY_ID=your-key-id\nS3_SECRET_KEY=your-secret-key\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=false\nS3_AWS_REGION=eu-central-1\nS3_HOST=\nS3_USE_HTTPS=true\n</code></pre> <pre><code>SEAF_SERVER_STORAGE_TYPE=s3\nS3_COMMIT_BUCKET=my-commit-objects\nS3_FS_BUCKET=my-fs-objects\nS3_BLOCK_BUCKET=my-block-objects\nS3_KEY_ID=your-key-id\nS3_SECRET_KEY=your-secret-key\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=true\nS3_AWS_REGION=eu-central-1 # will be ignored when S3_HOST is specified\nS3_HOST=sos-de-fra-1.exo.io\nS3_USE_HTTPS=true\n</code></pre> <pre><code>SEAF_SERVER_STORAGE_TYPE=s3\nS3_COMMIT_BUCKET=my-commit-objects\nS3_FS_BUCKET=my-fs-objects\nS3_BLOCK_BUCKET=my-block-objects\nS3_KEY_ID=your-key-id\nS3_SECRET_KEY=your-secret-key\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=true\nS3_AWS_REGION=eu-central-1 # will be ignored when S3_HOST is specified\nS3_HOST=fsn1.your-objectstorage.com\nS3_USE_HTTPS=true\n</code></pre> <p>There are other S3-compatible cloud storage providers in the market, such as Blackblaze and Wasabi. Configuration for those providers are just a bit different from AWS. We don't assure the following configuration works for all providers. If you have problems please contact our support</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=s3\nS3_COMMIT_BUCKET=my-commit-objects\nS3_FS_BUCKET=my-fs-objects\nS3_BLOCK_BUCKET=my-block-objects\nS3_KEY_ID=your-key-id\nS3_SECRET_KEY=your-secret-key\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=true\nS3_AWS_REGION=eu-central-1 # will be ignored when S3_HOST is specified\nS3_HOST=&lt;access endpoint for storage provider&gt;\nS3_USE_HTTPS=true\n</code></pre> <p>Many self-hosted object storage systems are now compatible with the S3 API, such as OpenStack Swift, Ceph's RADOS Gateway and Minio. You can use these S3-compatible storage systems as backend for Seafile. Here is an example config:</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=s3\nS3_COMMIT_BUCKET=my-commit-objects\nS3_FS_BUCKET=my-fs-objects\nS3_BLOCK_BUCKET=my-block-objects\nS3_KEY_ID=your-key-id\nS3_SECRET_KEY=your-secret-key\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=true\nS3_AWS_REGION=eu-central-1 # will be ignored when S3_HOST is specified\nS3_HOST=&lt;your s3 api endpoint host&gt;:&lt;your s3 api endpoint port&gt;\nS3_USE_HTTPS=true # according to your S3 configuration\n</code></pre>"},{"location":"setup/setup_with_s3/#setup-with-config-file","title":"Setup with config file","text":"<p>Seafile configures S3 storage by adding or modifying the following section in <code>seafile.conf</code>:</p> <pre><code>[xxx_object_backend]\nname = s3\nbucket = my-xxx-objects\nkey_id = your-key-id\nkey = your-secret-key\nuse_v4_signature = true\nuse_https = true\n... ; other optional configurations\n</code></pre> <p>Similar to configure in <code>.env</code>, you have to create at least 3 buckets for Seafile too, corresponding to the sections: <code>commit_object_backend</code>, <code>fs_object_backend</code> and <code>block_backend</code>. For the configurations for each backend section, please refer to the following table:</p> Variable Description <code>bucket</code> Bucket name for commit, fs, and block objects. Make sure it follows S3 naming rules (you can refer the notes below the table). <code>key_id</code> The <code>key_id</code> is required to authenticate you to S3. You can find the <code>key_id</code> in the \"security credentials\" section on your AWS account page or from your storage provider. <code>key</code> The <code>key</code> is required to authenticate you to S3. You can find the <code>key</code> in the \"security credentials\" section on your AWS account page or from your storage provider. <code>use_v4_signature</code> There are two versions of authentication protocols that can be used with S3 storage: Version 2 (older, may still be supported by some regions) and Version 4 (current, used by most regions). If you don't set this option, Seafile will use the v2 protocol. It's suggested to use the v4 protocol. <code>use_https</code> Use https to connect to S3. It's recommended to use https. <code>aws_region</code> (Optional) If you use the v4 protocol and AWS S3, set this option to the region you chose when you create the buckets. If it's not set and you're using the v4 protocol, Seafile will use <code>us-east-1</code> as the default. This option will be ignored if you use the v2 protocol. <code>host</code> (Optional) The endpoint by which you access the storage service. Usually it starts with the region name. It's required to provide the host address if you use storage provider other than AWS, otherwise Seafile will use AWS's address (i.e., <code>s3.us-east-1.amazonaws.com</code>). <code>sse_c_key</code> (Optional) A string of 32 characters can be generated by <code>openssl rand -base64 24</code>. It can be any 32-character long random string. It's required to use V4 authentication protocol and https if you enable SSE-C. <code>path_style_request</code> (Optional) This option asks Seafile to use URLs like <code>https://192.168.1.123:8080/bucketname/object</code> to access objects. In Amazon S3, the default URL format is in virtual host style, such as <code>https://bucketname.s3.amazonaws.com/object</code>. But this style relies on advanced DNS server setup. So most self-hosted storage systems only implement the path style format. So we recommend to set this option to true for self-hosted storage."},{"location":"setup/setup_with_s3/#example-configurations_1","title":"Example configurations","text":"AWSExoscaleHetznerOther Public Hosted S3 StorageSelf-hosted S3 Storage <pre><code>[commit_object_backend]\nname = s3\nbucket = my-commit-objects\nkey_id = your-key-id\nkey = your-secret-key\nuse_v4_signature = true\naws_region = eu-central-1\nuse_https = true\n\n[fs_object_backend]\nname = s3\nbucket = my-fs-objects\nkey_id = your-key-id\nkey = your-secret-key\nuse_v4_signature = true\naws_region = eu-central-1\nuse_https = true\n\n[block_backend]\nname = s3\nbucket = my-block-objects\nkey_id = your-key-id\nkey = your-secret-key\nuse_v4_signature = true\naws_region = eu-central-1\nuse_https = true\n</code></pre> <pre><code>[commit_object_backend]\nname = s3\nbucket = your-bucket-name\nhost = sos-de-fra-1.exo.io\nkey_id = ...\nkey = ...\nuse_https = true\npath_style_request = true\n\n[fs_object_backend]\nname = s3\nbucket = your-bucket-name\nhost = sos-de-fra-1.exo.io\nkey_id = ...\nkey = ...\nuse_https = true\npath_style_request = true\n\n[block_backend]\nname = s3\nbucket = your-bucket-name\nhost = sos-de-fra-1.exo.io\nkey_id = ...\nkey = ...\nuse_https = true\npath_style_request = true\n</code></pre> <pre><code>[commit_object_backend]\nname = s3\nbucket = your-bucket-name\nhost = fsn1.your-objectstorage.com\nkey_id = ...\nkey = ...\nuse_https = true\npath_style_request = true\n\n[fs_object_backend]\nname = s3\nbucket = your-bucket-name\nhost = fsn1.your-objectstorage.com\nkey_id = ...\nkey = ...\nuse_https = true\npath_style_request = true\n\n[block_backend]\nname = s3\nbucket = your-bucket-name\nhost = fsn1.your-objectstorage.com\nkey_id = ...\nkey = ...\nuse_https = true\npath_style_request = true\n</code></pre> <p>There are other S3-compatible cloud storage providers in the market, such as Blackblaze and Wasabi. Configuration for those providers are just a bit different from AWS. We don't assure the following configuration works for all providers. If you have problems please contact our support</p> <pre><code>[commit_object_backend]\nname = s3\nbucket = my-commit-objects\nhost = &lt;access endpoint for storage provider&gt;\nkey_id = your-key-id\nkey = your-secret-key\n# v2 authentication protocol will be used if not set\nuse_v4_signature = true\n# required for v4 protocol. ignored for v2 protocol.\naws_region = &lt;region name for storage provider&gt;\nuse_https = true\n\n[fs_object_backend]\nname = s3\nbucket = my-fs-objects\nhost = &lt;access endpoint for storage provider&gt;\nkey_id = your-key-id\nkey = your-secret-key\nuse_v4_signature = true\naws_region = &lt;region name for storage provider&gt;\nuse_https = true\n\n[block_backend]\nname = s3\nbucket = my-block-objects\nhost = &lt;access endpoint for storage provider&gt;\nkey_id = your-key-id\nkey = your-secret-key\nuse_v4_signature = true\naws_region = &lt;region name for storage provider&gt;\nuse_https = true\n</code></pre> <p>Many self-hosted object storage systems are now compatible with the S3 API, such as OpenStack Swift, Ceph's RADOS Gateway and Minio. You can use these S3-compatible storage systems as backend for Seafile. Here is an example config:</p> <pre><code>[commit_object_backend]\nname = s3\nbucket = my-commit-objects\nkey_id = your-key-id\nkey = your-secret-key\nhost = &lt;your s3 api endpoint host&gt;:&lt;your s3 api endpoint port&gt;\npath_style_request = true\nuse_v4_signature = true\nuse_https = true\n\n[fs_object_backend]\nname = s3\nbucket = my-fs-objects\nkey_id = your-key-id\nkey = your-secret-key\nhost = &lt;your s3 api endpoint host&gt;:&lt;your s3 api endpoint port&gt;\npath_style_request = true\nuse_v4_signature = true\nuse_https = true\n\n[block_backend]\nname = s3\nbucket = my-block-objects\nkey_id = your-key-id\nkey = your-secret-key\nhost = &lt;your s3 api endpoint host&gt;:&lt;your s3 api endpoint port&gt;\npath_style_request = true\nuse_v4_signature = true\nuse_https = true\n</code></pre> <p>Use server-side encryption with customer-provided keys (SSE-C) in Seafile</p> <p>Since Pro 11.0, you can use SSE-C to S3. Add the following <code>sse_c_key</code> to seafile.conf (as shown in the above variables table):</p> <pre><code>[commit_object_backend]\nname = s3\n......\nuse_v4_signature = true\nuse_https = true\nsse_c_key = XiqMSf3x5ja4LRibBbV0sVntVpdHXl3P\n\n[fs_object_backend]\nname = s3\n......\nuse_v4_signature = true\nuse_https = true\nsse_c_key = XiqMSf3x5ja4LRibBbV0sVntVpdHXl3P\n\n[block_backend]\nname = s3\n......\nuse_v4_signature = true\nuse_https = true\nsse_c_key = XiqMSf3x5ja4LRibBbV0sVntVpdHXl3P\n</code></pre>"},{"location":"setup/setup_with_s3/#run-and-test","title":"Run and Test","text":"<p>Now you can start Seafile and test</p>"},{"location":"setup/setup_with_swift/","title":"Setup With OpenStack Swift","text":"<p>This backend uses the native Swift API. Previously users can only use the S3-compatibility layer of Swift. That way is obsolete now. </p> <p>Since version 6.3, OpenStack Swift v3.0 API is supported.</p>"},{"location":"setup/setup_with_swift/#prepare","title":"Prepare","text":"<p>To setup Seafile Professional Server with Swift:</p> <ul> <li>Setup the basic Seafile Professional Server</li> <li>Install and configure memcached or Redis. For best performance, Seafile requires enable memory cache for objects. We recommend to at least allocate 128MB memory for memcached.</li> </ul>"},{"location":"setup/setup_with_swift/#modify-seafileconf","title":"Modify Seafile.conf","text":"<p>Edit <code>seafile.conf</code>, add the following lines:</p> <pre><code>[block_backend]\nname = swift\ntenant = yourTenant\nuser_name = user\npassword = secret\ncontainer = seafile-blocks\nauth_host = 192.168.56.31:5000\nauth_ver = v3.0\nregion = yourRegion\n\n[commit_object_backend]\nname = swift\ntenant = yourTenant\nuser_name = user\npassword = secret\ncontainer = seafile-commits\nauth_host = 192.168.56.31:5000\nauth_ver = v3.0\nregion = yourRegion\n\n[fs_object_backend]\nname = swift\ntenant = yourTenant\nuser_name = user\npassword = secret\ncontainer = seafile-fs\nauth_host = 192.168.56.31:5000\nauth_ver = v3.0\nregion = yourRegion\n</code></pre> <p>You also need to add memory cache configurations</p> <p>The above config is just an example. You should replace the options according to your own environment.</p> <p>Seafile supports Swift with Keystone as authentication mechanism. The <code>auth_host</code> option is the address and port of Keystone service.The <code>region</code> option is used to select publicURL,if you don't configure it, use the first publicURL in returning authenticated information.</p> <p>Seafile also supports Tempauth and Swauth since professional edition 6.2.1. The <code>auth_ver</code> option should be set to <code>v1.0</code>, <code>tenant</code> and <code>region</code> are no longer needed.</p> <p>It's required to create separate containers for commit, fs, and block objects.</p>"},{"location":"setup/setup_with_swift/#use-https-connections-to-swift","title":"Use HTTPS connections to Swift","text":"<p>Since Pro 5.0.4, you can use HTTPS connections to Swift. Add the following options to seafile.conf:</p> <pre><code>[commit_object_backend]\nname = swift\n......\nuse_https = true\n\n[fs_object_backend]\nname = swift\n......\nuse_https = true\n\n[block_backend]\nname = swift\n......\nuse_https = true\n</code></pre> <p>Because the server package is built on CentOS 6, if you're using Debian/Ubuntu, you have to copy the system CA bundle to CentOS's CA bundle path. Otherwise Seafile can't find the CA bundle so that the SSL connection will fail.</p> <pre><code>sudo mkdir -p /etc/pki/tls/certs\nsudo cp /etc/ssl/certs/ca-certificates.crt /etc/pki/tls/certs/ca-bundle.crt\nsudo ln -s /etc/pki/tls/certs/ca-bundle.crt /etc/pki/tls/cert.pem\n</code></pre>"},{"location":"setup/setup_with_swift/#run-and-test","title":"Run and Test","text":"<p>Now you can start Seafile by <code>./seafile.sh start</code> and <code>./seahub.sh start</code> and visit the website.</p>"},{"location":"setup/system_requirements/","title":"System requirements","text":"<p>This page shows the minimal requirements of Seafile.</p> <p>About the system requirements</p> <p>The system requirements in this document refer to the minimum system hardware requirements are the suggestions to smooth operation of Seafile (network connection is not discussed here). If not otherwise specified, it will apply to all deployment scenarios, but for binary installations, the libraries we provided in the documents are only supporting the following operation systems:</p> <ul> <li>Ubuntu 24.04</li> <li>Ubuntu 22.04</li> <li>Debian 12</li> <li>Debian 11</li> </ul> <p>Important: Information of Docker-base deployment integration services</p> <ul> <li> <p>In each case, we have shown the services integrated names Docker-base deployment integration services by standard installation with Docker. If these services are already installed and you do not need them in your deployment, you need to refer to the corresponding documentation and disable them in the Docker resource file.However, we do not recommend that you reduce the corresponding system resource requirements on our suggestions, unless otherwise specified.</p> </li> <li> <p>However, if you use other installation methods (e.g., binary deployment, K8S deployment) you have to make sure you have installed these services, because it will not include the installation of that. </p> </li> <li> <p>If you need to install other extensions not included here (e.g., OnlyOffice), you should increase the system requirements appropriately above our recommendations.</p> </li> </ul>"},{"location":"setup/system_requirements/#seafile-ce","title":"Seafile CE","text":"<ul> <li>Memory requirements: 2G</li> <li>CPU requirements: 2 cores, more than 2G Hz are recommended</li> <li>Hard disk requirements: 10G availables, more than 50G are recommended</li> <li>Docker-base deployment integration services:<ul> <li>Seafile</li> <li>Redis</li> <li>Mariadb</li> <li>Seadoc</li> <li>Caddy</li> </ul> </li> </ul>"},{"location":"setup/system_requirements/#seafile-pro","title":"Seafile Pro","text":"<ul> <li> <p>CPU and Memory requirements:</p> Deployment Scenarios CPU Requirements Memory Requirements Indexer / Search Engine Docker deployment 4 Cores 4G Default All 4 Cores 4G With existing ElasticSearch service, but on the same machine / node All 2 Cores 2G With existing ElasticSearch service, and on another machine / node All 2 Cores 2G Use SeaSearch as the search engine, instead of ElasticSearch </li> <li> <p>Hard disk requirements: More than 50G are recommended</p> </li> <li>Docker-base deployment integration services:<ul> <li>Seafile</li> <li>Redis</li> <li>Mariadb</li> <li>ElasticSearch</li> <li>Seadoc</li> <li>Caddy</li> </ul> </li> </ul> <p>More details of files indexer used in Seafile PE</p> <ul> <li> <p>By default, Seafile Pro will use Elasticsearch as the files indexer</p> <p>Please make sure the mmapfs counts do not cause excptions like out of memory, which can be increased by following command (see https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html for futher details):</p> <pre><code>sysctl -w vm.max_map_count=262144 #run as root\n</code></pre> <p>or modify /etc/sysctl.conf and reboot to set this value permanently:</p> <pre><code>nano /etc/sysctl.conf\n\n# modify vm.max_map_count\nvm.max_map_count=262144\n</code></pre> </li> <li> <p>If your machine dose not have enough requirements, 2 Cores and 2GB RAM are minimum by chosing one of following two ways after first-time deployment:</p> <ul> <li> <p>Use SeaSearch, a lightweight search engine built on open source search engine ZincSearch, as the indexer</p> </li> <li> <p>Deploy Elasticsearch in another machine, and modify <code>es_host</code> and <code>es_port</code> in seafevents.conf</p> </li> </ul> </li> </ul>"},{"location":"setup/system_requirements/#seafile-cluster","title":"Seafile Cluster","text":"<ul> <li>Node requirements: Minimal 2 nodes (one frontend and one backend), but recommend more than 3 nodes (two frontend and three backend)</li> </ul> <p>More details about the number of nodes</p> <ol> <li>If your number of nodes does not meet our recommended number (i.e. 3 nodes), please adjust according to the following strategies:<ul> <li>2 nodes: A frontend service and a backend service on the same node</li> <li>1 node: Please deploy Seafile in a single node instead a cluster.</li> </ul> </li> <li>If you have more available nodes for Seafile server, please provide them to the Seafile frontend service and make sure there is only one backend service running. Here is a simple relationship between the number of Seafile frontent services (\\(N_f\\)) and total nodes (\\(N_t\\)):     $$     N_f = N_t - 1,     $$     where the number 1 means one node for Seafile backend service.</li> </ol> <ul> <li>Other system requirements: similar with Seafile Pro, but make sure that all nodes should meet this condition</li> <li>Docker-base deployment integration services: Seafile only</li> </ul> <p>More suggestions in Seafile cluster</p> <ul> <li> <p>We assume you have already deployed Redis (Memcached alternatively, but still recommend Redis), MariaDB, file indexer (e.g., ElasticSearch) in separate machines and use S3 like object storage. </p> </li> <li> <p>Generally, when deploying Seafile in a cluster, we recommend that you use a storage backend (such as AWS S3) to store Seafile data. However, according to the Seafile image startup rules and K8S persistent storage strategy, you still need to prepare a persistent directory for configuring the startup of the Seafile container. </p> </li> </ul>"},{"location":"setup/use_other_reverse_proxy/","title":"Use other reverse proxy","text":"<p>Since Seafile 12.0, all reverse proxy, HTTPS, etc. processing for single-node deployment based on Docker is handled by caddy. If you need to use other reverse proxy services, you can refer to this document to modify the relevant configuration files.</p>"},{"location":"setup/use_other_reverse_proxy/#services-that-require-reverse-proxy","title":"Services that require reverse proxy","text":"<p>Before making changes to the configuration files, you have to know the services used by Seafile and related components (Table 1 therafter).</p> <p>Tip</p> <p>The services shown in the table below are all based on the single-node integrated deployment in accordance with the Seafile official documentation. </p> <p>If these services are deployed in standalone mode (such as seadoc and notification-server), or deployed in the official documentation of third-party plugins (such as onlyoffice and collabora), you can skip modifying the configuration files of these services (because Caddy is not used as a reverse proxy for such deployment approaches).</p> <p>If you have not integrated the services in the Table 1, please choose Standalone or Refer to the official documentation of third-party plugins to install them when you need these services</p> YML Service Suggest exposed port Service listen port Require WebSocket <code>seafile-server.yml</code> seafile 80 80 No <code>seadoc.yml</code> seadoc 8888 80 Yes <code>notification-server.yml</code> notification-server 8083 8083 Yes <code>collabora.yml</code> collabora 6232 9980 No <code>onlyoffice.yml</code> onlyoffice 6233 80 No <code>thumbnail-server.yml</code> thumbnail 8084 80 No"},{"location":"setup/use_other_reverse_proxy/#modify-yml-files","title":"Modify YML files","text":"<ol> <li> <p>Refer to Table 1 for the related service exposed ports. Add section <code>ports</code> for corresponding services</p> <pre><code>services:\n    &lt;the service need to be modified&gt;:\n        ...\n        ports:\n            - \"&lt;Suggest exposed port&gt;:&lt;Service listen port&gt;\"\n</code></pre> </li> <li> <p>Delete all fields related to Caddy reverse proxy (in <code>label</code> section)</p> <p>Tip</p> <p>Some <code>.yml</code> files (e.g., <code>collabora.yml</code>) also have port-exposing information with Caddy in the top of the file, which also needs to be removed.</p> </li> </ol> <p>We take <code>seafile-server.yml</code> for example (Pro edition):</p> <pre><code>services:\n    # ... other services\n\n    seafile:\n    image: ${SEAFILE_IMAGE:-seafileltd/seafile-pro-mc:13.0-latest}\n    container_name: seafile\n    ports:\n       - \"80:80\"\n    volumes:\n      - ${SEAFILE_VOLUME:-/opt/seafile-data}:/shared\n    environment:\n      ... # enviroment variables map, donnot make change\n\n    # please remove the `label` section\n    #label: ...  &lt;- remove this section\n\n    depends_on:\n      ... # dependencies, donnot make change\n    ...\n\n# ... other options\n</code></pre>"},{"location":"setup/use_other_reverse_proxy/#add-reverse-proxy-for-related-services","title":"Add reverse proxy for related services","text":"<p>Modify <code>nginx.conf</code> and add reverse proxy for services seafile and seadoc:</p> <p>Note</p> <p>If your proxy server's host is not the same as the host the Seafile deployed to, please replase <code>127.0.0.1</code> to your Seafile server's host</p> seafileseadocnotification-serveronlyofficethumbnail <pre><code>location / {\n    proxy_pass http://127.0.0.1:80;\n    proxy_read_timeout 310s;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Connection \"\";\n    proxy_http_version 1.1;\n\n    client_max_body_size 0;\n}\n</code></pre> <pre><code>location /sdoc-server/ {\n    proxy_pass         http://127.0.0.1:8888/;\n    proxy_redirect     off;\n    proxy_set_header   Host              $host;\n    proxy_set_header   X-Real-IP         $remote_addr;\n    proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Host  $server_name;\n\n    client_max_body_size 100m;\n}\n\nlocation /socket.io {\n    proxy_pass http://127.0.0.1:8888;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_redirect off;\n\n    proxy_buffers 8 32k;\n    proxy_buffer_size 64k;\n\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-NginX-Proxy true;\n}\n</code></pre> <pre><code>location /notification/ping {\n    proxy_pass http://127.0.0.1:8083/ping;\n    access_log      /var/log/nginx/notification.access.log seafileformat;\n    error_log       /var/log/nginx/notification.error.log;\n}\nlocation /notification {\n    proxy_pass http://127.0.0.1:8083/;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    access_log      /var/log/nginx/notification.access.log seafileformat;\n    error_log       /var/log/nginx/notification.error.log;\n}\n</code></pre> <pre><code>map $http_x_forwarded_proto $the_scheme {\n    default $http_x_forwarded_proto;\n    \"\" $scheme;\n}\nmap $http_x_forwarded_host $the_host {\n    default $http_x_forwarded_host;\n    \"\" $host;\n}\nmap $http_upgrade $proxy_connection {\n    default upgrade;\n    \"\" close;\n}\nlocation /onlyofficeds/ {\n    proxy_pass http://127.0.0.1:6233/;\n    proxy_http_version 1.1;\n    client_max_body_size 100M;\n    proxy_read_timeout 3600s;\n    proxy_connect_timeout 3600s;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection $proxy_connection;\n    proxy_set_header X-Forwarded-Host $the_host/onlyofficeds;\n    proxy_set_header X-Forwarded-Proto $the_scheme;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n}\n</code></pre> <pre><code>location /thumbnail {\n    proxy_pass http://127.0.0.1:8084/;\n    proxy_http_version 1.1;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n\n    access_log /var/log/nginx/thumbnail.access.log;\n    error_log  /var/log/nginx/thumbnail.error.log;\n}\n</code></pre>"},{"location":"setup/use_other_reverse_proxy/#modify-env","title":"Modify .env","text":"<p>Remove <code>caddy.yml</code> from field <code>COMPOSE_FILE</code> in <code>.env</code>, e.g.</p> <pre><code>COMPOSE_FILE='seafile-server.yml' # remove caddy.yml\n</code></pre>"},{"location":"setup/use_other_reverse_proxy/#restart-services-and-nginx","title":"Restart services and nginx","text":"<pre><code>docker compose down\ndocker compose up -d\nnginx restart\n</code></pre>"},{"location":"setup/use_seasearch/","title":"Use SeaSearch as search engine (Pro)","text":"<p>SeaSearch, a file indexer with more lightweight and efficiency than Elasticsearch, is supported from Seafile 12.</p> <p>For Seafile deploy from binary package</p> <p>We currently only support Docker-based deployment for SeaSearch Server, so this document describes the configuration with the situation of using Docker to deploy Seafile server. </p> <p>If your Seafile Server deploy from binary package, please refer here to start or stop Seafile Server.</p> <p>For Seafile cluster</p> <p>Theoretically, at least the backend node has to restart, if your Seafile server deploy in cluster mode, but we still suggest you configure and restart all node to make sure the consistency and synchronization in the cluster</p>"},{"location":"setup/use_seasearch/#deploy-seasearch-service","title":"Deploy SeaSearch service","text":"<p>SeaSearch service is currently mainly deployed via docker. We have integrated it into the relevant docker-compose file. You only need to download it to the same directory as <code>seafile-server.yml</code>:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/pro/seasearch.yml\n</code></pre>"},{"location":"setup/use_seasearch/#modify-env","title":"Modify <code>.env</code>","text":"<p>We have configured the relevant variables in .env. Here you must pay special attention to the following variable information, which will affect the SeaSearch initialization process. For variables in <code>.env</code> of SeaSearch service, please refer here for the details. We use <code>/opt/seasearch-data</code> as the persistent directory of SeaSearch (the information of administrator are same as Seafile's admin by default from Seafile 13):</p> <p>For Apple's Chips</p> <p>Since Apple's chips (such as M2) do not support MKL, you need to set the relevant image to <code>xxx-nomkl:latest</code>, e.g.:</p> <pre><code>SEASEARCH_IMAGE=seafileltd/seasearch-nomkl:latest\n</code></pre> <pre><code>COMPOSE_FILE='...,seasearch.yml' # ... means other docker-compose files\n\n#SEASEARCH_IMAGE=seafileltd/seasearch-nomkl:1.0-latest  # for Apple's Chip\nSEASEARCH_IMAGE=seafileltd/seasearch:1.0-latest\n\nSS_DATA_PATH=/opt/seasearch-data\nINIT_SS_ADMIN_USER=&lt;admin-username&gt;  \nINIT_SS_ADMIN_PASSWORD=&lt;admin-password&gt;\n\n\n# if you would like to use S3 for saving seasearch data\nSS_STORAGE_TYPE=s3\nS3_SS_BUCKET=...\nS3_KEY_ID=&lt;your-key-id&gt;\nS3_SECRET_KEY=&lt;your-secret-key&gt;\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=false\nS3_AWS_REGION=us-east-1\nS3_HOST=\nS3_USE_HTTPS=true\nS3_SSE_C_KEY=\n</code></pre>"},{"location":"setup/use_seasearch/#modify-seafile-serveryml-to-disable-elasticsearch-service","title":"Modify <code>seafile-server.yml</code> to disable <code>elasticSearch</code> service","text":"<p>If you would like to use SeaSearch as the search engine, the <code>elasticSearch</code> service can be removed, which is no longer used: remove <code>elasticsearch.yml</code> in the list variable <code>COMPOSE_FILE</code> on the file <code>.env</code>.</p>"},{"location":"setup/use_seasearch/#modify-seafeventsconf","title":"Modify <code>seafevents.conf</code>","text":"<ol> <li> <p>Get your authorization token by base64 code consist of <code>INIT_SS_ADMIN_USER</code> and <code>INIT_SS_ADMIN_PASSWORD</code> defined in <code>.env</code> firsly, which is used to authorize when calling the SeaSearch API:</p> <pre><code>echo -n 'username:password' | base64\n\n# example output\nYWRtaW46YWRtaW5fcGFzc3dvcmQ=\n</code></pre> </li> <li> <p>Add the following section in seafevents to enable seafile backend service to access SeaSearch APIs</p> <p>SeaSearch server deploy on a different machine with Seafile</p> <p>If your SeaSearch server deploy on a different machine with Seafile, please replace <code>http://seasearch:4080</code> to the url <code>&lt;scheme&gt;://&lt;address&gt;:&lt;prot&gt;</code> of your SeaSearch server </p> <pre><code>[SEASEARCH]\nenabled = true\nseasearch_url = http://seasearch:4080\nseasearch_token = &lt;your auth token&gt;\ninterval = 10m\n\n# if you would like to enable full-text indexing (i.e., search for document content), also set the option below to true (support from 13.0 Pro)\nindex_office_pdf = true\n</code></pre> </li> <li> <p>Disable the ElasticSearch, as you can set <code>enabled = false</code> in <code>INDEX FILES</code> section:</p> <pre><code>[INDEX FILES]\nenabled = false\n...\n</code></pre> </li> </ol>"},{"location":"setup/use_seasearch/#restart-seafile-server","title":"Restart Seafile Server","text":"<pre><code>docker compose down\ndocker compose up -d\n</code></pre> <p>After startup the SeaSearch service, you can check the following logs for Whether SeaSearch runs normally and Seafile is called successfully:</p> <ul> <li>container logs by command <code>docker logs -f seafile-seasearch</code></li> <li><code>/opt/seasearch-data/log/seafevents.log</code></li> </ul> <p>After first time start SeaSearch Server</p> <p>You can remove the initial admin account informations in <code>.env</code> (e.g., <code>INIT_SS_ADMIN_USER</code>, <code>INIT_SS_ADMIN_PASSWORD</code>), which are only used in the SeaSearch initialization progress (i.e., the first time to start services). But make sure you have recorded it somewhere else in case you forget the password.</p>"},{"location":"setup/use_seasearch/#other-configurations","title":"Other configurations","text":""},{"location":"setup/use_seasearch/#set-tokenization-language","title":"Set tokenization language","text":"<p>By default, SeaSearch use word based tokenizer designed for English/German/French language. You can add following configuration to use tokenizer designed for Chinese language.</p> <pre><code>[SEASEARCH]\nenabled = true\n...\nlang = chinese\n</code></pre>"},{"location":"setup_binary/cluster_deployment/","title":"Cluster Deployment","text":"<p>Tip</p> <p>Since version 8.0, the recommend way to install Seafile clsuter is using Docker</p>"},{"location":"setup_binary/cluster_deployment/#cluster-requirements","title":"Cluster requirements","text":"<p>Please refer here for the details about the cluster requirements for all nodes in Seafile cluster. In general, we recommend that each node should have at least 2G RAM and a 2-core CPU (&gt; 2GHz).</p>"},{"location":"setup_binary/cluster_deployment/#preparation-all-nodes","title":"Preparation (all nodes)","text":""},{"location":"setup_binary/cluster_deployment/#install-prerequisites","title":"Install prerequisites","text":"<p>Please follow here to install prerequisites</p> <p>Note</p> <p>Cache server (the first step) is not necessary, if you donot wish this node deploy it.</p>"},{"location":"setup_binary/cluster_deployment/#create-user-seafile","title":"Create user <code>seafile</code>","text":"<p>Create a new user and follow the instructions on the screen:</p> <pre><code>adduser seafile\n</code></pre> <p>Change ownership of the created directory to the new user:</p> <pre><code>chown -R seafile: /opt/seafile\n</code></pre> <p>All the following steps are done as user seafile.</p> <p>Change to user seafile:</p> <pre><code>su seafile\n</code></pre>"},{"location":"setup_binary/cluster_deployment/#placing-the-seafile-pe-license-in-optseafile","title":"Placing the Seafile PE license in <code>/opt/seafile</code>","text":"<p>Save the license file in Seafile's programm directory <code>/opt/seafile</code>. Make sure that the name is <code>seafile-license.txt</code>. </p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p>"},{"location":"setup_binary/cluster_deployment/#setup-and-configure-nginx-only-for-frontend-nodes","title":"Setup and configure Nginx (only for frontend nodes)","text":"<p>For security reasons, the Seafile frontend service will only listen to requests from the local port <code>8000</code>. You need to use Nginx to reverse proxy this port to port <code>80</code> for external access:</p> <ol> <li> <p>Install Nginx</p> <pre><code>sudo apt update\nsudo apt install nginx\n</code></pre> </li> <li> <p>Create the configurations file for current node</p> <pre><code>sudo nano /etc/nginx/sites-available/seafile.conf\n</code></pre> <p>and, add the following contents into this file:</p> <pre><code>log_format seafileformat '$http_x_forwarded_for $remote_addr [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $upstream_response_time';\n\nserver {\n    listen 80;\n    server_name &lt;current node's IP&gt;;\n\n    proxy_set_header X-Forwarded-For $remote_addr;\n\n    location / {\n        proxy_pass         http://127.0.0.1:8000;\n        proxy_set_header   Host $http_host;\n        proxy_set_header   X-Real-IP $remote_addr;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Host $server_name;\n        proxy_read_timeout  1200s;\n\n        # used for view/edit office file via Office Online Server\n        client_max_body_size 0;\n\n        access_log      /var/log/nginx/seahub.access.log seafileformat;\n        error_log       /var/log/nginx/seahub.error.log;\n    }\n\n    location /seafhttp {\n        rewrite ^/seafhttp(.*)$ $1 break;\n        proxy_pass http://127.0.0.1:8082;\n        client_max_body_size 0;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n\n        proxy_read_timeout  36000s;\n        proxy_send_timeout  36000s;\n\n        send_timeout  36000s;\n\n        access_log      /var/log/nginx/seafhttp.access.log seafileformat;\n        error_log       /var/log/nginx/seafhttp.error.log;\n    }\n    location /media {\n        root /opt/seafile/seafile-server-latest/seahub;\n    }\n}\n</code></pre> </li> <li> <p>Link the configurations file to <code>sites-enabled</code> directory:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/seafile.conf /etc/nginx/sites-enabled/\n</code></pre> </li> <li> <p>Test and enable configuration</p> <pre><code>sudo nginx -t\nsudo nginx -s reload\n</code></pre> </li> </ol>"},{"location":"setup_binary/cluster_deployment/#start-seafile-service-on-boot-optional","title":"Start Seafile Service on boot (optional)","text":"<p>It would be convenient to setup Seafile service to start on system boot. Follow this documentation to set it up on.</p>"},{"location":"setup_binary/cluster_deployment/#firewall-settings","title":"Firewall Settings","text":"<p>There are 2 firewall rule changes for Seafile cluster:</p> <ul> <li>On each nodes, you should open the health check port (default 11001);</li> <li>On the Cache and ElasticSearch server, please only allow Seafile servers to access this port for security resons.</li> </ul>"},{"location":"setup_binary/cluster_deployment/#setup-the-first-frontend-node","title":"Setup the first frontend Node","text":""},{"location":"setup_binary/cluster_deployment/#setup-seafile-server-pro","title":"Setup Seafile server Pro","text":"<p>Please follow Installation of Seafile Server Professional Edition to setup:</p> <ul> <li>Download the install package</li> <li>Uncompress the package</li> <li>Set up Seafile Pro databases</li> </ul>"},{"location":"setup_binary/cluster_deployment/#create-and-modify-configuration-files-in-optseafileconf","title":"Create and Modify configuration files in <code>/opt/seafile/conf</code>","text":""},{"location":"setup_binary/cluster_deployment/#env","title":".env","text":"<p>Tip</p> <p><code>JWT_PRIVATE_KEY</code>, A random string with a length of no less than 32 characters can be generated from:  <pre><code>pwgen -s 40 1\n</code></pre></p> <pre><code>JWT_PRIVATE_KEY=&lt;Your jwt private key&gt;\nSEAFILE_SERVER_PROTOCOL=https\nSEAFILE_SERVER_HOSTNAME=seafile.example.com\nSEAFILE_MYSQL_DB_HOST=&lt;your database host&gt;\nSEAFILE_MYSQL_DB_PORT=3306\nSEAFILE_MYSQL_DB_USER=seafile\nSEAFILE_MYSQL_DB_PASSWORD=&lt;your MySQL password&gt;\nSEAFILE_MYSQL_DB_CCNET_DB_NAME=ccnet_db\nSEAFILE_MYSQL_DB_SEAFILE_DB_NAME=seafile_db\nSEAFILE_MYSQL_DB_SEAHUB_DB_NAME=seahub_db\n</code></pre>"},{"location":"setup_binary/cluster_deployment/#seafileconf","title":"seafile.conf","text":"<ol> <li> <p>Add or modify the following configuration to <code>seafile.conf</code>:</p> MemcachedRedis <pre><code>[memcached]\nmemcached_options = --SERVER=&lt;your memcached ip&gt;[:&lt;your memcached port&gt;] --POOL-MIN=10 --POOL-MAX=100\n</code></pre> <pre><code>[redis]\nredis_host = &lt;your redis ip&gt;\nredis_port = &lt;your redis port, default 6379&gt;\nmax_connections = 100\n</code></pre> </li> <li> <p>Enable cluster mode</p> <pre><code>[cluster]\nenabled = true\n</code></pre> <p>More options in <code>cluster</code> section</p> <p>The Seafile server also opens a port for the load balancers to run health checks. Seafile by default uses port <code>11001</code>. You can change this by adding the following config:</p> <pre><code>[cluster]\nhealth_check_port = 12345\n</code></pre> </li> <li> <p>Enable backend storage:</p> <ul> <li>S3</li> <li>OpenStack Swift</li> <li>Ceph</li> </ul> </li> </ol>"},{"location":"setup_binary/cluster_deployment/#seahub_settingspy","title":"seahub_settings.py","text":"<ol> <li> <p>You must setup and use memory cache when deploying Seafile cluster, please add or modify the following configuration to <code>seahub_settings.py</code>:</p> MemcachedRedis <pre><code>CACHES = {\n    'default': {\n        'BACKEND': 'django_pylibmc.memcached.PyLibMCCache',\n        'LOCATION': '&lt;your Memcached host&gt;:&lt;your Memcached port, default 11211&gt;',\n    },\n}\n</code></pre> <p>please Refer to Django's documentation about using Redis cache to add Redis configurations to <code>seahub_settings.py</code>.</p> </li> <li> <p>Add following options to seahub_setting.py, which will tell Seahub to store avatar in database and cache avatar in memcached, and store css CACHE to local memory.</p> <pre><code>AVATAR_FILE_STORAGE = 'seahub.base.database_storage.DatabaseStorage'\n</code></pre> </li> </ol>"},{"location":"setup_binary/cluster_deployment/#seafeventsconf","title":"seafevents.conf","text":"<p>Modify the <code>[INDEX FILES]</code> section to enable full test search, we take ElasticSearch for example:</p> <pre><code>[INDEX FILES]\nenabled = true\ninterval = 10m\nhighlight = fvh\nindex_office_pdf = true\nes_host = &lt;your ElasticSearch host&gt;\nes_port = &lt;your ElasticSearch port, default 9200&gt;\n</code></pre>"},{"location":"setup_binary/cluster_deployment/#update-seahub-database","title":"Update Seahub Database","text":"<p>In cluster environment, we have to store avatars in the database instead of in a local disk.</p> <pre><code>mysql -h&lt;your MySQL host&gt; -P&lt;your MySQL port&gt; -useafile -p&lt;user seafile's password&gt;\n\n# enter MySQL environment\nUSE seahub_db;\n\nCREATE TABLE `avatar_uploaded` (`filename` TEXT NOT NULL, `filename_md5` CHAR(32) NOT NULL PRIMARY KEY, `data` MEDIUMTEXT NOT NULL, `size` INTEGER NOT NULL, `mtime` datetime NOT NULL);\n</code></pre>"},{"location":"setup_binary/cluster_deployment/#run-and-test-the-single-node","title":"Run and Test the Single Node","text":"<p>Once you have finished configuring this single node, start it to test if it runs properly:</p> <p>Note</p> <p>For installations using python virtual environment, activate it if it isn't already active</p> <pre><code>source python-venv/bin/activate\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\nsu seafile\n./seafile.sh start\n./seahub.sh start\n</code></pre> <p>Success</p> <p>The first time you start seahub, the script would prompt you to create an admin account for your Seafile server. Then you can see the following message in your console:</p> <pre><code>Starting seafile server, please wait ...\nSeafile server started\n\nDone.\n\nStarting seahub at port 8000 ...\n\nSeahub is started\n\nDone.\n</code></pre> <p>Finally, you can visit <code>http://ip-address-of-this-node:80</code> and login with the admin account to test if this node is working fine or not.</p>"},{"location":"setup_binary/cluster_deployment/#configure-other-frontend-nodes","title":"Configure other frontend nodes","text":"<p>If the first frontend node works fine, you can compress the whole directory <code>/opt/seafile</code> into a tarball and copy it to all other Seafile server nodes. You can simply uncompress it and start the server by:</p> <p>Note</p> <p>For installations using python virtual environment, activate it if it isn't already active</p> <pre><code>source python-venv/bin/activate\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\nsu seafile\n./seafile.sh start\n./seahub.sh start\n</code></pre>"},{"location":"setup_binary/cluster_deployment/#backend-node","title":"Backend node","text":"<p>In the backend node, you need to execute the following command to start Seafile server. CLUSTER_MODE=backend means this node is seafile backend server.</p> <p>Note</p> <p>For installations using python virtual environment, activate it if it isn't already active</p> <pre><code>source python-venv/bin/activate\n</code></pre> <pre><code>export CLUSTER_MODE=backend\ncd /opt/seafile/seafile-server-latest\nsu seafile\n./seafile.sh start\n./seafile-background-tasks.sh start\n</code></pre>"},{"location":"setup_binary/cluster_deployment/#load-balancer-setting","title":"Load Balancer Setting","text":"<p>Note</p> <p>Since Seafile Pro server 6.0.0, cluster deployment requires \"sticky session\" settings in the load balancer. Otherwise sometimes folder download on the web UI can't work properly. Read the \"Load Balancer Setting\" section below for details</p> <p>Generally speaking, in order to better access the Seafile service, we recommend that you use a load balancing service to access the Seafile cluster and bind your domain name (such as <code>seafile.cluster.com</code>) to the load balancing service. Usually, you can use:</p> <ul> <li>Cloud service provider's load balancing service (e.g., AWS Elastic Load Balancer)</li> <li> <p>Deploy your own load balancing service, our document will give two of common load balance services:</p> <ul> <li>Nginx</li> <li>HAproxy</li> </ul> </li> </ul>"},{"location":"setup_binary/cluster_deployment/#aws-elastic-load-balancer-elb","title":"AWS Elastic Load Balancer (ELB)","text":"<p>In the AWS ELB management console, after you've added the Seafile server instances to the instance list, you should do two more configurations.</p> <p>First you should setup HTTP(S) listeners. Ports 443 and 80 of ELB should be forwarded to the ports 80 or 443 of the Seafile servers.</p> <p>Then you setup health check</p> <p></p> <p>Refer to AWS documentation about how to setup sticky sessions.</p>"},{"location":"setup_binary/cluster_deployment/#nginx","title":"Nginx","text":"<ol> <li> <p>Install Nginx in the host if you would like to deploy load balance service</p> <pre><code>sudo apt update\nsudo apt install nginx\n</code></pre> </li> <li> <p>Create the configurations file for Seafile cluster</p> <pre><code>sudo nano /etc/nginx/sites-available/seafile-cluster\n</code></pre> <p>and, add the following contents into this file:</p> <pre><code>upstream seafile_cluster {\n    server &lt;IP: your frontend node 1&gt;:80;\n    server &lt;IP: your frontend node 2&gt;:80;\n    ...\n}\n\nserver {\n    listen 80;\n    server_name &lt;your domain&gt;;\n\n    location / {\n        proxy_pass http://seafile_cluster;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        http_502 http_503 http_504;\n    }\n}\n</code></pre> </li> <li> <p>Link the configurations file to <code>sites-enabled</code> directory:</p> <pre><code>sudo ln -s /etc/nginx/sites-available/seafile-cluster /etc/nginx/sites-enabled/\n</code></pre> </li> <li> <p>Test and enable configuration</p> <pre><code>sudo nginx -t\nsudo nginx -s reload\n</code></pre> </li> </ol>"},{"location":"setup_binary/cluster_deployment/#haproxy","title":"HAProxy","text":"<p>This is a sample <code>/etc/haproxy/haproxy.cfg</code>:</p> <p>(Assume your health check port is <code>11001</code>)</p> <pre><code>global\n    log 127.0.0.1 local1 notice\n    maxconn 4096\n    user haproxy\n    group haproxy\n\ndefaults\n    log global\n    mode http\n    retries 3\n    maxconn 2000\n    timeout connect 10000\n    timeout client 300000\n    timeout server 36000000\n\nlisten seafile 0.0.0.0:80\n    mode http\n    option httplog\n    option dontlognull\n    option forwardfor\n    cookie SERVERID insert indirect nocache\n    server seafileserver01 192.168.1.165:80 check port 11001 cookie seafileserver01\n    server seafileserver02 192.168.1.200:80 check port 11001 cookie seafileserver02\n</code></pre>"},{"location":"setup_binary/cluster_deployment/#see-how-it-runs","title":"See how it runs","text":"<p>Now you should be able to test your cluster. Open https://seafile.example.com in your browser and enjoy. You can also synchronize files with Seafile clients.</p>"},{"location":"setup_binary/cluster_deployment/#the-final-configuration-of-the-front-end-nodes","title":"The final configuration of the front-end nodes","text":"<p>Here is the summary of configurations at the front-end node that related to cluster setup. (for version 7.1+)</p> <p>For seafile.conf:</p> <pre><code>[cluster]\nenabled = true\n</code></pre> <p>The <code>enabled</code> option will prevent the start of background tasks by <code>./seafile.sh start</code> in the front-end node. The tasks should be explicitly started by <code>./seafile-background-tasks.sh start</code> at the back-end node.</p> <p>For seahub_settings.py:</p> <pre><code>AVATAR_FILE_STORAGE = 'seahub.base.database_storage.DatabaseStorage'\n</code></pre> <p>For seafevents.conf:</p> <pre><code>[INDEX FILES]\nenabled = true\ninterval = 10m\nhighlight = fvh     # This configuration is for improving searching speed\nes_host = &lt;IP of background node&gt;\nes_port = 9200\n</code></pre> <p>The <code>[INDEX FILES]</code> section is needed to let the front-end node know the file search feature is enabled.</p>"},{"location":"setup_binary/cluster_deployment/#https","title":"HTTPS","text":"<p>You can engaged HTTPS in your load balance service, as you can use certificates manager (e.g., Certbot) to acquire and enable HTTPS to your Seafile cluster. You have to modify the relative URLs from the prefix <code>http://</code> to <code>https://</code> in <code>seahub_settings.py</code> and <code>.env</code>, after enabling HTTPS.</p>"},{"location":"setup_binary/cluster_deployment/#optional-deploy-seadoc-server","title":"(Optional) Deploy SeaDoc server","text":"<p>You can follow here to deploy SeaDoc server. And then modify <code>SEADOC_SERVER_URL</code> in your <code>.env</code> file</p>"},{"location":"setup_binary/https_with_nginx/","title":"Enabling HTTPS with Nginx","text":"<p>After completing the installation of Seafile Server Professional Edition, communication between the Seafile server and clients runs over (unencrypted) HTTP. While HTTP is ok for testing purposes, switching to HTTPS is imperative for production use.</p> <p>HTTPS requires a SSL certificate from a Certificate Authority (CA). Unless you already have a SSL certificate, we recommend that you get your SSL certificate from Let\u2019s Encrypt using Certbot. If you have a SSL certificate from another CA, skip the section \"Getting a Let's Encrypt certificate\".</p> <p>A second requirement is a reverse proxy supporting SSL. Nginx, a popular and resource-friendly web server and reverse proxy, is a good option.  Nginx's documentation is available at http://nginx.org/en/docs/.</p>"},{"location":"setup_binary/https_with_nginx/#setup","title":"Setup","text":"<p>The setup of Seafile using Nginx as a reverse proxy with HTTPS is demonstrated using the sample host name <code>seafile.example.com</code>. </p> <p>This manual assumes the following requirements:</p> <ul> <li>Seafile Server Community Edition/Professional Edition was set up according to the instructions in this manual</li> <li>A host name points at the IP address of the server and the server is available on port 80 and 443</li> </ul> <p>If your setup differs from thes requirements, adjust the following instructions accordingly.</p> <p>The setup proceeds in two steps: First, Nginx is installed. Second, a SSL certificate is integrated in the Nginx configuration.</p>"},{"location":"setup_binary/https_with_nginx/#installing-nginx","title":"Installing Nginx","text":"<p>Install Nginx using the package repositories:</p> <pre><code>sudo apt install nginx -y\n</code></pre> <p>After the installation, start the server and enable it so that Nginx starts at system boot:</p> <pre><code>sudo systemctl start nginx\nsudo systemctl enable nginx\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#preparing-nginx","title":"Preparing Nginx","text":"<p>Create a configuration file for seafile in <code>/etc/nginx/sites-available/</code>:</p> <pre><code>touch /etc/nginx/sites-available/seafile.conf\n</code></pre> <p>Delete the default files in <code>/etc/nginx/sites-enabled/</code> and <code>/etc/nginx/sites-available</code>: </p> <pre><code>rm /etc/nginx/sites-enabled/default\nrm /etc/nginx/sites-available/default\n</code></pre> <p>Create a symbolic link: </p> <pre><code>ln -s /etc/nginx/sites-available/seafile.conf /etc/nginx/sites-enabled/seafile.conf\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#configuring-nginx","title":"Configuring Nginx","text":"<p>Copy the following sample Nginx config file into the just created <code>seafile.conf</code> (i.e., <code>nano /etc/nginx/sites-available/seafile.conf</code>) and modify the content to fit your needs:</p> <pre><code>log_format seafileformat '$http_x_forwarded_for $remote_addr [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $upstream_response_time';\n\nserver {\n    listen 80;\n    server_name seafile.example.com;\n\n    proxy_set_header X-Forwarded-For $remote_addr;\n\n    location / {\n         proxy_pass         http://127.0.0.1:8000;\n         proxy_set_header   Host $http_host;\n         proxy_set_header   X-Real-IP $remote_addr;\n         proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n         proxy_set_header   X-Forwarded-Host $server_name;\n         proxy_read_timeout  1200s;\n\n         # used for view/edit office file via Office Online Server\n         client_max_body_size 0;\n\n         access_log      /var/log/nginx/seahub.access.log seafileformat;\n         error_log       /var/log/nginx/seahub.error.log;\n    }\n\n    location /seafhttp {\n        rewrite ^/seafhttp(.*)$ $1 break;\n        proxy_pass http://127.0.0.1:8082;\n        client_max_body_size 0;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n\n        proxy_read_timeout  36000s;\n        proxy_send_timeout  36000s;\n\n        send_timeout  36000s;\n\n        access_log      /var/log/nginx/seafhttp.access.log seafileformat;\n        error_log       /var/log/nginx/seafhttp.error.log;\n    }\n    location /media {\n        root /opt/seafile/seafile-server-latest/seahub;\n    }\n}\n</code></pre> <p>The following options must be modified in the CONF file:</p> <ul> <li>Server name (server_name)</li> </ul> <p>Optional customizable options in the seafile.conf are:</p> <ul> <li>Server listening port (<code>listen</code>) - if Seafile server should be available on a non-standard port</li> <li>Proxy pass for location <code>/</code> - if Seahub is configured to start on a different port than 8000</li> <li>Proxy pass for location <code>/seafhttp</code> - if seaf-server is configured to start on a different port than 8082</li> <li>Maximum allowed size of the client request body (<code>client_max_body_size</code>)</li> </ul> <p>The default value for <code>client_max_body_size</code> is 1M. Uploading larger files will result in an error message HTTP error code 413 (\"Request Entity Too Large\"). It is recommended to syncronize the value of client_max_body_size with the parameter <code>max_upload_size</code> in section <code>[fileserver]</code> of seafile.conf. Optionally, the value can also be set to 0 to disable this feature. Client uploads are only partly effected by this limit. With a limit of 100 MiB they can safely upload files of any size.</p> <p>Finally, make sure your seafile.conf does not contain syntax errors and restart Nginx for the configuration changes to take effect:</p> <pre><code>nginx -t\nnginx -s reload\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#getting-a-lets-encrypt-certificate","title":"Getting a Let's Encrypt certificate","text":"<p>Getting a Let's Encrypt certificate is straightforward thanks to Certbot. Certbot is a free, open source software tool for requesting, receiving, and renewing Let's Encrypt certificates.</p> <p>First, go to the Certbot website and choose your webserver and OS. </p> <p>Second, follow the detailed instructions then shown.</p> <p></p> <p>We recommend that you get just a certificate and that you modify the Nginx configuration yourself:</p> <pre><code>sudo certbot certonly --nginx\n</code></pre> <p>Follow the instructions on the screen.</p> <p>Upon successful verification, Certbot saves the certificate files in a directory named after the host name in  <code>/etc/letsencrypt/live</code>. For the host name seafile.example.com, the files are stored in <code>/etc/letsencrypt/live/seafile.example.com</code>. </p>"},{"location":"setup_binary/https_with_nginx/#modifying-nginx-configuration-file","title":"Modifying Nginx configuration file","text":"<p>Tip</p> <p>Normally, your nginx configuration can be automatically managed by a certificate manager (e.g., CertBot) after you install the certificate. If you find that your nginx is already listening on port 443 through the certificate manager after installing the certificate, you can skip this step.</p> <p>Add an  server block for port 443 and a http-to-https redirect to the <code>seafile.conf</code> configuration file in <code>/etc/nginx</code>.  </p> <p>This is a (shortened) sample configuration for the host name seafile.example.com:</p> <pre><code>log_format seafileformat '$http_x_forwarded_for $remote_addr [$time_local] \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $upstream_response_time';\n\nserver {\n    listen       80;\n    server_name  seafile.example.com;\n    rewrite ^ https://$http_host$request_uri? permanent;    # Forced redirect from HTTP to HTTPS\n\n    server_tokens off;      # Prevents the Nginx version from being displayed in the HTTP response header\n}\n\nserver {\n    listen 443 ssl;\n    ssl_certificate /etc/letsencrypt/live/seafile.example.com/fullchain.pem;    # Path to your fullchain.pem\n    ssl_certificate_key /etc/letsencrypt/live/seafile.example.com/privkey.pem;  # Path to your privkey.pem\n    server_name seafile.example.com;\n    server_tokens off;\n\n    location / {\n        proxy_pass         http://127.0.0.1:8000;\n        proxy_set_header   Host $http_host;\n        proxy_set_header   X-Real-IP $remote_addr;\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Host $server_name;\n        proxy_read_timeout 1200s;\n\n        proxy_set_header   X-Forwarded-Proto https;\n\n... # No changes beyond this point compared to the Nginx configuration without HTTPS\n</code></pre> <p>Finally, make sure your seafile.conf does not contain syntax errors and restart Nginx for the configuration changes to take effect:</p> <pre><code>nginx -t\nnginx -s reload\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#large-file-uploads","title":"Large file uploads","text":"<p>Tip for uploading very large files (&gt; 4GB): By default Nginx will buffer large request body in temp file. After the body is completely received, Nginx will send the body to the upstream server (seaf-server in our case). But it seems when file size is very large, the buffering mechanism dosen't work well. It may stop proxying the body in the middle. So if you want to support file upload larger for 4GB, we suggest you install Nginx version &gt;= 1.8.0 and add the following options to Nginx config file:</p> <pre><code>    location /seafhttp {\n        ... ...\n        proxy_request_buffering off;\n    }\n</code></pre> <p>If you have WebDAV enabled it is recommended to add the same:</p> <pre><code>    location /seafdav {\n        ... ...\n        proxy_request_buffering off;\n    }\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#modify-env","title":"Modify .env","text":"<p>Modify the following field to <code>https</code></p> <pre><code>SEAFILE_SERVER_PROTOCOL=https\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#modifying-seafileconf-optional","title":"Modifying seafile.conf (optional)","text":"<p>To improve security, the file server should only be accessible via Nginx.</p> <p>Add the following line in the <code>[fileserver]</code> block on <code>seafile.conf</code> in <code>/opt/seafile/conf</code>:</p> <pre><code>host = 127.0.0.1  ## default port 0.0.0.0\n</code></pre> <p>After his change, the file server only accepts requests from Nginx.</p>"},{"location":"setup_binary/https_with_nginx/#starting-seafile-and-seahub","title":"Starting Seafile and Seahub","text":"<p>Restart the seaf-server and Seahub for the config changes to take effect:</p> <pre><code>su seafile\ncd /opt/seafile/seafile-server-latest\n./seafile.sh restart\n./seahub.sh restart # or \"./seahub.sh start-fastcgi\" if you're using fastcgi\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#additional-modern-settings-for-nginx-optional","title":"Additional modern settings for Nginx (optional)","text":""},{"location":"setup_binary/https_with_nginx/#activating-ipv6","title":"Activating IPv6","text":"<p>Require IPv6 on server otherwise the server will not start! Also the AAAA dns record is required for IPv6 usage.</p> <pre><code>listen 443;\nlisten [::]:443;\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#activating-http2","title":"Activating HTTP2","text":"<p>Activate HTTP2 for more performance. Only available for SSL and nginx version&gt;=1.9.5. Simply add <code>http2</code>. <pre><code>listen 443 http2;\nlisten [::]:443 http2;\n</code></pre></p>"},{"location":"setup_binary/https_with_nginx/#advanced-tls-configuration-for-nginx-optional","title":"Advanced TLS configuration for Nginx (optional)","text":"<p>The TLS configuration in the sample Nginx configuration file above receives a B overall rating on SSL Labs. By modifying the TLS configuration in <code>seafile.conf</code>,  this rating can be significantly improved. </p> <p>The following sample Nginx configuration file for the host name seafile.example.com contains additional security-related directives. (Note that this sample file uses a generic path for the SSL certificate files.) Some of the directives require further steps as explained below.</p> <pre><code>    server {\n        listen       80;\n        server_name  seafile.example.com;\n        rewrite ^ https://$http_host$request_uri? permanent;    # Forced redirect from HTTP to HTTPS\n        server_tokens off;\n    }\n    server {\n        listen 443 ssl;\n        ssl_certificate /etc/ssl/cacert.pem;        # Path to your cacert.pem\n        ssl_certificate_key /etc/ssl/privkey.pem;   # Path to your privkey.pem\n        server_name seafile.example.com;\n        server_tokens off;\n\n        # HSTS for protection against man-in-the-middle-attacks\n        add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\";\n\n        # DH parameters for Diffie-Hellman key exchange\n        ssl_dhparam /etc/nginx/dhparam.pem;\n\n        # Supported protocols and ciphers for general purpose server with good security and compatability with most clients\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n        ssl_prefer_server_ciphers off;\n\n        # Supported protocols and ciphers for server when clients &gt; 5years (i.e., Windows Explorer) must be supported\n        #ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;\n        #ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA256:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA;\n        #ssl_prefer_server_ciphers on;\n\n        ssl_session_timeout 5m;\n        ssl_session_cache shared:SSL:5m;\n\n        location / {\n            proxy_pass         http://127.0.0.1:8000;\n            proxy_set_header   Host $http_host;\n            proxy_set_header   X-Real-IP $remote_addr;\n            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header   X-Forwarded-Host $server_name;\n            proxy_set_header   X-Forwarded-Proto https;\n\n            access_log      /var/log/nginx/seahub.access.log;\n            error_log       /var/log/nginx/seahub.error.log;\n\n            proxy_read_timeout  1200s;\n\n            client_max_body_size 0;\n        }\n\n        location /seafhttp {\n            rewrite ^/seafhttp(.*)$1 break;\n            proxy_pass http://127.0.0.1:8082;\n            client_max_body_size 0;\n            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n\n            proxy_read_timeout  36000s;\n            proxy_send_timeout  36000s;\n            send_timeout  36000s;\n        }\n\n        location /media {\n            root /home/user/haiwen/seafile-server-latest/seahub;\n        }\n    }\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#enabling-http-strict-transport-security","title":"Enabling HTTP Strict Transport Security","text":"<p>Enable HTTP Strict Transport Security (HSTS) to prevent man-in-the-middle-attacks by adding this directive:</p> <pre><code>add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n</code></pre> <p>HSTS instructs web browsers to automatically use HTTPS. That means, after the first visit of the HTTPS version of Seahub, the browser will only use https to access the site.</p>"},{"location":"setup_binary/https_with_nginx/#using-perfect-forward-secrecy","title":"Using Perfect Forward Secrecy","text":"<p>Enable Diffie-Hellman (DH) key-exchange. Generate DH parameters and write them in a .pem file using the following command:</p> <pre><code>openssl dhparam 2048 &gt; /etc/nginx/dhparam.pem  # Generates DH parameter of length 2048 bits\n</code></pre> <p>The generation of the the DH parameters may take some time depending on the server's processing power.</p> <p>Add the following directive in the HTTPS server block:</p> <pre><code>ssl_dhparam /etc/nginx/dhparam.pem;\n</code></pre>"},{"location":"setup_binary/https_with_nginx/#restricting-tls-protocols-and-ciphers","title":"Restricting TLS protocols and ciphers","text":"<p>Disallow the use of old TLS protocols and cipher. Mozilla provides a configuration generator for optimizing the conflicting objectives of security and compabitility. Visit https://wiki.mozilla.org/Security/Server_Side_TLS#Nginx for more Information.</p>"},{"location":"setup_binary/installation/","title":"Installation of Seafile Server Professional Edition","text":"<p>This manual explains how to deploy and run Seafile Server Professional Edition (Seafile PE) on a Linux server from a pre-built package using MySQL/MariaDB as database. The deployment has been tested for Debian/Ubuntu.</p>"},{"location":"setup_binary/installation/#requirements","title":"Requirements","text":"<p>Please refer here for system requirements about Seafile PE. In general, we recommend that you should have at least 4G RAM and a 4-core CPU (&gt; 2GHz).</p> <p>Seafile PE can be used without a paid license with up to three users. Licenses for more user can be purchased in the Seafile Customer Center or contact Seafile Sales at sales@seafile.com or one of our partners.</p>"},{"location":"setup_binary/installation/#setup","title":"Setup","text":""},{"location":"setup_binary/installation/#installing-and-preparing-the-sql-database","title":"Installing and preparing the SQL database","text":"<p>Seafile supports MySQL and MariaDB. We recommend that you use the preferred SQL database management engine included in the package repositories of your distribution.</p> <p>You can find step-by-step how-tos for installing MySQL and MariaDB in the tutorials on the Digital Ocean website.</p> <p>Seafile uses the <code>mysql_native_password</code> plugin for authentication. The versions of MySQL and MariaDB installed on CentOS 8, Debian 10, and Ubuntu 20.04 use a different authentication plugin by default. It is therefore required to change to authentication plugin to <code>mysql_native_password</code> for the root user prior to the installation of Seafile. The above mentioned tutorials explain how to do it.</p>"},{"location":"setup_binary/installation/#installing-prerequisites","title":"Installing prerequisites","text":"<p>Tip</p> <p>The standard directory <code>/opt/seafile</code> is assumed for the rest of this manual. If you decide to put Seafile in another directory, some commands need to be modified accordingly</p> <ol> <li> <p>Install cache server (e.g., Memcached)</p> <pre><code>sudo apt-get update\nsudo apt-get install -y memcached libmemcached-dev\n</code></pre> </li> <li> <p>Install Python and related libraries</p> Ubuntu 24.04Debian 13Debian 12 <p>Note</p> <p>Debian 12 and Ubuntu 24.04 are now discouraging system-wide installation of python modules with pip.  It is preferred now to install modules into a virtual environment which keeps them separate from the files installed by the system package manager, and enables different versions to be installed for different applications.  With these python virtual environments (venv for short) to work, you have to activate the venv to make the packages installed in it available to the programs you run.  That is done here with <code>source python-venv/bin/activate</code>.</p> <pre><code>sudo apt-get install -y python3 python3-dev python3-setuptools python3-pip python3-ldap python3-rados libmysqlclient-dev libmemcached-dev ldap-utils libldap2-dev python3.12-venv default-libmysqlclient-dev build-essential pkg-config\n\nmkdir /opt/seafile\ncd /opt/seafile\n\n# create the vitual environment in the python-venv directory\npython3 -m venv python-venv\n\n# activate the venv\nsource python-venv/bin/activate\n# Notice that this will usually change your prompt so you know the venv is active\n\n# install packages into the active venv with pip (sudo isn't needed because this is installing in the venv, not system-wide).\npip3 install --timeout=3600 boto3 oss2 twilio configparser \\\n    sqlalchemy==2.0.* pymysql==1.1.* jinja2 django-pylibmc pylibmc psd-tools lxml \\\n    django==5.2.* cffi==1.17.1 future==1.0.* mysqlclient==2.2.* captcha==0.7.* django_simple_captcha==0.6.* \\\n    pyjwt==2.10.* djangosaml2==1.11.* pysaml2==7.5.* pycryptodome==3.23.* python-ldap==3.4.* pillow==11.3.* pillow-heif==1.0.*\n</code></pre> <p>Note</p> <p>Debian 12 and Ubuntu 24.04 are now discouraging system-wide installation of python modules with pip.  It is preferred now to install modules into a virtual environment which keeps them separate from the files installed by the system package manager, and enables different versions to be installed for different applications.  With these python virtual environments (venv for short) to work, you have to activate the venv to make the packages installed in it available to the programs you run.  That is done here with <code>source python-venv/bin/activate</code>.</p> <pre><code>sudo apt-get install -y python3 python3-dev python3-setuptools python3-pip python3-ldap python3-rados libmariadb-dev-compat libmemcached-dev ldap-utils libldap2-dev libsasl2-dev pkg-config python3.13-venv\n\nmkdir /opt/seafile\ncd /opt/seafile\n\n# create the vitual environment in the python-venv directory\npython3 -m venv python-venv\n\n# activate the venv\nsource python-venv/bin/activate\n# Notice that this will usually change your prompt so you know the venv is active\n\n# install packages into the active venv with pip (sudo isn't needed because this is installing in the venv, not system-wide).\npip3 install --timeout=3600 boto3 oss2 twilio configparser \\\n    sqlalchemy==2.0.* pymysql==1.1.* jinja2 django-pylibmc pylibmc psd-tools lxml \\\n    django==5.2.* cffi==1.17.1 future==1.0.* mysqlclient==2.2.* captcha==0.7.* django_simple_captcha==0.6.* \\\n    pyjwt==2.10.* djangosaml2==1.11.* pysaml2==7.5.* pycryptodome==3.23.* python-ldap==3.4.* pillow==11.3.* pillow-heif==1.0.*\n</code></pre> <p>Note</p> <p>Debian 12 and Ubuntu 24.04 are now discouraging system-wide installation of python modules with pip.  It is preferred now to install modules into a virtual environment which keeps them separate from the files installed by the system package manager, and enables different versions to be installed for different applications.  With these python virtual environments (venv for short) to work, you have to activate the venv to make the packages installed in it available to the programs you run.  That is done here with <code>source python-venv/bin/activate</code>.</p> <pre><code>sudo apt-get install -y python3 python3-dev python3-setuptools python3-pip python3-ldap python3-rados libmariadb-dev-compat libmemcached-dev ldap-utils libldap2-dev libsasl2-dev pkg-config python3.11-venv \n\nmkdir /opt/seafile\ncd /opt/seafile\n\n# create the vitual environment in the python-venv directory\npython3 -m venv python-venv\n\n# activate the venv\nsource python-venv/bin/activate\n# Notice that this will usually change your prompt so you know the venv is active\n\n# install packages into the active venv with pip (sudo isn't needed because this is installing in the venv, not system-wide).\npip3 install --timeout=3600 boto3 oss2 twilio configparser \\\n    sqlalchemy==2.0.* pymysql==1.1.* jinja2 django-pylibmc pylibmc psd-tools lxml \\\n    django==5.2.* cffi==1.17.1 future==1.0.* mysqlclient==2.2.* captcha==0.7.* django_simple_captcha==0.6.* \\\n    pyjwt==2.10.* djangosaml2==1.11.* pysaml2==7.5.* pycryptodome==3.23.* python-ldap==3.4.* pillow==11.3.* pillow-heif==1.0.*\n</code></pre> </li> </ol>"},{"location":"setup_binary/installation/#creating-user-seafile","title":"Creating user seafile","text":"<p>Elasticsearch, the indexing server, cannot be run as root. More generally, it is good practice not to run applications as root. </p> <p>Create a new user and follow the instructions on the screen:</p> Ubuntu 24.04Debian 13/12 <pre><code>adduser seafile\n</code></pre> <pre><code>/usr/sbin/adduser seafile\n</code></pre> <p>Change ownership of the created directory to the new user:</p> <pre><code>chown -R seafile: /opt/seafile\n</code></pre> <p>All the following steps are done as user seafile.</p> <p>Change to user seafile:</p> <pre><code>su seafile\n</code></pre>"},{"location":"setup_binary/installation/#placing-the-seafile-pe-license","title":"Placing the Seafile PE license","text":"<p>Save the license file in Seafile's programm directory <code>/opt/seafile</code>. Make sure that the name is <code>seafile-license.txt</code>. </p> <p>If the license file has a different name or cannot be read, Seafile server will start with in trailer mode with most THREE users</p>"},{"location":"setup_binary/installation/#downloading-the-install-package","title":"Downloading the install package","text":"<p>The install packages for Seafile PE are available for download in the the Seafile Customer Center. To access the Customer Center, a  user account is necessary. The registration is free.</p> <p>Beginning with Seafile PE 7.0.17, the Seafile Customer Center provides two install packages for every version (using Seafile PE 12.0.6 as an example):</p> <ul> <li>seafile-pro-server_12.0.6_x86-64_Ubuntu.tar.gz, compiled in Ubuntu environment</li> </ul> <p>The former is suitable for installation on Ubuntu/Debian servers.</p> <p>Download the install package using wget (replace the x.x.x with the version you wish to download):</p> <pre><code># Debian/Ubuntu\nwget -O 'seafile-pro-server_x.x.x_x86-64_Ubuntu.tar.gz' 'VERSION_SPECIFIC_LINK_FROM_SEAFILE_CUSTOMER_CENTER'\n</code></pre> <p>We use Seafile version 12.0.6 as an example in the remainder of these instructions.</p>"},{"location":"setup_binary/installation/#uncompressing-the-package","title":"Uncompressing the package","text":"<p>The install package is downloaded as a compressed tarball which needs to be uncompressed.</p> <p>Uncompress the package using tar:</p> <pre><code># Debian/Ubuntu\ntar xf seafile-pro-server_12.0.6_x86-64_Ubuntu.tar.gz\n</code></pre> <p>Now you have:</p> <pre><code>$ tree -L 2 /opt/seafile\n.\n\u251c\u2500\u2500 seafile-license.txt\n\u251c\u2500\u2500 python-venv # you will not see this directory if you use ubuntu 22/debian 10\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bin\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 include\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib64 -&gt; lib\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 pyvenv.cfg\n\u251c\u2500\u2500 seafile-pro-server-12.0.6\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 check_init_admin.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index_op.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate-repo.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate-repo.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate_ldapusers.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 parse_seahub_db.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pro\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 remove-objs.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 remove-objs.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 reset-admin.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 run_index_master.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 run_index_worker.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 runtime\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-backup-cmd.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-backup-cmd.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-encrypt.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-fsck.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-fuse.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-gc.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-import.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile-background-tasks.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile-monitor.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seahub\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seahub.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 setup-seafile-mysql.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 setup-seafile-mysql.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 setup-seafile.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sql\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 upgrade\n\u2514\u2500\u2500 seafile-pro-server_12.0.6_x86-64_Ubuntu.tar.gz\n</code></pre> <p>Tip</p> <p>The names of the install packages differ for Seafile CE and Seafile PE. Using Seafile CE and Seafile PE 12.0.6 as an example, the names are as follows:</p> <ul> <li>Seafile CE: <code>seafile-server_12.0.6_x86-86.tar.gz</code>; uncompressing into folder <code>seafile-server-12.0.6</code></li> <li>Seafile PE: <code>seafile-pro-server_12.0.6_x86-86.tar.gz</code>; uncompressing into folder <code>seafile-pro-server-12.0.6</code></li> </ul>"},{"location":"setup_binary/installation/#setting-up-seafile-pro-databases","title":"Setting up Seafile Pro databases","text":"<p>The install package comes with a script that sets Seafile up for you. Specifically, the script creates the required directories and extracts all files in the right place. It can also create a MySQL user and the three databases that Seafile's components require:</p> <ul> <li>ccnet server</li> <li>seafile server</li> <li>seahub</li> </ul> <p>While ccnet server was merged into the seafile-server in Seafile 8.0, the corresponding database is still required for the time being</p> <p>Run the script as user seafile:</p> <p>Note</p> <p>For installations using python virtual environment, activate it if it isn't already active</p> <pre><code>source python-venv/bin/activate\n</code></pre> <pre><code>cd seafile-pro-server-12.0.6\n./setup-seafile-mysql.sh\n</code></pre> <p>Configure your Seafile Server by specifying the following three parameters:</p> Option Description Note server name Name of the Seafile Server 3-15 characters, only English letters, digits and underscore ('_') are allowed server's ip or domain IP address or domain name used by the Seafile Server Seafile client program will access the server using this address fileserver port TCP port used by the Seafile fileserver Default port is 8082, it is recommended to use this port and to only change it if is used by other service <p>In the next step, choose whether to create new databases for Seafile or to use existing databases. The creation of new databases requires the root password for the SQL server. </p> <p></p> <p>Note</p> <p>If you don't have the root password, you need someone who has the privileges, e.g., the database admin, to create the three databases required by Seafile, as well as a MySQL user who can access the databases. For example, to create three databases <code>ccnet_db</code> / <code>seafile_db</code> / <code>seahub_db</code> for ccnet/seafile/seahub respectively, and a MySQL user \"seafile\" to access these databases run the following SQL queries:</p> <pre><code>create database `ccnet_db` character set = 'utf8';\ncreate database `seafile_db` character set = 'utf8';\ncreate database `seahub_db` character set = 'utf8';\n\ncreate user 'seafile'@'localhost' identified by 'seafile';\n\nGRANT ALL PRIVILEGES ON `ccnet_db`.* to `seafile`@localhost;\nGRANT ALL PRIVILEGES ON `seafile_db`.* to `seafile`@localhost;\nGRANT ALL PRIVILEGES ON `seahub_db`.* to `seafile`@localhost;\n</code></pre> [1] Create new ccnet/seafile/seahub databases[2] Use existing ccnet/seafile/seahub databases <p>The script creates these databases and a MySQL user that Seafile Server will use to access them. To this effect, you need to answer these questions:</p> Question Description Note mysql server host Host address of the MySQL server Default is localhost mysql server port TCP port used by the MySQL server Default port is 3306; almost every MySQL server uses this port mysql root password Password of the MySQL root account The root password is required to create new databases and a MySQL user mysql user for Seafile MySQL user created by the script, used by Seafile's components to access the databases Default is seafile; the user is created unless it exists mysql password for Seafile user Password for the user above, written in Seafile's config files Percent sign ('%') is not allowed database name Name of the database used by ccnet Default is \"ccnet_db\", the database is created if it does not exist seafile database name Name of the database used by Seafile Default is \"seafile_db\", the database is created if it does not exist seahub database name Name of the database used by seahub Default is \"seahub_db\", the database is created if it does not exist <p>The prompts you need to answer: </p> Question Description Note mysql server host Host address of the MySQL server Default is localhost mysql server port TCP port used by MySQL server Default port is 3306; almost every MySQL server uses this port mysql user for Seafile User used by Seafile's components to access the databases The user must exists mysql password for Seafile user Password for the user above ccnet database name Name of the database used by ccnet, default is \"ccnet_db\" The database must exist seafile database name Name of the database used by Seafile, default is \"seafile_db\" The database must exist seahub dabase name Name of the database used by Seahub, default is \"seahub_db\" The database must exist <p>If the setup is successful, you see the following output:</p> <p></p> <p>The directory layout then looks as follows:</p> <pre><code>/opt/seafile\n\u251c\u2500\u2500 seafile-license.txt\n\u251c\u2500\u2500 ccnet\n\u251c\u2500\u2500 conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 gunicorn.conf.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafdav.conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafevents.conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile.conf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 seahub_settings.py\n\u251c\u2500\u2500 pro-data\n\u251c\u2500\u2500 python-venv # you will not see this directory if you use ubuntu 22/debian 10\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bin\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 include\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib64 -&gt; lib\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 pyvenv.cfg\n\u251c\u2500\u2500 seafile-data\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 library-template\n\u251c\u2500\u2500 seafile-pro-server-12.0.6\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 check_init_admin.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 index_op.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate-repo.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate-repo.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 migrate_ldapusers.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 parse_seahub_db.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 pro\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 remove-objs.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 remove-objs.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 reset-admin.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 run_index_master.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 run_index_worker.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 runtime\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-backup-cmd.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-backup-cmd.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-encrypt.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-fsck.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-fuse.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-gc.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seaf-import.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile-background-tasks.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile-monitor.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seafile.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seahub\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 seahub.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 setup-seafile-mysql.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 setup-seafile-mysql.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 setup-seafile.sh\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 sql\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 upgrade\n\u251c\u2500\u2500 seafile-pro-server_12.0.6_x86-64_Ubuntu.tar.gz\n\u251c\u2500\u2500 seafile-server-latest -&gt; seafile-pro-server-12.0.6\n\u2514\u2500\u2500 seahub-data\n    \u2514\u2500\u2500 avatars\n</code></pre> <p>The folder <code>seafile-server-latest</code> is a symbolic link to the current Seafile Server folder. When later you upgrade to a new version, the upgrade scripts update this link to point to the latest Seafile Server folder.</p>"},{"location":"setup_binary/installation/#setup-memory-cache","title":"Setup Memory Cache","text":"<p>Memory cache is mandatory for pro edition. You may use Memcached or Reids as cache server.</p> MemcachedRedis <p>Use the following commands to install memcached and corresponding libraies on your system:</p> <pre><code># on Debian/Ubuntu 18.04+\napt-get install memcached libmemcached-dev -y\npip3 install --timeout=3600 pylibmc django-pylibmc\n\nsystemctl enable --now memcached\n</code></pre> <p>Add or modify the following configuration to <code>seahub_settings.py</code>:</p> <pre><code>CACHES = {\n    'default': {\n        'BACKEND': 'django_pylibmc.memcached.PyLibMCCache',\n        'LOCATION': '127.0.0.1:11211',\n    },\n}\n</code></pre> <p>Add or modify the following configuration to <code>seafile.conf</code>:</p> <pre><code>[memcached]\nmemcached_options = --SERVER=127.0.0.1 --POOL-MIN=10 --POOL-MAX=100\n</code></pre> <p>Redis is supported since version 11.0</p> <ol> <li> <p>Install Redis with package installers in your OS.</p> </li> <li> <p>Refer to Django's documentation about using Redis cache to add Redis configurations to <code>seahub_settings.py</code>.</p> </li> <li> <p>Add or modify the following configuration to <code>seafile.conf</code>:</p> <pre><code>[redis]\nredis_host = 127.0.0.1\nredis_port = 6379\nmax_connections = 100\n</code></pre> </li> </ol>"},{"location":"setup_binary/installation/#enabling-httphttps-optional-but-recommended","title":"Enabling HTTP/HTTPS (Optional but Recommended)","text":"<p>You need at least setup HTTP to make Seafile's web interface work. This manual provides instructions for enabling HTTP/HTTPS for the two most popular web servers and reverse proxies (e.g., Nginx).</p>"},{"location":"setup_binary/installation/#create-the-env-file-in-conf-directory","title":"Create the <code>.env</code> file in <code>conf/</code> directory","text":"<pre><code>nano /opt/seafile/conf/.env\n</code></pre> <p>Tip</p> <p><code>JWT_PRIVATE_KEY</code>, A random string with a length of no less than 32 characters can be generated from:  <pre><code>pwgen -s 40 1\n</code></pre></p> <pre><code>JWT_PRIVATE_KEY=&lt;Your jwt private key&gt;\nSEAFILE_SERVER_PROTOCOL=https\nSEAFILE_SERVER_HOSTNAME=seafile.example.com\nSEAFILE_MYSQL_DB_HOST=&lt;your database host&gt;\nSEAFILE_MYSQL_DB_PORT=3306\nSEAFILE_MYSQL_DB_USER=seafile\nSEAFILE_MYSQL_DB_PASSWORD=&lt;your MySQL password&gt;\nSEAFILE_MYSQL_DB_CCNET_DB_NAME=ccnet_db\nSEAFILE_MYSQL_DB_SEAFILE_DB_NAME=seafile_db\nSEAFILE_MYSQL_DB_SEAHUB_DB_NAME=seahub_db\n</code></pre>"},{"location":"setup_binary/installation/#starting-seafile-server","title":"Starting Seafile Server","text":"<p>Run the following commands in <code>/opt/seafile/seafile-server-latest</code>:</p> <p>Note</p> <p>For installations using python virtual environment, activate it if it isn't already active</p> <pre><code>source python-venv/bin/activate\n</code></pre> <pre><code>su seafile\n./seafile.sh start # Start Seafile service\n./seahub.sh start  # Start seahub website, port defaults to 127.0.0.1:8000\n</code></pre> <p>Success</p> <p>The first time you start Seahub, the script prompts you to create an admin account for your Seafile Server. Enter the email address of the admin user followed by the password, i.e.:</p> <pre><code>What is the email for the admin account?\n[ admin email ]  &lt;please input your admin's email&gt;\n\nWhat is the password for the admin account?\n[ admin password ] &lt;please input your admin's password&gt;\n\nEnter the password again:\n[ admin password again ] &lt;please input your admin's password again&gt;\n</code></pre> <p>Now you can access Seafile via the web interface at the host address (e.g., https://seafile.example.com).</p>"},{"location":"setup_binary/installation/#enabling-full-text-search","title":"Enabling full text search","text":"<p>Seafile uses the indexing server ElasticSearch to enable full text search.</p>"},{"location":"setup_binary/installation/#deploying-elasticsearch","title":"Deploying ElasticSearch","text":"<p>Our recommendation for deploying ElasticSearch is using Docker. Detailed information about installing Docker on various Linux distributions is available at Docker Docs.</p> <p>Seafile PE 9.0 only supports ElasticSearch 7.x. Seafile PE 10.0, 11.0, 12.0 only supports ElasticSearch 8.x.</p> <p>We use ElasticSearch version 8.15.0 as an example in this section. Version 8.15.0 and newer version have been successfully tested with Seafile.</p> <p>Pull the Docker image: <pre><code>sudo docker pull elasticsearch:8.15.0\n</code></pre></p> <p>Create a folder for persistent data created by ElasticSearch and change its permission: <pre><code>sudo mkdir -p /opt/seafile-elasticsearch/data  &amp;&amp; chmod -R 777 /opt/seafile-elasticsearch/data/\n</code></pre></p> <p>Now start the ElasticSearch container using the docker run command: <pre><code>sudo docker run -d \\\n--name es \\\n-p 9200:9200 \\\n-e \"discovery.type=single-node\" -e \"bootstrap.memory_lock=true\" \\\n-e \"ES_JAVA_OPTS=-Xms2g -Xmx2g\" -e \"xpack.security.enabled=false\" \\\n--restart=always \\\n-v /opt/seafile-elasticsearch/data:/usr/share/elasticsearch/data \\\n-d elasticsearch:8.15.0\n</code></pre></p> <p>Security notice</p> <p>We sincerely thank Mohammed Adel of Safe Decision Co., for the suggestion of this notice.</p> <p>By default, Elasticsearch will only listen on <code>127.0.0.1</code>, but this rule may become invalid after Docker exposes the service port,  which will make your Elasticsearch service vulnerable to attackers accessing and extracting sensitive data due to exposure to the external network. We recommend that you manually configure the Docker firewall, such as</p> <pre><code>sudo iptables -A INPUT -p tcp -s &lt;your seafile server ip&gt; --dport 9200 -j ACCEPT\nsudo iptables -A INPUT -p tcp --dport 9200 -j DROP\n</code></pre> <p>The above command will only allow the host where your Seafile service is located to connect to Elasticsearch, and other addresses will be blocked. If you deploy Elasticsearch based on binary packages, you need to refer to the official document to set the address that Elasticsearch binds to.</p>"},{"location":"setup_binary/installation/#modifying-seafevents","title":"Modifying seafevents","text":"<p>Add the following configuration to <code>seafevents.conf</code>:</p> <pre><code>[INDEX FILES]\nes_host = &lt;your elasticsearch server's IP, e.g., 127.0.0.1&gt;    # IP address of ElasticSearch host\nes_port = 9200   # port of ElasticSearch host\n</code></pre> <p>Finally, restart Seafile:</p> <pre><code>su seafile\n./seafile.sh restart  &amp;&amp; ./seahub.sh restart \n</code></pre>"},{"location":"setup_binary/outline/","title":"Deploy Seafile Pro Edition","text":"<p>Binary-based community edition Seafile is not supported since version 13.0</p> <p>Since version 13.0, binary-based deployment for community edition is no longer supported.</p> <p>There are two ways to deploy Seafile Pro Edition. Since version 8.0, the recommend way to install Seafile Pro Edition is using Docker.</p> <ul> <li>Method 1 (Recommend): Deploy Seafile with Docker</li> <li>Method 2: Download and Setup Seafile Professional Server Step by Step</li> </ul>"},{"location":"setup_binary/outline/#migration-from-community-edition","title":"Migration from community edition","text":"<ul> <li>Migrate from Seafile Community edition</li> </ul>"},{"location":"setup_binary/outline/#s3-storage-backends","title":"S3 Storage Backends","text":"<ul> <li>Setup Seafile Professional Server With S3</li> <li>Setup Seafile Professional Server With OpenStack Swift</li> <li>Data migration between different backends</li> <li>Using multiple storage backends</li> </ul>"},{"location":"setup_binary/outline/#cluster","title":"Cluster","text":"<ul> <li>Deploy seafile servers in a cluster</li> </ul>"},{"location":"setup_binary/start_seafile_at_system_bootup/","title":"Start Seafile at System Bootup","text":""},{"location":"setup_binary/start_seafile_at_system_bootup/#for-systems-running-systemd-and-python-virtual-environments","title":"For systems running systemd and python virtual environments","text":"<p>For example Debian 12</p> <p>Create systemd service files, change ${seafile_dir} to your seafile installation location and seafile to user, who runs seafile (if appropriate). Then you need to reload systemd's daemons: systemctl daemon-reload.</p> <p>Firstly, you should create a script to activate the python virtual environment, which goes in the ${seafile_dir} directory.  Put another way, it does not go in \"seafile-server-latest\", but the directory above that.  Throughout this manual the examples use /opt/seafile for this directory, but you might have chosen to use a different directory.</p> <pre><code>sudo vim /opt/seafile/run_with_venv.sh\n</code></pre> <p>The content of the file is:</p> <p><pre><code>#!/bin/bash\n# Activate the python virtual environment (venv) before starting one of the seafile scripts\n\ndir_name=\"$(dirname $0)\"\nsource \"${dir_name}/python-venv/bin/activate\"\nscript=\"$1\"\nshift 1\n\necho \"${dir_name}/seafile-server-latest/${script}\" \"$@\"\n\"${dir_name}/seafile-server-latest/${script}\" \"$@\"\n</code></pre> make this script executable <pre><code>sudo chmod 755 /opt/seafile/run_with_venv.sh\n</code></pre></p>"},{"location":"setup_binary/start_seafile_at_system_bootup/#seafile-component","title":"Seafile component","text":"<pre><code>sudo vim /etc/systemd/system/seafile.service\n</code></pre> <p>The content of the file is:</p> <pre><code>[Unit]\nDescription=Seafile\n# add mysql.service or postgresql.service depending on your database to the line below\nAfter=network.target\n\n[Service]\nType=forking\nExecStart=bash ${seafile_dir}/run_with_venv.sh seafile.sh start\nExecStop=bash ${seafile_dir}/seafile-server-latest/seafile.sh stop\nLimitNOFILE=infinity\nUser=seafile\nGroup=seafile\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"setup_binary/start_seafile_at_system_bootup/#seahub-component","title":"Seahub component","text":"<pre><code>sudo vim /etc/systemd/system/seahub.service\n</code></pre> <p>The content of the file is:</p> <pre><code>[Unit]\nDescription=Seafile hub\nAfter=network.target seafile.service\n\n[Service]\nType=forking\nExecStart=bash ${seafile_dir}/run_with_venv.sh seahub.sh start\nExecStop=bash ${seafile_dir}/seafile-server-latest/seahub.sh stop\nUser=seafile\nGroup=seafile\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"setup_binary/start_seafile_at_system_bootup/#for-systems-running-systemd-without-python-virtual-environment","title":"For systems running systemd without python virtual environment","text":"<p>For example Debian 8 through Debian 11, Linux Ubuntu 15.04 and newer</p> <p>Create systemd service files, change ${seafile_dir} to your seafile installation location and seafile to user, who runs seafile (if appropriate). Then you need to reload systemd's daemons: systemctl daemon-reload.</p>"},{"location":"setup_binary/start_seafile_at_system_bootup/#seafile-component_1","title":"Seafile component","text":"<pre><code>sudo vim /etc/systemd/system/seafile.service\n</code></pre> <p>The content of the file is:</p> <pre><code>[Unit]\nDescription=Seafile\n# add mysql.service or postgresql.service depending on your database to the line below\nAfter=network.target\n\n[Service]\nType=forking\nExecStart=${seafile_dir}/seafile-server-latest/seafile.sh start\nExecStop=${seafile_dir}/seafile-server-latest/seafile.sh stop\nLimitNOFILE=infinity\nUser=seafile\nGroup=seafile\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"setup_binary/start_seafile_at_system_bootup/#seahub-component_1","title":"Seahub component","text":"<p>Create systemd service file /etc/systemd/system/seahub.service</p> <pre><code>sudo vim /etc/systemd/system/seahub.service\n</code></pre> <p>The content of the file is:</p> <pre><code>[Unit]\nDescription=Seafile hub\nAfter=network.target seafile.service\n\n[Service]\nType=forking\nExecStart=${seafile_dir}/seafile-server-latest/seahub.sh start\nExecStop=${seafile_dir}/seafile-server-latest/seahub.sh stop\nUser=seafile\nGroup=seafile\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"setup_binary/start_seafile_at_system_bootup/#seafile-cli-client-optional","title":"Seafile cli client (optional)","text":"<p>Create systemd service file /etc/systemd/system/seafile-client.service </p> <p>You need to create this service file only if you have seafile console client and you want to run it on system boot.</p> <pre><code>sudo vim /etc/systemd/system/seafile-client.service\n</code></pre> <p>The content of the file is:</p> <pre><code>[Unit]\nDescription=Seafile client\n# Uncomment the next line you are running seafile client on the same computer as server\n# After=seafile.service\n# Or the next one in other case\n# After=network.target\n\n[Service]\nType=oneshot\nExecStart=/usr/bin/seaf-cli start\nExecStop=/usr/bin/seaf-cli stop\nRemainAfterExit=yes\nUser=seafile\nGroup=seafile\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>"},{"location":"setup_binary/start_seafile_at_system_bootup/#enable-service-start-on-system-boot","title":"Enable service start on system boot","text":"<pre><code>sudo systemctl enable seafile.service\nsudo systemctl enable seahub.service\nsudo systemctl enable seafile-client.service   # optional\n</code></pre>"},{"location":"setup_binary/using_logrotate/","title":"Set up logrotate for server","text":""},{"location":"setup_binary/using_logrotate/#how-it-works","title":"How it works","text":"<p>seaf-server support reopenning logfiles by receiving a <code>SIGUR1</code> signal.</p> <p>This feature is very useful when you need cut logfiles while you don't want to shutdown the server. All you need to do now is cutting the logfile on the fly.</p>"},{"location":"setup_binary/using_logrotate/#default-logrotate-configuration-directory","title":"Default logrotate configuration directory","text":"<p>For Debian, the default directory for logrotate should be <code>/etc/logrotate.d/</code></p>"},{"location":"setup_binary/using_logrotate/#sample-configuration","title":"Sample configuration","text":"<p>Assuming your seaf-server's logfile is setup to <code>/opt/seafile/logs/seafile.log</code> and your seaf-server's pidfile is setup to <code>/opt/seafile/pids/seaf-server.pid</code>:</p> <p>The configuration for logrotate could be like this:</p> <pre><code>/opt/seafile/logs/seafile.log\n/opt/seafile/logs/seahub.log\n/opt/seafile/logs/seafdav.log\n/opt/seafile/logs/fileserver-access.log\n/opt/seafile/logs/fileserver-error.log\n/opt/seafile/logs/fileserver.log\n/opt/seafile/logs/file_updates_sender.log\n/opt/seafile/logs/repo_old_file_auto_del_scan.log\n/opt/seafile/logs/seahub_email_sender.log\n/opt/seafile/logs/index.log\n{\n        daily\n        missingok\n        rotate 7\n        # compress\n        # delaycompress\n        dateext\n        dateformat .%Y-%m-%d\n        notifempty\n        # create 644 root root\n        sharedscripts\n        postrotate\n                if [ -f /opt/seafile/pids/seaf-server.pid ]; then\n                        kill -USR1 `cat /opt/seafile/pids/seaf-server.pid`\n                fi\n\n                if [ -f /opt/seafile/pids/fileserver.pid ]; then\n                        kill -USR1 `cat /opt/seafile/pids/fileserver.pid`\n                fi\n\n                if [ -f /opt/seafile/pids/seahub.pid ]; then\n                        kill -HUP `cat /opt/seafile/pids/seahub.pid`\n                fi\n\n                if [ -f /opt/seafile/pids/seafdav.pid ]; then\n                        kill -HUP `cat /opt/seafile/pids/seafdav.pid`\n                fi\n\n                find /opt/seafile/logs/ -mtime +7 -name \"*.log*\" -exec rm -f {} \\;\n        endscript\n}\n</code></pre> <p>You can save this file, in Debian for example, at <code>/etc/logrotate.d/seafile</code>.</p>"},{"location":"upgrade/upgrade/","title":"Upgrade manual","text":"<p>There are three types of upgrade, i.e., major version upgrade, minor version upgrade and maintenance version upgrade. This page contains general instructions for the three types of upgrade.</p> <ul> <li>After upgrading, you may need to clean seahub cache if it doesn't behave as expect.</li> <li>If you are using a Docker based deployment, please read upgrade a Seafile docker instance</li> <li>If you are running a cluster, please read upgrade a Seafile cluster.</li> <li>If you are using a binary package based deployment, please read instructions below.</li> </ul>"},{"location":"upgrade/upgrade/#special-upgrade-notes","title":"Special upgrade notes","text":"<p>Please check the upgrade notes for any special configuration or changes before/while upgrading.</p> <ul> <li>Upgrade notes for 13.0.x</li> <li>Upgrade notes for 12.0.x</li> <li>Upgrade notes for 11.0.x</li> <li>Upgrade notes for 10.0.x</li> <li>Upgrade notes for 9.0.x</li> </ul>"},{"location":"upgrade/upgrade/#upgrade-a-binary-package-based-deployment","title":"Upgrade a binary package based deployment","text":""},{"location":"upgrade/upgrade/#major-version-upgrade-eg-from-5xx-to-6yy","title":"Major version upgrade (e.g. from 5.x.x to 6.y.y)","text":"<p>Suppose you are using version 5.1.0 and like to upgrade to version 6.1.0. First download and extract the new version. You should have a directory layout similar to this:</p> <pre><code>seafile\n   -- seafile-server-5.1.0\n   -- seafile-server-6.1.0\n   -- ccnet\n   -- seafile-data\n</code></pre> <p>Now upgrade to version 6.1.0.</p> <p>Shutdown Seafile server if it's running</p> <pre><code>cd seafile/seafile-server-latest\n./seahub.sh stop\n./seafile.sh stop\n# or via service\n/etc/init.d/seafile-server stop\n</code></pre> <p>Check the upgrade scripts in seafile-server-6.1.0 directory.</p> <pre><code>cd seafile/seafile-server-6.1.0\nls upgrade/upgrade_*\n</code></pre> <p>You will get a list of upgrade files:</p> <pre><code>...\nupgrade_5.0_5.1.sh\nupgrade_5.1_6.0.sh\nupgrade_6.0_6.1.sh\n</code></pre> <p>Start from your current version, run the script(s one by one)</p> <pre><code>upgrade/upgrade_5.1_6.0.sh\nupgrade/upgrade_6.0_6.1.sh\n</code></pre> <p>Start Seafile server</p> <pre><code>cd seafile/seafile-server-latest/\n./seafile.sh start\n./seahub.sh start # or \"./seahub.sh start-fastcgi\" if you're using fastcgi\n# or via service\n/etc/init.d/seafile-server start\n</code></pre> <p>If the new version works fine, the old version can be removed</p> <pre><code>rm -rf seafile-server-5.1.0/\n</code></pre>"},{"location":"upgrade/upgrade/#minor-version-upgrade-eg-from-61x-to-62y","title":"Minor version upgrade (e.g. from 6.1.x to 6.2.y)","text":"<p>Suppose you are using version 6.1.0 and like to upgrade to version 6.2.0. First download and extract the new version. You should have a directory layout similar to this:</p> <pre><code>seafile\n   -- seafile-server-6.1.0\n   -- seafile-server-6.2.0\n   -- ccnet\n   -- seafile-data\n</code></pre> <p>Now upgrade to version 6.2.0.</p> <ol> <li>Shutdown Seafile server if it's running</li> </ol> <pre><code>cd seafile/seafile-server-latest\n./seahub.sh stop\n./seafile.sh stop\n# or via service\n/etc/init.d/seafile-server stop\n</code></pre> <p>Check the upgrade scripts in seafile-server-6.2.0 directory.</p> <pre><code>cd seafile/seafile-server-6.2.0\nls upgrade/upgrade_*\n</code></pre> <p>You will get a list of upgrade files:</p> <pre><code>...\nupgrade/upgrade_5.1_6.0.sh\nupgrade/upgrade_6.0_6.1.sh\nupgrade/upgrade_6.1_6.2.sh\n</code></pre> <p>Start from your current version, run the script(s one by one)</p> <pre><code>upgrade/upgrade_6.1_6.2.sh\n</code></pre> <p>Start Seafile server</p> <pre><code>./seafile.sh start\n./seahub.sh start\n# or via service\n/etc/init.d/seafile-server start\n</code></pre> <p>If the new version works, the old version can be removed</p> <pre><code>rm -rf seafile-server-6.1.0/\n</code></pre>"},{"location":"upgrade/upgrade/#maintenance-version-upgrade-eg-from-622-to-623","title":"Maintenance version upgrade (e.g. from 6.2.2 to 6.2.3)","text":"<p>A maintenance upgrade is for example an upgrade from 6.2.2 to 6.2.3.</p> <ol> <li>Shutdown Seafile server if it's running</li> <li> <p>For this type of upgrade, you only need to update the symbolic links (for avatar and a few other folders).     A script to perform a minor upgrade is provided with Seafile server (for history reasons, the script is called <code>minor-upgrade.sh</code>):</p> <pre><code>cd seafile-server-6.2.3/upgrade/ &amp;&amp; ./minor-upgrade.sh\n</code></pre> </li> <li> <p>Start Seafile</p> </li> <li> <p>If the new version works, the old version can be removed</p> <pre><code>rm -rf seafile-server-6.2.2/\n</code></pre> </li> </ol>"},{"location":"upgrade/upgrade_a_cluster/","title":"Upgrade a Seafile cluster","text":""},{"location":"upgrade/upgrade_a_cluster/#major-and-minor-version-upgrade","title":"Major and minor version upgrade","text":"<p>Seafile adds new features in major and minor versions. It is likely that some database tables need to be modified or the search index need to be updated. In general, upgrading a cluster contains the following steps:</p> <ol> <li>Update Seafile image</li> <li>Upgrade the database</li> <li>Update configuration files at each node</li> <li>Update search index in the backend node</li> </ol> <p>In general, to upgrade a cluster, you need:</p> <ol> <li>Download the new image, stop the old docker container, modify the Seafile image version in docker-compose.yml to the new version. Start with docker compose up.</li> <li>Run the upgrade script in container (for example, <code>/opt/seafile/seafile-server-latest/upgrade/upgrade_x_x_x_x.sh</code>) in one frontend node</li> <li>Update configuration files at each node according to the documentation for each version</li> <li>Delete old search index in the backend node if needed</li> </ol>"},{"location":"upgrade/upgrade_a_cluster/#upgrade-a-cluster-from-seafile-12-to-13","title":"Upgrade a cluster from Seafile 12 to 13","text":""},{"location":"upgrade/upgrade_a_cluster/#step-1-stop-the-services","title":"Step 1) Stop the services","text":"<p>Before upgrading, please shutdown you Seafile server</p> <pre><code>docker compose down\n</code></pre>"},{"location":"upgrade/upgrade_a_cluster/#step-2-download-the-newest-seafile-serveryml-file","title":"Step 2) Download the newest <code>seafile-server.yml</code> file","text":"<p>Before downloading the newest <code>seafile-server.yml</code>, please backup your original one:</p> <pre><code>mv seafile-server.yml seafile-server.yml.bak\n</code></pre> <p>Then download the new <code>seafile-server.yml</code> according to the following commands:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/cluster/seafile-server.yml\n</code></pre>"},{"location":"upgrade/upgrade_a_cluster/#step-3-modify-env-update-image-version-and-some-configurations","title":"Step 3) Modify <code>.env</code>, update image version and some configurations","text":""},{"location":"upgrade/upgrade_a_cluster/#step-31-update-image-version-to-seafile-13","title":"Step 3.1) Update image version to Seafile 13","text":"<pre><code>SEAFILE_IMAGE=seafileltd/seafile-pro-mc:13.0-latest\n</code></pre>"},{"location":"upgrade/upgrade_a_cluster/#step-32-add-configurations-for-cache","title":"Step 3.2) Add configurations for cache","text":"<p>From Seafile 13, the configurations of cache can be set via environment variables directly (you can define it in the <code>.env</code>). What's more, the Redis will be recommended as the primary cache server for supporting some new features (please refer the upgradte notes, you can also refer to more details about Redis in Seafile Docker here).</p> RedisMemcached <pre><code>## Cache\nCACHE_PROVIDER=redis\n\n### Redis\nREDIS_HOST=redis\nREDIS_PORT=6379\nREDIS_PASSWORD=\n</code></pre> <pre><code>## Cache\nCACHE_PROVIDER=memcached\n\n### Memcached\nMEMCACHED_HOST=memcached\nMEMCACHED_PORT=11211\n</code></pre>"},{"location":"upgrade/upgrade_a_cluster/#step-33-add-configurations-for-database","title":"Step 3.3) Add configurations for database","text":"<pre><code>SEAFILE_MYSQL_DB_HOST=db\nSEAFILE_MYSQL_DB_USER=seafile\nSEAFILE_MYSQL_DB_PASSWORD=PASSWORD\nSEAFILE_MYSQL_DB_CCNET_DB_NAME=ccnet_db\nSEAFILE_MYSQL_DB_SEAFILE_DB_NAME=seafile_db\nSEAFILE_MYSQL_DB_SEAHUB_DB_NAME=seahub_db\n</code></pre>"},{"location":"upgrade/upgrade_a_cluster/#step-34-add-configurations-for-storage-backend","title":"Step 3.4) Add configurations for storage backend","text":"<p>Seafile 13.0 add a new environment <code>SEAF_SERVER_STORAGE_TYPE</code> to determine the storage backend of seaf-server component. You can delete the variable or set it to empty (<code>SEAF_SERVER_STORAGE_TYPE=</code>) to use the old way, i.e., determining the storage backend from seafile.conf.</p> Local disk (default)S3 backendMultiple storage backendsUse the configuration in <code>seafile.conf</code> <p>Set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>disk</code> (default value):</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=disk\n</code></pre> <p>Set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>s3</code>, and add your s3 configurations:</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=s3\n\nS3_COMMIT_BUCKET=&lt;your commit bucket name&gt;\nS3_FS_BUCKET=&lt;your fs bucket name&gt;\nS3_BLOCK_BUCKET=&lt;your block bucket name&gt;\nS3_KEY_ID=&lt;your-key-id&gt;\nS3_SECRET_KEY=&lt;your-secret-key&gt;\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=false\nS3_AWS_REGION=us-east-1\nS3_HOST=\nS3_USE_HTTPS=true\nS3_SSE_C_KEY=\n</code></pre> <p>Set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>multiple</code>. In this case, you don't need to change the storage configuration in <code>seafile.conf</code>.</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=multiple\n</code></pre> <p>If you would like to use the storage configuration in <code>seafile.conf</code>, please remove default value of <code>SEAF_SERVER_STORAGE_TYPE</code> in <code>.env</code>:</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=\n</code></pre>"},{"location":"upgrade/upgrade_a_cluster/#step-4-remove-obsolete-configurations","title":"Step 4) Remove obsolete configurations","text":"<p>Although the configurations in environment (i.e., <code>.env</code>) have higher priority than the configurations in config files, we recommend that you remove or modify the cache configuration in the following files to avoid ambiguity:</p> <ol> <li> <p>Backup the old configuration files:</p> <pre><code>cp /opt/seafile/shared/seafile/conf/seafile.conf /opt/seafile/shared/seafile/conf/seafile.conf.bak\ncp /opt/seafile/shared/seafile/conf/seahub_settings.py /opt/seafile/shared/seafile/conf/seahub_settings.py.bak\n</code></pre> </li> <li> <p>Clean up redundant configuration items in the configuration files:</p> <ul> <li>Open <code>/opt/seafile/shared/seafile/conf/seafile.conf</code> and remove the entire <code>[memcached]</code>, <code>[database]</code>, <code>[commit_object_backend]</code>, <code>[fs_object_backend]</code>, <code>[notification]</code> and <code>[block_backend]</code> if above sections have correctly specified in <code>.env</code>.</li> <li>Open <code>/opt/seafile/shared/seafile/conf/seahub_settings.py</code> and remove the entire blocks for <code>DATABASES = {...}</code> and <code>CAHCES = {...}</code></li> </ul> <p>In the most cases, the <code>seafile.conf</code> only include the listen port <code>8082</code> of Seafile file server.</p> </li> </ol>"},{"location":"upgrade/upgrade_a_cluster/#step-5-start-the-seafile-in-a-node","title":"Step 5) Start the Seafile in a node","text":"<p>Note</p> <p>According to this upgrade document, a frontend service will be started here. If you plan to use this node as a backend node, you need to modify this item in <code>.env</code> and set it to <code>backend</code>:</p> <pre><code>CLUSTER_MODE=backend\n</code></pre> <pre><code>docker compose up -d\n</code></pre>"},{"location":"upgrade/upgrade_a_cluster/#step-6-upgrade-seafile","title":"Step 6) Upgrade Seafile","text":"<pre><code>docker exec -it seafile bash\n# enter the container `seafile`\n\n# stop servers\ncd /opt/seafile/seafile-server-latest\n./seafile.sh stop\n./seahub.sh stop\n\n# upgrade seafile\ncd upgrade\n./upgrade_12.0_13.0.sh\n</code></pre> <p>Success</p> <p>After upgrading the Seafile, you can see the following messages in your console:</p> <pre><code>Updating seafile/seahub database ...\n\n[INFO] You are using MySQL\n[INFO] updating seafile database...\n[INFO] updating seahub database...\n[INFO] updating seafevents database...\nDone\n\nmigrating avatars ...\n\nDone\n\nupdating /opt/seafile/seafile-server-latest symbolic link to /opt/seafile/seafile-pro-server-13.0.11 ...\n\n\n\n-----------------------------------------------------------------\nUpgraded your seafile server successfully.\n-----------------------------------------------------------------\n</code></pre> <p>Then you can exit the container by <code>exit</code></p>"},{"location":"upgrade/upgrade_a_cluster/#step-7-restart-current-node","title":"Step 7) Restart current node","text":"<pre><code>docker compose down\ndocker compose up -d\n</code></pre> <p>Tip</p> <ul> <li>You can use <code>docker logs -f seafile</code> to check whether the current node service is running normally</li> </ul>"},{"location":"upgrade/upgrade_a_cluster/#step-8-operations-for-other-nodes","title":"Step 8) Operations for other nodes","text":"<ul> <li> <p>Download the newest seafile-sever.yml file and modify <code>.env</code> similar to the first node (for backend node, you should set <code>CLUSTER_MODE=backend</code>)</p> </li> <li> <p>Start the Seafile server:      <pre><code>docker compose up -d\n</code></pre></p> </li> </ul>"},{"location":"upgrade/upgrade_a_cluster/#upgrade-a-cluster-from-seafile-11-to-12","title":"Upgrade a cluster from Seafile 11 to 12","text":"<ol> <li> <p>Stop the seafile service in all nodes</p> <pre><code>docker compose down\n</code></pre> </li> <li> <p>Download the docker-compose files for Seafile 12</p> <pre><code>wget -O .env https://manual.seafile.com/13.0/repo/docker/cluster/env\nwget https://manual.seafile.com/13.0/repo/docker/cluster/seafile-server.yml\n</code></pre> </li> <li> <p>Modify <code>.env</code>:</p> <ul> <li> <p>Generate a JWT key</p> <pre><code>pwgen -s 40 1\n\n# e.g., EkosWcXonPCrpPE9CFsnyQLLPqoPhSJZaqA3JMFw\n</code></pre> </li> <li> <p>Fill up the following field according to your configurations using in Seafile 11:</p> <pre><code>SEAFILE_SERVER_HOSTNAME=&lt;your loadbalance's host&gt;\nSEAFILE_SERVER_PROTOCOL=https # or http\nSEAFILE_MYSQL_DB_HOST=&lt;your mysql host&gt;\nSEAFILE_MYSQL_DB_USER=seafile # if you don't use `seafile` as your Seafile server's account, please correct it\nSEAFILE_MYSQL_DB_PASSWORD=&lt;your mysql password for user `seafile`&gt;\nJWT_PRIVATE_KEY=&lt;your JWT key generated in Sec. 3.1&gt;\n</code></pre> <p>Remove the variables using in Cluster initialization</p> <p>Since Seafile has been initialized in Seafile 11, the variables related to Seafile cluster initialization can be removed from <code>.env</code>:</p> <ul> <li>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</li> <li>CLUSTER_INIT_MODE</li> <li>CLUSTER_INIT_MEMCACHED_HOST</li> <li>CLUSTER_INIT_ES_HOST</li> <li>CLUSTER_INIT_ES_PORT</li> <li>INIT_S3_STORAGE_BACKEND_CONFIG</li> <li>INIT_S3_COMMIT_BUCKET</li> <li>INIT_S3_FS_BUCKET</li> <li>INIT_S3_BLOCK_BUCKET</li> <li>INIT_S3_KEY_ID</li> <li>INIT_S3_USE_V4_SIGNATURE</li> <li>INIT_S3_SECRET_KEY</li> <li>INIT_S3_AWS_REGION</li> <li>INIT_S3_HOST</li> <li>INIT_S3_USE_HTTPS</li> </ul> </li> </ul> </li> <li> <p>Start the Seafile in a node</p> <p>Note</p> <p>According to this upgrade document, a frontend service will be started here. If you plan to use this node as a backend node, you need to modify this item in <code>.env</code> and set it to <code>backend</code>:</p> <pre><code>CLUSTER_MODE=backend\n</code></pre> <pre><code>docker compose up -d\n</code></pre> </li> <li> <p>Upgrade Seafile</p> <pre><code>docker exec -it seafile bash\n# enter the container `seafile`\n\n# stop servers\ncd /opt/seafile/seafile-server-latest\n./seafile.sh stop\n./seahub.sh stop\n\n# upgrade seafile\ncd upgrade\n./upgrade_11.0_12.0.sh\n</code></pre> <p>Success</p> <p>After upgrading the Seafile, you can see the following messages in your console:</p> <pre><code>Updating seafile/seahub database ...\n\n[INFO] You are using MySQL\n[INFO] updating seafile database...\n[INFO] updating seahub database...\n[INFO] updating seafevents database...\nDone\n\nmigrating avatars ...\n\nDone\n\nupdating /opt/seafile/seafile-server-latest symbolic link to /opt/seafile/seafile-pro-server-12.0.6 ...\n\n\n\n-----------------------------------------------------------------\nUpgraded your seafile server successfully.\n-----------------------------------------------------------------\n</code></pre> <p>Then you can exit the container by <code>exit</code></p> </li> <li> <p>Restart current node</p> <pre><code>    docker compose down\n    docker compose up -d\n</code></pre> <p>Tip</p> <ul> <li>You can use <code>docker logs -f seafile</code> to check whether the current node service is running normally</li> </ul> </li> <li> <p>Operations for other nodes</p> <ul> <li> <p>Download and modify <code>.env</code> similar to the first node (for backend node, you should set <code>CLUSTER_MODE=backend</code>)</p> </li> <li> <p>Start the Seafile server:     <pre><code>docker compose up -d\n</code></pre></p> </li> </ul> </li> </ol>"},{"location":"upgrade/upgrade_a_cluster_binary/","title":"Upgrade a Seafile cluster (binary)","text":""},{"location":"upgrade/upgrade_a_cluster_binary/#major-and-minor-version-upgrade","title":"Major and minor version upgrade","text":"<p>Seafile adds new features in major and minor versions. It is likely that some database tables need to be modified or the search index need to be updated. In general, upgrading a cluster contains the following steps:</p> <ol> <li>Upgrade the database</li> <li>Update symbolic link at frontend and backend nodes to point to the newest version</li> <li>Update configuration files at each node</li> <li>Update search index in the backend node</li> </ol> <p>In general, to upgrade a cluster, you need:</p> <ol> <li>Run the upgrade script (for example, ./upgrade/upgrade_4_0_4_1.sh) in one frontend node</li> <li>Run the minor upgrade script (./upgrade/minor_upgrade.sh) in all other nodes to update symbolic link</li> <li>Update configuration files at each node according to the documentation for each version</li> <li>Delete old search index in the backend node if needed</li> </ol>"},{"location":"upgrade/upgrade_a_cluster_binary/#maintanence-upgrade","title":"Maintanence upgrade","text":"<p>Doing maintanence upgrading is simple, you only need to run the script <code>./upgrade/minor_upgrade.sh</code> at each node to update the symbolic link.</p>"},{"location":"upgrade/upgrade_a_cluster_binary/#upgrade-a-cluster-from-seafile-11-to-12","title":"Upgrade a cluster from Seafile 11 to 12","text":"<p>Clean Database</p> <p>If you have a large number of <code>Activity</code> in MySQL, clear this table first Clean Database. Otherwise, the database upgrade will take a long time.</p> <ol> <li> <p>Stop Seafile server</p> <p>Note</p> <p>For installations using python virtual environment, activate it if it isn't already active</p> <pre><code>source python-venv/bin/activate\n</code></pre> Frontend nodeBackend node <pre><code>cd /opt/seafile/seafile-server-latest\nsu seafile\n./seafile.sh stop\n./seahub.sh stop\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\nsu seafile\n./seafile.sh stop\n./seafile-background-tasks.sh stop\n</code></pre> </li> <li> <p>Install new Python libraries</p> </li> <li> <p>Download and uncompress the package</p> </li> <li> <p>Run the upgrade script in a single node</p> <pre><code>seafile-pro-server-12.x.x/upgrade/upgrade_11.0_12.0.sh\n</code></pre> </li> <li> <p>Follow here to create the <code>.env</code> file in <code>conf/</code> directory</p> </li> <li> <p>Start Seafile server</p> Frontend nodeBackend node <pre><code>cd /opt/seafile/seafile-server-latest\nsu seafile\n./seafile.sh start\n./seahub.sh start\n</code></pre> <pre><code>cd /opt/seafile/seafile-server-latest\nsu seafile\n./seafile.sh start\n./seafile-background-tasks.sh start\n</code></pre> </li> <li> <p>(Optional) Refer here to upgrade notification server</p> </li> <li> <p>(Optional) Refer here to upgrade SeaDoc server</p> </li> </ol>"},{"location":"upgrade/upgrade_docker/","title":"Upgrade Seafile Docker","text":"<p>For maintenance upgrade, like from version 10.0.1 to version 10.0.4, just download the new image, stop the old docker container, modify the Seafile image version in docker-compose.yml to the new version, then start with docker compose up.</p> <p>For major version upgrade, like from 10.0 to 11.0, see instructions below.</p> <p>Please check the upgrade notes for any special configuration or changes before/while upgrading.</p>"},{"location":"upgrade/upgrade_docker/#upgrade-from-120-to-130","title":"Upgrade from 12.0 to 13.0","text":"<p>From Seafile Docker 13.0, the <code>elasticsearch.yml</code> has separated from <code>seafile-server.yml</code>, and Seafile will support getting cache configuration from environment variables</p>"},{"location":"upgrade/upgrade_docker/#step-1-stop-the-services","title":"Step 1) Stop the services:","text":"<p>Before upgrading, please shutdown you Seafile server</p> <pre><code>docker compose down\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-2-download-the-newest-yml-files","title":"Step 2) Download the newest <code>.yml</code> files","text":""},{"location":"upgrade/upgrade_docker/#step-21-download-seafile-serveryml","title":"Step 2.1) Download <code>seafile-server.yml</code>","text":"<p>Before downloading the newest <code>seafile-server.yml</code>, please backup your original one:</p> <pre><code>mv seafile-server.yml seafile-server.yml.bak\n</code></pre> <p>Then download the new <code>seafile-server.yml</code> according to the following commands:</p> Seafile community editionSeafile Pro edition <pre><code>wget https://manual.seafile.com/13.0/repo/docker/ce/seafile-server.yml\n</code></pre> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/pro/seafile-server.yml\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-22-download-yml-file-for-notification-server","title":"Step 2.2) Download <code>.yml</code> file for notification server","text":"Deployment with SeafileStandalone deployment <pre><code>wget https://manual.seafile.com/13.0/repo/docker/notification-server.yml\n</code></pre> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/notification-server/notification-server.yml\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-23-download-yml-file-for-search-engine-pro-edition","title":"Step 2.3) Download <code>.yml</code> file for search engine (Pro edition)","text":"ElasticSearchSeaSearch <p>From Seafile Docker 13.0 (Pro), the ElasticSearch service will be controlled by a separate resource file (i.e., <code>elasticsearch.yml</code>). If you are using Seafile Pro and still plan to use ElasticSearch, please download the <code>elasticsearch.yml</code>:</p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/pro/elasticsearch.yml\n</code></pre> <p>If you are using SeaSearch as the search engine, please download the newest <code>seasearch.yml</code> file:</p> <pre><code>mv seasearch.yml seasearch.yml.bak\nwget https://manual.seafile.com/13.0/repo/docker/pro/seasearch.yml\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-24-download-yml-file-for-seadoc-optional","title":"Step 2.4) Download <code>.yml</code> file for SeaDoc (optional)","text":"<p>If you use SeaDoc extension, the seadoc.yml file need to be updated too: </p> <pre><code>wget https://manual.seafile.com/13.0/repo/docker/seadoc.yml\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-3-modify-env-update-image-version-and-add-cache-configurations","title":"Step 3) Modify <code>.env</code>, update image version and add cache configurations","text":""},{"location":"upgrade/upgrade_docker/#step-31-update-image-version-to-seafile-13","title":"Step 3.1) Update image version to Seafile 13","text":"Seafile CESeafile Pro <pre><code>SEAFILE_IMAGE=seafileltd/seafile-mc:13.0-latest\nSEADOC_IMAGE=seafileltd/sdoc-server:2.0-latest\nNOTIFICATION_SERVER_IMAGE=seafileltd/notification-server:13.0-latest\n</code></pre> <pre><code># -- add `elasticsearch.yml` if you are still using ElasticSearch\n# COMPOSE_FILE='...,elasticsearch.yml'\n\n# -- if you are using SeaSearch, please also update the SeaSearch image\n# SEASEARCH_IMAGE=seafileltd/seasearch:1.0-latest # or seafileltd/seasearch-nomkl:1.0-latest for Apple chips\n\nSEAFILE_IMAGE=seafileltd/seafile-pro-mc:13.0-latest\nSEADOC_IMAGE=seafileltd/sdoc-server:2.0-latest\nNOTIFICATION_SERVER_IMAGE=seafileltd/notification-server:13.0-latest\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-32-add-configurations-for-cache","title":"Step 3.2) Add configurations for cache","text":"<p>From Seafile 13, the configurations of database and cache can be set via environment variables directly (you can define it in the <code>.env</code>). What's more, the Redis will be recommended as the primary cache server for supporting some new features (please refer the upgradte notes, you can also refer to more details about Redis in Seafile Docker here).</p> RedisMemcached <pre><code>## Cache\nCACHE_PROVIDER=redis\n\n### Redis\nREDIS_HOST=redis\nREDIS_PORT=6379\nREDIS_PASSWORD=\n</code></pre> <pre><code>## Cache\nCACHE_PROVIDER=memcached\n\n### Memcached\nMEMCACHED_HOST=memcached\nMEMCACHED_PORT=11211\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-33-add-configuration-for-notification-server","title":"Step 3.3)  Add configuration for notification server","text":"<p>If you are using notification server in Seafile 12, please specify the notification server url in <code>.env</code>:</p> Deploy in the same host with SeafileStandalone deployment <pre><code>ENABLE_NOTIFICATION_SERVER=true\n</code></pre> <pre><code>ENABLE_NOTIFICATION_SERVER=true\nNOTIFICATION_SERVER_URL=http://&lt;your notification server host&gt;:8083\nINNER_NOTIFICATION_SERVER_URL=$NOTIFICATION_SERVER_URL\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-34-add-configurations-for-storage-backend-pro","title":"Step 3.4) Add configurations for storage backend (Pro)","text":"<p>Seafile 13.0 add a new environment <code>SEAF_SERVER_STORAGE_TYPE</code> to determine the storage backend of seaf-server component. You can delete the variable or set it to empty (<code>SEAF_SERVER_STORAGE_TYPE=</code>) to use the old way, i.e., determining the storage backend from seafile.conf.</p> Local disk (default)S3 backendMultiple storage backendsUse the configuration in <code>seafile.conf</code> <p>Set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>disk</code> (default value):</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=disk\n</code></pre> <p>Set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>s3</code>, and add your s3 configurations:</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=s3\n\nS3_COMMIT_BUCKET=&lt;your commit bucket name&gt;\nS3_FS_BUCKET=&lt;your fs bucket name&gt;\nS3_BLOCK_BUCKET=&lt;your block bucket name&gt;\nS3_SS_BUCKET=&lt;your seasearch bucket name&gt; # for seasearch\nS3_MD_BUCKET=&lt;your metadata bucket name&gt; # for metadata-server\nS3_KEY_ID=&lt;your-key-id&gt;\nS3_SECRET_KEY=&lt;your-secret-key&gt;\nS3_USE_V4_SIGNATURE=true\nS3_PATH_STYLE_REQUEST=false\nS3_AWS_REGION=us-east-1\nS3_HOST=\nS3_USE_HTTPS=true\nS3_SSE_C_KEY=\n</code></pre> <p>Set <code>SEAF_SERVER_STORAGE_TYPE</code> to <code>multiple</code>. In this case, you don't need to change the storage configuration in <code>seafile.conf</code>.</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=multiple\n</code></pre> <p>If you would like to use the storage configuration in <code>seafile.conf</code>, please remove default value of <code>SEAF_SERVER_STORAGE_TYPE</code> in <code>.env</code>:</p> <pre><code>SEAF_SERVER_STORAGE_TYPE=\n</code></pre>"},{"location":"upgrade/upgrade_docker/#step-4-remove-obsolete-configurations","title":"Step 4) Remove obsolete configurations","text":"<p>Although the configurations in environment (i.e., <code>.env</code>) have higher priority than the configurations in config files, we recommend that you remove or modify the cache configuration in the following files to avoid ambiguity:</p> <ol> <li> <p>Backup the old configuration files:</p> <pre><code># please replace /opt/seafile-data to your $SEAFILE_VOLUME\n\ncp /opt/seafile-data/seafile/conf/seafile.conf /opt/seafile-data/seafile/conf/seafile.conf.bak\ncp /opt/seafile-data/seafile/conf/seahub_settings.py /opt/seafile-data/seafile/conf/seahub_settings.py.bak\n</code></pre> </li> <li> <p>Clean up redundant configuration items in the configuration files:</p> <ul> <li>Open <code>/opt/seafile-data/seafile/conf/seafile.conf</code> and remove the entire <code>[memcached]</code>, <code>[database]</code>, <code>[commit_object_backend]</code>, <code>[fs_object_backend]</code>, <code>[notification]</code> and <code>[block_backend]</code> if above sections have correctly specified in <code>.env</code>.</li> <li>Open <code>/opt/seafile-data/seafile/conf/seahub_settings.py</code> and remove the entire blocks for <code>DATABASES = {...}</code> and <code>CAHCES = {...}</code></li> </ul> <p>In the most cases, the <code>seafile.conf</code> only include the listen port <code>8082</code> of Seafile file server.</p> </li> </ol>"},{"location":"upgrade/upgrade_docker/#step-5-start-seafile","title":"Step 5) Start Seafile","text":"<pre><code>docker compose up -d\n</code></pre>"},{"location":"upgrade/upgrade_docker/#upgrade-from-110-to-120","title":"Upgrade from 11.0 to 12.0","text":"<p>Note: If you have a large number of <code>Activity</code> in MySQL, clear this table first Clean Database. Otherwise, the database upgrade will take a long time.</p> <p>From Seafile Docker 12.0, we recommend that you use <code>.env</code> and <code>seafile-server.yml</code> files for configuration.</p>"},{"location":"upgrade/upgrade_docker/#backup-the-original-docker-composeyml-file","title":"Backup the original docker-compose.yml file:","text":"<pre><code>mv docker-compose.yml docker-compose.yml.bak\n</code></pre>"},{"location":"upgrade/upgrade_docker/#download-seafile-120-docker-files","title":"Download Seafile 12.0 Docker files","text":"<p>Download <code>.env</code>, <code>seafile-server.yml</code> and <code>caddy.yml</code>, and modify <code>.env</code> file according to the old configuration in <code>docker-compose.yml.bak</code></p> Seafile community editionSeafile pro edition <p><pre><code>wget -O .env https://manual.seafile.com/12.0/repo/docker/ce/env\nwget https://manual.seafile.com/12.0/repo/docker/ce/seafile-server.yml\nwget https://manual.seafile.com/12.0/repo/docker/caddy.yml\n</code></pre> The following fields merit particular attention:</p> Variable Description Default Value <code>SEAFILE_VOLUME</code> The volume directory of Seafile data <code>/opt/seafile-data</code> <code>SEAFILE_MYSQL_VOLUME</code> The volume directory of MySQL data <code>/opt/seafile-mysql/db</code> <code>SEAFILE_CADDY_VOLUME</code> The volume directory of Caddy data used to store certificates obtained from Let's Encrypt's <code>/opt/seafile-caddy</code> <code>SEAFILE_MYSQL_DB_USER</code> The user of MySQL (<code>database</code> - <code>user</code> can be found in <code>conf/seafile.conf</code>) <code>seafile</code> <code>SEAFILE_MYSQL_DB_PASSWORD</code> The user <code>seafile</code> password of MySQL (required) <code>SEAFILE_MYSQL_DB_CCNET_DB_NAME</code> The database name of ccnet <code>ccnet_db</code> <code>SEAFILE_MYSQL_DB_SEAFILE_DB_NAME</code> The database name of seafile <code>seafile_db</code> <code>SEAFILE_MYSQL_DB_SEAHUB_DB_NAME</code> The database name of seahub <code>seahub_db</code> <code>JWT_PRIVATE_KEY</code> JWT_PRIVATE_KEY, A random string with a length of no less than 32 characters is required for Seafile, which can be generated by using <code>pwgen -s 40 1</code> (required) <code>SEAFILE_SERVER_HOSTNAME</code> Seafile server hostname or domain (required) <code>SEAFILE_SERVER_PROTOCOL</code> Seafile server protocol (http or https) <code>http</code> <code>TIME_ZONE</code> Time zone <code>UTC</code> <p><pre><code>wget -O .env https://manual.seafile.com/12.0/repo/docker/pro/env\nwget https://manual.seafile.com/12.0/repo/docker/pro/seafile-server.yml\nwget https://manual.seafile.com/12.0/repo/docker/caddy.yml\n</code></pre> The following fields merit particular attention:</p> Variable Description Default Value <code>SEAFILE_VOLUME</code> The volume directory of Seafile data <code>/opt/seafile-data</code> <code>SEAFILE_MYSQL_VOLUME</code> The volume directory of MySQL data <code>/opt/seafile-mysql/db</code> <code>SEAFILE_CADDY_VOLUME</code> The volume directory of Caddy data used to store certificates obtained from Let's Encrypt's <code>/opt/seafile-caddy</code> <code>SEAFILE_ELASTICSEARCH_VOLUME</code> (Only valid for Seafile PE) The volume directory of Elasticsearch data <code>/opt/seafile-elasticsearch/data</code> <code>SEAFILE_MYSQL_DB_USER</code> The user of MySQL (<code>database</code> - <code>user</code> can be found in <code>conf/seafile.conf</code>) <code>seafile</code> <code>SEAFILE_MYSQL_DB_PASSWORD</code> The user <code>seafile</code> password of MySQL (required) <code>JWT_PRIVATE_KEY</code> JWT_PRIVATE_KEY, A random string with a length of no less than 32 characters is required for Seafile, which can be generated by using <code>pwgen -s 40 1</code> (required) <code>SEAFILE_SERVER_HOSTNAME</code> Seafile server hostname or domain (required) <code>SEAFILE_SERVER_PROTOCOL</code> Seafile server protocol (http or https) <code>http</code> <code>TIME_ZONE</code> Time zone <code>UTC</code> <p>Note</p> <ul> <li>The value of the variables in the above table should be identical to your existing installation. You should check them from the existing configuration files (e.g., <code>seafile.conf</code>).</li> <li>For variables used to initialize configurations (e.g., <code>INIT_SEAFILE_MYSQL_ROOT_PASSWORD</code>, <code>INIT_SEAFILE_ADMIN_EMAIL</code>, <code>INIT_SEAFILE_ADMIN_PASSWORD</code>), you can remove it in the <code>.env</code> file.</li> </ul> <p>SSL is now handled by the caddy server. If you have used SSL before, you will also need modify the seafile.nginx.conf. Change server listen 443 to 80.</p> <p>Backup the original seafile.nginx.conf file:</p> <pre><code>cp seafile.nginx.conf seafile.nginx.conf.bak\n</code></pre> <p>Remove the <code>server listen 80</code> section:</p> <pre><code>#server {\n#    listen 80;\n#    server_name _ default_server;\n\n    # allow certbot to connect to challenge location via HTTP Port 80\n    # otherwise renewal request will fail\n#    location /.well-known/acme-challenge/ {\n#        alias /var/www/challenges/;\n#        try_files $uri =404;\n#    }\n\n#    location / {\n#        rewrite ^ https://seafile.example.com$request_uri? permanent;\n#    }\n#}\n</code></pre> <p>Change <code>server listen 443</code> to <code>80</code>:</p> <pre><code>server {\n#listen 443 ssl;\nlisten 80;\n\n#    ssl_certificate      /shared/ssl/pkg.seafile.top.crt;\n#    ssl_certificate_key  /shared/ssl/pkg.seafile.top.key;\n\n#    ssl_ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS;\n\n   ...\n</code></pre> <p>Start with docker compose up.</p>"},{"location":"upgrade/upgrade_docker/#upgrade-notification-server","title":"Upgrade notification server","text":"<p>If you has deployed the notification server. The Notification Server is now moved to its own Docker image. You need to redeploy it according to Notification Server document</p>"},{"location":"upgrade/upgrade_docker/#upgrade-seadoc-from-08-to-10-for-seafile-v120","title":"Upgrade SeaDoc from 0.8 to 1.0 for Seafile v12.0","text":"<p>If you have deployed SeaDoc v0.8 with Seafile v11.0, you can upgrade it to 1.0 use the following steps:</p> <ol> <li>Delete sdoc_db.</li> <li>Remove SeaDoc configs in seafile.nginx.conf file.</li> <li>Re-deploy SeaDoc server. In other words, delete the old SeaDoc deployment and deploy a new SeaDoc server.</li> </ol>"},{"location":"upgrade/upgrade_docker/#delete-sdoc_db","title":"Delete sdoc_db","text":"<p>From version 1.0, SeaDoc is using seahub_db database to store its operation logs and no longer need an extra database sdoc_db. The database tables in seahub_db are created automatically when you upgrade Seafile server from v11.0 to v12.0. You can simply delete sdoc_db.</p>"},{"location":"upgrade/upgrade_docker/#remove-seadoc-configs-in-seafilenginxconf-file","title":"Remove SeaDoc configs in seafile.nginx.conf file","text":"<p>If you have deployed SeaDoc older version, you should remove <code>/sdoc-server/</code>, <code>/socket.io</code> configs in seafile.nginx.conf file.</p> <pre><code>#    location /sdoc-server/ {\n#        add_header Access-Control-Allow-Origin *;\n#        add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;\n#        add_header Access-Control-Allow-Headers \"deviceType,token, authorization, content-type\";\n#        if ($request_method = 'OPTIONS') {\n#            add_header Access-Control-Allow-Origin *;\n#            add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS;\n#            add_header Access-Control-Allow-Headers \"deviceType,token, authorization, content-type\";\n#            return 204;\n#        }\n#        proxy_pass         http://sdoc-server:7070/;\n#        proxy_redirect     off;\n#        proxy_set_header   Host              $host;\n#        proxy_set_header   X-Real-IP         $remote_addr;\n#        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;\n#        proxy_set_header   X-Forwarded-Host  $server_name;\n#        proxy_set_header   X-Forwarded-Proto $scheme;\n#        client_max_body_size 100m;\n#    }\n#    location /socket.io {\n#        proxy_pass http://sdoc-server:7070;\n#        proxy_http_version 1.1;\n#        proxy_set_header Upgrade $http_upgrade;\n#        proxy_set_header Connection 'upgrade';\n#        proxy_redirect off;\n#        proxy_buffers 8 32k;\n#        proxy_buffer_size 64k;\n#        proxy_set_header X-Real-IP $remote_addr;\n#        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n#        proxy_set_header Host $http_host;\n#        proxy_set_header X-NginX-Proxy true;\n#    }\n</code></pre>"},{"location":"upgrade/upgrade_docker/#deploy-a-new-seadoc-server","title":"Deploy a new SeaDoc server","text":"<p>Please see the document Setup SeaDoc to install SeaDoc with Seafile.</p>"},{"location":"upgrade/upgrade_docker/#other-configuration-changes","title":"Other configuration changes","text":""},{"location":"upgrade/upgrade_docker/#enable-passing-of-remote_user","title":"Enable passing of REMOTE_USER","text":"<p>REMOTE_USER header is not passed to Seafile by default, you need to change <code>gunicorn.conf.py</code> if you need REMOTE_USER header for SSO.</p> <pre><code>forwarder_headers = 'SCRIPT_NAME,PATH_INFO,REMOTE_USER'\n</code></pre>"},{"location":"upgrade/upgrade_docker/#supplement-or-remove-allowed_hosts-in-seahub_settingspy","title":"Supplement or remove ALLOWED_HOSTS in seahub_settings.py","text":"<p>Since version 12.0, the seaf-server component need to send internal requests to seahub component to check permissions, as reporting 400 Error when downloading files if the <code>ALLOWED_HOSTS</code> set incorrect. In this case, you can either remove <code>ALLOWED_HOSTS</code> in <code>seahub_settings.py</code> or supplement <code>127.0.0.1</code> in <code>ALLOWED_HOSTS</code> list:</p> <pre><code># seahub_settings.py\n\nALLOWED_HOSTS = ['...(your domain)', '127.0.0.1']\n</code></pre>"},{"location":"upgrade/upgrade_docker/#upgrade-from-100-to-110","title":"Upgrade from 10.0 to 11.0","text":"<p>Download the new image, stop the old docker container, modify the Seafile image version in docker-compose.yml to the new version. Taking the community edition as an example, you have to modify</p> <pre><code>...\nservice:\n    ...\n    seafile:\n        image: seafileltd/seafile-mc:10.0-latest\n        ...\n    ...\n</code></pre> <p>to</p> <pre><code>service:\n    ...\n    seafile:\n        image: seafileltd/seafile-mc:11.0-latest\n        ...\n    ...\n</code></pre> <p>It is also recommended that you upgrade mariadb and memcached to newer versions as in the v11.0 docker-compose.yml file. Specifically, in version 11.0, we use the following versions:</p> <ul> <li>MariaDB: 10.11</li> <li>Memcached: 1.6.18</li> </ul> <p>What's more, you have to migrate configuration for LDAP and OAuth according to here</p> <p>Start with docker compose up.</p>"},{"location":"upgrade/upgrade_docker/#upgrade-from-90-to-100","title":"Upgrade from 9.0 to 10.0","text":"<p>Just download the new image, stop the old docker container, modify the Seafile image version in docker-compose.yml to the new version, then start with docker compose up.</p> <p>If you are using pro edition with ElasticSearch, SAML SSO and storage backend features, follow the upgrading manual on how to update the configuration for these features.</p> <p>If you want to use the new notification server and rate control (pro edition only), please refer to the upgrading manual.</p>"},{"location":"upgrade/upgrade_docker/#upgrade-from-80-to-90","title":"Upgrade from 8.0 to 9.0","text":"<p>Just download the new image, stop the old docker container, modify the Seafile image version in docker-compose.yml to the new version, then start with docker compose up.</p>"},{"location":"upgrade/upgrade_docker/#lets-encrypt-ssl-certificate","title":"Let's encrypt SSL certificate","text":"<p>Since version 9.0.6, we use Acme V3 (not acme-tiny) to get certificate.</p> <p>If there is a certificate generated by an old version, you need to back up and move the old certificate directory and the seafile.nginx.conf before starting.</p> <pre><code>mv /opt/seafile/shared/ssl /opt/seafile/shared/ssl-bak\n\nmv /opt/seafile/shared/nginx/conf/seafile.nginx.conf /opt/seafile/shared/nginx/conf/seafile.nginx.conf.bak\n</code></pre> <p>Starting the new container will automatically apply a certificate.</p> <pre><code>docker compose down\ndocker compose up -d\n</code></pre> <p>Please wait a moment for the certificate to be applied, then you can modify the new seafile.nginx.conf as you want. Execute the following command to make the nginx configuration take effect.</p> <pre><code>docker exec seafile nginx -s reload\n</code></pre> <p>A cron job inside the container will automatically renew the certificate.</p>"},{"location":"upgrade/upgrade_notes_for_10.0.x/","title":"Upgrade notes for 10.0","text":"<p>These notes give additional information about changes. Please always follow the main upgrade guide.</p> <p>For docker based version, please check upgrade Seafile Docker image</p>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#important-release-changes","title":"Important release changes","text":""},{"location":"upgrade/upgrade_notes_for_10.0.x/#enable-notification-server","title":"Enable notification server","text":"<p>The notification server enables desktop syncing and drive clients to get notification of library changes immediately using websocket. There are two benefits:</p> <ol> <li>Reduce the time for syncing new changes to local</li> <li>Reduce the load of the server as periodically pulling is removed. There are significant reduction of load when you have 1000+ clients. </li> </ol> <p>The notification server works with Seafile syncing client 9.0+ and drive client 3.0+.</p> <p>Please follow the document to enable notification server</p>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#memcached-section-in-the-seafileconf-pro-edition-only","title":"Memcached section in the seafile.conf (pro edition only)","text":"<p>If you use storage backend or cluster, make sure the memcached section is in the seafile.conf.</p> <p>Since version 10.0, all memcached options are consolidated to the one below.</p> <p>Modify the seafile.conf:</p> <pre><code>[memcached]\nmemcached_options = --SERVER=&lt;the IP of Memcached Server&gt; --POOL-MIN=10 --POOL-MAX=100\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#saml-sso-change-pro-edition-only","title":"SAML SSO change (pro edition only)","text":"<p>The configuration for SAML SSO in Seafile is greatly simplified. Now only three options are needed:</p> <pre><code>ENABLE_ADFS_LOGIN = True\nLOGIN_REDIRECT_URL = '/saml2/complete/'\nSAML_REMOTE_METADATA_URL = 'https://login.microsoftonline.com/xxx/federationmetadata/2007-06/federationmetadata.xml?appid=xxx'\nSAML_ATTRIBUTE_MAPPING = {\n    'name': ('display_name', ),\n    'mail': ('contact_email', ),\n    ...\n}\n</code></pre> <p>Please check the new document on SAML SSO</p>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#rate-control-in-role-settings-pro-edition-only","title":"Rate control in role settings (pro edition only)","text":"<p>Starting from version 10.0, Seafile allows administrators to configure upload and download speed limits for users with different roles through the following two steps:</p> <ol> <li>Configuring rate limiting for different roles in <code>seahub_settings.py</code>.</li> </ol> <pre><code>ENABLED_ROLE_PERMISSIONS = {\n    'default': {\n    ...\n        'upload_rate_limit': 2000,  # unit: kb/s\n        'download_rate_limit': 4000,\n    ...\n    },\n    'guest': {\n    ...\n        'upload_rate_limit': 100,\n        'download_rate_limit': 200,\n    ...\n    },\n}\n</code></pre> <ol> <li>Run the following command in the <code>seafile-server-latest</code> directory to make the configuration take effect.</li> </ol> <pre><code>./seahub.sh python-env python3 seahub/manage.py set_user_role_upload_download_rate_limit\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#elasticsearch-change-pro-edition-only","title":"ElasticSearch change (pro edition only)","text":"<p>Elasticsearch is upgraded to version 8.x, fixed and improved some issues of file search function.</p> <p>Since elasticsearch 7.x, the default number of shards has changed from 5 to 1, because too many index shards will over-occupy system resources; but when a single shard data is too large, it will also reduce search performance. Starting from version 10.0, Seafile supports customizing the number of shards in the configuration file.</p> <p>You can use the following command to query the current size of each shard to determine the best number of shards for you:</p> <pre><code>curl 'http{s}://&lt;es IP&gt;:9200/_cat/shards/repofiles?v'\n</code></pre> <p>The official recommendation is that the size of each shard should be between 10G-50G: https://www.elastic.co/guide/en/elasticsearch/reference/8.6/size-your-shards.html#shard-size-recommendation.</p> <p>Modify the seafevents.conf:</p> <pre><code>[INDEX FILES]\n...\nshards = 10     # default is 5\n...\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#new-python-libraries","title":"New Python libraries","text":"<p>Note, you should install Python libraries system wide using root user or sudo mode.</p> <p>For Ubuntu 20.04/22.04</p> <pre><code>sudo pip3 install future==0.18.* mysqlclient==2.1.* pillow==10.2.* captcha==0.5.* django_simple_captcha==0.5.20 djangosaml2==1.5.* pysaml2==7.2.* pycryptodome==3.16.* cffi==1.15.1\n</code></pre> <p>For Debian 11</p> <pre><code>su pip3 install future==0.18.* mysqlclient==2.1.* pillow==9.3.* captcha==0.4 django_simple_captcha==0.5.* djangosaml2==1.5.* pysaml2==7.2.* pycryptodome==3.16.* cffi==1.15.1\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#upgrade-to-100x","title":"Upgrade to 10.0.x","text":"<ol> <li> <p>Stop Seafile-9.0.x server.</p> </li> <li> <p>Start from Seafile 10.0.x, run the script:</p> <pre><code>upgrade/upgrade_9.0_10.0.sh\n</code></pre> </li> </ol> <p>If you are using pro edtion, modify memcached option in seafile.conf and SAML SSO configuration if needed.</p> <ol> <li>Start Seafile-10.0.x server.</li> </ol>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#update-elasticsearch-pro-edition-only","title":"Update Elasticsearch (pro edition only)","text":"<p>You can choose one of the methods to upgrade your index data.</p>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#method-one-reindex-the-old-index-data","title":"Method one, reindex the old index data","text":"<p>1. Download Elasticsearch image:</p> <pre><code>docker pull elasticsearch:7.17.9\n</code></pre> <p>Create a new folder to store ES data and give the folder permissions:</p> <pre><code>mkdir -p /opt/seafile-elasticsearch/data  &amp;&amp; chmod -R 777 /opt/seafile-elasticsearch/data/\n</code></pre> <p>Start ES docker image:</p> <pre><code>sudo docker run -d --name es-7.17 -p 9200:9200  -e \"discovery.type=single-node\" -e \"bootstrap.memory_lock=true\" -e \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" -e \"xpack.security.enabled=false\" --restart=always -v /opt/seafile-elasticsearch/data:/usr/share/elasticsearch/data -d elasticsearch:7.17.9\n</code></pre> <p>PS: <code>ES_JAVA_OPTS</code> can be adjusted according to your need.</p> <p>2. Create an index with 8.x compatible mappings:</p> <pre><code># create repo_head index\ncurl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/repo_head_8?pretty=true' -d '\n{\n  \"mappings\" : {\n    \"properties\" : {\n      \"commit\" : {\n        \"type\" : \"keyword\",\n        \"index\" : false\n      },\n      \"repo\" : {\n        \"type\" : \"keyword\",\n        \"index\" : false\n      },\n      \"updatingto\" : {\n        \"type\" : \"keyword\",\n        \"index\" : false\n      }\n    }\n  }\n}'\n\n# create repofiles index, number_of_shards is the number of shards, here is set to 5, you can also modify it to the most suitable number of shards\ncurl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/repofiles_8/?pretty=true' -d '\n{\n  \"settings\" : {\n    \"index\" : {\n      \"number_of_shards\" : \"5\",\n      \"analysis\" : {\n        \"analyzer\" : {\n          \"seafile_file_name_ngram_analyzer\" : {\n            \"filter\" : [\n              \"lowercase\"\n            ],\n            \"type\" : \"custom\",\n            \"tokenizer\" : \"seafile_file_name_ngram_tokenizer\"\n          }\n        },\n        \"tokenizer\" : {\n          \"seafile_file_name_ngram_tokenizer\" : {\n            \"type\" : \"ngram\",\n            \"min_gram\" : \"3\",\n            \"max_gram\" : \"4\"\n          }\n        }\n      }\n    }\n  },\n  \"mappings\" : {\n    \"properties\" : {\n      \"content\" : {\n        \"type\" : \"text\",\n        \"term_vector\" : \"with_positions_offsets\"\n      },\n      \"filename\" : {\n        \"type\" : \"text\",\n        \"fields\" : {\n          \"ngram\" : {\n            \"type\" : \"text\",\n            \"analyzer\" : \"seafile_file_name_ngram_analyzer\"\n          }\n        }\n      },\n      \"is_dir\" : {\n        \"type\" : \"boolean\"\n      },\n      \"mtime\" : {\n        \"type\" : \"date\"\n      },\n      \"path\" : {\n        \"type\" : \"keyword\"\n      },\n      \"repo\" : {\n        \"type\" : \"keyword\"\n      },\n      \"size\" : {\n        \"type\" : \"long\"\n      },\n      \"suffix\" : {\n        \"type\" : \"keyword\"\n      }\n    }\n  }\n}'\n</code></pre> <p>3. Set the <code>refresh_interval</code> to <code>-1</code> and the <code>number_of_replicas</code> to <code>0</code> for efficient reindex:</p> <pre><code>curl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/repo_head_8/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : \"-1\",\n    \"number_of_replicas\" : 0\n  }\n}'\n\ncurl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/repofiles_8/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : \"-1\",\n    \"number_of_replicas\" : 0\n  }\n}'\n</code></pre> <p>4. Use the reindex API to copy documents from the 7.x index into the new index:</p> <pre><code>curl -X POST -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/_reindex/?wait_for_completion=false&amp;pretty=true' -d '\n{\n  \"source\": {\n    \"index\": \"repo_head\"\n  },\n  \"dest\": {\n    \"index\": \"repo_head_8\"\n  }\n}'\n\ncurl -X POST -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/_reindex/?wait_for_completion=false&amp;pretty=true' -d '\n{\n  \"source\": {\n    \"index\": \"repofiles\"\n  },\n  \"dest\": {\n    \"index\": \"repofiles_8\"\n  }\n}'\n</code></pre> <p>5. Use the following command to check if the reindex task is complete:</p> <pre><code># Get the task_id of the reindex task:\n$ curl 'http{s}://{es server IP}:9200/_tasks?actions=*reindex&amp;pretty'\n# Check to see if the reindex task is complete:\n$ curl 'http{s}://{es server IP}:9200/_tasks/:&lt;task_id&gt;?pretty'\n</code></pre> <p>6. Reset the <code>refresh_interval</code> and <code>number_of_replicas</code> to the values used in the old index:</p> <pre><code>curl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/repo_head_8/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : null,\n    \"number_of_replicas\" : 1\n  }\n}'\n\ncurl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/repofiles_8/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : null,\n    \"number_of_replicas\" : 1\n  }\n}'\n</code></pre> <p>7. Wait for the elasticsearch status to change to <code>green</code> (or <code>yellow</code> if it is a single node).</p> <pre><code>curl 'http{s}://{es server IP}:9200/_cluster/health?pretty'\n</code></pre> <p>8. Use the aliases API delete the old index and add an alias with the old index name to the new index:</p> <pre><code>curl -X POST -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/_aliases?pretty' -d '\n{\n  \"actions\": [\n    {\"remove_index\": {\"index\": \"repo_head\"}},\n    {\"remove_index\": {\"index\": \"repofiles\"}},\n    {\"add\": {\"index\": \"repo_head_8\", \"alias\": \"repo_head\"}},\n    {\"add\": {\"index\": \"repofiles_8\", \"alias\": \"repofiles\"}}\n  ]\n}'\n</code></pre> <p>9. Deactivate the 7.17 container, pull the 8.x image and run:</p> <pre><code>$ docker stop es-7.17\n\n$ docker rm es-7.17\n\n$ docker pull elasticsearch:8.6.2\n\n$ sudo docker run -d --name es -p 9200:9200 -e \"discovery.type=single-node\" -e \"bootstrap.memory_lock=true\" -e \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" -e \"xpack.security.enabled=false\" --restart=always -v /opt/seafile-elasticsearch/data:/usr/share/elasticsearch/data -d elasticsearch:8.6.2\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#method-two-rebuild-the-index-and-discard-the-old-index-data","title":"Method two, rebuild the index and discard the old index data","text":"<p>1. Pull Elasticsearch image:</p> <pre><code>docker pull elasticsearch:8.5.3\n</code></pre> <p>Create a new folder to store ES data and give the folder permissions:</p> <pre><code>mkdir -p /opt/seafile-elasticsearch/data  &amp;&amp; chmod -R 777 /opt/seafile-elasticsearch/data/\n</code></pre> <p>Start ES docker image:</p> <pre><code>sudo docker run -d --name es -p 9200:9200 -e \"discovery.type=single-node\" -e \"bootstrap.memory_lock=true\" -e \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" -e \"xpack.security.enabled=false\" --restart=always -v /opt/seafile-elasticsearch/data:/usr/share/elasticsearch/data -d elasticsearch:8.5.3\n</code></pre> <p>2. Modify the seafevents.conf:</p> <pre><code>[INDEX FILES]\n...\nexternal_es_server = true\nes_host = http{s}://{es server IP}\nes_port = 9200\nshards = 10   # default is 5.\n...\n</code></pre> <p>Restart Seafile server:</p> <pre><code>su seafile\ncd seafile-server-latest/\n./seafile.sh stop &amp;&amp; ./seahub.stop \n./seafile.sh start &amp;&amp; ./seahub.start\n</code></pre> <p>3. Delete old index data</p> <pre><code>rm -rf /opt/seafile-elasticsearch/data/*\n</code></pre> <p>4. Create new index data:</p> <pre><code>$ cd /opt/seafile/seafile-server-latest\n$ ./pro/pro.py search --update\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_10.0.x/#method-three-if-you-are-in-a-cluster-environment","title":"Method three, if you are in a cluster environment","text":"<p>1. Deploy elasticsearch 8.x according to method two. Use Seafile 10.0 version to deploy a new backend node and modify the <code>seafevents.conf</code> file. The background node does not start the Seafile background service, just manually run the command <code>./pro/pro.py search --update</code>.</p> <p>2. Upgrade the other nodes to Seafile 10.0 version and use the new Elasticsearch 8.x server.</p> <p>3. Then deactivate the old backend node and the old version of Elasticsearch.</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/","title":"Upgrade notes for 11.0","text":"<p>These notes give additional information about changes. Please always follow the main upgrade guide.</p> <p>For docker based version, please check upgrade Seafile Docker image</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#important-release-changes","title":"Important release changes","text":""},{"location":"upgrade/upgrade_notes_for_11.0.x/#change-of-user-identity","title":"Change of user identity","text":"<p>Previous Seafile versions directly used a user's email address or SSO identity as their internal user ID.</p> <p>Seafile 11.0 introduces virtual user IDs - random, internal identifiers like \"adc023e7232240fcbb83b273e1d73d36@auth.local\". For new users, a virtual ID will be generated instead of directly using their email. A mapping between the email and virtual ID will be stored in the \"profile_profile\" database table. For SSO users,the mapping between SSO ID and virtual ID is stored in the \"social_auth_usersocialauth\" table.</p> <p>Overall this brings more flexibility to handle user accounts and identity changes. Existing users will use the same old ID.</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#reimplementation-of-ldap-integration","title":"Reimplementation of LDAP Integration","text":"<p>Previous Seafile versions handled LDAP authentication in the ccnet-server component. In Seafile 11.0, LDAP is reimplemented within the Seahub Python codebase.</p> <p>LDAP configuration has been moved from ccnet.conf to seahub_settings.py. The ccnet_db.LDAPImported table is no longer used - LDAP users are now stored in ccnet_db.EmailUsers along with other users.</p> <p>Benefits of this new implementation:</p> <ul> <li>Improved compatibility across different systems. Python code is more portable than the previous C implementation.</li> <li>Consistent handling of users whether they login via LDAP or other methods like email/password.</li> </ul> <p>You need to run <code>migrate_ldapusers.py</code> script to merge ccnet_db.LDAPImported table to ccnet_db.EmailUsers table. The setting files need to be changed manually. (See more details below)</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#oauth-authentication-and-other-sso-methods","title":"OAuth authentication and other SSO methods","text":"<p>If you use OAuth authentication, the configuration need to be changed a bit.</p> <p>If you use SAML, you don't need to change configuration files. For SAML2, in version 10, the name_id field is returned from SAML server, and is used as the username (the email field in ccnet_dbEmailUser). In version 11, for old users, Seafile will find the old user and create a name_id to name_id mapping in social_auth_usersocialauth. For new users, Seafile will create a new user with random ID and add a name_id to the random ID mapping in social_auth_usersocialauth. In addition, we have added a feature where you can configure to disable login with a username and password for saml users by using the config of <code>DISABLE_ADFS_USER_PWD_LOGIN = True</code> in seahub_settings.py.</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#dropped-sqlite-database-support","title":"Dropped SQLite Database Support","text":"<p>Seafile 11.0 dropped using SQLite as the database. It is better to migrate from SQLite database to MySQL database before upgrading to version 11.0.</p> <p>There are several reasons driving this change:</p> <ul> <li>Focus on collaborative features - SQLite's limitations make advanced concurrency and locking difficult, which collaborative editing requires. Different Seafile components need simultaneous database access. Especially after adding seafevents component in version 11.0 for the community edition.</li> <li>Docker deployments - Our official Docker images do not support SQLite. MySQL is the preferred option.</li> <li>Migration difficulties - Migrating SQLite databases to MySQL via SQL translation is unreliable.</li> </ul> <p>To migrate from SQLite database to MySQL database, you can follow the document Migrate from SQLite to MySQL. If you have issues in the migration, just post a thread in our forum. We are glad to help you.</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#elasticsearch-change-pro-edition-only","title":"ElasticSearch change (pro edition only)","text":"<p>Elasticsearch version is not changed in Seafile version 11.0</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#new-saml-prerequisites-multi_tenancy-only","title":"New SAML prerequisites (MULTI_TENANCY only)","text":"<p>For Ubuntu 20.04/22.04</p> <pre><code>sudo apt-get update\nsudo apt-get install -y dnsutils\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#django-csrf-protection-issue","title":"Django CSRF protection issue","text":"<p>Django 4.* has introduced a new check for the origin http header in CSRF verification. It now compares the values of the origin field in HTTP header and the host field in HTTP header. If they are different, an error is triggered.</p> <p>If you deploy Seafile behind a proxy, or if you use a non-standard port, or if you deploy Seafile in cluster, it is likely the origin field in HTTP header received by Django and the host field in HTTP header received by Django are different. Because the host field in HTTP header is likely to be modified by proxy. This mismatch results in a CSRF error.</p> <p>You can add CSRF_TRUSTED_ORIGINS to seahub_settings.py to solve the problem:</p> <pre><code>CSRF_TRUSTED_ORIGINS = [\"https://&lt;your-domain&gt;\"]\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#new-python-libraries","title":"New Python libraries","text":"<p>Note, you should install Python libraries system wide using root user or sudo mode.</p> <p>For Ubuntu 20.04/22.04</p> <pre><code>sudo apt-get update\nsudo apt-get install -y python3-dev ldap-utils libldap2-dev\n\nsudo pip3 install future==0.18.* mysqlclient==2.1.* pillow==10.2.* sqlalchemy==2.0.18 captcha==0.5.* django_simple_captcha==0.6.* djangosaml2==1.5.* pysaml2==7.2.* pycryptodome==3.16.* cffi==1.15.1 python-ldap==3.4.3\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#upgrade-to-110x","title":"Upgrade to 11.0.x","text":""},{"location":"upgrade/upgrade_notes_for_11.0.x/#1-stop-seafile-100x-server","title":"1) Stop Seafile-10.0.x server.","text":""},{"location":"upgrade/upgrade_notes_for_11.0.x/#2-start-from-seafile-110x-run-the-script","title":"2) Start from Seafile 11.0.x, run the script:","text":"<pre><code>upgrade/upgrade_10.0_11.0.sh\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#3modify-configurations-and-migrate-ldap-records","title":"3\uff09Modify configurations and migrate LDAP records","text":""},{"location":"upgrade/upgrade_notes_for_11.0.x/#change-configurations-for-ldap","title":"Change configurations for LDAP","text":"<p>The configuration items of LDAP login and LDAP sync tasks are migrated from ccnet.conf to seahub_settings.py. The name of the configuration item is based on the 10.0 version, and the characters 'LDAP_' or 'MULTI_LDAP_1' are added. Examples are as follows:</p> <pre><code># Basic configuration items for LDAP login\nENABLE_LDAP = True\nLDAP_SERVER_URL = 'ldap://192.168.0.125'     # The URL of LDAP server\nLDAP_BASE_DN = 'ou=test,dc=seafile,dc=ren'   # The root node of users who can \n                                             # log in to Seafile in the LDAP server\nLDAP_ADMIN_DN = 'administrator@seafile.ren'  # DN of the administrator used \n                                             # to query the LDAP server for information\nLDAP_ADMIN_PASSWORD = 'Hello@123'            # Password of LDAP_ADMIN_DN\nLDAP_PROVIDER = 'ldap'                       # Identify the source of the user, used in \n                                             # the table social_auth_usersocialauth, defaults to 'ldap'\nLDAP_LOGIN_ATTR = 'userPrincipalName'        # User's attribute used to log in to Seafile, \n                                             # can be mail or userPrincipalName, cannot be changed\nLDAP_FILTER = 'memberOf=CN=testgroup,OU=test,DC=seafile,DC=ren'  # Additional filter conditions,\n                                                                 # users who meet the filter conditions can log in, otherwise they cannot log in\n# For update user info when login\nLDAP_CONTACT_EMAIL_ATTR = ''             # For update user's contact_email\nLDAP_USER_ROLE_ATTR = ''                 # For update user's role\nLDAP_USER_FIRST_NAME_ATTR = 'givenName'  # For update user's first name\nLDAP_USER_LAST_NAME_ATTR = 'sn'          # For update user's last name\nLDAP_USER_NAME_REVERSE = False           # Whether to reverse the user's first and last name\n</code></pre> <p>The following configuration items are only for Pro Edition: <pre><code># Configuration items for LDAP sync tasks.\nLDAP_SYNC_INTERVAL = 60                  # LDAP sync task period, in minutes\n\n# LDAP user sync configuration items.\nENABLE_LDAP_USER_SYNC = True             # Whether to enable user sync\nLDAP_USER_OBJECT_CLASS = 'person'        # This is the name of the class used to search for user objects. \n                                         # In Active Directory, it's usually \"person\". The default value is \"person\".\nLDAP_DEPT_ATTR = ''                      # LDAP user's department info\nLDAP_UID_ATTR = ''                       # LDAP user's login_id attribute\nLDAP_AUTO_REACTIVATE_USERS = True        # Whether to auto activate deactivated user\nLDAP_USE_PAGED_RESULT = False            # Whether to use pagination extension\nIMPORT_NEW_USER = True                   # Whether to import new users when sync user\nACTIVATE_USER_WHEN_IMPORT = True         # Whether to activate the user when importing new user\nENABLE_EXTRA_USER_INFO_SYNC = True       # Whether to enable sync of additional user information,\n                                         # including user's full name, contact_email, department, and Windows login name, etc.\nDEACTIVE_USER_IF_NOTFOUND = False        # Set to \"true\" if you want to deactivate a user \n                                         # when he/she was deleted in AD server.\n\n# LDAP group sync configuration items.\nENABLE_LDAP_GROUP_SYNC = True            # Whether to enable group sync\nLDAP_GROUP_FILTER = ''                   # Group sync filter\nLDAP_SYNC_DEPARTMENT_FROM_OU = True      # Whether to enable sync departments from OU.\nLDAP_GROUP_OBJECT_CLASS = 'group'        # This is the name of the class used to search for group objects.\nLDAP_GROUP_MEMBER_ATTR = 'member'        # The attribute field to use when loading the group's members. \n                                         # For most directory servers, the attributes is \"member\" \n                                         # which is the default value.For \"posixGroup\", it should be set to \"memberUid\".\nLDAP_USER_ATTR_IN_MEMBERUID = 'uid'      # The user attribute set in 'memberUid' option, \n                                         # which is used in \"posixGroup\".The default value is \"uid\".\nLDAP_GROUP_UUID_ATTR = 'objectGUID'      # Used to uniquely identify groups in LDAP\nLDAP_USE_GROUP_MEMBER_RANGE_QUERY = False   # When a group contains too many members, \n                                            # AD will only return part of them. Set this option to TRUE\n                                            # to make LDAP sync work with large groups.\nLDAP_SYNC_GROUP_AS_DEPARTMENT = False    # Whether to sync groups as top-level departments in Seafile\nLDAP_DEPT_NAME_ATTR = ''                 # Used to get the department name.\nLDAP_CREATE_DEPARTMENT_LIBRARY = False   # If you decide to sync the group as a department,\n                                         # you can set this option to \"true\". In this way, when \n                                         # the group is synchronized for the first time, a library\n                                         # is automatically created for the department, and the \n                                         # library's name is the department's name.\nLDAP_DEPT_REPO_PERM = 'rw'               # Set the permissions of the department repo, default permission is 'rw'.\nLDAP_DEFAULT_DEPARTMENT_QUOTA = -2       # You can set a default space quota for each department\n                                         # when you synchronize a group for the first time. The \n                                         # quota is set to unlimited if this option is not set.\n                                         # Unit is MB.\nDEL_GROUP_IF_NOT_FOUND = False           # Set to \"true\", sync process will delete the group if not found it in LDAP server.\nDEL_DEPARTMENT_IF_NOT_FOUND = False      # Set to \"true\", sync process will deleted the department if not found it in LDAP server.\n</code></pre></p> <p>If you sync users from LDAP to Seafile, when the user login via SSO (ADFS or OAuth or Shibboleth), you want Seafile to find the existing account for this user instead of creating a new one, you can set <code>SSO_LDAP_USE_SAME_UID = True</code>:</p> <pre><code>SSO_LDAP_USE_SAME_UID = True\n</code></pre> <p>Note, here the UID means the unique user ID, in LDAP it is the attribute you use for <code>LDAP_LOGIN_ATTR</code> (not <code>LDAP_UID_ATTR</code>), in ADFS it is <code>uid</code> attribute. You need make sure you use the same attribute for the two settings.</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#migrate-ldap-records","title":"Migrate LDAP records","text":"<p>Run the following script to migrate users in <code>LDAPImported</code> to <code>EmailUsers</code></p> <pre><code>cd &lt;install-path&gt;/seafile-server-latest\npython3 migrate_ldapusers.py\n</code></pre> <p>For Seafile docker</p> <pre><code>docker exec -it seafile /usr/bin/python3 /opt/seafile/seafile-server-latest/migrate_ldapusers.py\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#change-configuration-for-oauth","title":"Change configuration for OAuth:","text":"<p>In the new version, the OAuth login configuration should keep the email attribute unchanged to be compatible with new and old user logins. In version 11.0, a new uid attribute is added to be used as a user's external unique ID. The uid will be stored in social_auth_usersocialauth to map to internal virtual ID. For old users, the original  email is used the internal virtual ID. The example is as follows:</p> <pre><code># Version 10.0 or earlier\nOAUTH_ATTRIBUTE_MAP = {\n    \"id\": (True, \"email\"),\n    \"name\": (False, \"name\"),\n    \"email\": (False, \"contact_email\"),\n}\n\n# Since 11.0 version, added 'uid' attribute.\nOAUTH_ATTRIBUTE_MAP = {\n    \"id\": (True, \"email\"),  # In the new version, the email attribute configuration should be kept unchanged to be compatible with old and new user logins\n    \"uid\": (True, \"uid\"),   # Seafile use 'uid' as the external unique identifier of the user. Different OAuth systems have different attributes, which may be: 'uid' or 'username', etc.\n    \"name\": (False, \"name\"),\n    \"email\": (False, \"contact_email\"),\n}\n</code></pre> <p>When a user login, Seafile will first use \"id -&gt; email\" map to find the old user and then create \"uid -&gt; uid\" map for this old user. After all users login once, you can delete the configuration  <code>\"id\": (True, \"email\")</code>. You can also manully add records in social_auth_usersocialauth to map extenral uid to old users.</p>"},{"location":"upgrade/upgrade_notes_for_11.0.x/#4-start-seafile-110x-server","title":"4) Start Seafile-11.0.x server.","text":""},{"location":"upgrade/upgrade_notes_for_11.0.x/#faq","title":"FAQ","text":"<p>We have documented common issues encountered by users when upgrading to version 11.0 in our FAQ https://cloud.seatable.io/dtable/external-links/7b976c85f504491cbe8e/?tid=0000&amp;vid=0000.</p> <p>If you encounter any issue, please give it a check. </p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/","title":"Upgrade notes for 12.0","text":"<ul> <li> <p>These notes give additional information about changes. Please always follow the main upgrade guide.</p> </li> <li> <p>For docker based version, please check upgrade Seafile Docker image</p> </li> </ul>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#important-release-changes","title":"Important release changes","text":"<p>Seafile version 12.0 has following major changes:</p> <ul> <li>A redesigned Web UI</li> <li>SeaDoc is now stable, providing online notes and documents feature</li> <li>A new wiki module</li> <li>A new trash mechanism, that deleted files will be recorded in database for fast listing. In the old version, deleted files are scanned from library history, which is slow.</li> <li>Community edition now also support online GC (because SQLite support is dropped)</li> </ul> <p>Configuration changes:</p> <ul> <li>Notification server is now packaged into its own docker image.</li> <li>For binary package based installation, a new <code>.env</code> file is needed to contain some configuration items. These configuration items need to be shared by different components in Seafile. We name it <code>.env</code> to be consistant with docker based installation.</li> <li>The password strength level is now calculated by algorithm. The old USER_PASSWORD_MIN_LENGTH, USER_PASSWORD_STRENGTH_LEVEL is removed. Only USER_STRONG_PASSWORD_REQUIRED is still used.</li> <li>ADDITIONAL_APP_BOTTOM_LINKS is removed. Because there is no buttom bar in the navigation side bar now.</li> <li>SERVICE_URL and FILE_SERVER_ROOT are removed. SERVICE_URL will be calculated from SEAFILE_SERVER_PROTOCOL and SEAFILE_SERVER_HOSTNAME in <code>.env</code> file.</li> <li><code>ccnet.conf</code> is removed. Some of its configuration items are moved from <code>.env</code> file, others are read from items in <code>seafile.conf</code> with same name.</li> <li>Two role permissions are added, <code>can_create_wiki</code> and <code>can_publish_wiki</code> are used to control whether a role can create a Wiki and publish a Wiki. The old role permission <code>can_publish_repo</code> is removed.</li> <li>REMOTE_USER header is not passed to Seafile by default, you need to change <code>gunicorn.conf.py</code> if you need REMOTE_USER header for SSO.</li> </ul> <p>Other changes:</p> <ul> <li>A new lightweight and fast search engine, SeaSearch. SeaSearch is optional, you can still use ElasticSearch.</li> </ul> <p>Breaking changes</p> <ul> <li>For security reason, WebDAV no longer support login with LDAP account, the user with LDAP account must generate a WebDAV token at the profile page</li> <li>[File tags] The current file tags feature is deprecated. We will re-implement a new one in version 13.0 with a new general metadata management module.</li> <li>For ElasticSearch based search, full text search of doc/xls/ppt file types are no longer supported. This enable us to remove Java dependency in Seafile side.</li> <li>The search dialog now support loading more items when scroll down and the original separate detailed file search page is no longer used</li> <li>The right side panel is redesigned and the seldom used file comments feature in the panel is removed</li> </ul> <p>Deploying Seafile with binary package is now deprecated and probably no longer be supported in version 13.0. We recommend you to migrate your existing Seafile deployment to docker based.</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#elasticsearch-change-pro-edition-only","title":"ElasticSearch change (pro edition only)","text":"<p>Elasticsearch version is not changed in Seafile version 12.0</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#new-system-libraries","title":"New system libraries","text":"Ubuntu 24.04/22.04Debian 11 <pre><code>apt-get install -y default-libmysqlclient-dev build-essential pkg-config libmemcached-dev\n</code></pre> <pre><code>apt-get install -y libsasl2-dev\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#new-python-libraries","title":"New Python libraries","text":"<p>Note, you should install Python libraries system wide using root user or sudo mode.</p> Ubuntu 24.04 / Debian 12Ubuntu 22.04 / Debian 11 <pre><code>sudo pip3 install future==1.0.* mysqlclient==2.2.* pillow==10.4.* sqlalchemy==2.0.* pillow_heif==0.18.0 \\\ngevent==24.2.* captcha==0.6.* django_simple_captcha==0.6.* djangosaml2==1.9.* \\\npysaml2==7.3.* pycryptodome==3.20.* cffi==1.17.0 python-ldap==3.4.*\n</code></pre> <pre><code>sudo pip3 install future==1.0.* mysqlclient==2.1.* pillow==10.4.* sqlalchemy==2.0.* pillow_heif==0.18.0 \\\ngevent==24.2.* captcha==0.6.* django_simple_captcha==0.6.* djangosaml2==1.9.* \\\npysaml2==7.2.* pycryptodome==3.16.* cffi==1.15.1 python-ldap==3.2.0\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#upgrade-to-120-for-binary-installation","title":"Upgrade to 12.0 (for binary installation)","text":"<p>The following instruction is for binary package based installation. If you use Docker based installation, please see Upgrade Docker</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#1-clean-database-tables-before-upgrade","title":"1) Clean database tables before upgrade","text":"<p>If you have a large number of <code>Activity</code> in MySQL, clear this table first Clean Database. Otherwise, the database upgrade will take a long time.</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#2-install-new-system-libraries-and-python-libraries","title":"2) Install new system libraries and Python libraries","text":"<p>Install new system libraries and Python libraries for your operation system as documented above.</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#3-stop-seafile-110x-server","title":"3) Stop Seafile-11.0.x server","text":"<p>In the folder of Seafile 11.0.x, run the commands:</p> <pre><code>./seahub.sh stop\n./seafile.sh stop\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#4-run-seafile-120x-upgrade-script","title":"4) Run Seafile 12.0.x upgrade script","text":"<p>In the folder of Seafile 12.0.x, run the upgrade script</p> <pre><code>upgrade/upgrade_11.0_12.0.sh\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#5-create-the-env-file-in-conf-directory","title":"5) Create the <code>.env</code> file in <code>conf/</code> directory","text":"<p>conf/.env</p> <pre><code>TIME_ZONE=UTC\nJWT_PRIVATE_KEY=xxx\nSEAFILE_SERVER_PROTOCOL=https\nSEAFILE_SERVER_HOSTNAME=seafile.example.com\nSEAFILE_MYSQL_DB_HOST=db # your MySQL host\nSEAFILE_MYSQL_DB_PORT=3306\nSEAFILE_MYSQL_DB_USER=seafile\nSEAFILE_MYSQL_DB_PASSWORD=&lt;your MySQL password&gt;\nSEAFILE_MYSQL_DB_CCNET_DB_NAME=ccnet_db\nSEAFILE_MYSQL_DB_SEAFILE_DB_NAME=seafile_db\nSEAFILE_MYSQL_DB_SEAHUB_DB_NAME=seahub_db\n</code></pre> <p>Tip</p> <p>JWT_PRIVATE_KEY, A random string with a length of no less than 32 characters, can be generated by</p> <pre><code>pwgen -s 40 1\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#6-start-seafile-120x-server","title":"6) Start Seafile-12.0.x server","text":"<p>In the folder of Seafile 12.0.x, run the command:</p> <pre><code>./seafile.sh start # starts seaf-server\n./seahub.sh start  # starts seahub\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#7-optional-upgrade-notification-server","title":"7) (Optional) Upgrade notification server","text":"<p>Since seafile 12.0, we use docker to deploy the notification server. Please follow the document of notification server to re-deploy notification server.</p> <p>Note</p> <p>Notification server is designed to be work with Docker based deployment. To make it work with Seafile binary package on the same server, you will need to add Nginx rules for notification server properly.</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#8-optional-upgrade-seadoc-from-08-to-10","title":"8) (Optional) Upgrade SeaDoc from 0.8 to 1.0","text":"<p>If you have deployed SeaDoc v0.8 with Seafile v11.0, you can upgrade it to 1.0 use the following two steps:</p> <ol> <li>Delete sdoc_db.</li> <li>Re-deploy SeaDoc server. In other words, delete the old SeaDoc deployment and re-deploy a new SeaDoc server.</li> </ol> <p>SeaDoc and Seafile binary package</p> <p>Deploying SeaDoc and Seafile binary package on the same server is no longer officially supported. You will need to add Nginx rules for SeaDoc server properly.</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#81-delete-sdoc_db","title":"8.1) Delete sdoc_db","text":"<p>From version 1.0, SeaDoc is using seahub_db database to store its operation logs and no longer need an extra database sdoc_db. The database tables in seahub_db are created automatically when you upgrade Seafile server from v11.0 to v12.0. You can simply delete sdoc_db.</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#82-deploy-a-new-seadoc-server","title":"8.2) Deploy a new SeaDoc server","text":"<p>Please see the document Setup SeaDoc to install SeaDoc on a separate machine and integrate with your binary packaged based Seafile server v12.0.</p>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#9-optional-update-gunicornconfpy-file-in-conf-directory","title":"9) (Optional) Update <code>gunicorn.conf.py</code> file in <code>conf/</code> directory","text":"<p>If you deployed single sign on (SSO) by Shibboleth protocol, the following line should be added to the gunicorn config file.</p> <pre><code>forwarder_headers = 'SCRIPT_NAME,PATH_INFO,REMOTE_USER'\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#10-optional-other-configuration-changes","title":"10) (Optional) Other configuration changes","text":""},{"location":"upgrade/upgrade_notes_for_12.0.x/#enable-passing-of-remote_user","title":"Enable passing of REMOTE_USER","text":"<p>REMOTE_USER header is not passed to Seafile by default, you need to change <code>gunicorn.conf.py</code> if you need REMOTE_USER header for SSO.</p> <pre><code>forwarder_headers = 'SCRIPT_NAME,PATH_INFO,REMOTE_USER'\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#supplement-or-remove-allowed_hosts-in-seahub_settingspy","title":"Supplement or remove ALLOWED_HOSTS in seahub_settings.py","text":"<p>Since version 12.0, the seaf-server component need to send internal requests to seahub component to check permissions, as reporting 400 Error when downloading files if the <code>ALLOWED_HOSTS</code> set incorrect. In this case, you can either remove <code>ALLOWED_HOSTS</code> in <code>seahub_settings.py</code> or supplement <code>127.0.0.1</code> in <code>ALLOWED_HOSTS</code> list:</p> <pre><code># seahub_settings.py\n\nALLOWED_HOSTS = ['...(your domain)', '127.0.0.1']\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_12.0.x/#faq","title":"FAQ","text":"<p>We have documented common issues encountered by users when upgrading to version 12.0 in our FAQ https://cloud.seatable.io/dtable/external-links/7b976c85f504491cbe8e/?tid=0000&amp;vid=0000.</p> <p>If you encounter any issue, please give it a check.</p>"},{"location":"upgrade/upgrade_notes_for_13.0.x/","title":"Upgrade notes for 13.0","text":"<ul> <li> <p>These notes give additional information about changes. Please always follow the main upgrade guide.</p> </li> <li> <p>For docker based version, please check upgrade Seafile Docker image</p> </li> </ul>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#important-release-changes","title":"Important release changes","text":"<p>Seafile version 13.0 has following major changes:</p> <ul> <li>SeaDoc: SeaDoc is now version 2.0, beside support sdoc, it support whiteboard too</li> <li>Thumbnail server: A new thumbnail server component is added to improve performance for thumbnail generating and support thumbnail for videos</li> <li>Metadata server: A new metadata server component is avaible to manage extended file properties</li> <li>Notification server: The web interface now support real-time update when other people add or remove files if notification-server is enabled</li> <li>SeaSearch: SeaSearch is now version 1.0 and support full-text search</li> </ul> <p>Configuration changes:</p> <ul> <li>Database and memcache configurations are added to <code>.env</code>, it is recommended to use environment variables to config database and memcache</li> <li>Redis is recommended to be used as memcache server</li> <li>(Optional) S3 configuration can be done via environment variables and is much simplified</li> <li>Elastic search is now have its own yml file</li> </ul> <p>Breaking changes</p> <ul> <li>For security reason, WebDAV no longer support login with LDAP account, the user with LDAP account must generate a WebDAV token at the profile page</li> <li>[File tags] The old file tags feature can no longer be used, the interface provide an upgrade notice for migrate the data to the new file tags feature</li> </ul> <p>Deploying Seafile with binary package is no longer supported for community edition. We recommend you to migrate your existing Seafile deployment to docker based.</p>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#elasticsearch-change-pro-edition-only","title":"ElasticSearch change (pro edition only)","text":"<p>Elasticsearch version is not changed in Seafile version 13.0</p>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#new-system-libraries-to-be-updated","title":"New system libraries (TO be updated)","text":"Ubuntu 24.04/22.04Debian 11 <pre><code>apt-get install -y default-libmysqlclient-dev build-essential pkg-config libmemcached-dev\n</code></pre> <pre><code>apt-get install -y libsasl2-dev\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#new-python-libraries-to-be-updated","title":"New Python libraries (TO be updated)","text":"<p>Note, you should install Python libraries system wide using root user or sudo mode.</p> Ubuntu 24.04 / Debian 12Ubuntu 22.04 / Debian 11 <pre><code>sudo pip3 install future==1.0.* mysqlclient==2.2.* pillow==10.4.* sqlalchemy==2.0.* pillow_heif==0.18.0 \\\ngevent==24.2.* captcha==0.6.* django_simple_captcha==0.6.* djangosaml2==1.9.* \\\npysaml2==7.3.* pycryptodome==3.20.* cffi==1.17.0 python-ldap==3.4.*\n</code></pre> <pre><code>sudo pip3 install future==1.0.* mysqlclient==2.1.* pillow==10.4.* sqlalchemy==2.0.* pillow_heif==0.18.0 \\\ngevent==24.2.* captcha==0.6.* django_simple_captcha==0.6.* djangosaml2==1.9.* \\\npysaml2==7.2.* pycryptodome==3.16.* cffi==1.15.1 python-ldap==3.2.0\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#upgrade-to-130-for-binary-installation","title":"Upgrade to 13.0 (for binary installation)","text":"<p>The following instruction is for binary package based installation. If you use Docker based installation, please see Updgrade Docker</p>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#1-clean-database-tables-before-upgrade","title":"1) Clean database tables before upgrade","text":"<p>If you have a large number of <code>Activity</code> in MySQL, clear this table first Clean Database. Otherwise, the database upgrade will take a long time.</p>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#2-install-new-system-libraries-and-python-libraries","title":"2) Install new system libraries and Python libraries","text":"<p>Install new system libraries and Python libraries for your operation system as documented above.</p>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#3-stop-seafile-110x-server","title":"3) Stop Seafile-11.0.x server","text":"<p>In the folder of Seafile 11.0.x, run the commands:</p> <pre><code>./seahub.sh stop\n./seafile.sh stop\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#4-run-seafile-120x-upgrade-script","title":"4) Run Seafile 12.0.x upgrade script","text":"<p>In the folder of Seafile 12.0.x, run the upgrade script</p> <pre><code>upgrade/upgrade_11.0_12.0.sh\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#5-create-the-env-file-in-conf-directory","title":"5) Create the <code>.env</code> file in <code>conf/</code> directory","text":"<p>conf/.env</p> <pre><code>TIME_ZONE=UTC\nJWT_PRIVATE_KEY=xxx\nSEAFILE_SERVER_PROTOCOL=https\nSEAFILE_SERVER_HOSTNAME=seafile.example.com\nSEAFILE_MYSQL_DB_HOST=db # your MySQL host\nSEAFILE_MYSQL_DB_PORT=3306\nSEAFILE_MYSQL_DB_USER=seafile\nSEAFILE_MYSQL_DB_PASSWORD=&lt;your MySQL password&gt;\nSEAFILE_MYSQL_DB_CCNET_DB_NAME=ccnet_db\nSEAFILE_MYSQL_DB_SEAFILE_DB_NAME=seafile_db\nSEAFILE_MYSQL_DB_SEAHUB_DB_NAME=seahub_db\n</code></pre> <p>Tip</p> <p>JWT_PRIVATE_KEY, A random string with a length of no less than 32 characters, can be generated by</p> <pre><code>pwgen -s 40 1\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#6-start-seafile-120x-server","title":"6) Start Seafile-12.0.x server","text":"<p>In the folder of Seafile 12.0.x, run the command:</p> <pre><code>./seafile.sh start # starts seaf-server\n./seahub.sh start  # starts seahub\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_13.0.x/#7-optional-upgrade-notification-server","title":"7) (Optional) Upgrade notification server","text":""},{"location":"upgrade/upgrade_notes_for_13.0.x/#8-optional-upgrade-seadoc-from-10-to-20","title":"8) (Optional) Upgrade SeaDoc from 1.0 to 2.0","text":""},{"location":"upgrade/upgrade_notes_for_13.0.x/#faq","title":"FAQ","text":"<p>We have documented common issues encountered by users when upgrading to version 12.0 in our FAQ https://cloud.seatable.io/dtable/external-links/7b976c85f504491cbe8e/?tid=0000&amp;vid=0000.</p> <p>If you encounter any issue, please give it a check.</p>"},{"location":"upgrade/upgrade_notes_for_9.0.x/","title":"Upgrade notes for 9.0","text":"<p>These notes give additional information about changes. Please always follow the main upgrade guide.</p>"},{"location":"upgrade/upgrade_notes_for_9.0.x/#important-release-changes","title":"Important release changes","text":"<p>9.0 version includes following major changes:</p> <ol> <li>SERVICE_URL is moved from ccnet.conf to seahub_settings.py. The upgrade script will read it from ccnet.conf and write to seahub_settings.py</li> <li>(pro edition only) ElasticSearch is upgraded to version 6.8. ElasticSearch needs to be installed and managed individually. (As ElasticSearch changes license since 6.2, it can no longer be included in Seafile package). There are some benefits for ElasticSearch to be managed individually:<ul> <li>Reduce the size of Seafile package</li> <li>You can change ElasticSearch setttings more easily</li> </ul> </li> <li>(pro edition only) The built-in Office file preview is now implemented by a separate docker image. This makes is more easy to maintain. We also suggest users to use OnlyOffice as an alternative.</li> <li>Seafile community edition package for CentOS is no longer maintained (pro editions will still be maintaied). We suggest users to migrate to Docker images.</li> <li>We rewrite HTTP service in seaf-server with golang and move it to a separate component (turn off by default)</li> </ol> <p>The new file-server written in golang serves HTTP requests to upload/download/sync files. It provides three advantages:</p> <ul> <li>The performance is better in a high-concurrency environment and it can handle long requests.</li> <li>Now you can sync libraries with large number of files.</li> <li>Now file zipping and downloading can be done simutaneously. When zip downloading a folder, you don't need to wait until zip is done.</li> <li>Support rate control for file uploading and downloading.</li> </ul> <p>You can turn golang file-server on by adding following configuration in seafile.conf</p> <pre><code>[fileserver]\nuse_go_fileserver = true\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_9.0.x/#new-python-libraries","title":"New Python libraries","text":"<p>Note, you should install Python libraries system wide using root user or sudo mode.</p> <ul> <li>For Ubuntu 18.04/20.04</li> </ul> <pre><code>sudo pip3 install pycryptodome==3.12.0 cffi==1.14.0\n</code></pre>"},{"location":"upgrade/upgrade_notes_for_9.0.x/#upgrade-to-90x","title":"Upgrade to 9.0.x","text":"<ol> <li>Stop Seafile-8.0.x server.</li> <li> <p>Start from Seafile 9.0.x, run the script:</p> <pre><code>upgrade/upgrade_8.0_9.0.sh\n</code></pre> </li> <li> <p>Start Seafile-9.0.x server.</p> </li> </ol>"},{"location":"upgrade/upgrade_notes_for_9.0.x/#update-elasticsearch-pro-edition-only","title":"Update ElasticSearch (pro edition only)","text":""},{"location":"upgrade/upgrade_notes_for_9.0.x/#method-one-rebuild-the-index-and-discard-the-old-index-data","title":"Method one, rebuild the index and discard the old index data","text":"<p>If your elasticsearch data is not large, it is recommended to deploy the latest 7.x version of ElasticSearch and then rebuild the new index. Specific steps are as follows</p> <p>Download ElasticSearch image</p> <pre><code>docker pull elasticsearch:7.16.2\n</code></pre> <p>Create a new folder to store ES data and give the folder permissions</p> <pre><code>mkdir -p /opt/seafile-elasticsearch/data  &amp;&amp; chmod -R 777 /opt/seafile-elasticsearch/data/\n</code></pre> <p>Note: You must properly grant permission to access the es data directory, and run the Elasticsearch container as the root user, refer to here.</p> <p>Start ES docker image</p> <pre><code>sudo docker run -d --name es -p 9200:9200 -e \"discovery.type=single-node\" -e \"bootstrap.memory_lock=true\" -e \"ES_JAVA_OPTS=-Xms2g -Xmx2g\" -e \"xpack.security.enabled=false\" --restart=always -v /opt/seafile-elasticsearch/data:/usr/share/elasticsearch/data -d elasticsearch:7.16.2\n</code></pre> <p>Delete old index data</p> <pre><code>rm -rf /opt/seafile/pro-data/search/data/*\n</code></pre> <p>Modify seafevents.conf</p> <pre><code>[INDEX FILES]\nexternal_es_server = true\nes_host = your server's IP (use 127.0.0.1 if deployed locally)\nes_port = 9200\n</code></pre> <p>Restart seafile</p> <pre><code>su seafile\ncd seafile-server-latest/\n./seafile.sh stop &amp;&amp; ./seahub.stop \n./seafile.sh start &amp;&amp; ./seahub.start \n</code></pre>"},{"location":"upgrade/upgrade_notes_for_9.0.x/#method-two-reindex-the-existing-data","title":"Method two, reindex the existing data","text":"<p>If your data volume is relatively large, it will take a long time to rebuild indexes for all Seafile databases, so you can reindex the existing data. This requires the following steps</p> <ul> <li>Download and start Elasticsearch 7.x</li> <li>Use the existing data to execute ElasticSearch Reindex in order to build an index that can be used in 7.x</li> </ul> <p>The detailed process is as follows</p> <p>Download ElasticSearch image:</p> <pre><code>docker pull elasticsearch:7.16.2\n</code></pre> <p>PS\uff1aFor seafile version 9.0, you need to manually create the elasticsearch mapping path on the host machine and give it 777 permission, otherwise elasticsearch will report path permission problems when starting, the command is as follows  </p> <pre><code>mkdir -p /opt/seafile-elasticsearch/data \n</code></pre> <p>Move original data to the new folder and give the folder permissions</p> <pre><code>mv  /opt/seafile/pro-data/search/data/*  /opt/seafile-elasticsearch/data/\nchmod -R 777 /opt/seafile-elasticsearch/data/\n</code></pre> <p>Note: You must properly grant permission to access the es data directory, and run the Elasticsearch container as the root user, refer to here.</p> <p>Start ES docker image</p> <pre><code>sudo docker run -d --name es -p 9200:9200 -e \"discovery.type=single-node\" -e \"bootstrap.memory_lock=true\" -e \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" -e \"xpack.security.enabled=false\" --restart=always -v /opt/seafile-elasticsearch/data:/usr/share/elasticsearch/data -d elasticsearch:7.16.2\n</code></pre> <p>Note:<code>ES_JAVA_OPTS</code> can be adjusted according to your need.</p> <p>Create an index with 7.x compatible mappings.</p> <pre><code>curl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/new_repo_head?include_type_name=false&amp;pretty=true' -d '\n{\n  \"mappings\" : {\n    \"properties\" : {\n      \"commit\" : {\n        \"type\" : \"text\",\n        \"index\" : false\n      },\n      \"repo\" : {\n        \"type\" : \"text\",\n        \"index\" : false\n      },\n      \"updatingto\" : {\n        \"type\" : \"text\",\n        \"index\" : false\n      }\n    }\n  }\n}'\n\ncurl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/new_repofiles/?include_type_name=false&amp;pretty=true' -d '\n{\n  \"settings\" : {\n    \"index\" : {\n      \"number_of_shards\" : 5,\n      \"number_of_replicas\" : 1,\n      \"analysis\" : {\n        \"analyzer\" : {\n          \"seafile_file_name_ngram_analyzer\" : {\n            \"filter\" : [\n              \"lowercase\"\n            ],\n            \"type\" : \"custom\",\n            \"tokenizer\" : \"seafile_file_name_ngram_tokenizer\"\n          }\n        },\n        \"tokenizer\" : {\n          \"seafile_file_name_ngram_tokenizer\" : {\n            \"type\" : \"ngram\",\n            \"min_gram\" : \"3\",\n            \"max_gram\" : \"4\"\n          }\n        }\n      }\n    }\n  },\n  \"mappings\" : {\n    \"properties\" : {\n      \"content\" : {\n        \"type\" : \"text\",\n        \"term_vector\" : \"with_positions_offsets\"\n      },\n      \"filename\" : {\n        \"type\" : \"text\",\n        \"fields\" : {\n          \"ngram\" : {\n            \"type\" : \"text\",\n            \"analyzer\" : \"seafile_file_name_ngram_analyzer\"\n          }\n        }\n      },\n      \"is_dir\" : {\n        \"type\" : \"boolean\"\n      },\n      \"mtime\" : {\n        \"type\" : \"date\"\n      },\n      \"path\" : {\n        \"type\" : \"keyword\"\n      },\n      \"repo\" : {\n        \"type\" : \"keyword\"\n      },\n      \"size\" : {\n        \"type\" : \"long\"\n      },\n      \"suffix\" : {\n        \"type\" : \"keyword\"\n      }\n    }\n  }\n}'\n</code></pre> <p>Set the <code>refresh_interval</code> to <code>-1</code> and the <code>number_of_replicas</code> to <code>0</code> for efficient reindexing:</p> <pre><code>curl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/new_repo_head/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : \"-1\",\n    \"number_of_replicas\" : 0\n  }\n}'\n\ncurl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/new_repofiles/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : \"-1\",\n    \"number_of_replicas\" : 0\n  }\n}'\n</code></pre> <p>Use the reindex API to copy documents from the 5.x index into the new index.</p> <pre><code>curl -X POST -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/_reindex/?pretty' -d '\n{\n  \"source\": {\n    \"index\": \"repo_head\",\n    \"type\": \"repo_commit\"\n  },\n  \"dest\": {\n    \"index\": \"new_repo_head\",\n    \"type\": \"_doc\"\n  }\n}'\n\ncurl -X POST -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/_reindex/?pretty' -d '\n{\n  \"source\": {\n    \"index\": \"repofiles\",\n    \"type\": \"file\"\n  },\n  \"dest\": {\n    \"index\": \"new_repofiles\",\n    \"type\": \"_doc\"\n  }\n}'\n</code></pre> <p>Reset the <code>refresh_interval</code> and <code>number_of_replicas</code> to the values used in the old index.</p> <pre><code>curl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/new_repo_head/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : null,\n    \"number_of_replicas\" : 1\n  }\n}'\n\ncurl -X PUT -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/new_repofiles/_settings?pretty' -d '\n{\n  \"index\" : {\n    \"refresh_interval\" : null,\n    \"number_of_replicas\" : 1\n  }\n}'\n</code></pre> <p>Wait for the index status to change to <code>green</code>.</p> <pre><code>curl http{s}://{es server IP}:9200/_cluster/health?pretty\n</code></pre> <p>Use the aliases API delete the old index and add an alias with the old index name to the new index.</p> <pre><code>curl -X POST -H 'Content-Type: application/json' 'http{s}://{es server IP}:9200/_aliases?pretty' -d '\n{\n  \"actions\": [\n    {\"remove_index\": {\"index\": \"repo_head\"}},\n    {\"remove_index\": {\"index\": \"repofiles\"}},\n    {\"add\": {\"index\": \"new_repo_head\", \"alias\": \"repo_head\"}},\n    {\"add\": {\"index\": \"new_repofiles\", \"alias\": \"repofiles\"}}\n  ]\n}'\n</code></pre> <p>After reindex, modify the configuration in Seafile.</p> <p>Modify seafevents.conf</p> <pre><code>[INDEX FILES]\nexternal_es_server = true\nes_host = your server's IP\nes_port = 9200\n</code></pre> <p>Restart seafile</p> <pre><code>su seafile\ncd seafile-server-latest/\n./seafile.sh stop &amp;&amp; ./seahub.stop \n./seafile.sh start &amp;&amp; ./seahub.start \n</code></pre>"},{"location":"upgrade/upgrade_notes_for_9.0.x/#method-three-if-you-are-in-a-cluster-environment","title":"Method three, if you are in a cluster environment","text":"<p>Deploy a new ElasticSeach 7.x service, use Seafile 9.0 version to deploy a new backend node, and connect to ElasticSeach 7.x. The background node does not start the Seafile background service, just manually run the command <code>./pro/pro.py search --update</code>, and then upgrade the other nodes to Seafile 9.0 version and use the new ElasticSeach 7.x after the index is created. Then deactivate the old backend node and the old version of ElasticSeach.</p>"}]}